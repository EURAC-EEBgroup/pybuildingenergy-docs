{"config":{"lang":["en","it"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"pybuildingenergy","text":"<p>Welcome to pybuildingenergy documentation!</p> <p>...</p>"},{"location":"iso_15316/","title":"Introduction to EN ISO 15316-1","text":""},{"location":"iso_15316/#overview","title":"Overview","text":"<p>ISO 15316-1 (equivalent to EN 15316-1 in Europe) defines the framework and general principles for calculating the energy performance of building heating and domestic hot water systems. It provides a systematic, modular approach that allows engineers, researchers, and software tools to evaluate and compare energy efficiency across different system configurations.</p> <p>This standard is part of the broader Energy Performance of Buildings (EPB) suite developed under the EU Energy Performance of Buildings Directive (EPBD).</p>"},{"location":"iso_15316/#scope","title":"Scope","text":"<p>The standard covers water-based heating and DHW systems where heat is generated, distributed, and emitted to maintain indoor comfort. It applies to: - Emission systems (radiators, floor heating, fan coils, etc.) - Distribution systems (piping, manifolds, circulation) - Storage components (thermal buffers, DHW tanks) - Generation systems (boilers, heat pumps, cogeneration)</p> <p>It does not include ventilation-only or purely air-based systems, except when heated by water circuits.</p>"},{"location":"iso_15316/#methodological-structure","title":"Methodological Structure","text":"<p>EN 15316-1 introduces a modular structure, dividing the entire heating system into interconnected subsystems:</p> <ol> <li>Emission (C.2\u2013C.5) \u2013 heat transfer from water to the indoor space  </li> <li>Distribution \u2013 transport of heat through pipes, including losses and auxiliaries  </li> <li>Storage \u2013 intermediate energy buffering or recovery  </li> <li>Generation \u2013 production of useful heat from a fuel or electricity source  </li> </ol> <p>Each module has its own energy balance:</p> \\[ \\text{Energy In} = \\text{Useful Output} + \\text{Losses} - \\text{Recoverable Losses} - \\text{Auxiliaries} \\] <p>The calculation proceeds in the direction:</p> \\[ \\text{Energy Needs (Building)} \\rightarrow \\text{Delivered Heat (Emission)} \\rightarrow \\text{Distribution} \\rightarrow \\text{Generation} \\rightarrow \\text{Primary Energy Input} \\] <p>This enables transparent energy tracking and consistent efficiency assessment across technologies.</p>"},{"location":"iso_15316/#objectives","title":"Objectives","text":"<p>The main objectives of ISO 15316-1 are to: - Provide a consistent calculation structure for all sub-systems in heating and DHW installations. - Define input and output data exchange between modules. - Enable comparability between different system types (e.g., boilers vs. heat pumps). - Serve as the reference method for EPB-compliant national calculation procedures.</p>"},{"location":"iso_15316/#key-principles","title":"Key Principles","text":"<ul> <li>System boundary definition \u2013 explicit separation of emission, distribution, storage, and generation.  </li> <li>Energy flow consistency \u2013 all sub-systems connect via clear input/output relationships.  </li> <li>Recoverable vs. non-recoverable losses \u2013 internal gains can offset building demand.  </li> <li>Auxiliary energy \u2013 electric or mechanical support energy is always accounted for.  </li> <li>Adaptability \u2013 compatible with both monthly and hourly calculation time steps.</li> </ul>"},{"location":"iso_15316/#benefits","title":"Benefits","text":"<ul> <li>Harmonized methodology for energy performance certificates, design tools, and research.  </li> <li>Facilitates diagnostic comparison of subsystems (e.g., identifying excessive distribution losses).  </li> <li>Supports policy implementation under EPBD and national building codes.  </li> <li>Enhances reproducibility and transparency in simulation and benchmarking.</li> </ul>"},{"location":"iso_15316/#relationship-with-subsequent-parts","title":"Relationship with Subsequent Parts","text":"<p>Part 1 provides the general framework only. Detailed formulas and reference values for each sub-system are defined in:</p> <ul> <li>EN 15316-2 \u2013 Emission and control (M3-5) </li> <li>EN 15316-3 \u2013 Distribution and control (M3 -6)  </li> <li>EN 15316-4 \u2013 Generation systems (M3-8) for different generator: <ul> <li>EN 15316-4-1 \u2013 Combustion boilers (M3-8-1) </li> <li>EN 15316-4-2 \u2013 Heat pumps (M3-8-2) </li> <li>EN 15316-4-3 \u2013 Thermal solar and photovoltaic (M3-8-3) </li> <li>EN 15316-4-4 \u2013 On-site cogeneration (M3-8-4) </li> <li>EN 15316-4-5 \u2013 District Heating and Cooling (M3-8-5) </li> <li>EN 15316-4-9 \u2013 Direct electrical heater (M3-8-6) </li> <li>EN 15316-4-8 \u2013 Radiant heating and stoves (M3-8-8) </li> </ul> </li> <li>EN 15316-5 \u2013 Storage and control (M3-7)  </li> </ul>"},{"location":"iso_15316/#references","title":"References","text":"<ul> <li>EN 15316-1:2017 \u2013 Energy performance of buildings \u2014 Method for calculation of system energy requirements and system efficiencies \u2014 Part 1: General and energy performance expression. </li> <li>REHVA (2017) \u2014 Information Paper: CEN Standards for Heating and Domestic Hot Water Systems. </li> <li>CENSE Project (EU) \u2014 Application of the EPBD Calculation Framework.</li> </ul>"},{"location":"iso_15316_calculation_procedure/","title":"CALCULATION PROCEDURE","text":"Note: THE ACTUAL CALCULATION OF PRIMARY ENRGY USING THE ISO 15316-1 IS FOR A SINGLE ZONE, IT IS NOT YET IMPLEMENTED THE CALCULATION FOR MULTIPLE ZONES.   <p>The calculation procedure follows the direction from the energy need to the source (building energy need -&gt; primary energy)</p> <p>Building Energy Need: The building energy need is calculated using the module ISO 52016. For more information refers to the module ISO 52016.</p> <p>HVAC System:Based on different type of system configuration (from type C2 to C5) the HVAC system is calculated using the ANNEX C of  ISO 15316-1. </p>"},{"location":"iso_15316_calculation_procedure/#description-of-functions","title":"Description of functions","text":""},{"location":"iso_15316_calculation_procedure/#heatingsystemcalculator-guida-e-commento-riga-per-riga-it","title":"HeatingSystemCalculator \u2014 Guida e commento riga-per-riga (IT)","text":"<p>Questa guida spiega cosa fa lo script e commenta ogni funzione, con enfasi su: - assunzioni, unit\u00e0 di misura e formule utilizzate; - struttura dei dati in ingresso/uscita; - flusso di calcolo per singolo passo e per serie temporali.</p> <p>Standard di riferimento: il calcolatore segue la logica della ISO 15316-1 per i sistemi di riscaldamento e supporta 4 tipologie di circuito di emissione (C.2, C.3, C.4, C.5).</p>"},{"location":"iso_15316_calculation_procedure/#1-panoramica-rapida","title":"1) Panoramica rapida","text":"<ul> <li>Classe principale: <code>HeatingSystemCalculator</code></li> <li>Input: un dizionario <code>input_data</code> con parametri di emissione, distribuzione e generazione (primario).</li> <li>Dati tabellari:</li> <li><code>TB14</code> (DF): tabella ISO con \u0394T nominali ed esponente n per il terminale (radiatori, pannelli, ecc.).     Se non fornita in <code>input_data[\"TB14\"]</code>, viene usato <code>TB14_backup</code> da <code>global_inputs</code>.</li> <li>Unit\u00e0 (principali):</li> <li>Energia: kWh (eccezione: <code>Q_H</code> pu\u00f2 arrivare in Wh e viene convertito)</li> <li>Potenza: kW, Perdite/Aux: kWh</li> <li>Portate volumetriche: m\u00b3/h</li> <li>Temperature: \u00b0C</li> <li>c_w: calore specifico dell\u2019acqua in Wh/(kg\u00b7K) (\u22481.16)</li> <li>Output:</li> <li>per singolo passo: dizionario con temperature, portate ed energie su emissione, distribuzione e generazione;</li> <li>per serie temporali: DataFrame orario/temporale con la stessa struttura.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#2-struttura-della-classe","title":"2) Struttura della classe","text":"<pre><code>class HeatingSystemCalculator:\n    \\\"\\\"\\\"Calcolatore secondo ISO 15316-1 con 4 tipologie C.2\u2013C.5.\\\"\\\"\\\"\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#__init__self-input_data","title":"<code>__init__(self, input_data)</code>","text":"<ul> <li>Cosa fa: salva l\u2019input, carica costanti e parametri richiamando <code>_load_constants()</code> e <code>_load_input_parameters()</code>.</li> <li>Attenzione: <code>input_data</code> guida tutto (policy di controllo, efficienza generatore, curve esterne, ecc.).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#3-caricamento-costanti-e-parametri","title":"3) Caricamento costanti e parametri","text":""},{"location":"iso_15316_calculation_procedure/#_load_constantsself","title":"<code>_load_constants(self)</code>","text":"<ul> <li>Scopo: carica i riferimenti globali e le costanti.</li> <li>Dettagli:</li> <li>Se <code>input_data[\"TB14\"]</code> \u00e8 un <code>pd.DataFrame</code>, usa quello; altrimenti usa <code>TB14_backup</code>.</li> <li>Imposta <code>c_w = 1.16</code> Wh/(kg\u00b7K).</li> <li>Perch\u00e9 serve: <code>TB14</code> fornisce \u0394T nominali ed esponente n per calcolare la relazione potenza \u2194 \u0394T aria-emettitore.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_load_input_parametersself","title":"<code>_load_input_parameters(self)</code>","text":"<ul> <li>Scopo: legge dal dizionario d\u2019ingresso i parametri di:</li> <li>Emissione (secondario): tipo emettitore, potenza nominale, efficienza, valvola di miscelazione, tipo di controllo della temperatura di mandata (domanda/esterna/costante), potenze ausiliarie, t operative, dati curva esterna secondaria.</li> <li>Distribuzione: recupero perdite, ausiliari, coefficiente di perdita [W/K], tempo in servizio, ecc.</li> <li>Generazione (primario): potenza a pieno carico, fattore di carico max, tempo in servizio, schema idraulico (direct o independent), controllo pompa, \u0394T nominale, setpoint opzionali, modello di efficienza del generatore (simple/parametric/manufacturer) e relative curve/parametri, controllo della mandata primaria (Type A/B/C) e curva esterna primaria.</li> <li>Note importanti:</li> <li><code>selected_emm_cont_circuit</code> \u2208 {0,1,2,3} \u2192 C.2/C.3/C.4/C.5.</li> <li>Policy Q_H \u2264 0: <code>calc_when_QH_positive_only</code> + <code>off_compute_mode</code> (<code>idle</code>/<code>temps</code>/<code>full</code>) decidono come trattare i periodi senza carico.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#4-tabelle-e-dati-di-default","title":"4) Tabelle e dati di default","text":""},{"location":"iso_15316_calculation_procedure/#_default_emission_dataself","title":"<code>_default_emission_data(self)</code>","text":"<ul> <li>Cosa fornisce: limiti/setpoint secondari (emissione): T mandata max, \u0394T max, T ritorno desiderata, fattore di carico con ON/OFF, T minima di mandata.</li> <li>Perch\u00e9: servono a vincolare il calcolo dell\u2019emettitore in funzione della domanda e del tipo C.2\u2013C.5.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_default_outdoor_dataself","title":"<code>_default_outdoor_data(self)</code>","text":"<ul> <li>Cosa fornisce: curva climatica secondaria (mandata min/max vs T esterna min/max).</li> <li>Uso: impiegata da <code>calculate_circuit_node_temperature</code> quando il controllo \u00e8 \u201cbasato su esterno\u201d.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#5-dati-di-serie-temporali","title":"5) Dati di serie temporali","text":""},{"location":"iso_15316_calculation_procedure/#load_csv_dataself-csv_path_or_df","title":"<code>load_csv_data(self, csv_path_or_df)</code>","text":"<ul> <li>Scopo: carica dati orari/temporali da CSV/DataFrame con colonne attese:</li> <li><code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> (alias supportati).</li> <li>Logica:</li> <li>Se presente <code>Q_H</code> in Wh, crea <code>Q_H_kWh = Q_H / 1000</code>.</li> <li>Salva in <code>self.timeseries_data</code>.</li> <li>Ritorna: DataFrame caricato.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#6-emissione-parametri-comuni","title":"6) Emissione \u2014 parametri comuni","text":""},{"location":"iso_15316_calculation_procedure/#calculate_common_emission_parametersself-heating_needs_kwh-int","title":"<code>calculate_common_emission_parameters(self, heating_needs_kWh, \u03b8int)</code>","text":"<ul> <li>Scopo: calcola grandezze comuni a C.2\u2013C.5:</li> <li>domanda netta (dopo perdite recuperabili di sistema),</li> <li>potenza media emessa <code>\u03a6H_em_eff</code> (kW) su <code>tH_em_i_ON</code>,</li> <li>perdite/ingressi di emissione, ausiliari,</li> <li>parametri nominali TB14: <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code>, portata nominale <code>V_H_em_nom</code>.</li> <li>Note:</li> <li><code>V_H_em_nom = \u03a6H_em_n / (\u0394\u03b8H_em_n * c_w)</code>.</li> <li>Calcola fattore di carico \u03b2 e tempo ON parziale per ausiliari.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#7-emissione-modelli-c2c3c4c5","title":"7) Emissione \u2014 modelli C.2/C.3/C.4/C.5","text":"<p>Tutti usano la relazione non lineare potenza \u2194 \u0394T aria-emettitore con esponente n da TB14.</p>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c2self-common_params-int-c2-portata-costante-t-acqua-costante","title":"<code>calculate_type_C2(self, common_params, \u03b8int)</code> \u2014 C.2: portata costante, T acqua costante","text":"<ul> <li>Usa <code>V_H_em_nom</code> come portata effettiva.</li> <li>Stima <code>\u0394\u03b8H_em_air_eff = \u0394\u03b8_air_nom * (\u03a6_eff/\u03a6_nom)^(1/n)</code>.</li> <li>Calcola <code>\u03b8H_em_avg</code>, quindi \u0394T acqua <code>\u0394\u03b8H_em_w_eff = \u03a6_eff / (c_w * V)</code> e da qui mandata/ritorno emettitore.</li> <li><code>\u03b8H_em_flw_min</code> include offset di miscelazione se <code>MIX_EM=True</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c3self-common_params-int-c3-portata-variabile-t-emettitore-costante-ritorno-vincolato","title":"<code>calculate_type_C3(self, common_params, \u03b8int)</code> \u2014 C.3: portata variabile, T emettitore costante (ritorno vincolato)","text":"<ul> <li>Fissa <code>\u03b8H_em_ret_set</code> (\u2265 <code>\u03b8int</code>), limita T mandata (<code>\u03b8H_em_flw_max</code>, \u0394T_w_max).</li> <li>Determina <code>\u03b8H_em_flw</code> e <code>\u03b8H_em_ret</code> coerenti e ricava la portata da \u0394T acqua.</li> <li><code>\u03b8H_em_flw_min</code> include offset di miscelazione.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c4self-common_params-int-c4-onoff-intermittente","title":"<code>calculate_type_C4(self, common_params, \u03b8int)</code> \u2014 C.4: ON\u2013OFF intermittente","text":"<ul> <li>Usa un duty cycle per garantire l\u2019energia oraria con potenza ON.</li> <li>Determina <code>\u03b8H_em_flw_calc</code> durante ON (da TB14, \u03b2 richiesto).</li> <li>Fornisce minimi di mandata per il circuito di distribuzione.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c5self-common_params-int-c5-portata-costante-scambio-variabile-bypass","title":"<code>calculate_type_C5(self, common_params, \u03b8int)</code> \u2014 C.5: portata costante, scambio variabile (bypass)","text":"<ul> <li>Mantiene portata nominale; la mandata effettiva \u00e8 il massimo tra il calcolo e il set minimo (<code>\u03b8H_em_flw_min_tz_i</code>).</li> <li>L\u2019uscita include <code>\u03b8H_em_flw_min</code> (con margine di miscelazione).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#8-temperatura-nodo-circuito-secondario","title":"8) Temperatura nodo circuito (secondario)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_circuit_node_temperatureself-ext-emission_results","title":"<code>calculate_circuit_node_temperature(self, \u03b8ext, emission_results)</code>","text":"<ul> <li>Scopo: calcola la mandata al nodo <code>\u03b8H_nod_out</code> in base al tipo di controllo secondario:</li> <li>Type 1 \u2013 Based on demand: usa <code>\u03b8H_em_flw_min</code> dell\u2019emissione.</li> <li>Type 2 \u2013 Based on outdoor: usa la curva climatica secondaria.</li> <li>Type 3 \u2013 Constant temperature: usa <code>\u03b8em_flw_sahz_i</code> (costante).</li> <li>Output: <code>\u03b8H_nod_out</code> (\u00b0C).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#9-condizioni-operative-secondario","title":"9) Condizioni operative (secondario)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_operating_conditionsself-emission_results-common_params-int-h_nod_out","title":"<code>calculate_operating_conditions(self, emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"<ul> <li>Scopo: combina la scelta C.2/C.3/C.4/C.5 e il nodo per generare:</li> <li>temperature circuito: <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, portata <code>V_H_cr</code>;</li> <li>temperature distribuzione (tra collettore ed emettitore): <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>;</li> <li>fattore di carico <code>\u03b2H_em</code> e mandata minima richiesta <code>\u03b8H_em_flw_min</code>;</li> <li>ritorno effettivo emettitore (usato a valle).</li> <li>Note:</li> <li>C.4 introduce tempo ON e calcolo di potenza in ON;</li> <li>C.5 tiene mandata minima e calcola il ritorno dal bilancio con portata costante.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#10-distribuzione","title":"10) Distribuzione","text":""},{"location":"iso_15316_calculation_procedure/#calculate_distributionself-h_dis_flw-h_dis_ret-int-qh_em_i_in","title":"<code>calculate_distribution(self, \u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"<ul> <li>Scopo: stima le perdite di distribuzione e gli ausiliari, la parte recuperabile e l\u2019energia in ingresso richiesta dalla distribuzione.</li> <li>Formule chiave:</li> <li>Perdite [kWh] \u2248 <code>((T_media - T_int) * U[W/K] / 1000) * t[h]</code></li> <li>Ingresso richiesto: <code>QH_dis_i_in = QH_dis_i_req + perdite - aux - recuperi</code></li> <li>Portata di distribuzione: <code>V_H_dis = QH_dis_i_in / (c_w * \u0394T_dis * t)</code></li> <li>Output: dizionario con perdite/aux/recuperi e <code>V_H_dis</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#11-efficienza-del-generatore-primario","title":"11) Efficienza del generatore (primario)","text":""},{"location":"iso_15316_calculation_procedure/#_efficiency_from_modelself-flw-ret-load_frac10","title":"<code>_efficiency_from_model(self, \u03b8flw, \u03b8ret, load_frac=1.0)</code>","text":"<ul> <li>Scopo: restituisce l\u2019efficienza (%) secondo il modello scelto:</li> <li>simple: euristico in funzione di <code>\u03b8ret</code> (condensa alta a ritorni bassi).</li> <li>parametric: modello lineare a tratti (parametri: <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>).</li> <li>manufacturer: curve 1D (\u03b7=f(Tret)) o 2D (\u03b7=f(Tflw,Tret)) con interpolazione bilineare.</li> <li>Note: clamp a [1, 110] %; fallback a modello semplice se curve non valide.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#12-setpoint-mandata-primaria","title":"12) Setpoint mandata primaria","text":""},{"location":"iso_15316_calculation_procedure/#_generator_flow_setpointself-ext-h_dis_flw_demand","title":"<code>_generator_flow_setpoint(self, \u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"<ul> <li>Scopo: calcola il setpoint di mandata primaria in base al controllo selezionato:</li> <li>Type A \u2013 Outdoor: usa la curva primaria (min/max vs T esterna).</li> <li>Type B \u2013 Demand: insegue la domanda secondaria (<code>\u03b8H_dis_flw</code>).</li> <li>Type C \u2013 Constant: usa <code>\u03b8HW_gen_flw_const</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#13-generazione-primario","title":"13) Generazione (primario)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_generationself-h_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"<code>calculate_generation(self, \u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"<ul> <li>Scopo: calcola l\u2019uscita termica primaria e i consumi.</li> <li>Passi:</li> <li>Capacit\u00e0 max: <code>max_output_g1 = P_full * LF_max * t</code>.</li> <li>Richiesta: <code>QH_gen_out = min(QH_dis_i_in, max_output_g1)</code>.</li> <li>Masse/portate: <code>ms = \u03c1 * V_dis</code>.</li> <li>Schemi idraulici:<ul> <li>direct: primario=secondario;</li> <li>independent: calcolo <code>\u0394T_p</code>, setpoint mandata primaria (A/B/C), perdite linea primaria, portata primaria <code>mp = Q * 1000 / (c_w * \u0394T)</code>, antimescolamento opzionale, ritorno <code>Tp_ret</code>.</li> </ul> </li> <li>Efficienza: ricalcolo con temperature effettive.</li> <li>Energetica:<ul> <li><code>EHW_gen_in = (QH_gen_out * 100) / \u03b7</code></li> <li><code>EHW_gen_aux = EHW_gen_in * (aux_generator/100)</code></li> <li>Perdite recuperabili del generatore <code>QW_gen_i_ls_rbl_H</code></li> <li>Bilanci <code>QW_gen_out</code>, <code>QHW_gen_out</code> e ripartizione <code>EH_gen_in</code> / <code>EWH_gen_in</code></li> </ul> </li> <li>Output: dizionario con temperature primarie, portate, efficienza e consumi.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#14-esecuzione-singolo-passo","title":"14) Esecuzione singolo passo","text":""},{"location":"iso_15316_calculation_procedure/#compute_stepself-q_h_kwh-int-ext","title":"<code>compute_step(self, q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>Flusso:</li> <li>Parametri comuni emissione</li> <li>Emissione C.2/C.3/C.4/C.5 (in base a <code>selected_emm_cont_circuit</code>)</li> <li>Calcolo mandata nodo (secondario)</li> <li>Operating conditions del circuito</li> <li>Distribuzione</li> <li>Generazione (primario)</li> <li>Composizione dell\u2019output del passo (dizionario)</li> <li>Ritorna: tutte le temperature, portate ed energie del passo.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#15-esecuzione-serie-temporali","title":"15) Esecuzione serie temporali","text":""},{"location":"iso_15316_calculation_procedure/#_temps_row_when_offself-int-ext","title":"<code>_temps_row_when_off(self, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>Scopo: in assenza di carico (<code>Q_H \u2264 0</code>) e con policy <code>off_compute_mode='temps'</code>,   calcola solo le temperature significative tenendo potenze/portate=0.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#run_timeseriesself-dfnone","title":"<code>run_timeseries(self, df=None)</code>","text":"<ul> <li>Scopo: esegue il calcolo su tutto il DataFrame temporale.</li> <li>Alias riconosciuti:</li> <li><code>Q_H_kWh</code> \u2194 <code>Q_H</code>, <code>Q_h</code>, <code>Heating_needs</code></li> <li><code>T_op</code> \u2194 <code>T_int</code>, <code>theta_int</code></li> <li><code>T_ext</code> \u2194 <code>theta_ext</code></li> <li>Policy quando <code>Q_H \u2264 0</code>:</li> <li><code>calc_when_QH_positive_only=False</code>: calcola comunque il flusso completo.</li> <li><code>True</code> con:<ul> <li><code>idle</code>: riga \u201cvuota\u201d (NaN/0) \u2014 vedi <code>_idle_row</code>.</li> <li><code>temps</code>: riga solo temperature \u2014 vedi <code>_temps_row_when_off</code>.</li> <li><code>full</code>: calcolo completo anche con carico nullo.</li> </ul> </li> <li>Ritorna: DataFrame indicizzato per timestamp con tutte le colonne.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#16-colonne-chiave-in-uscita-estratto","title":"16) Colonne chiave in uscita (estratto)","text":"<ul> <li>Ingressi di passo: <code>Q_h(kWh)</code>, <code>T_op(\u00b0C)</code>, <code>T_ext(\u00b0C)</code></li> <li>Emissione: <code>\u03a6H_em_eff(kW)</code>, <code>\u03b8H_em_flow(\u00b0C)</code>, <code>\u03b8H_em_ret(\u00b0C)</code>, <code>V_H_em_eff(m3/h)</code>, <code>\u03b8H_em_flw_min_req(\u00b0C)</code></li> <li>Nodo/Circuito: <code>\u03b8H_nod_out(\u00b0C)</code>, <code>\u03b8H_cr_flw(\u00b0C)</code>, <code>\u03b8H_cr_ret(\u00b0C)</code>, <code>V_H_cr(m3/h)</code>, <code>\u03b2H_em(-)</code></li> <li>Distribuzione: <code>Q_w_dis_i_ls(kWh)</code>, <code>Q_w_dis_i_aux(kWh)</code>, <code>Q_w_dis_i_ls_rbl_H(kWh)</code>, <code>QH_dis_i_in(kWh)</code>, <code>V_H_dis(m3/h)</code></li> <li>Generazione: <code>QH_gen_out(kWh)</code>, <code>\u03b8X_gen_cr_flw(\u00b0C)</code>, <code>\u03b8X_gen_cr_ret(\u00b0C)</code>, <code>V_H_gen(m3/h)</code>, <code>efficiency_gen(%)</code>, <code>EHW_gen_in(kWh)</code>, <code>EHW_gen_aux(kWh)</code></li> </ul>"},{"location":"iso_15316_calculation_procedure/#17-esempio-minimo-duso","title":"17) Esempio minimo d\u2019uso","text":"<pre><code>import pandas as pd\n\n# Serie oraria minimale\ndf = pd.DataFrame({\n    \"Q_H_kWh\": [4.0, 2.0, 0.0, 3.5],\n    \"T_op\":    [20.0, 20.0, 20.0, 20.0],\n    \"T_ext\":   [5.0, 6.0, 7.0, 4.0],\n}, index=pd.date_range(\"2025-01-01\", periods=4, freq=\"H\"))\n\ninp = {\n    \"emitter_type\": \"Floor heating\",\n    \"nominal_power\": 8.0,\n    \"selected_emm_cont_circuit\": 1,  # C.3\n    \"flow_temp_control_type\": \"Type 1 - Based on demand\",\n    \"gen_flow_temp_control_type\": \"Type A - Based on outdoor temperature\",\n}\n\ncalc = HeatingSystemCalculator(inp)\ncalc.load_csv_data(df)\nout = calc.run_timeseries()\nprint(out.head())\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#18-buone-pratiche-e-note","title":"18) Buone pratiche e note","text":"<ul> <li>Verificare che <code>TB14</code> contenga le righe per il tipo emettitore (<code>emitter_type</code>) e le colonne:</li> <li><code>Emitters_nominal_deltaTeta_Water_C</code>, <code>Emitters_nominale_deltaTeta_air_C</code>, <code>Emitters_exponent_n</code>.</li> <li>Coerenza unit\u00e0: fornire Q_H in kWh (o Wh con conversione automatica).</li> <li>Per schemi independent, valutare:</li> <li><code>generator_nominal_deltaT</code>, <code>gen_flow_temp_control_type</code>, <code>\u03b8HW_gen_flw_const</code>,</li> <li><code>allow_dilution</code> e <code>primary_line_loss</code> se si vuole modellare il nodo idraulico primario con/ senza miscelazione.</li> <li>Il modello di efficienza pu\u00f2 essere raffinato con curve produttore (1D/2D) per caldaie/pompe di calore.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#19-mappa-funzioni-responsabilita","title":"19) Mappa funzioni \u2192 responsabilit\u00e0","text":"Funzione Responsabilit\u00e0 principale <code>_load_constants</code> Costanti globali e <code>TB14</code> <code>_load_input_parameters</code> Lettura di tutti i parametri (emissione, distribuzione, generazione) <code>_default_emission_data</code>, <code>_default_outdoor_data</code> Default per limiti/setpoint e curva climatica secondaria <code>load_csv_data</code> Caricamento timeseries e normalizzazione energia <code>calculate_common_emission_parameters</code> Parametri comuni emissione (C.2\u2013C.5) <code>calculate_type_C2/C3/C4/C5</code> Modelli specifici di emissione <code>calculate_circuit_node_temperature</code> Mandata al nodo secondo la policy secondaria <code>calculate_operating_conditions</code> Temperature/portate circuito e distribuzione <code>calculate_distribution</code> Perdite/ausiliari/recuperi e portata di distribuzione <code>_efficiency_from_model</code> Rendimento generatore secondo modello scelto <code>_generator_flow_setpoint</code> Setpoint mandata primaria (outdoor/demand/costante) <code>calculate_generation</code> Bilancio primario: potenza utile, efficienza, consumi <code>compute_step</code> Pipeline completa per un singolo passo <code>_temps_row_when_off</code> Riga \u201csolo temperature\u201d quando Q_H\u22640 <code>run_timeseries</code> Esecuzione sull\u2019intera serie temporale <p>Fine. Se vuoi, posso aggiungere un diagramma di flusso (mermaid) o una tabella parametri I/O dettagliata per ogni funzione.</p>"},{"location":"iso_15316_calculation_procedure/#heatingsystemcalculator-guida-estesa-con-diagramma-di-flusso-e-tabelle-io-it","title":"HeatingSystemCalculator \u2014 Guida estesa con diagramma di flusso e tabelle I/O (IT)","text":"<p>Questo documento estende la guida con: 1) Un diagramma di flusso (Mermaid) del percorso di calcolo 2) Tabelle I/O (ingressi/uscite/side-effects) per le funzioni principali</p> <p>Nota: richiede un renderer che supporti i blocchi <code>mermaid</code>.</p>"},{"location":"iso_15316_calculation_procedure/#1-diagramma-di-flusso-panoramica","title":"1) Diagramma di flusso (panoramica)","text":"<pre><code>flowchart TB\n    subgraph Primary[\"Primary Circuit\"]\n        G[Generator/Boiler]\n        PP[Primary Pump]\n        HS[Hydraulic Separator]\n    end\n\n    subgraph Secondary[\"Secondary Circuit\"]\n        SP[Secondary Pump]\n        Z1[Zone 1]\n        Z2[Zone 2]\n        Z3[Zone 3]\n    end\n\n    G --&gt; PP\n    PP --&gt; HS\n    HS --&gt; SP\n    SP --&gt; Z1\n    SP --&gt; Z2\n    SP --&gt; Z3\n</code></pre> <pre><code>graph TD\n    A[Start] --&gt; B{Decision}\n    B --&gt;|Yes| C[Option 1]\n    B --&gt;|No| D[Option 2]\n    C --&gt; E[End]\n    D --&gt; E\n</code></pre> <pre><code>flowchart TD\n    A[Start] --&gt; B[__init__(input_data)]\n    B --&gt; C[_load_constants]\n    B --&gt; D[_load_input_parameters]\n    C --&gt; E{Esecuzione?}\n    D --&gt; E\n\n    E --&gt;|singolo passo| F[compute_step(q_h, \u03b8int, \u03b8ext)]\n    E --&gt;|serie temporali| TS[run_timeseries(df)]\n\n    %% Pipeline singolo passo\n    subgraph Pipeline compute_step\n    F --&gt; G[calculate_common_emission_parameters]\n    G --&gt; H{Tipo circuito?}\n    H --&gt;|C.2| I1[calculate_type_C2]\n    H --&gt;|C.3| I2[calculate_type_C3]\n    H --&gt;|C.4| I3[calculate_type_C4]\n    H --&gt;|C.5| I4[calculate_type_C5]\n    I1 --&gt; J[calculate_circuit_node_temperature]\n    I2 --&gt; J\n    I3 --&gt; J\n    I4 --&gt; J\n    J --&gt; K[calculate_operating_conditions]\n    K --&gt; L[calculate_distribution]\n    L --&gt; M[calculate_generation]\n    M --&gt; N[Compose outputs dict]\n    end\n\n    %% Pipeline serie temporali\n    subgraph Timeseries run_timeseries\n    TS --&gt; TS0{Row loop}\n    TS0 --&gt;|Q_H \u2264 0 AND policy=idle| T0[_idle_row]\n    TS0 --&gt;|Q_H \u2264 0 AND policy=temps| T1[_temps_row_when_off]\n    TS0 --&gt;|altrimenti| T2[compute_step]\n    T0 --&gt; T3[accumula risultati]\n    T1 --&gt; T3\n    T2 --&gt; T3\n    end\n\n    N --&gt; O[Return dict]\n    T3 --&gt; P[Return DataFrame]\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#2-tabelle-di-inputoutput-funzioni-principali","title":"2) Tabelle di Input/Output (funzioni principali)","text":""},{"location":"iso_15316_calculation_procedure/#21-__init__input_data","title":"2.1 <code>__init__(input_data)</code>","text":"Campo Tipo Descrizione <code>input_data</code> dict Parametri di emissione, distribuzione, generazione, policy e tabelle. Output Inizializza l\u2019istanza e richiama <code>_load_constants()</code> &amp; <code>_load_input_parameters()</code>."},{"location":"iso_15316_calculation_procedure/#22-_load_constants","title":"2.2 <code>_load_constants()</code>","text":"Campo Tipo Descrizione <code>input_data[\"TB14\"]</code> (opzionale) <code>pd.DataFrame</code> Tabella ISO con \u0394T nominali/esponente; se assente usa <code>TB14_backup</code>. Side-effects <code>self.TB14</code> assegnata; <code>self.c_w = 1.16</code>. Output Nessun ritorno esplicito."},{"location":"iso_15316_calculation_procedure/#23-_load_input_parameters","title":"2.3 <code>_load_input_parameters()</code>","text":"Blocco Chiavi principali Default (esempio) Emissione <code>emitter_type</code>, <code>nominal_power</code>, <code>emission_efficiency</code>, <code>mixing_valve</code>, <code>flow_temp_control_type</code>, <code>auxiliars_power</code>, <code>emission_operation_time</code>, <code>mixing_valve_delta</code>, <code>selected_emm_cont_circuit</code>, <code>heat_emission_data</code>, <code>outdoor_temp_data</code>, <code>constant_flow_temp</code> <code>Floor heating</code>, <code>8 kW</code>, <code>90%</code>, <code>True</code>, <code>Type 1</code>, <code>0 W</code>, <code>1 h</code>, <code>2 \u00b0C</code>, <code>0</code>, tabelle di default Distribuzione <code>Heat_losses_recovered</code>, <code>distribution_loss_recovery</code>, <code>simplified_approach</code>, <code>distribution_aux_recovery</code>, <code>distribution_aux_power</code>, <code>distribution_loss_coeff</code>, <code>distribution_operation_time</code>, <code>recoverable_losses</code> <code>True</code>, <code>90%</code>, <code>80%</code>, <code>80%</code>, <code>30 W</code>, <code>48 W/K</code>, <code>1 h</code>, <code>0 kWh</code> Generazione <code>full_load_power</code>, <code>max_monthly_load_factor</code>, <code>tH_gen_i_ON</code>, <code>auxiliary_power_generator</code>, <code>fraction_of_auxiliary_power_generator</code>, <code>generator_circuit</code>, <code>speed_control_generator_pump</code>, <code>generator_nominal_deltaT</code>, <code>\u03b8HW_gen_flw_set</code>, <code>\u03b8HW_gen_ret_set</code>, <code>calc_when_QH_positive_only</code>, <code>fill_zeros_when_skipped</code>, <code>off_compute_mode</code>, <code>efficiency_model</code>, <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>, <code>manuf_curve_1d</code>, <code>manuf_curve_2d</code>, <code>gen_flow_temp_control_type</code>, <code>gen_outdoor_temp_data</code>, <code>\u03b8HW_gen_flw_const</code> <code>24 kW</code>, <code>100%</code>, <code>1 h</code>, <code>0%</code>, <code>40%</code>, <code>independent</code>, <code>variable</code>, <code>20 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>True</code>, <code>False</code>, <code>idle</code>, <code>simple</code>, <code>110%</code>, <code>95%</code>, <code>20 \u00b0C</code>, <code>50 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>Type A</code>, curva primaria default, <code>50 \u00b0C</code>"},{"location":"iso_15316_calculation_procedure/#24-_default_emission_data-_default_outdoor_data","title":"2.4 <code>_default_emission_data()</code> / <code>_default_outdoor_data()</code>","text":"Funzione Output Note <code>_default_emission_data</code> DF con <code>\u03b8H_em_flw_max_sahz_i</code>, <code>\u0394\u03b8H_em_w_max_sahz_i</code>, <code>\u03b8H_em_ret_req_sahz_i</code>, <code>\u03b2H_em_req_sahz_i</code>, <code>\u03b8H_em_flw_min_tz_i</code> Limiti/setpoint lato secondario <code>_default_outdoor_data</code> DF con <code>\u03b8ext_min_sahz_i</code>, <code>\u03b8ext_max_sahz_i</code>, <code>\u03b8em_flw_max_sahz_i</code>, <code>\u03b8em_flw_min_sahz_i</code> Curva climatica secondaria"},{"location":"iso_15316_calculation_procedure/#25-load_csv_datacsv_path_or_df","title":"2.5 <code>load_csv_data(csv_path_or_df)</code>","text":"Input Tipo Descrizione <code>csv_path_or_df</code> str / DataFrame Timeseries con colonne (<code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> o alias) Output DataFrame Con eventuale <code>Q_H_kWh</code> aggiunto; salvato in <code>self.timeseries_data</code>"},{"location":"iso_15316_calculation_procedure/#26-calculate_common_emission_parametersheating_needs_kwh-int","title":"2.6 <code>calculate_common_emission_parameters(heating_needs_kWh, \u03b8int)</code>","text":"Output (chiave) Descrizione <code>QH_sys_out_hz_i</code> Richiesta netta dopo recuperi <code>QH_em_i_in</code> Energia in ingresso all\u2019emissione <code>\u03a6H_em_eff</code> Potenza media su intervallo (kW) <code>V_H_em_nom</code> Portata nominale (m\u00b3/h) <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code> Parametri da TB14"},{"location":"iso_15316_calculation_procedure/#27-calculate_type_c2-c3-c4-c5","title":"2.7 <code>calculate_type_C2 / C3 / C4 / C5</code>","text":"Funzione Principio Output principali <code>C2</code> Portata costante, T acqua costante <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C3</code> Portata variabile, T emettitore costante (ritorno limitato) <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C4</code> ON\u2013OFF (duty cycle) <code>\u03b8H_em_flw_calc</code>, <code>\u03b8H_em_flw_min</code>, ecc. <code>C5</code> Portata costante, scambio variabile (bypass) <code>\u03b8H_em_flow=min</code>, <code>\u03b8H_em_ret\u2248</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code>"},{"location":"iso_15316_calculation_procedure/#28-calculate_circuit_node_temperatureext-emission_results","title":"2.8 <code>calculate_circuit_node_temperature(\u03b8ext, emission_results)</code>","text":"Controllo Logica Output Type 1 Domanda \u2192 <code>\u03b8H_em_flw_min</code> <code>\u03b8H_nod_out</code> Type 2 Curva climatica secondaria <code>\u03b8H_nod_out</code> Type 3 Costante (<code>\u03b8em_flw_sahz_i</code>) <code>\u03b8H_nod_out</code>"},{"location":"iso_15316_calculation_procedure/#29-calculate_operating_conditionsemission_results-common_params-int-h_nod_out","title":"2.9 <code>calculate_operating_conditions(emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"Caso Output principali C.2 / C.3 / C.4 / C.5 <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, <code>V_H_cr</code>, <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>, <code>\u03b2H_em</code>, <code>\u03b8H_em_flw_min</code>, <code>\u03b8H_em_ret_eff</code>"},{"location":"iso_15316_calculation_procedure/#210-calculate_distributionh_dis_flw-h_dis_ret-int-qh_em_i_in","title":"2.10 <code>calculate_distribution(\u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"Output Significato <code>Q_w_dis_i_ls</code>, <code>Q_w_dis_i_aux</code>, <code>Q_w_dis_i_ls_rbl_H</code> Perdite, ausiliari e parte recuperabile (kWh) <code>QH_dis_i_req</code>, <code>QH_dis_i_in</code> Richiesta e ingresso effettivo alla distribuzione <code>V_H_dis</code> Portata volumetrica di distribuzione (m\u00b3/h)"},{"location":"iso_15316_calculation_procedure/#211-_efficiency_from_modelflw-ret-load_frac","title":"2.11 <code>_efficiency_from_model(\u03b8flw, \u03b8ret, load_frac)</code>","text":"Modelli Descrizione <code>simple</code> Efficienza in funzione di T_ritorno (condensa) <code>parametric</code> Lineare a tratti con soglie (<code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>) <code>manufacturer</code> Curve 1D/2D del costruttore con interpolazione"},{"location":"iso_15316_calculation_procedure/#212-_generator_flow_setpointext-h_dis_flw_demand","title":"2.12 <code>_generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"Tipo Logica Type A Curva primaria (outdoor) Type B Insegue domanda secondaria Type C Costante"},{"location":"iso_15316_calculation_procedure/#213-calculate_generationh_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"2.13 <code>calculate_generation(\u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"Output Significato <code>max_output_g1</code>, <code>QH_gen_out</code> Limite capacit\u00e0 e uscita termica (kWh) <code>\u03b8X_gen_cr_flw</code>, <code>\u03b8X_gen_cr_ret</code> Mandata/ritorno primario effettivi (\u00b0C) <code>V_H_gen</code> Portata primaria (m\u00b3/h) <code>efficiency_gen</code> Rendimento (%) <code>EHW_gen_in</code>, <code>EHW_gen_aux</code> Energia in ingresso e ausiliari (kWh) <code>QW_gen_i_ls_rbl_H</code> Perdite recuperabili generatore (kWh) <code>QW_gen_out</code>, <code>QHW_gen_out</code>, <code>EH_gen_in</code>, <code>EWH_gen_in</code> Bilanci termici"},{"location":"iso_15316_calculation_procedure/#214-compute_stepq_h_kwh-int-ext","title":"2.14 <code>compute_step(q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"Input Output <code>q_h_kWh</code>, <code>\u03b8int</code>, <code>\u03b8ext</code> Dizionario completo con emissione, nodo/circuito, distribuzione, generazione"},{"location":"iso_15316_calculation_procedure/#215-_temps_row_when_offint-ext","title":"2.15 <code>_temps_row_when_off(\u03b8int, \u03b8ext)</code>","text":"Scopo Output Riga \u201csolo temperature\u201d per <code>Q_H \u2264 0</code> Stesse chiavi principali, con potenze/portate=0"},{"location":"iso_15316_calculation_procedure/#216-run_timeseriesdfnone","title":"2.16 <code>run_timeseries(df=None)</code>","text":"Input Output <code>df</code> (opzionale) o <code>self.timeseries_data</code> DataFrame indicizzato per timestamp con risultati di ogni passo"},{"location":"iso_15316_calculation_procedure/#3-suggerimenti-di-modellazione","title":"3) Suggerimenti di modellazione","text":"<ul> <li>Verifica coerenza tra tipo emettitore e righe di <code>TB14</code>.  </li> <li>Per schemi independent, cura <code>generator_nominal_deltaT</code>, <code>primary_line_loss</code> e <code>allow_dilution</code>.  </li> <li>Usa <code>manufacturer</code> con curve realistiche del produttore quando disponibili.</li> </ul> <p>Fine \u2014 versione estesa.</p>"},{"location":"iso_15316_generation_circuit/","title":"GENERATION","text":"<p>The annex D of ISO 15316-1 standard provides the calculation procedure for the generation circuit. It is the general procedure that can be improved using the detailed standards for different type of generator, such as Heat pump, Combustion boilers, District heating and cooling, etc. </p> <p>There are 2 typed of generaiont circuit:</p> <p>1) Generation with DIRECT circuit withou hydraulic separtion 2) Generation with INDIPENDENT flow rate circuit, using the hydraulic separtion</p>"},{"location":"iso_15316_generation_circuit/#direct-circuit","title":"DIRECT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>The standard define no control to the circuit.  In the pybuildingenergy, the contol have been applied on the generator based on:</p> <pre><code>- 'Type A - Based on outdoor temperature': uses primary's own weather curve\n- 'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)\n- 'Type C - Constant temperature'       : uses self.\u03b8HW_gen_flw_const\n</code></pre> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> <p>No data</p> <p>System design data: </p> <p>No data</p> <p>Process control data</p> <p>No data</p> <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#independent-circuit","title":"INDEPENDENT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal generator power max_output_g1 kW - 0 to 10<sup>4</sup> Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) water (flow-return) dTp \u00b0C - 1..40 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system <p>System design data: </p> <p>No data</p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Generator pump speed control speed_control_generator_pump - - - Generator pump speed control, could be varaible or deltaT_constant <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Generation flow Temperature Tp_sup \u00b0C - - Generation flow Temperature Generation return Temperature Tp_ret \u00b0C - - Generation return Temperature Generation flow rate V_H_gen m3/h - - Generation flow rate"},{"location":"iso_15316_heating_circuit/","title":"Heating circuit.","text":"<p>The library provides modules for evaluating 4 types of hydraulic circuits, where, based on Table C.1 of the standard, for each circuit it is identified which type of emission system to use and the type of control. as defined below: </p> Code Module Emitters Control C2 Constan mass flow rate and varying water temperature Radiators and Panels Heating curve, mixing valvew and variable generation temperature C3 Varying mass flow (constant temperature) Radiators, Panels, Heating coils Thermostatic valve, flow rate control with two way valve C4 ON-OFF and varying temperature Radiators and Panels On-Off control C5 Varying heat exchange Fan-coil, heating coils emitters with on-off blower  and continuos circulation 3 way by-pass valve control <p>All modules allow the us of a mixing valve to allow different temperatures in the different circuits. A distinction is made between:  - the emitter tmperature and flow rate; - the circuit temperature and flow rate; </p> <p>They differ where there is a mixing or by-pass 3 way valve in the circuit.</p>"},{"location":"iso_15316_heating_circuit/#system-type-and-input-parameters","title":"System type and input parameters","text":""},{"location":"iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators Heating Panels Control Parameters Heating curve flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maximum distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c3-varying-mass-flow-rate-and-constant-water-temperature","title":"C3 - varying mass flow rate and constant water temperature","text":"<p>This configuration is for sample heating circuit with varying mass flow rate and constant water temperature. </p> Figure 1: System C3_1 - Example of sample heating circuit varying mass flow rate.  Figure 1: System C3_1 - Example of sample heating circuit with series control (AHU coil).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators with thermostatic valve AHU coil with series control Panels with PID control Control Parameters Maximum flow/return \u0394\u03b8 Maximum flow temperature Target return temperature <p>Inputs required</p> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve Target return temperature \u03b8H_em_ret_req_sahz_i \u00b0C - - Desired return temperature of the emission circuit Maximum flow/return \u0394\u03b8 \u0394\u03b8H_em_w_max_sahz_i \u00b0C - - Maximum flow/return temperature difference of the emission circuit Maximum flow temperature \u03b8H_em_flw_max_sahz_i \u00b0C - - Maximum flow temperature of the emission circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c4-intermittent-flow-rate-module-on-off","title":"C4 - Intermittent flow rate module (ON-OFF)","text":"<p>This configuration is for sample heating circuit with intermittent flow rate and constant water temperature. </p> Figure 1: System C4 - Example of sample heating circuit with intermittent flow rate module (ON-OFF).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Desired load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c5-constant-flow-rate-and-variable-heat-exchange","title":"C5 - Constant flow rate and variable heat exchange","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  Figure 1: System C4 - Example of sample heating circuit with three way by-pass control.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Target load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Minimum flow temperature \u03b8H_em_flw_min_sahz_i \u00b0C - - Minimum flow temperature of the emission circuit for a zone i Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"iso_15316_system_inputs/","title":"HVAC SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"iso_15316_system_inputs/#emission","title":"EMISSION","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</li> <li> <p>mixing valve delta: it is the offset temperature of the mixing valve in \u00b0C. It refers to the varaible mixing_valve_delta. </p> <ul> <li> <p>The offset refers to the temperature difference between the desired temperature and the actual temperature, which is applied when mixing hot and cold water.</p> </li> <li> <p>In this case, the parameter \u0394\u03b8H_em_mix_sahz_i represents the temperature offset applied by the mixing valve, with a default value set to 2\u00b0C (as defined in the code).</p> </li> <li> <p>This means that when the mixing valve is operating, it will allow a 2\u00b0C deviation from the desired temperature to account for system dynamics, such as heat losses, system inertia, or external temperature influences.</p> </li> </ul> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0 <p>heat_emission_data: it is the table that contains the data of the emission circuit. If it is not provided the default values are used and the emitter_type is set to the first one in the table. In the code we have the function <code>_default_emission_data()</code> that returns the default values. These values are default emission circuit parameters for the heating system\u2019s secondary side (the side connected to heating emitters, such as radiators or underfloor heating).  They represent nominal and operational setpoints for a single heating zone (HZ1), including flow/return temperatures and load control factors.</p> <p>Table 4: Emission circuit data</p> Parameter (column name) Description Default Value Unit <code>\u03b8H_em_flw_max_sahz_i</code> Maximum flow temperature for the heating emission circuit 45 \u00b0C <code>\u0394\u03b8H_em_w_max_sahz_i</code> Maximum water flow/return temperature difference 8 \u00b0C <code>\u03b8H_em_ret_req_sahz_i</code> Desired return temperature of the emission circuit 20 \u00b0C <code>\u03b2H_em_req_sahz_i</code> Desired load factor with ON/OFF control 80 % <code>\u03b8H_em_flw_min_tz_i</code> Minimum required flow temperature for the thermal zone 28 \u00b0C"},{"location":"iso_15316_system_inputs/#distribution","title":"DISTRIBUTION","text":"<p><pre><code># --- distribution ---\n'heat_losses_recovered': True,\n'distribution_loss_recovery': 90,\n'simplified_approach': 80,\n'distribution_aux_recovery': 80,\n'distribution_aux_power': 30,\n'distribution_loss_coeff': 48,\n'distribution_operation_time': 1,\n</code></pre> The parameters are used inside the class HeatingSystemCalculator as:</p> <pre><code>self.Heat_losses_recovered = inp.get('heat_losses_recovered', True)\nself.f_h_dist_i_ls = inp.get('distribution_loss_recovery', 90)  # %\nself.simplified_or_holistic_approach = inp.get('simplified_approach', 80)  # %\nself.f_h_dist_i_aux = inp.get('distribution_aux_recovery', 80)  # %\nself.W_H_dist_i_aux = inp.get('distribution_aux_power', 30)  # W\nself.Heat_loss_coefficent_dist = inp.get('distribution_loss_coeff', 48)  # W/K\nself.tH_dis_i_ON = inp.get('distribution_operation_time', 1)  # h\n</code></pre> <p>if data is not provided by the user, the default values are used.</p> <p>These parameters describe the thermal and electrical behavior of the heat distribution subsystem, which connects the generator to the emitters (secondary circuits). They define how heat losses, auxiliary energy use, and simplifications in the calculation are handled within the ISO 15316-1 framework.</p> Variable Description Default Unit <code>heat_losses_recovered</code> Boolean flag that defines whether distribution heat losses are considered recoverable in the building (e.g., heat lost in indoor piping contributes to heating). <code>True</code> \u2013 <code>distribution_loss_recovery</code> (<code>f_h_dist_i_ls</code>) Fraction of distribution losses that are recoverable (typically within the heated zone). <code>90</code> % <code>simplified_approach</code> (<code>simplified_or_holistic_approach</code>) Defines the calculation approach for recovered losses: a simplified method (<code>&gt; 0</code>) or a holistic method (<code>0</code> for detailed ISO modeling). <code>80</code> % <code>distribution_aux_recovery</code> (<code>f_h_dist_i_aux</code>) Fraction of auxiliary electrical power (e.g., pumps, valves) that is converted into useful heat and recovered within the heated space. <code>80</code> % <code>distribution_aux_power</code> (<code>W_H_dist_i_aux</code>) Rated auxiliary electrical power of the distribution system (e.g., circulation pumps). <code>30</code> W <code>distribution_loss_coeff</code> (<code>Heat_loss_coefficent_dist</code>) Overall heat loss coefficient of the distribution system, representing thermal losses per degree of temperature difference between the fluid and ambient air. <code>48</code> W/K <code>distribution_operation_time</code> (<code>tH_dis_i_ON</code>) Average operation time of the distribution system per time step (typically the same as the emission system). <code>1</code> h"},{"location":"iso_15316_system_inputs/#generation","title":"GENERATION","text":"<p>The generator is modelled using the following parameters:</p> <pre><code>    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"])\n    '\u03b8HW_gen_flw_const': 50.0\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20\n</code></pre> <p>That are: </p> <ul> <li>load power: it is the power of the generator in kW, defined in the product data. variable name: 'full_load_power'</li> <li>max monthly load factor: it is the maximum load factor of the generator in %.  variable_name: 'max_monthly_load_factor'</li> <li>tH_gen_i_ON: it is the time of the generator in ON state in hours. variable_name: 'tH_gen_i_ON'</li> </ul> <ul> <li>auxiliary power generator: Percentage of generator input energy used by auxiliary systems (generally 0-5 %).Increases total system energy input. variable_name: 'auxiliary_power_generator'</li> <li> <p>fraction of auxiliary power generator: it is the portion of auxiliary energy recovered as heat (generally 20\u201360%). Reduces auxiliary losses.variable_name: 'fraction_of_auxiliary_power_generator'.</p> <p> 1. <code>auxiliary_power_generator</code> This parameter defines how much additional electrical power (in %) is consumed by the generator\u2019s own auxiliary components, such as:</p> <ul> <li>Circulation pumps  </li> <li>Combustion or ventilation fans  </li> <li>Electronic controls and sensors  </li> <li>Ignition systems  </li> <li>Internal electronics (standby mode)</li> </ul> <p>Formula:</p> \\[ E_{HW,gen,aux} = E_{HW,gen,in} \\times \\frac{\\text{auxiliary\\_power\\_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( E_{HW,gen,in} \\): Generator input energy (kWh)  </li> <li>\\( E_{HW,gen,aux} \\): Auxiliary energy consumed (kWh)</li> </ul> <p> 2. <code>fraction_of_auxiliary_power_generator</code></p> <p>This parameter represents the fraction of auxiliary power that is recoverable as useful heat. Some auxiliary systems release heat that can be recovered by the generator\u2019s thermal circuit.</p> <p>For example: - Pump motors or internal electronics may release part of their heat to the water loop. - Fans or controllers might dissipate energy inside the generator casing.</p> <p>Formula:</p> \\[ Q_{W,gen,i,ls,rbl,H} = E_{HW,gen,aux} \\times \\frac{\\text{fraction_of_auxiliary_power_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( Q_{W,gen,i,ls,rbl,H} \\): Recovered auxiliary heat (kWh)</li> </ul> </li> </ul> <ul> <li>generator circuit: it is the circuit of the generator. It can be 'direct' or 'independent'. variable_name: 'generator_circuit'<ul> <li>Direct: the generator is connected to the primary circuit, no hydraulic separation primary = secondary</li> <li>Independent: the generator is connected to the secondary circuit, with hydraulic separator primary != secondary</li> </ul> </li> </ul> <p>The primary circuit supply temperature setpoint (Tp_sup_set), i.e., the flow temperature on the generator side (boiler, heat pump, etc.) is calculated using the function _generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand), according to the selected control strategy of the generation system</p> <p>It determines how hot the generator should make the supply water based on: - the outdoor temperature (\u03b8ext), and/or - the heating demand from the distribution/emission side (\u03b8H_dis_flw_demand), and/or - a fixed setpoint defined by the user.</p> <p>The input parameters of the function are:</p> <ul> <li>\u03b8ext: outdoor air temperature</li> <li>\u03b8H_dis_flw_demand: Flow temperature requested by the secondary circuit (distribution/emission side)</li> </ul> <p>with global inputs that are:</p> <ul> <li>df_gen_out_temp: Table defining the primary (generator) heating curve</li> <li> <p>gen_flow_temp_control_type: Type of control used to control the flow temperature of the generator.Defines which control strategy is used (\u201cType A\u201d, \u201cType B\u201d, \u201cType C\u201d):</p> <ul> <li>'Type A - Based on outdoor temperature': uses primary's own weather curve</li> <li>'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)</li> <li>'Type C - Constant temperature'       : uses \u03b8HW_gen_flw_const</li> </ul> </li> <li> <p>\u03b8HW_gen_flw_const: Constant flow temperature of the generator</p> </li> </ul> <p>The user should provide the information directly in the dictionary:</p> <pre><code>'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n'gen_outdoor_temp_data': pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],\n    \"\u03b8flw_gen_min\": [35],\n}, index=[\"Generator curve\"])\n'\u03b8HW_gen_flw_const': 50.0\n</code></pre> <p>where, in the code are defined as: </p> <p><pre><code>self.df_gen_out_temp = inp.get('gen_outdoor_temp_data', pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],   # \u00b0C, max primary supply\n    \"\u03b8flw_gen_min\": [35],   # \u00b0C, min primary supply\n}, index=[\"Generator curve\"]))\n\nself.gen_flow_temp_control_type = inp.get(\n    'gen_flow_temp_control_type',\n    'Type A - Based on outdoor temperature'   # 'Type A' | 'Type B' | 'Type C'\n)\n\nself.\u03b8HW_gen_flw_const = float(inp.get('\u03b8HW_gen_flw_const', 50.0))\n</code></pre> Explanation of the different type of control:</p> <ul> <li> Type A - Based on outdoor temperature. Climatic curve (outdoor compensation) <pre><code>if ctrl.startswith('Type A'):\n    if \u03b8ext_max != \u03b8ext_min:\n        Tp = \u03b8flw_min + (\u03b8flw_max - \u03b8flw_min) * (\u03b8ext_max - \u03b8ext) / (\u03b8ext_max - \u03b8ext_min)\n        return max(min(Tp, \u03b8flw_max), \u03b8flw_min)\n    return \u03b8flw_min\n</code></pre> Calculates the generator flow temperature linearly based on outdoor temperature. Equation: The generator flow temperature \\( T_{p, \\text{set}} \\) is calculated linearly based on the outdoor temperature \\( \\theta_{\\text{ext}} \\), following the formula:</li> </ul> \\[ T_{p, \\text{set}} = T_{\\text{flw}, \\text{min}} + \\left( T_{\\text{flw}, \\text{max}} - T_{\\text{flw}, \\text{min}} \\right) \\cdot \\frac{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}} \\right)}{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}, \\text{min}} \\right)} \\] <p>Where:</p> <ul> <li>\\( T_{\\text{flw}, \\text{min}} \\) = minimum flow temperature (e.g., 35\u00b0C)</li> <li>\\( T_{\\text{flw}, \\text{max}} \\) = maximum flow temperature (e.g., 60\u00b0C)</li> <li>\\( \\theta_{\\text{ext}} \\) = outdoor air temperature</li> <li>\\( \\theta_{\\text{ext}, \\text{min}} \\) = minimum outdoor temperature (e.g., -7\u00b0C)</li> <li>\\( \\theta_{\\text{ext}, \\text{max}} \\) = maximum outdoor temperature (e.g., 15\u00b0C) The calculated \\( T_{p, \\text{set}} \\) is then clamped between the minimum and maximum values:</li> </ul> \\[ T_{p, \\text{set}} = \\max\\left( \\min\\left( T_{p, \\text{set}}, T_{\\text{flw}, \\text{max}} \\right), T_{\\text{flw}, \\text{min}} \\right) \\] <p>\ud83d\udc49\ud83c\udffb Meaning: This is the typical weather-compensated control used (for example) in boilers and heat pumps. It automatically adjusts water temperature to the outdoor conditions for better efficiency and comfort. Example visualization of type A: <pre><code>Generator flow temperature (\u00b0C)\n\u2502\n\u2502    60\u00b0C \u2500\u2500\u2500\u2500\u2510\n\u2502              \\\n\u2502               \\\n\u2502                \\\n\u2502                 \\\n\u2502    35\u00b0C \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Outdoor temperature (\u00b0C)\n          -7          0           +15\n</code></pre></p> <ul> <li> <p> Type B - Based on demand. Follow secondary demand <pre><code>if ctrl.startswith('Type B'):\n    return float(\u03b8H_dis_flw_demand)\n</code></pre> Sets the generator supply temperature equal to the demand from the secondary (distribution/emission) side. \ud83d\udc49\ud83c\udffb Meaning: This is used in systems with hydraulic separation (e.g., with a buffer tank or heat exchanger) where the generator must match the needs of the secondary circuit dynamically. Example: If the radiator loop requests 45 \u00b0C \u2192 the generator must deliver exactly 45 \u00b0C to maintain balance.</p> </li> <li> <p> Type C - Constant temperature <pre><code>return float(self.\u03b8HW_gen_flw_const)\n</code></pre> Ignores weather and demand \u2014 the generator runs at a fixed supply temperature (e.g., 50 \u00b0C). \ud83d\udc49\ud83c\udffb Meaning: Simplest and oldest control type, often found in small or legacy heating systems. It offers no adaptation to weather or load, typically less efficient. Example: If the user defines a constant supply temperature of 50 \u00b0C \u2192 the generator will always deliver 50 \u00b0C, regardless of the demand from the secondary circuit.</p> </li> </ul> <ul> <li>speed control of generator pump: icontrols how \u0394T varies with system load (constant vs variable). It can be in the code 'variable' or 'deltaT_constant'. variable_name: 'speed_control_generator_pump'</li> <li> <p>Nominal water deltaT of generator: defines the nominal \u0394T at design (full load) \u2014 the reference used in thermal balance equations in \u00b0C. variable_name: 'generator_nominal_deltaT'. It is used if speed_control_of_generator_pump is 'deltaT_constant'.</p> <p>More info:</p> <ul> <li><code>\"deltaT_constant\"</code> \u2192 The pump maintains a fixed temperature difference (\u0394T) between flow and return.</li> <li>Example: The pump adjusts its speed so that \u0394T = 20 \u00b0C remains constant.</li> <li><code>\"variable\"</code> \u2192 The pump varies its speed dynamically according to the system load.</li> <li>When heating demand decreases, the water flow rate decreases.</li> <li>This leads to a smaller \u0394T at partial loads, improving efficiency.</li> </ul> <p>When <code>variable</code>, the temperature difference (\u0394T) decreases proportionally with the thermal load, which represents real modulating behavior of pumps and heat generators.</p> <p><code>generator_nominal_deltaT</code></p> <p>Defines the nominal temperature difference (\u0394T) between the generator flow and return at full-load conditions.</p> \\[ \\Delta T_{nom} = T_{flow,nominal} - T_{return,nominal} \\] <p>This is the design operating condition for the generator, used as a reference in calculations.</p> <p>Example:</p> <p>If <code>generator_nominal_deltaT = 20</code>, then at full load:</p> <ul> <li>Supply temperature = 60 \u00b0C  </li> <li>Return temperature = 40 \u00b0C \u2192 \u0394T = 20 \u00b0C  </li> </ul> <p>At partial load:</p> <ul> <li>If <code>speed_control_generator_pump = \"deltaT_constant\"</code> \u2192 \u0394T remains 20 \u00b0C.  </li> <li>If <code>speed_control_generator_pump = \"variable\"</code> \u2192 \u0394T may drop to 10\u201315 \u00b0C, depending on demand.</li> </ul> </li> </ul> <p>It is possible to define the optional primary setpoints (used if circuit is independent).</p> <ul> <li>\u03b8HW_gen_flw_set: flow temperature setpoint</li> <li>\u03b8HW_gen_ret_set: return temperature setpoint</li> </ul>"},{"location":"iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <pre><code>1) 'simple'       : linear heuristic vs. return temperature\n2) 'parametric'   : piecewise/threshold model\n3) 'manufacturer' : 1D (return) or 2D (flow/return) map\n</code></pre> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic</p> <p>1) Detect zero or negative heating demand</p> <p><pre><code>if float(qh) &lt;= 0:\n</code></pre> This means there is no heating required (or possibly cooling). Now the function checks which policy is set for such cases.</p> <p>2) Case 1 \u2014 Full simulation even when Q_H = 0 <pre><code>if not self.calc_when_QH_positive_only:\n    # Full calculation even with zero load\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n    ...\n</code></pre></p> <ul> <li>Here, the flag calc_when_QH_positive_only is False, so the user wants to compute everything even when there\u2019s no load.</li> <li> <p>It runs the complete thermal balance by calling: <pre><code>res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre> This means: compute system temperatures, efficiencies, flow rates, etc., as if the system were still active but with zero heating power.</p> </li> <li> <p>The results are appended to the output DataFrame as usual.</p> </li> </ul> <p>Use case: See how the system behaves under \u201cno load\u201d conditions (e.g., during shoulder months) \u2014 including standby losses or auxiliary power.</p> <p>3) Case 2 \u2014 Skip detailed calculation (calc_when_QH_positive_only = True)</p> <p>If this flag is True, the system should behave differently depending on how \u201coff periods\u201d are treated.</p> <p>There are three \u201coff modes\u201d controlled by self.off_compute_mode.</p> <ul> <li> <p> a) Mode: 'idle' \u2192 Minimal record  <pre><code>if self.off_compute_mode == 'idle':\n    res_row = {'timestamp': idx}\n    res_row.update(self._idle_row(0.0, float(\u03b8int), float(\u03b8ext)))\n</code></pre></p> <ul> <li>Produces a minimal output line using _idle_row().</li> <li>This function fills the row mostly with zeros or NaN values \u2014 representing that nothing is being calculated because the system is idle.</li> <li>Only basic fields like timestamp, indoor temperature, and outdoor temperature are kept.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For speed optimization when simulating a full year \u2014 avoids doing unnecessary physics calculations.</p> </li> <li> <p> b) Mode: 'temps' \u2192 Record only temperatures  <pre><code>elif self.off_compute_mode == 'temps':\n    res = self._temps_row_when_off(float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>This still computes temperatures (like circuit or node flow/return) using _temps_row_when_off(),</li> <li>but all energetic terms (flows, powers, losses) are set to zero.</li> <li>This way, you can visualize how the temperature control or mixing valves behave even with zero heating demand.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For continuous temperature mapping, useful when validating system controls or comfort conditions.</p> </li> <li> <p> c) Mode: 'full' \u2192 Full calculation despite Q_H = 0  <pre><code>elif self.off_compute_mode == 'full':\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>Similar to Case 1 but triggered explicitly by mode 'full' \u2014 performs a complete computation of all variables even if load = 0.</li> <li>This is a \u201cforce full calc\u201d inside the zero-demand policy.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: When testing or debugging; ensures identical data structure across all timesteps.</p> </li> </ul> <p>4) continue statements</p> <p>Each branch ends with continue \u2014 \u2192 meaning the loop moves to the next timestep immediately after handling this case. No further code in the timestep is executed once the \u201czero-load\u201d policy has been applied.</p> <p>General-physical interpretation </p> <p>This logic helps balance accuracy vs performance:</p> <p>In annual simulations (8760 hours), 70\u201390% of the time may have zero heating demand (e.g., in summer). Recomputing all hydraulic and thermal equations each hour would waste time.</p> <p>Therefore, this control allows skipping unnecessary computations or simplifying the result depending on your simulation purpose:</p> <ul> <li>\"idle\" \u2192 fastest</li> <li>\"temps\" \u2192 medium (keep comfort analysis)</li> <li>\"full\" \u2192 slowest but most complete</li> </ul> <p>Example of inputs system: <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n    'heat_emission_data' : pd.DataFrame({\n            \"\u03b8H_em_flw_max_sahz_i\": [45],\n            \"\u0394\u03b8H_em_w_max_sahz_i\": [8],\n            \"\u03b8H_em_ret_req_sahz_i\": [20],\n            \"\u03b2H_em_req_sahz_i\": [80],\n            \"\u03b8H_em_flw_min_tz_i\": [28],\n        }, index=[\n            \"Max flow temperature HZ1\",\n            \"Max \u0394\u03b8 flow / return HZ1\",\n            \"Desired return temperature HZ1\",\n            \"Desired load factor with ON-OFF for HZ1\",\n            \"Minimum flow temperature for HZ1\"\n        ])\n\n    # --- distribution ---\n    'heat_losses_recovered': True,\n    'distribution_loss_recovery': 90,\n    'simplified_approach': 80,\n    'distribution_aux_recovery': 80,\n    'distribution_aux_power': 30,\n    'distribution_loss_coeff': 48,\n    'distribution_operation_time': 1,\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n}\n</code></pre></p>"},{"location":"iso_52016_input_check/","title":"ISO 52016 Input Check","text":"<p>The data provided before being used for the simulation are processed and evaluated to be considered fit for the simulation. This process includes a series of checks that allow to identify any potential errors.  The following controls are applied:</p>"},{"location":"iso_52016_input_check/#thermal-and-adjacent-zone","title":"Thermal and Adjacent Zone","text":"<p>Uno degli errori pi\u00f9 caratteristici pu\u00f2 essere quello di immetere dei valori errati di superficie della parete di confine tra la zona termica e la zona non termica. Un esempio \u00e8 quello di dare dei valori pi\u00f9 alti della superificie della parete nella zona non termica rispetto alla superificie della parete nella zona termica. In questo caso se il controllo risulta essere negativo allora il tool imposta il valore del superificie della zona non termica uguale a quello della zona termica.  Qui voglio dire che sebbene la superficie di contatto \u00e8 la stessa pu`o succedere che la parete della zona termica sia o totlamente a contatto con la zon non termica o solamente una parte a contatto con la zona termica   </p>"},{"location":"iso_52016_input_check/#quality-check-of-system-inputs","title":"Quality check of system inputs:","text":""},{"location":"iso_52016_input_check/#check_heating_system_inputs-function","title":"<code>check_heating_system_inputs</code> Function","text":"<p>This function validates and normalizes the input configuration for the heating system. It performs the following checks:</p> <ol> <li>TB14 Table: </li> <li>If a custom <code>TB14</code> DataFrame is provided, it is used.</li> <li> <p>Otherwise, the default <code>TB14</code> from <code>global_inputs.py</code> is used.</p> </li> <li> <p>Emitter Type Validation:</p> </li> <li> <p>If the <code>emitter_type</code> is not found in the selected <code>TB14</code> table, it is automatically set to the first available emitter type, and a warning message is generated.</p> </li> <li> <p>Generator Flow Temperature Control Type (<code>gen_flow_temp_control_type</code>):</p> </li> <li>Type A: Requires <code>gen_outdoor_temp_data</code> as a DataFrame. If not provided, it switches to <code>Type B</code> and generates a warning.</li> <li>Type C: If <code>\u03b8HW_gen_flw_const</code> is not provided, it defaults to <code>50</code> and a warning is shown.</li> <li>Invalid Control Type: Any other values are automatically set to <code>Type B</code>.</li> </ol> <p>The function returns: - The selected <code>TB14</code> table. - The validated <code>emitter_type</code>. - A list of messages about any changes or validations. - The normalized input configuration.</p>"},{"location":"it/","title":"pybuildingenergy","text":"<p>Welcome to pybuildingenergy documentation!</p> <p>..</p>"},{"location":"it/iso_15316/","title":"Introduction to ISO 15316-1 / EN 15316-1","text":""},{"location":"it/iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> System Application Control Parameters Radiators Heating curve, flow/return \u0394\u03b8 Heating panel Heating curve, flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"it/iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design temperature flow return \u0394\u03b8 - nominal delta T water \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-50 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours maximum Distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"it/iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"it/iso_15316_system_inputs/","title":"ISO 15316 - HVAC System inputs","text":""},{"location":"it/iso_15316_system_inputs/#system-inputs","title":"SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"it/iso_15316_system_inputs/#emitter","title":"EMITTER","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li> <p>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</p> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0"},{"location":"it/iso_15316_system_inputs/#generator","title":"GENERATOR","text":""},{"location":"it/iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <p>1) 'simple'       : linear heuristic vs. return temperature 2) 'parametric'   : piecewise/threshold model 3) 'manufacturer' : 1D (return) or 2D (flow/return) map</p> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic </p> <p>Example of input systems:  <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n}\n</code></pre></p>"},{"location":"it/iso_52016_input_check.md/","title":"ISO 52016 Input Check","text":"<p>The data provided before being used for the simulation are processed and evaluated to be considered fit for the simulation. This process includes a series of checks that allow to identify any potential errors.  The following controls are applied:</p>"},{"location":"it/iso_52016_input_check.md/#thermal-and-adjacent-zone","title":"Thermal and Adjacent Zone","text":"<p>Uno degli errori pi\u00f9 caratteristici pu\u00f2 essere quello di immetere dei valori errati di superficie della parete di confine tra la zona termica e la zona non termica. Un esempio \u00e8 quello di dare dei valori pi\u00f9 alti della superificie della parete nella zona non termica rispetto alla superificie della parete nella zona termica. In questo caso se il controllo risulta essere negativo allora il tool imposta il valore del superificie della zona non termica uguale a quello della zona termica.  Qui voglio dire che sebbene la superficie di contatto \u00e8 la stessa pu`o succedere che la parete della zona termica sia o totlamente a contatto con la zon non termica o solamente una parte a contatto con la zona termica   </p>"},{"location":"","title":"pybuildingenergy","text":"<p>Welcome to pybuildingenergy documentation!</p> <p>...</p>"},{"location":"iso_15316/","title":"Introduction to EN ISO 15316-1","text":""},{"location":"iso_15316/#overview","title":"Overview","text":"<p>ISO 15316-1 (equivalent to EN 15316-1 in Europe) defines the framework and general principles for calculating the energy performance of building heating and domestic hot water systems. It provides a systematic, modular approach that allows engineers, researchers, and software tools to evaluate and compare energy efficiency across different system configurations.</p> <p>This standard is part of the broader Energy Performance of Buildings (EPB) suite developed under the EU Energy Performance of Buildings Directive (EPBD).</p>"},{"location":"iso_15316/#scope","title":"Scope","text":"<p>The standard covers water-based heating and DHW systems where heat is generated, distributed, and emitted to maintain indoor comfort. It applies to: - Emission systems (radiators, floor heating, fan coils, etc.) - Distribution systems (piping, manifolds, circulation) - Storage components (thermal buffers, DHW tanks) - Generation systems (boilers, heat pumps, cogeneration)</p> <p>It does not include ventilation-only or purely air-based systems, except when heated by water circuits.</p>"},{"location":"iso_15316/#methodological-structure","title":"Methodological Structure","text":"<p>EN 15316-1 introduces a modular structure, dividing the entire heating system into interconnected subsystems:</p> <ol> <li>Emission (C.2\u2013C.5) \u2013 heat transfer from water to the indoor space  </li> <li>Distribution \u2013 transport of heat through pipes, including losses and auxiliaries  </li> <li>Storage \u2013 intermediate energy buffering or recovery  </li> <li>Generation \u2013 production of useful heat from a fuel or electricity source  </li> </ol> <p>Each module has its own energy balance:</p> \\[ \\text{Energy In} = \\text{Useful Output} + \\text{Losses} - \\text{Recoverable Losses} - \\text{Auxiliaries} \\] <p>The calculation proceeds in the direction:</p> \\[ \\text{Energy Needs (Building)} \\rightarrow \\text{Delivered Heat (Emission)} \\rightarrow \\text{Distribution} \\rightarrow \\text{Generation} \\rightarrow \\text{Primary Energy Input} \\] <p>This enables transparent energy tracking and consistent efficiency assessment across technologies.</p>"},{"location":"iso_15316/#objectives","title":"Objectives","text":"<p>The main objectives of ISO 15316-1 are to: - Provide a consistent calculation structure for all sub-systems in heating and DHW installations. - Define input and output data exchange between modules. - Enable comparability between different system types (e.g., boilers vs. heat pumps). - Serve as the reference method for EPB-compliant national calculation procedures.</p>"},{"location":"iso_15316/#key-principles","title":"Key Principles","text":"<ul> <li>System boundary definition \u2013 explicit separation of emission, distribution, storage, and generation.  </li> <li>Energy flow consistency \u2013 all sub-systems connect via clear input/output relationships.  </li> <li>Recoverable vs. non-recoverable losses \u2013 internal gains can offset building demand.  </li> <li>Auxiliary energy \u2013 electric or mechanical support energy is always accounted for.  </li> <li>Adaptability \u2013 compatible with both monthly and hourly calculation time steps.</li> </ul>"},{"location":"iso_15316/#benefits","title":"Benefits","text":"<ul> <li>Harmonized methodology for energy performance certificates, design tools, and research.  </li> <li>Facilitates diagnostic comparison of subsystems (e.g., identifying excessive distribution losses).  </li> <li>Supports policy implementation under EPBD and national building codes.  </li> <li>Enhances reproducibility and transparency in simulation and benchmarking.</li> </ul>"},{"location":"iso_15316/#relationship-with-subsequent-parts","title":"Relationship with Subsequent Parts","text":"<p>Part 1 provides the general framework only. Detailed formulas and reference values for each sub-system are defined in:</p> <ul> <li>EN 15316-2 \u2013 Emission and control (M3-5) </li> <li>EN 15316-3 \u2013 Distribution and control (M3 -6)  </li> <li>EN 15316-4 \u2013 Generation systems (M3-8) for different generator: <ul> <li>EN 15316-4-1 \u2013 Combustion boilers (M3-8-1) </li> <li>EN 15316-4-2 \u2013 Heat pumps (M3-8-2) </li> <li>EN 15316-4-3 \u2013 Thermal solar and photovoltaic (M3-8-3) </li> <li>EN 15316-4-4 \u2013 On-site cogeneration (M3-8-4) </li> <li>EN 15316-4-5 \u2013 District Heating and Cooling (M3-8-5) </li> <li>EN 15316-4-9 \u2013 Direct electrical heater (M3-8-6) </li> <li>EN 15316-4-8 \u2013 Radiant heating and stoves (M3-8-8) </li> </ul> </li> <li>EN 15316-5 \u2013 Storage and control (M3-7)  </li> </ul>"},{"location":"iso_15316/#references","title":"References","text":"<ul> <li>EN 15316-1:2017 \u2013 Energy performance of buildings \u2014 Method for calculation of system energy requirements and system efficiencies \u2014 Part 1: General and energy performance expression. </li> <li>REHVA (2017) \u2014 Information Paper: CEN Standards for Heating and Domestic Hot Water Systems. </li> <li>CENSE Project (EU) \u2014 Application of the EPBD Calculation Framework.</li> </ul>"},{"location":"iso_15316_calculation_procedure/","title":"CALCULATION PROCEDURE","text":"Note: THE ACTUAL CALCULATION OF PRIMARY ENRGY USING THE ISO 15316-1 IS FOR A SINGLE ZONE, IT IS NOT YET IMPLEMENTED THE CALCULATION FOR MULTIPLE ZONES.   <p>The calculation procedure follows the direction from the energy need to the source (building energy need -&gt; primary energy)</p> <p>Building Energy Need: The building energy need is calculated using the module ISO 52016. For more information refers to the module ISO 52016.</p> <p>HVAC System:Based on different type of system configuration (from type C2 to C5) the HVAC system is calculated using the ANNEX C of  ISO 15316-1. </p>"},{"location":"iso_15316_calculation_procedure/#description-of-functions","title":"Description of functions","text":""},{"location":"iso_15316_calculation_procedure/#heatingsystemcalculator-guida-e-commento-riga-per-riga-it","title":"HeatingSystemCalculator \u2014 Guida e commento riga-per-riga (IT)","text":"<p>Questa guida spiega cosa fa lo script e commenta ogni funzione, con enfasi su: - assunzioni, unit\u00e0 di misura e formule utilizzate; - struttura dei dati in ingresso/uscita; - flusso di calcolo per singolo passo e per serie temporali.</p> <p>Standard di riferimento: il calcolatore segue la logica della ISO 15316-1 per i sistemi di riscaldamento e supporta 4 tipologie di circuito di emissione (C.2, C.3, C.4, C.5).</p>"},{"location":"iso_15316_calculation_procedure/#1-panoramica-rapida","title":"1) Panoramica rapida","text":"<ul> <li>Classe principale: <code>HeatingSystemCalculator</code></li> <li>Input: un dizionario <code>input_data</code> con parametri di emissione, distribuzione e generazione (primario).</li> <li>Dati tabellari:</li> <li><code>TB14</code> (DF): tabella ISO con \u0394T nominali ed esponente n per il terminale (radiatori, pannelli, ecc.).     Se non fornita in <code>input_data[\"TB14\"]</code>, viene usato <code>TB14_backup</code> da <code>global_inputs</code>.</li> <li>Unit\u00e0 (principali):</li> <li>Energia: kWh (eccezione: <code>Q_H</code> pu\u00f2 arrivare in Wh e viene convertito)</li> <li>Potenza: kW, Perdite/Aux: kWh</li> <li>Portate volumetriche: m\u00b3/h</li> <li>Temperature: \u00b0C</li> <li>c_w: calore specifico dell\u2019acqua in Wh/(kg\u00b7K) (\u22481.16)</li> <li>Output:</li> <li>per singolo passo: dizionario con temperature, portate ed energie su emissione, distribuzione e generazione;</li> <li>per serie temporali: DataFrame orario/temporale con la stessa struttura.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#2-struttura-della-classe","title":"2) Struttura della classe","text":"<pre><code>class HeatingSystemCalculator:\n    \\\"\\\"\\\"Calcolatore secondo ISO 15316-1 con 4 tipologie C.2\u2013C.5.\\\"\\\"\\\"\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#__init__self-input_data","title":"<code>__init__(self, input_data)</code>","text":"<ul> <li>Cosa fa: salva l\u2019input, carica costanti e parametri richiamando <code>_load_constants()</code> e <code>_load_input_parameters()</code>.</li> <li>Attenzione: <code>input_data</code> guida tutto (policy di controllo, efficienza generatore, curve esterne, ecc.).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#3-caricamento-costanti-e-parametri","title":"3) Caricamento costanti e parametri","text":""},{"location":"iso_15316_calculation_procedure/#_load_constantsself","title":"<code>_load_constants(self)</code>","text":"<ul> <li>Scopo: carica i riferimenti globali e le costanti.</li> <li>Dettagli:</li> <li>Se <code>input_data[\"TB14\"]</code> \u00e8 un <code>pd.DataFrame</code>, usa quello; altrimenti usa <code>TB14_backup</code>.</li> <li>Imposta <code>c_w = 1.16</code> Wh/(kg\u00b7K).</li> <li>Perch\u00e9 serve: <code>TB14</code> fornisce \u0394T nominali ed esponente n per calcolare la relazione potenza \u2194 \u0394T aria-emettitore.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_load_input_parametersself","title":"<code>_load_input_parameters(self)</code>","text":"<ul> <li>Scopo: legge dal dizionario d\u2019ingresso i parametri di:</li> <li>Emissione (secondario): tipo emettitore, potenza nominale, efficienza, valvola di miscelazione, tipo di controllo della temperatura di mandata (domanda/esterna/costante), potenze ausiliarie, t operative, dati curva esterna secondaria.</li> <li>Distribuzione: recupero perdite, ausiliari, coefficiente di perdita [W/K], tempo in servizio, ecc.</li> <li>Generazione (primario): potenza a pieno carico, fattore di carico max, tempo in servizio, schema idraulico (direct o independent), controllo pompa, \u0394T nominale, setpoint opzionali, modello di efficienza del generatore (simple/parametric/manufacturer) e relative curve/parametri, controllo della mandata primaria (Type A/B/C) e curva esterna primaria.</li> <li>Note importanti:</li> <li><code>selected_emm_cont_circuit</code> \u2208 {0,1,2,3} \u2192 C.2/C.3/C.4/C.5.</li> <li>Policy Q_H \u2264 0: <code>calc_when_QH_positive_only</code> + <code>off_compute_mode</code> (<code>idle</code>/<code>temps</code>/<code>full</code>) decidono come trattare i periodi senza carico.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#4-tabelle-e-dati-di-default","title":"4) Tabelle e dati di default","text":""},{"location":"iso_15316_calculation_procedure/#_default_emission_dataself","title":"<code>_default_emission_data(self)</code>","text":"<ul> <li>Cosa fornisce: limiti/setpoint secondari (emissione): T mandata max, \u0394T max, T ritorno desiderata, fattore di carico con ON/OFF, T minima di mandata.</li> <li>Perch\u00e9: servono a vincolare il calcolo dell\u2019emettitore in funzione della domanda e del tipo C.2\u2013C.5.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_default_outdoor_dataself","title":"<code>_default_outdoor_data(self)</code>","text":"<ul> <li>Cosa fornisce: curva climatica secondaria (mandata min/max vs T esterna min/max).</li> <li>Uso: impiegata da <code>calculate_circuit_node_temperature</code> quando il controllo \u00e8 \u201cbasato su esterno\u201d.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#5-dati-di-serie-temporali","title":"5) Dati di serie temporali","text":""},{"location":"iso_15316_calculation_procedure/#load_csv_dataself-csv_path_or_df","title":"<code>load_csv_data(self, csv_path_or_df)</code>","text":"<ul> <li>Scopo: carica dati orari/temporali da CSV/DataFrame con colonne attese:</li> <li><code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> (alias supportati).</li> <li>Logica:</li> <li>Se presente <code>Q_H</code> in Wh, crea <code>Q_H_kWh = Q_H / 1000</code>.</li> <li>Salva in <code>self.timeseries_data</code>.</li> <li>Ritorna: DataFrame caricato.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#6-emissione-parametri-comuni","title":"6) Emissione \u2014 parametri comuni","text":""},{"location":"iso_15316_calculation_procedure/#calculate_common_emission_parametersself-heating_needs_kwh-int","title":"<code>calculate_common_emission_parameters(self, heating_needs_kWh, \u03b8int)</code>","text":"<ul> <li>Scopo: calcola grandezze comuni a C.2\u2013C.5:</li> <li>domanda netta (dopo perdite recuperabili di sistema),</li> <li>potenza media emessa <code>\u03a6H_em_eff</code> (kW) su <code>tH_em_i_ON</code>,</li> <li>perdite/ingressi di emissione, ausiliari,</li> <li>parametri nominali TB14: <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code>, portata nominale <code>V_H_em_nom</code>.</li> <li>Note:</li> <li><code>V_H_em_nom = \u03a6H_em_n / (\u0394\u03b8H_em_n * c_w)</code>.</li> <li>Calcola fattore di carico \u03b2 e tempo ON parziale per ausiliari.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#7-emissione-modelli-c2c3c4c5","title":"7) Emissione \u2014 modelli C.2/C.3/C.4/C.5","text":"<p>Tutti usano la relazione non lineare potenza \u2194 \u0394T aria-emettitore con esponente n da TB14.</p>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c2self-common_params-int-c2-portata-costante-t-acqua-costante","title":"<code>calculate_type_C2(self, common_params, \u03b8int)</code> \u2014 C.2: portata costante, T acqua costante","text":"<ul> <li>Usa <code>V_H_em_nom</code> come portata effettiva.</li> <li>Stima <code>\u0394\u03b8H_em_air_eff = \u0394\u03b8_air_nom * (\u03a6_eff/\u03a6_nom)^(1/n)</code>.</li> <li>Calcola <code>\u03b8H_em_avg</code>, quindi \u0394T acqua <code>\u0394\u03b8H_em_w_eff = \u03a6_eff / (c_w * V)</code> e da qui mandata/ritorno emettitore.</li> <li><code>\u03b8H_em_flw_min</code> include offset di miscelazione se <code>MIX_EM=True</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c3self-common_params-int-c3-portata-variabile-t-emettitore-costante-ritorno-vincolato","title":"<code>calculate_type_C3(self, common_params, \u03b8int)</code> \u2014 C.3: portata variabile, T emettitore costante (ritorno vincolato)","text":"<ul> <li>Fissa <code>\u03b8H_em_ret_set</code> (\u2265 <code>\u03b8int</code>), limita T mandata (<code>\u03b8H_em_flw_max</code>, \u0394T_w_max).</li> <li>Determina <code>\u03b8H_em_flw</code> e <code>\u03b8H_em_ret</code> coerenti e ricava la portata da \u0394T acqua.</li> <li><code>\u03b8H_em_flw_min</code> include offset di miscelazione.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c4self-common_params-int-c4-onoff-intermittente","title":"<code>calculate_type_C4(self, common_params, \u03b8int)</code> \u2014 C.4: ON\u2013OFF intermittente","text":"<ul> <li>Usa un duty cycle per garantire l\u2019energia oraria con potenza ON.</li> <li>Determina <code>\u03b8H_em_flw_calc</code> durante ON (da TB14, \u03b2 richiesto).</li> <li>Fornisce minimi di mandata per il circuito di distribuzione.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c5self-common_params-int-c5-portata-costante-scambio-variabile-bypass","title":"<code>calculate_type_C5(self, common_params, \u03b8int)</code> \u2014 C.5: portata costante, scambio variabile (bypass)","text":"<ul> <li>Mantiene portata nominale; la mandata effettiva \u00e8 il massimo tra il calcolo e il set minimo (<code>\u03b8H_em_flw_min_tz_i</code>).</li> <li>L\u2019uscita include <code>\u03b8H_em_flw_min</code> (con margine di miscelazione).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#8-temperatura-nodo-circuito-secondario","title":"8) Temperatura nodo circuito (secondario)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_circuit_node_temperatureself-ext-emission_results","title":"<code>calculate_circuit_node_temperature(self, \u03b8ext, emission_results)</code>","text":"<ul> <li>Scopo: calcola la mandata al nodo <code>\u03b8H_nod_out</code> in base al tipo di controllo secondario:</li> <li>Type 1 \u2013 Based on demand: usa <code>\u03b8H_em_flw_min</code> dell\u2019emissione.</li> <li>Type 2 \u2013 Based on outdoor: usa la curva climatica secondaria.</li> <li>Type 3 \u2013 Constant temperature: usa <code>\u03b8em_flw_sahz_i</code> (costante).</li> <li>Output: <code>\u03b8H_nod_out</code> (\u00b0C).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#9-condizioni-operative-secondario","title":"9) Condizioni operative (secondario)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_operating_conditionsself-emission_results-common_params-int-h_nod_out","title":"<code>calculate_operating_conditions(self, emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"<ul> <li>Scopo: combina la scelta C.2/C.3/C.4/C.5 e il nodo per generare:</li> <li>temperature circuito: <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, portata <code>V_H_cr</code>;</li> <li>temperature distribuzione (tra collettore ed emettitore): <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>;</li> <li>fattore di carico <code>\u03b2H_em</code> e mandata minima richiesta <code>\u03b8H_em_flw_min</code>;</li> <li>ritorno effettivo emettitore (usato a valle).</li> <li>Note:</li> <li>C.4 introduce tempo ON e calcolo di potenza in ON;</li> <li>C.5 tiene mandata minima e calcola il ritorno dal bilancio con portata costante.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#10-distribuzione","title":"10) Distribuzione","text":""},{"location":"iso_15316_calculation_procedure/#calculate_distributionself-h_dis_flw-h_dis_ret-int-qh_em_i_in","title":"<code>calculate_distribution(self, \u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"<ul> <li>Scopo: stima le perdite di distribuzione e gli ausiliari, la parte recuperabile e l\u2019energia in ingresso richiesta dalla distribuzione.</li> <li>Formule chiave:</li> <li>Perdite [kWh] \u2248 <code>((T_media - T_int) * U[W/K] / 1000) * t[h]</code></li> <li>Ingresso richiesto: <code>QH_dis_i_in = QH_dis_i_req + perdite - aux - recuperi</code></li> <li>Portata di distribuzione: <code>V_H_dis = QH_dis_i_in / (c_w * \u0394T_dis * t)</code></li> <li>Output: dizionario con perdite/aux/recuperi e <code>V_H_dis</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#11-efficienza-del-generatore-primario","title":"11) Efficienza del generatore (primario)","text":""},{"location":"iso_15316_calculation_procedure/#_efficiency_from_modelself-flw-ret-load_frac10","title":"<code>_efficiency_from_model(self, \u03b8flw, \u03b8ret, load_frac=1.0)</code>","text":"<ul> <li>Scopo: restituisce l\u2019efficienza (%) secondo il modello scelto:</li> <li>simple: euristico in funzione di <code>\u03b8ret</code> (condensa alta a ritorni bassi).</li> <li>parametric: modello lineare a tratti (parametri: <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>).</li> <li>manufacturer: curve 1D (\u03b7=f(Tret)) o 2D (\u03b7=f(Tflw,Tret)) con interpolazione bilineare.</li> <li>Note: clamp a [1, 110] %; fallback a modello semplice se curve non valide.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#12-setpoint-mandata-primaria","title":"12) Setpoint mandata primaria","text":""},{"location":"iso_15316_calculation_procedure/#_generator_flow_setpointself-ext-h_dis_flw_demand","title":"<code>_generator_flow_setpoint(self, \u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"<ul> <li>Scopo: calcola il setpoint di mandata primaria in base al controllo selezionato:</li> <li>Type A \u2013 Outdoor: usa la curva primaria (min/max vs T esterna).</li> <li>Type B \u2013 Demand: insegue la domanda secondaria (<code>\u03b8H_dis_flw</code>).</li> <li>Type C \u2013 Constant: usa <code>\u03b8HW_gen_flw_const</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#13-generazione-primario","title":"13) Generazione (primario)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_generationself-h_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"<code>calculate_generation(self, \u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"<ul> <li>Scopo: calcola l\u2019uscita termica primaria e i consumi.</li> <li>Passi:</li> <li>Capacit\u00e0 max: <code>max_output_g1 = P_full * LF_max * t</code>.</li> <li>Richiesta: <code>QH_gen_out = min(QH_dis_i_in, max_output_g1)</code>.</li> <li>Masse/portate: <code>ms = \u03c1 * V_dis</code>.</li> <li>Schemi idraulici:<ul> <li>direct: primario=secondario;</li> <li>independent: calcolo <code>\u0394T_p</code>, setpoint mandata primaria (A/B/C), perdite linea primaria, portata primaria <code>mp = Q * 1000 / (c_w * \u0394T)</code>, antimescolamento opzionale, ritorno <code>Tp_ret</code>.</li> </ul> </li> <li>Efficienza: ricalcolo con temperature effettive.</li> <li>Energetica:<ul> <li><code>EHW_gen_in = (QH_gen_out * 100) / \u03b7</code></li> <li><code>EHW_gen_aux = EHW_gen_in * (aux_generator/100)</code></li> <li>Perdite recuperabili del generatore <code>QW_gen_i_ls_rbl_H</code></li> <li>Bilanci <code>QW_gen_out</code>, <code>QHW_gen_out</code> e ripartizione <code>EH_gen_in</code> / <code>EWH_gen_in</code></li> </ul> </li> <li>Output: dizionario con temperature primarie, portate, efficienza e consumi.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#14-esecuzione-singolo-passo","title":"14) Esecuzione singolo passo","text":""},{"location":"iso_15316_calculation_procedure/#compute_stepself-q_h_kwh-int-ext","title":"<code>compute_step(self, q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>Flusso:</li> <li>Parametri comuni emissione</li> <li>Emissione C.2/C.3/C.4/C.5 (in base a <code>selected_emm_cont_circuit</code>)</li> <li>Calcolo mandata nodo (secondario)</li> <li>Operating conditions del circuito</li> <li>Distribuzione</li> <li>Generazione (primario)</li> <li>Composizione dell\u2019output del passo (dizionario)</li> <li>Ritorna: tutte le temperature, portate ed energie del passo.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#15-esecuzione-serie-temporali","title":"15) Esecuzione serie temporali","text":""},{"location":"iso_15316_calculation_procedure/#_temps_row_when_offself-int-ext","title":"<code>_temps_row_when_off(self, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>Scopo: in assenza di carico (<code>Q_H \u2264 0</code>) e con policy <code>off_compute_mode='temps'</code>,   calcola solo le temperature significative tenendo potenze/portate=0.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#run_timeseriesself-dfnone","title":"<code>run_timeseries(self, df=None)</code>","text":"<ul> <li>Scopo: esegue il calcolo su tutto il DataFrame temporale.</li> <li>Alias riconosciuti:</li> <li><code>Q_H_kWh</code> \u2194 <code>Q_H</code>, <code>Q_h</code>, <code>Heating_needs</code></li> <li><code>T_op</code> \u2194 <code>T_int</code>, <code>theta_int</code></li> <li><code>T_ext</code> \u2194 <code>theta_ext</code></li> <li>Policy quando <code>Q_H \u2264 0</code>:</li> <li><code>calc_when_QH_positive_only=False</code>: calcola comunque il flusso completo.</li> <li><code>True</code> con:<ul> <li><code>idle</code>: riga \u201cvuota\u201d (NaN/0) \u2014 vedi <code>_idle_row</code>.</li> <li><code>temps</code>: riga solo temperature \u2014 vedi <code>_temps_row_when_off</code>.</li> <li><code>full</code>: calcolo completo anche con carico nullo.</li> </ul> </li> <li>Ritorna: DataFrame indicizzato per timestamp con tutte le colonne.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#16-colonne-chiave-in-uscita-estratto","title":"16) Colonne chiave in uscita (estratto)","text":"<ul> <li>Ingressi di passo: <code>Q_h(kWh)</code>, <code>T_op(\u00b0C)</code>, <code>T_ext(\u00b0C)</code></li> <li>Emissione: <code>\u03a6H_em_eff(kW)</code>, <code>\u03b8H_em_flow(\u00b0C)</code>, <code>\u03b8H_em_ret(\u00b0C)</code>, <code>V_H_em_eff(m3/h)</code>, <code>\u03b8H_em_flw_min_req(\u00b0C)</code></li> <li>Nodo/Circuito: <code>\u03b8H_nod_out(\u00b0C)</code>, <code>\u03b8H_cr_flw(\u00b0C)</code>, <code>\u03b8H_cr_ret(\u00b0C)</code>, <code>V_H_cr(m3/h)</code>, <code>\u03b2H_em(-)</code></li> <li>Distribuzione: <code>Q_w_dis_i_ls(kWh)</code>, <code>Q_w_dis_i_aux(kWh)</code>, <code>Q_w_dis_i_ls_rbl_H(kWh)</code>, <code>QH_dis_i_in(kWh)</code>, <code>V_H_dis(m3/h)</code></li> <li>Generazione: <code>QH_gen_out(kWh)</code>, <code>\u03b8X_gen_cr_flw(\u00b0C)</code>, <code>\u03b8X_gen_cr_ret(\u00b0C)</code>, <code>V_H_gen(m3/h)</code>, <code>efficiency_gen(%)</code>, <code>EHW_gen_in(kWh)</code>, <code>EHW_gen_aux(kWh)</code></li> </ul>"},{"location":"iso_15316_calculation_procedure/#17-esempio-minimo-duso","title":"17) Esempio minimo d\u2019uso","text":"<pre><code>import pandas as pd\n\n# Serie oraria minimale\ndf = pd.DataFrame({\n    \"Q_H_kWh\": [4.0, 2.0, 0.0, 3.5],\n    \"T_op\":    [20.0, 20.0, 20.0, 20.0],\n    \"T_ext\":   [5.0, 6.0, 7.0, 4.0],\n}, index=pd.date_range(\"2025-01-01\", periods=4, freq=\"H\"))\n\ninp = {\n    \"emitter_type\": \"Floor heating\",\n    \"nominal_power\": 8.0,\n    \"selected_emm_cont_circuit\": 1,  # C.3\n    \"flow_temp_control_type\": \"Type 1 - Based on demand\",\n    \"gen_flow_temp_control_type\": \"Type A - Based on outdoor temperature\",\n}\n\ncalc = HeatingSystemCalculator(inp)\ncalc.load_csv_data(df)\nout = calc.run_timeseries()\nprint(out.head())\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#18-buone-pratiche-e-note","title":"18) Buone pratiche e note","text":"<ul> <li>Verificare che <code>TB14</code> contenga le righe per il tipo emettitore (<code>emitter_type</code>) e le colonne:</li> <li><code>Emitters_nominal_deltaTeta_Water_C</code>, <code>Emitters_nominale_deltaTeta_air_C</code>, <code>Emitters_exponent_n</code>.</li> <li>Coerenza unit\u00e0: fornire Q_H in kWh (o Wh con conversione automatica).</li> <li>Per schemi independent, valutare:</li> <li><code>generator_nominal_deltaT</code>, <code>gen_flow_temp_control_type</code>, <code>\u03b8HW_gen_flw_const</code>,</li> <li><code>allow_dilution</code> e <code>primary_line_loss</code> se si vuole modellare il nodo idraulico primario con/ senza miscelazione.</li> <li>Il modello di efficienza pu\u00f2 essere raffinato con curve produttore (1D/2D) per caldaie/pompe di calore.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#19-mappa-funzioni-responsabilita","title":"19) Mappa funzioni \u2192 responsabilit\u00e0","text":"Funzione Responsabilit\u00e0 principale <code>_load_constants</code> Costanti globali e <code>TB14</code> <code>_load_input_parameters</code> Lettura di tutti i parametri (emissione, distribuzione, generazione) <code>_default_emission_data</code>, <code>_default_outdoor_data</code> Default per limiti/setpoint e curva climatica secondaria <code>load_csv_data</code> Caricamento timeseries e normalizzazione energia <code>calculate_common_emission_parameters</code> Parametri comuni emissione (C.2\u2013C.5) <code>calculate_type_C2/C3/C4/C5</code> Modelli specifici di emissione <code>calculate_circuit_node_temperature</code> Mandata al nodo secondo la policy secondaria <code>calculate_operating_conditions</code> Temperature/portate circuito e distribuzione <code>calculate_distribution</code> Perdite/ausiliari/recuperi e portata di distribuzione <code>_efficiency_from_model</code> Rendimento generatore secondo modello scelto <code>_generator_flow_setpoint</code> Setpoint mandata primaria (outdoor/demand/costante) <code>calculate_generation</code> Bilancio primario: potenza utile, efficienza, consumi <code>compute_step</code> Pipeline completa per un singolo passo <code>_temps_row_when_off</code> Riga \u201csolo temperature\u201d quando Q_H\u22640 <code>run_timeseries</code> Esecuzione sull\u2019intera serie temporale <p>Fine. Se vuoi, posso aggiungere un diagramma di flusso (mermaid) o una tabella parametri I/O dettagliata per ogni funzione.</p>"},{"location":"iso_15316_calculation_procedure/#heatingsystemcalculator-guida-estesa-con-diagramma-di-flusso-e-tabelle-io-it","title":"HeatingSystemCalculator \u2014 Guida estesa con diagramma di flusso e tabelle I/O (IT)","text":"<p>Questo documento estende la guida con: 1) Un diagramma di flusso (Mermaid) del percorso di calcolo 2) Tabelle I/O (ingressi/uscite/side-effects) per le funzioni principali</p> <p>Nota: richiede un renderer che supporti i blocchi <code>mermaid</code>.</p>"},{"location":"iso_15316_calculation_procedure/#1-diagramma-di-flusso-panoramica","title":"1) Diagramma di flusso (panoramica)","text":"<pre><code>flowchart TB\n    subgraph Primary[\"Primary Circuit\"]\n        G[Generator/Boiler]\n        PP[Primary Pump]\n        HS[Hydraulic Separator]\n    end\n\n    subgraph Secondary[\"Secondary Circuit\"]\n        SP[Secondary Pump]\n        Z1[Zone 1]\n        Z2[Zone 2]\n        Z3[Zone 3]\n    end\n\n    G --&gt; PP\n    PP --&gt; HS\n    HS --&gt; SP\n    SP --&gt; Z1\n    SP --&gt; Z2\n    SP --&gt; Z3\n</code></pre> <pre><code>graph TD\n    A[Start] --&gt; B{Decision}\n    B --&gt;|Yes| C[Option 1]\n    B --&gt;|No| D[Option 2]\n    C --&gt; E[End]\n    D --&gt; E\n</code></pre> <pre><code>flowchart TD\n    A[Start] --&gt; B[__init__(input_data)]\n    B --&gt; C[_load_constants]\n    B --&gt; D[_load_input_parameters]\n    C --&gt; E{Esecuzione?}\n    D --&gt; E\n\n    E --&gt;|singolo passo| F[compute_step(q_h, \u03b8int, \u03b8ext)]\n    E --&gt;|serie temporali| TS[run_timeseries(df)]\n\n    %% Pipeline singolo passo\n    subgraph Pipeline compute_step\n    F --&gt; G[calculate_common_emission_parameters]\n    G --&gt; H{Tipo circuito?}\n    H --&gt;|C.2| I1[calculate_type_C2]\n    H --&gt;|C.3| I2[calculate_type_C3]\n    H --&gt;|C.4| I3[calculate_type_C4]\n    H --&gt;|C.5| I4[calculate_type_C5]\n    I1 --&gt; J[calculate_circuit_node_temperature]\n    I2 --&gt; J\n    I3 --&gt; J\n    I4 --&gt; J\n    J --&gt; K[calculate_operating_conditions]\n    K --&gt; L[calculate_distribution]\n    L --&gt; M[calculate_generation]\n    M --&gt; N[Compose outputs dict]\n    end\n\n    %% Pipeline serie temporali\n    subgraph Timeseries run_timeseries\n    TS --&gt; TS0{Row loop}\n    TS0 --&gt;|Q_H \u2264 0 AND policy=idle| T0[_idle_row]\n    TS0 --&gt;|Q_H \u2264 0 AND policy=temps| T1[_temps_row_when_off]\n    TS0 --&gt;|altrimenti| T2[compute_step]\n    T0 --&gt; T3[accumula risultati]\n    T1 --&gt; T3\n    T2 --&gt; T3\n    end\n\n    N --&gt; O[Return dict]\n    T3 --&gt; P[Return DataFrame]\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#2-tabelle-di-inputoutput-funzioni-principali","title":"2) Tabelle di Input/Output (funzioni principali)","text":""},{"location":"iso_15316_calculation_procedure/#21-__init__input_data","title":"2.1 <code>__init__(input_data)</code>","text":"Campo Tipo Descrizione <code>input_data</code> dict Parametri di emissione, distribuzione, generazione, policy e tabelle. Output Inizializza l\u2019istanza e richiama <code>_load_constants()</code> &amp; <code>_load_input_parameters()</code>."},{"location":"iso_15316_calculation_procedure/#22-_load_constants","title":"2.2 <code>_load_constants()</code>","text":"Campo Tipo Descrizione <code>input_data[\"TB14\"]</code> (opzionale) <code>pd.DataFrame</code> Tabella ISO con \u0394T nominali/esponente; se assente usa <code>TB14_backup</code>. Side-effects <code>self.TB14</code> assegnata; <code>self.c_w = 1.16</code>. Output Nessun ritorno esplicito."},{"location":"iso_15316_calculation_procedure/#23-_load_input_parameters","title":"2.3 <code>_load_input_parameters()</code>","text":"Blocco Chiavi principali Default (esempio) Emissione <code>emitter_type</code>, <code>nominal_power</code>, <code>emission_efficiency</code>, <code>mixing_valve</code>, <code>flow_temp_control_type</code>, <code>auxiliars_power</code>, <code>emission_operation_time</code>, <code>mixing_valve_delta</code>, <code>selected_emm_cont_circuit</code>, <code>heat_emission_data</code>, <code>outdoor_temp_data</code>, <code>constant_flow_temp</code> <code>Floor heating</code>, <code>8 kW</code>, <code>90%</code>, <code>True</code>, <code>Type 1</code>, <code>0 W</code>, <code>1 h</code>, <code>2 \u00b0C</code>, <code>0</code>, tabelle di default Distribuzione <code>Heat_losses_recovered</code>, <code>distribution_loss_recovery</code>, <code>simplified_approach</code>, <code>distribution_aux_recovery</code>, <code>distribution_aux_power</code>, <code>distribution_loss_coeff</code>, <code>distribution_operation_time</code>, <code>recoverable_losses</code> <code>True</code>, <code>90%</code>, <code>80%</code>, <code>80%</code>, <code>30 W</code>, <code>48 W/K</code>, <code>1 h</code>, <code>0 kWh</code> Generazione <code>full_load_power</code>, <code>max_monthly_load_factor</code>, <code>tH_gen_i_ON</code>, <code>auxiliary_power_generator</code>, <code>fraction_of_auxiliary_power_generator</code>, <code>generator_circuit</code>, <code>speed_control_generator_pump</code>, <code>generator_nominal_deltaT</code>, <code>\u03b8HW_gen_flw_set</code>, <code>\u03b8HW_gen_ret_set</code>, <code>calc_when_QH_positive_only</code>, <code>fill_zeros_when_skipped</code>, <code>off_compute_mode</code>, <code>efficiency_model</code>, <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>, <code>manuf_curve_1d</code>, <code>manuf_curve_2d</code>, <code>gen_flow_temp_control_type</code>, <code>gen_outdoor_temp_data</code>, <code>\u03b8HW_gen_flw_const</code> <code>24 kW</code>, <code>100%</code>, <code>1 h</code>, <code>0%</code>, <code>40%</code>, <code>independent</code>, <code>variable</code>, <code>20 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>True</code>, <code>False</code>, <code>idle</code>, <code>simple</code>, <code>110%</code>, <code>95%</code>, <code>20 \u00b0C</code>, <code>50 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>Type A</code>, curva primaria default, <code>50 \u00b0C</code>"},{"location":"iso_15316_calculation_procedure/#24-_default_emission_data-_default_outdoor_data","title":"2.4 <code>_default_emission_data()</code> / <code>_default_outdoor_data()</code>","text":"Funzione Output Note <code>_default_emission_data</code> DF con <code>\u03b8H_em_flw_max_sahz_i</code>, <code>\u0394\u03b8H_em_w_max_sahz_i</code>, <code>\u03b8H_em_ret_req_sahz_i</code>, <code>\u03b2H_em_req_sahz_i</code>, <code>\u03b8H_em_flw_min_tz_i</code> Limiti/setpoint lato secondario <code>_default_outdoor_data</code> DF con <code>\u03b8ext_min_sahz_i</code>, <code>\u03b8ext_max_sahz_i</code>, <code>\u03b8em_flw_max_sahz_i</code>, <code>\u03b8em_flw_min_sahz_i</code> Curva climatica secondaria"},{"location":"iso_15316_calculation_procedure/#25-load_csv_datacsv_path_or_df","title":"2.5 <code>load_csv_data(csv_path_or_df)</code>","text":"Input Tipo Descrizione <code>csv_path_or_df</code> str / DataFrame Timeseries con colonne (<code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> o alias) Output DataFrame Con eventuale <code>Q_H_kWh</code> aggiunto; salvato in <code>self.timeseries_data</code>"},{"location":"iso_15316_calculation_procedure/#26-calculate_common_emission_parametersheating_needs_kwh-int","title":"2.6 <code>calculate_common_emission_parameters(heating_needs_kWh, \u03b8int)</code>","text":"Output (chiave) Descrizione <code>QH_sys_out_hz_i</code> Richiesta netta dopo recuperi <code>QH_em_i_in</code> Energia in ingresso all\u2019emissione <code>\u03a6H_em_eff</code> Potenza media su intervallo (kW) <code>V_H_em_nom</code> Portata nominale (m\u00b3/h) <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code> Parametri da TB14"},{"location":"iso_15316_calculation_procedure/#27-calculate_type_c2-c3-c4-c5","title":"2.7 <code>calculate_type_C2 / C3 / C4 / C5</code>","text":"Funzione Principio Output principali <code>C2</code> Portata costante, T acqua costante <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C3</code> Portata variabile, T emettitore costante (ritorno limitato) <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C4</code> ON\u2013OFF (duty cycle) <code>\u03b8H_em_flw_calc</code>, <code>\u03b8H_em_flw_min</code>, ecc. <code>C5</code> Portata costante, scambio variabile (bypass) <code>\u03b8H_em_flow=min</code>, <code>\u03b8H_em_ret\u2248</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code>"},{"location":"iso_15316_calculation_procedure/#28-calculate_circuit_node_temperatureext-emission_results","title":"2.8 <code>calculate_circuit_node_temperature(\u03b8ext, emission_results)</code>","text":"Controllo Logica Output Type 1 Domanda \u2192 <code>\u03b8H_em_flw_min</code> <code>\u03b8H_nod_out</code> Type 2 Curva climatica secondaria <code>\u03b8H_nod_out</code> Type 3 Costante (<code>\u03b8em_flw_sahz_i</code>) <code>\u03b8H_nod_out</code>"},{"location":"iso_15316_calculation_procedure/#29-calculate_operating_conditionsemission_results-common_params-int-h_nod_out","title":"2.9 <code>calculate_operating_conditions(emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"Caso Output principali C.2 / C.3 / C.4 / C.5 <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, <code>V_H_cr</code>, <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>, <code>\u03b2H_em</code>, <code>\u03b8H_em_flw_min</code>, <code>\u03b8H_em_ret_eff</code>"},{"location":"iso_15316_calculation_procedure/#210-calculate_distributionh_dis_flw-h_dis_ret-int-qh_em_i_in","title":"2.10 <code>calculate_distribution(\u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"Output Significato <code>Q_w_dis_i_ls</code>, <code>Q_w_dis_i_aux</code>, <code>Q_w_dis_i_ls_rbl_H</code> Perdite, ausiliari e parte recuperabile (kWh) <code>QH_dis_i_req</code>, <code>QH_dis_i_in</code> Richiesta e ingresso effettivo alla distribuzione <code>V_H_dis</code> Portata volumetrica di distribuzione (m\u00b3/h)"},{"location":"iso_15316_calculation_procedure/#211-_efficiency_from_modelflw-ret-load_frac","title":"2.11 <code>_efficiency_from_model(\u03b8flw, \u03b8ret, load_frac)</code>","text":"Modelli Descrizione <code>simple</code> Efficienza in funzione di T_ritorno (condensa) <code>parametric</code> Lineare a tratti con soglie (<code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>) <code>manufacturer</code> Curve 1D/2D del costruttore con interpolazione"},{"location":"iso_15316_calculation_procedure/#212-_generator_flow_setpointext-h_dis_flw_demand","title":"2.12 <code>_generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"Tipo Logica Type A Curva primaria (outdoor) Type B Insegue domanda secondaria Type C Costante"},{"location":"iso_15316_calculation_procedure/#213-calculate_generationh_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"2.13 <code>calculate_generation(\u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"Output Significato <code>max_output_g1</code>, <code>QH_gen_out</code> Limite capacit\u00e0 e uscita termica (kWh) <code>\u03b8X_gen_cr_flw</code>, <code>\u03b8X_gen_cr_ret</code> Mandata/ritorno primario effettivi (\u00b0C) <code>V_H_gen</code> Portata primaria (m\u00b3/h) <code>efficiency_gen</code> Rendimento (%) <code>EHW_gen_in</code>, <code>EHW_gen_aux</code> Energia in ingresso e ausiliari (kWh) <code>QW_gen_i_ls_rbl_H</code> Perdite recuperabili generatore (kWh) <code>QW_gen_out</code>, <code>QHW_gen_out</code>, <code>EH_gen_in</code>, <code>EWH_gen_in</code> Bilanci termici"},{"location":"iso_15316_calculation_procedure/#214-compute_stepq_h_kwh-int-ext","title":"2.14 <code>compute_step(q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"Input Output <code>q_h_kWh</code>, <code>\u03b8int</code>, <code>\u03b8ext</code> Dizionario completo con emissione, nodo/circuito, distribuzione, generazione"},{"location":"iso_15316_calculation_procedure/#215-_temps_row_when_offint-ext","title":"2.15 <code>_temps_row_when_off(\u03b8int, \u03b8ext)</code>","text":"Scopo Output Riga \u201csolo temperature\u201d per <code>Q_H \u2264 0</code> Stesse chiavi principali, con potenze/portate=0"},{"location":"iso_15316_calculation_procedure/#216-run_timeseriesdfnone","title":"2.16 <code>run_timeseries(df=None)</code>","text":"Input Output <code>df</code> (opzionale) o <code>self.timeseries_data</code> DataFrame indicizzato per timestamp con risultati di ogni passo"},{"location":"iso_15316_calculation_procedure/#3-suggerimenti-di-modellazione","title":"3) Suggerimenti di modellazione","text":"<ul> <li>Verifica coerenza tra tipo emettitore e righe di <code>TB14</code>.  </li> <li>Per schemi independent, cura <code>generator_nominal_deltaT</code>, <code>primary_line_loss</code> e <code>allow_dilution</code>.  </li> <li>Usa <code>manufacturer</code> con curve realistiche del produttore quando disponibili.</li> </ul> <p>Fine \u2014 versione estesa.</p>"},{"location":"iso_15316_generation_circuit/","title":"GENERATION","text":"<p>The annex D of ISO 15316-1 standard provides the calculation procedure for the generation circuit. It is the general procedure that can be improved using the detailed standards for different type of generator, such as Heat pump, Combustion boilers, District heating and cooling, etc. </p> <p>There are 2 typed of generaiont circuit:</p> <p>1) Generation with DIRECT circuit withou hydraulic separtion 2) Generation with INDIPENDENT flow rate circuit, using the hydraulic separtion</p>"},{"location":"iso_15316_generation_circuit/#direct-circuit","title":"DIRECT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>The standard define no control to the circuit.  In the pybuildingenergy, the contol have been applied on the generator based on:</p> <pre><code>- 'Type A - Based on outdoor temperature': uses primary's own weather curve\n- 'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)\n- 'Type C - Constant temperature'       : uses self.\u03b8HW_gen_flw_const\n</code></pre> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> <p>No data</p> <p>System design data: </p> <p>No data</p> <p>Process control data</p> <p>No data</p> <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#independent-circuit","title":"INDEPENDENT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal generator power max_output_g1 kW - 0 to 10<sup>4</sup> Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) water (flow-return) dTp \u00b0C - 1..40 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system <p>System design data: </p> <p>No data</p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Generator pump speed control speed_control_generator_pump - - - Generator pump speed control, could be varaible or deltaT_constant <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Generation flow Temperature Tp_sup \u00b0C - - Generation flow Temperature Generation return Temperature Tp_ret \u00b0C - - Generation return Temperature Generation flow rate V_H_gen m3/h - - Generation flow rate"},{"location":"iso_15316_heating_circuit/","title":"Heating circuit.","text":"<p>The library provides modules for evaluating 4 types of hydraulic circuits, where, based on Table C.1 of the standard, for each circuit it is identified which type of emission system to use and the type of control. as defined below: </p> Code Module Emitters Control C2 Constan mass flow rate and varying water temperature Radiators and Panels Heating curve, mixing valvew and variable generation temperature C3 Varying mass flow (constant temperature) Radiators, Panels, Heating coils Thermostatic valve, flow rate control with two way valve C4 ON-OFF and varying temperature Radiators and Panels On-Off control C5 Varying heat exchange Fan-coil, heating coils emitters with on-off blower  and continuos circulation 3 way by-pass valve control <p>All modules allow the us of a mixing valve to allow different temperatures in the different circuits. A distinction is made between:  - the emitter tmperature and flow rate; - the circuit temperature and flow rate; </p> <p>They differ where there is a mixing or by-pass 3 way valve in the circuit.</p>"},{"location":"iso_15316_heating_circuit/#system-type-and-input-parameters","title":"System type and input parameters","text":""},{"location":"iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators Heating Panels Control Parameters Heating curve flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maximum distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c3-varying-mass-flow-rate-and-constant-water-temperature","title":"C3 - varying mass flow rate and constant water temperature","text":"<p>This configuration is for sample heating circuit with varying mass flow rate and constant water temperature. </p> Figure 1: System C3_1 - Example of sample heating circuit varying mass flow rate.  Figure 1: System C3_1 - Example of sample heating circuit with series control (AHU coil).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators with thermostatic valve AHU coil with series control Panels with PID control Control Parameters Maximum flow/return \u0394\u03b8 Maximum flow temperature Target return temperature <p>Inputs required</p> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve Target return temperature \u03b8H_em_ret_req_sahz_i \u00b0C - - Desired return temperature of the emission circuit Maximum flow/return \u0394\u03b8 \u0394\u03b8H_em_w_max_sahz_i \u00b0C - - Maximum flow/return temperature difference of the emission circuit Maximum flow temperature \u03b8H_em_flw_max_sahz_i \u00b0C - - Maximum flow temperature of the emission circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c4-intermittent-flow-rate-module-on-off","title":"C4 - Intermittent flow rate module (ON-OFF)","text":"<p>This configuration is for sample heating circuit with intermittent flow rate and constant water temperature. </p> Figure 1: System C4 - Example of sample heating circuit with intermittent flow rate module (ON-OFF).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Desired load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c5-constant-flow-rate-and-variable-heat-exchange","title":"C5 - Constant flow rate and variable heat exchange","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  Figure 1: System C4 - Example of sample heating circuit with three way by-pass control.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Target load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Minimum flow temperature \u03b8H_em_flw_min_sahz_i \u00b0C - - Minimum flow temperature of the emission circuit for a zone i Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"iso_15316_system_inputs/","title":"HVAC SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"iso_15316_system_inputs/#emission","title":"EMISSION","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</li> <li> <p>mixing valve delta: it is the offset temperature of the mixing valve in \u00b0C. It refers to the varaible mixing_valve_delta. </p> <ul> <li> <p>The offset refers to the temperature difference between the desired temperature and the actual temperature, which is applied when mixing hot and cold water.</p> </li> <li> <p>In this case, the parameter \u0394\u03b8H_em_mix_sahz_i represents the temperature offset applied by the mixing valve, with a default value set to 2\u00b0C (as defined in the code).</p> </li> <li> <p>This means that when the mixing valve is operating, it will allow a 2\u00b0C deviation from the desired temperature to account for system dynamics, such as heat losses, system inertia, or external temperature influences.</p> </li> </ul> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0 <p>heat_emission_data: it is the table that contains the data of the emission circuit. If it is not provided the default values are used and the emitter_type is set to the first one in the table. In the code we have the function <code>_default_emission_data()</code> that returns the default values. These values are default emission circuit parameters for the heating system\u2019s secondary side (the side connected to heating emitters, such as radiators or underfloor heating).  They represent nominal and operational setpoints for a single heating zone (HZ1), including flow/return temperatures and load control factors.</p> <p>Table 4: Emission circuit data</p> Parameter (column name) Description Default Value Unit <code>\u03b8H_em_flw_max_sahz_i</code> Maximum flow temperature for the heating emission circuit 45 \u00b0C <code>\u0394\u03b8H_em_w_max_sahz_i</code> Maximum water flow/return temperature difference 8 \u00b0C <code>\u03b8H_em_ret_req_sahz_i</code> Desired return temperature of the emission circuit 20 \u00b0C <code>\u03b2H_em_req_sahz_i</code> Desired load factor with ON/OFF control 80 % <code>\u03b8H_em_flw_min_tz_i</code> Minimum required flow temperature for the thermal zone 28 \u00b0C"},{"location":"iso_15316_system_inputs/#distribution","title":"DISTRIBUTION","text":"<p><pre><code># --- distribution ---\n'heat_losses_recovered': True,\n'distribution_loss_recovery': 90,\n'simplified_approach': 80,\n'distribution_aux_recovery': 80,\n'distribution_aux_power': 30,\n'distribution_loss_coeff': 48,\n'distribution_operation_time': 1,\n</code></pre> The parameters are used inside the class HeatingSystemCalculator as:</p> <pre><code>self.Heat_losses_recovered = inp.get('heat_losses_recovered', True)\nself.f_h_dist_i_ls = inp.get('distribution_loss_recovery', 90)  # %\nself.simplified_or_holistic_approach = inp.get('simplified_approach', 80)  # %\nself.f_h_dist_i_aux = inp.get('distribution_aux_recovery', 80)  # %\nself.W_H_dist_i_aux = inp.get('distribution_aux_power', 30)  # W\nself.Heat_loss_coefficent_dist = inp.get('distribution_loss_coeff', 48)  # W/K\nself.tH_dis_i_ON = inp.get('distribution_operation_time', 1)  # h\n</code></pre> <p>if data is not provided by the user, the default values are used.</p> <p>These parameters describe the thermal and electrical behavior of the heat distribution subsystem, which connects the generator to the emitters (secondary circuits). They define how heat losses, auxiliary energy use, and simplifications in the calculation are handled within the ISO 15316-1 framework.</p> Variable Description Default Unit <code>heat_losses_recovered</code> Boolean flag that defines whether distribution heat losses are considered recoverable in the building (e.g., heat lost in indoor piping contributes to heating). <code>True</code> \u2013 <code>distribution_loss_recovery</code> (<code>f_h_dist_i_ls</code>) Fraction of distribution losses that are recoverable (typically within the heated zone). <code>90</code> % <code>simplified_approach</code> (<code>simplified_or_holistic_approach</code>) Defines the calculation approach for recovered losses: a simplified method (<code>&gt; 0</code>) or a holistic method (<code>0</code> for detailed ISO modeling). <code>80</code> % <code>distribution_aux_recovery</code> (<code>f_h_dist_i_aux</code>) Fraction of auxiliary electrical power (e.g., pumps, valves) that is converted into useful heat and recovered within the heated space. <code>80</code> % <code>distribution_aux_power</code> (<code>W_H_dist_i_aux</code>) Rated auxiliary electrical power of the distribution system (e.g., circulation pumps). <code>30</code> W <code>distribution_loss_coeff</code> (<code>Heat_loss_coefficent_dist</code>) Overall heat loss coefficient of the distribution system, representing thermal losses per degree of temperature difference between the fluid and ambient air. <code>48</code> W/K <code>distribution_operation_time</code> (<code>tH_dis_i_ON</code>) Average operation time of the distribution system per time step (typically the same as the emission system). <code>1</code> h"},{"location":"iso_15316_system_inputs/#generation","title":"GENERATION","text":"<p>The generator is modelled using the following parameters:</p> <pre><code>    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"])\n    '\u03b8HW_gen_flw_const': 50.0\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20\n</code></pre> <p>That are: </p> <ul> <li>load power: it is the power of the generator in kW, defined in the product data. variable name: 'full_load_power'</li> <li>max monthly load factor: it is the maximum load factor of the generator in %.  variable_name: 'max_monthly_load_factor'</li> <li>tH_gen_i_ON: it is the time of the generator in ON state in hours. variable_name: 'tH_gen_i_ON'</li> </ul> <ul> <li>auxiliary power generator: Percentage of generator input energy used by auxiliary systems (generally 0-5 %).Increases total system energy input. variable_name: 'auxiliary_power_generator'</li> <li> <p>fraction of auxiliary power generator: it is the portion of auxiliary energy recovered as heat (generally 20\u201360%). Reduces auxiliary losses.variable_name: 'fraction_of_auxiliary_power_generator'.</p> <p> 1. <code>auxiliary_power_generator</code> This parameter defines how much additional electrical power (in %) is consumed by the generator\u2019s own auxiliary components, such as:</p> <ul> <li>Circulation pumps  </li> <li>Combustion or ventilation fans  </li> <li>Electronic controls and sensors  </li> <li>Ignition systems  </li> <li>Internal electronics (standby mode)</li> </ul> <p>Formula:</p> \\[ E_{HW,gen,aux} = E_{HW,gen,in} \\times \\frac{\\text{auxiliary\\_power\\_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( E_{HW,gen,in} \\): Generator input energy (kWh)  </li> <li>\\( E_{HW,gen,aux} \\): Auxiliary energy consumed (kWh)</li> </ul> <p> 2. <code>fraction_of_auxiliary_power_generator</code></p> <p>This parameter represents the fraction of auxiliary power that is recoverable as useful heat. Some auxiliary systems release heat that can be recovered by the generator\u2019s thermal circuit.</p> <p>For example: - Pump motors or internal electronics may release part of their heat to the water loop. - Fans or controllers might dissipate energy inside the generator casing.</p> <p>Formula:</p> \\[ Q_{W,gen,i,ls,rbl,H} = E_{HW,gen,aux} \\times \\frac{\\text{fraction_of_auxiliary_power_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( Q_{W,gen,i,ls,rbl,H} \\): Recovered auxiliary heat (kWh)</li> </ul> </li> </ul> <ul> <li>generator circuit: it is the circuit of the generator. It can be 'direct' or 'independent'. variable_name: 'generator_circuit'<ul> <li>Direct: the generator is connected to the primary circuit, no hydraulic separation primary = secondary</li> <li>Independent: the generator is connected to the secondary circuit, with hydraulic separator primary != secondary</li> </ul> </li> </ul> <p>The primary circuit supply temperature setpoint (Tp_sup_set), i.e., the flow temperature on the generator side (boiler, heat pump, etc.) is calculated using the function _generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand), according to the selected control strategy of the generation system</p> <p>It determines how hot the generator should make the supply water based on: - the outdoor temperature (\u03b8ext), and/or - the heating demand from the distribution/emission side (\u03b8H_dis_flw_demand), and/or - a fixed setpoint defined by the user.</p> <p>The input parameters of the function are:</p> <ul> <li>\u03b8ext: outdoor air temperature</li> <li>\u03b8H_dis_flw_demand: Flow temperature requested by the secondary circuit (distribution/emission side)</li> </ul> <p>with global inputs that are:</p> <ul> <li>df_gen_out_temp: Table defining the primary (generator) heating curve</li> <li> <p>gen_flow_temp_control_type: Type of control used to control the flow temperature of the generator.Defines which control strategy is used (\u201cType A\u201d, \u201cType B\u201d, \u201cType C\u201d):</p> <ul> <li>'Type A - Based on outdoor temperature': uses primary's own weather curve</li> <li>'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)</li> <li>'Type C - Constant temperature'       : uses \u03b8HW_gen_flw_const</li> </ul> </li> <li> <p>\u03b8HW_gen_flw_const: Constant flow temperature of the generator</p> </li> </ul> <p>The user should provide the information directly in the dictionary:</p> <pre><code>'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n'gen_outdoor_temp_data': pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],\n    \"\u03b8flw_gen_min\": [35],\n}, index=[\"Generator curve\"])\n'\u03b8HW_gen_flw_const': 50.0\n</code></pre> <p>where, in the code are defined as: </p> <p><pre><code>self.df_gen_out_temp = inp.get('gen_outdoor_temp_data', pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],   # \u00b0C, max primary supply\n    \"\u03b8flw_gen_min\": [35],   # \u00b0C, min primary supply\n}, index=[\"Generator curve\"]))\n\nself.gen_flow_temp_control_type = inp.get(\n    'gen_flow_temp_control_type',\n    'Type A - Based on outdoor temperature'   # 'Type A' | 'Type B' | 'Type C'\n)\n\nself.\u03b8HW_gen_flw_const = float(inp.get('\u03b8HW_gen_flw_const', 50.0))\n</code></pre> Explanation of the different type of control:</p> <ul> <li> Type A - Based on outdoor temperature. Climatic curve (outdoor compensation) <pre><code>if ctrl.startswith('Type A'):\n    if \u03b8ext_max != \u03b8ext_min:\n        Tp = \u03b8flw_min + (\u03b8flw_max - \u03b8flw_min) * (\u03b8ext_max - \u03b8ext) / (\u03b8ext_max - \u03b8ext_min)\n        return max(min(Tp, \u03b8flw_max), \u03b8flw_min)\n    return \u03b8flw_min\n</code></pre> Calculates the generator flow temperature linearly based on outdoor temperature. Equation: The generator flow temperature \\( T_{p, \\text{set}} \\) is calculated linearly based on the outdoor temperature \\( \\theta_{\\text{ext}} \\), following the formula:</li> </ul> \\[ T_{p, \\text{set}} = T_{\\text{flw}, \\text{min}} + \\left( T_{\\text{flw}, \\text{max}} - T_{\\text{flw}, \\text{min}} \\right) \\cdot \\frac{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}} \\right)}{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}, \\text{min}} \\right)} \\] <p>Where:</p> <ul> <li>\\( T_{\\text{flw}, \\text{min}} \\) = minimum flow temperature (e.g., 35\u00b0C)</li> <li>\\( T_{\\text{flw}, \\text{max}} \\) = maximum flow temperature (e.g., 60\u00b0C)</li> <li>\\( \\theta_{\\text{ext}} \\) = outdoor air temperature</li> <li>\\( \\theta_{\\text{ext}, \\text{min}} \\) = minimum outdoor temperature (e.g., -7\u00b0C)</li> <li>\\( \\theta_{\\text{ext}, \\text{max}} \\) = maximum outdoor temperature (e.g., 15\u00b0C) The calculated \\( T_{p, \\text{set}} \\) is then clamped between the minimum and maximum values:</li> </ul> \\[ T_{p, \\text{set}} = \\max\\left( \\min\\left( T_{p, \\text{set}}, T_{\\text{flw}, \\text{max}} \\right), T_{\\text{flw}, \\text{min}} \\right) \\] <p>\ud83d\udc49\ud83c\udffb Meaning: This is the typical weather-compensated control used (for example) in boilers and heat pumps. It automatically adjusts water temperature to the outdoor conditions for better efficiency and comfort. Example visualization of type A: <pre><code>Generator flow temperature (\u00b0C)\n\u2502\n\u2502    60\u00b0C \u2500\u2500\u2500\u2500\u2510\n\u2502              \\\n\u2502               \\\n\u2502                \\\n\u2502                 \\\n\u2502    35\u00b0C \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Outdoor temperature (\u00b0C)\n          -7          0           +15\n</code></pre></p> <ul> <li> <p> Type B - Based on demand. Follow secondary demand <pre><code>if ctrl.startswith('Type B'):\n    return float(\u03b8H_dis_flw_demand)\n</code></pre> Sets the generator supply temperature equal to the demand from the secondary (distribution/emission) side. \ud83d\udc49\ud83c\udffb Meaning: This is used in systems with hydraulic separation (e.g., with a buffer tank or heat exchanger) where the generator must match the needs of the secondary circuit dynamically. Example: If the radiator loop requests 45 \u00b0C \u2192 the generator must deliver exactly 45 \u00b0C to maintain balance.</p> </li> <li> <p> Type C - Constant temperature <pre><code>return float(self.\u03b8HW_gen_flw_const)\n</code></pre> Ignores weather and demand \u2014 the generator runs at a fixed supply temperature (e.g., 50 \u00b0C). \ud83d\udc49\ud83c\udffb Meaning: Simplest and oldest control type, often found in small or legacy heating systems. It offers no adaptation to weather or load, typically less efficient. Example: If the user defines a constant supply temperature of 50 \u00b0C \u2192 the generator will always deliver 50 \u00b0C, regardless of the demand from the secondary circuit.</p> </li> </ul> <ul> <li>speed control of generator pump: icontrols how \u0394T varies with system load (constant vs variable). It can be in the code 'variable' or 'deltaT_constant'. variable_name: 'speed_control_generator_pump'</li> <li> <p>Nominal water deltaT of generator: defines the nominal \u0394T at design (full load) \u2014 the reference used in thermal balance equations in \u00b0C. variable_name: 'generator_nominal_deltaT'. It is used if speed_control_of_generator_pump is 'deltaT_constant'.</p> <p>More info:</p> <ul> <li><code>\"deltaT_constant\"</code> \u2192 The pump maintains a fixed temperature difference (\u0394T) between flow and return.</li> <li>Example: The pump adjusts its speed so that \u0394T = 20 \u00b0C remains constant.</li> <li><code>\"variable\"</code> \u2192 The pump varies its speed dynamically according to the system load.</li> <li>When heating demand decreases, the water flow rate decreases.</li> <li>This leads to a smaller \u0394T at partial loads, improving efficiency.</li> </ul> <p>When <code>variable</code>, the temperature difference (\u0394T) decreases proportionally with the thermal load, which represents real modulating behavior of pumps and heat generators.</p> <p><code>generator_nominal_deltaT</code></p> <p>Defines the nominal temperature difference (\u0394T) between the generator flow and return at full-load conditions.</p> \\[ \\Delta T_{nom} = T_{flow,nominal} - T_{return,nominal} \\] <p>This is the design operating condition for the generator, used as a reference in calculations.</p> <p>Example:</p> <p>If <code>generator_nominal_deltaT = 20</code>, then at full load:</p> <ul> <li>Supply temperature = 60 \u00b0C  </li> <li>Return temperature = 40 \u00b0C \u2192 \u0394T = 20 \u00b0C  </li> </ul> <p>At partial load:</p> <ul> <li>If <code>speed_control_generator_pump = \"deltaT_constant\"</code> \u2192 \u0394T remains 20 \u00b0C.  </li> <li>If <code>speed_control_generator_pump = \"variable\"</code> \u2192 \u0394T may drop to 10\u201315 \u00b0C, depending on demand.</li> </ul> </li> </ul> <p>It is possible to define the optional primary setpoints (used if circuit is independent).</p> <ul> <li>\u03b8HW_gen_flw_set: flow temperature setpoint</li> <li>\u03b8HW_gen_ret_set: return temperature setpoint</li> </ul>"},{"location":"iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <pre><code>1) 'simple'       : linear heuristic vs. return temperature\n2) 'parametric'   : piecewise/threshold model\n3) 'manufacturer' : 1D (return) or 2D (flow/return) map\n</code></pre> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic</p> <p>1) Detect zero or negative heating demand</p> <p><pre><code>if float(qh) &lt;= 0:\n</code></pre> This means there is no heating required (or possibly cooling). Now the function checks which policy is set for such cases.</p> <p>2) Case 1 \u2014 Full simulation even when Q_H = 0 <pre><code>if not self.calc_when_QH_positive_only:\n    # Full calculation even with zero load\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n    ...\n</code></pre></p> <ul> <li>Here, the flag calc_when_QH_positive_only is False, so the user wants to compute everything even when there\u2019s no load.</li> <li> <p>It runs the complete thermal balance by calling: <pre><code>res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre> This means: compute system temperatures, efficiencies, flow rates, etc., as if the system were still active but with zero heating power.</p> </li> <li> <p>The results are appended to the output DataFrame as usual.</p> </li> </ul> <p>Use case: See how the system behaves under \u201cno load\u201d conditions (e.g., during shoulder months) \u2014 including standby losses or auxiliary power.</p> <p>3) Case 2 \u2014 Skip detailed calculation (calc_when_QH_positive_only = True)</p> <p>If this flag is True, the system should behave differently depending on how \u201coff periods\u201d are treated.</p> <p>There are three \u201coff modes\u201d controlled by self.off_compute_mode.</p> <ul> <li> <p> a) Mode: 'idle' \u2192 Minimal record  <pre><code>if self.off_compute_mode == 'idle':\n    res_row = {'timestamp': idx}\n    res_row.update(self._idle_row(0.0, float(\u03b8int), float(\u03b8ext)))\n</code></pre></p> <ul> <li>Produces a minimal output line using _idle_row().</li> <li>This function fills the row mostly with zeros or NaN values \u2014 representing that nothing is being calculated because the system is idle.</li> <li>Only basic fields like timestamp, indoor temperature, and outdoor temperature are kept.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For speed optimization when simulating a full year \u2014 avoids doing unnecessary physics calculations.</p> </li> <li> <p> b) Mode: 'temps' \u2192 Record only temperatures  <pre><code>elif self.off_compute_mode == 'temps':\n    res = self._temps_row_when_off(float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>This still computes temperatures (like circuit or node flow/return) using _temps_row_when_off(),</li> <li>but all energetic terms (flows, powers, losses) are set to zero.</li> <li>This way, you can visualize how the temperature control or mixing valves behave even with zero heating demand.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For continuous temperature mapping, useful when validating system controls or comfort conditions.</p> </li> <li> <p> c) Mode: 'full' \u2192 Full calculation despite Q_H = 0  <pre><code>elif self.off_compute_mode == 'full':\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>Similar to Case 1 but triggered explicitly by mode 'full' \u2014 performs a complete computation of all variables even if load = 0.</li> <li>This is a \u201cforce full calc\u201d inside the zero-demand policy.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: When testing or debugging; ensures identical data structure across all timesteps.</p> </li> </ul> <p>4) continue statements</p> <p>Each branch ends with continue \u2014 \u2192 meaning the loop moves to the next timestep immediately after handling this case. No further code in the timestep is executed once the \u201czero-load\u201d policy has been applied.</p> <p>General-physical interpretation </p> <p>This logic helps balance accuracy vs performance:</p> <p>In annual simulations (8760 hours), 70\u201390% of the time may have zero heating demand (e.g., in summer). Recomputing all hydraulic and thermal equations each hour would waste time.</p> <p>Therefore, this control allows skipping unnecessary computations or simplifying the result depending on your simulation purpose:</p> <ul> <li>\"idle\" \u2192 fastest</li> <li>\"temps\" \u2192 medium (keep comfort analysis)</li> <li>\"full\" \u2192 slowest but most complete</li> </ul> <p>Example of inputs system: <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n    'heat_emission_data' : pd.DataFrame({\n            \"\u03b8H_em_flw_max_sahz_i\": [45],\n            \"\u0394\u03b8H_em_w_max_sahz_i\": [8],\n            \"\u03b8H_em_ret_req_sahz_i\": [20],\n            \"\u03b2H_em_req_sahz_i\": [80],\n            \"\u03b8H_em_flw_min_tz_i\": [28],\n        }, index=[\n            \"Max flow temperature HZ1\",\n            \"Max \u0394\u03b8 flow / return HZ1\",\n            \"Desired return temperature HZ1\",\n            \"Desired load factor with ON-OFF for HZ1\",\n            \"Minimum flow temperature for HZ1\"\n        ])\n\n    # --- distribution ---\n    'heat_losses_recovered': True,\n    'distribution_loss_recovery': 90,\n    'simplified_approach': 80,\n    'distribution_aux_recovery': 80,\n    'distribution_aux_power': 30,\n    'distribution_loss_coeff': 48,\n    'distribution_operation_time': 1,\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n}\n</code></pre></p>"},{"location":"iso_52016_input_check/","title":"ISO 52016 Input Check","text":"<p>The data provided before being used for the simulation are processed and evaluated to be considered fit for the simulation. This process includes a series of checks that allow to identify any potential errors.  The following controls are applied:</p>"},{"location":"iso_52016_input_check/#thermal-and-adjacent-zone","title":"Thermal and Adjacent Zone","text":"<p>Uno degli errori pi\u00f9 caratteristici pu\u00f2 essere quello di immetere dei valori errati di superficie della parete di confine tra la zona termica e la zona non termica. Un esempio \u00e8 quello di dare dei valori pi\u00f9 alti della superificie della parete nella zona non termica rispetto alla superificie della parete nella zona termica. In questo caso se il controllo risulta essere negativo allora il tool imposta il valore del superificie della zona non termica uguale a quello della zona termica.  Qui voglio dire che sebbene la superficie di contatto \u00e8 la stessa pu`o succedere che la parete della zona termica sia o totlamente a contatto con la zon non termica o solamente una parte a contatto con la zona termica   </p>"},{"location":"iso_52016_input_check/#quality-check-of-system-inputs","title":"Quality check of system inputs:","text":""},{"location":"iso_52016_input_check/#check_heating_system_inputs-function","title":"<code>check_heating_system_inputs</code> Function","text":"<p>This function validates and normalizes the input configuration for the heating system. It performs the following checks:</p> <ol> <li>TB14 Table: </li> <li>If a custom <code>TB14</code> DataFrame is provided, it is used.</li> <li> <p>Otherwise, the default <code>TB14</code> from <code>global_inputs.py</code> is used.</p> </li> <li> <p>Emitter Type Validation:</p> </li> <li> <p>If the <code>emitter_type</code> is not found in the selected <code>TB14</code> table, it is automatically set to the first available emitter type, and a warning message is generated.</p> </li> <li> <p>Generator Flow Temperature Control Type (<code>gen_flow_temp_control_type</code>):</p> </li> <li>Type A: Requires <code>gen_outdoor_temp_data</code> as a DataFrame. If not provided, it switches to <code>Type B</code> and generates a warning.</li> <li>Type C: If <code>\u03b8HW_gen_flw_const</code> is not provided, it defaults to <code>50</code> and a warning is shown.</li> <li>Invalid Control Type: Any other values are automatically set to <code>Type B</code>.</li> </ol> <p>The function returns: - The selected <code>TB14</code> table. - The validated <code>emitter_type</code>. - A list of messages about any changes or validations. - The normalized input configuration.</p>"}]}