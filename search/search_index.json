{"config":{"lang":["en","it"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>Please cite us if you use this library:  </p>    Introduction: EPBD Requirements for ISO EN 52000 and ISO EN 15316 Standards  Note:  !!! New version available !!! New features:  - Calculation of multizona considering adiabiatic walls between zones with the same use destination - Calculation with non heated zones  -"},{"location":"#iso-en-52000-overarching-standards","title":"ISO EN 52000 - Overarching Standards","text":"<p>The EPBD Directive 2018 (and confirmed in the 2024 revision) requires Member States to describe their national calculation methodology following the national annexes of the \"overarching\" standards, namely: ISO EN 52000-1, 52003-1, 52010-1, 52016-1, and 52018-1, developed under mandate M/480 given to CEN (European Committee for Standardization).</p> <p>Important: This provision does not constitute mandatory legal codification of these standards. However, the obligation to describe the national methodology following the annexes of the overarching standards will push Member States to explain where and why they deviate from these standards, leading to greater recognition and promotion of the EPB standards set.</p> <p>The ISO EN 52000 overarching standards are:</p> <ol> <li>ISO EN 52000-1: General framework and procedures for EPB assessment</li> <li>ISO EN 52003-1: Indicators, requirements, ratings and certificates</li> <li>ISO EN 52010-1: Internal environmental parameters</li> <li>ISO EN 52016-1: Internal temperatures and energy needs for heating/cooling</li> <li>ISO EN 52018-1: Indicators for overall energy performance</li> </ol>"},{"location":"#new-epbd-recast-methodology","title":"New EPBD Recast Methodology","text":"<p>The new EPBD recast provides an update on building performance assessment through a methodology that must consider various factors such as the building\u2019s thermal characteristics, the use of renewable energy sources, building automation and control systems, ventilation, cooling, energy recovery, etc. The methodology should represent actual operating conditions, use measured energy for accuracy and comparability, and be based on hourly or sub-hourly intervals to account for variable conditions significantly impacting system performance, including internal conditions.</p> <p>The energy performance of a building shall be expressed by a numeric indicator of primary energy use per unit of reference floor area per year, in kWh/(m\u00b2.y), for energy performance certification and compliance with minimum energy performance requirements. Numeric indicators of final energy use per unit of reference floor area per year, in kWh/(m\u00b2.y), and energy needs according to ISO EN 52000 in kWh/(m\u00b2.y) shall also be used. The applied methodology for determining energy performance must be transparent, open to innovation, and reflect best practices, particularly from additional indicators.</p> <p>Member States shall describe their national calculation methodology based on Annex A of the key European standards on energy performance of buildings.</p>"},{"location":"#en-15316-heating-and-cooling-systems","title":"EN 15316 - Heating and Cooling Systems","text":"<p>The EN 15316 series covers the calculation method for system energy requirements and system efficiencies. This family of standards is an integral part of the EPB set and covers:</p>"},{"location":"#en-15316-modular-structure","title":"EN 15316 Modular Structure:","text":"<ul> <li>EN 15316-1: General and expression of energy performance (Modules M3-1, M3-4, M3-9, M8-1, M8-4)</li> <li>EN 15316-2: Emission systems (heating and cooling)</li> <li>EN 15316-3: Distribution systems (DHW, heating, cooling)</li> <li>EN 15316-4-X: Heat generation systems:<ul> <li>4-1: Combustion boilers</li> <li>4-2: Heat pumps</li> <li>4-3: Solar thermal and photovoltaic systems</li> <li>4-4: Cogeneration systems</li> <li>4-5: District heating</li> <li>4-7: Biomass</li> </ul> </li> <li>EN 15316-5: Storage systems</li> </ul> <p>For space heating, applicable standards include EN 15316-1, EN 15316-2-1, EN 15316-2-3 and the appropriate parts of EN 15316-4 depending on the system type, including losses and control aspects.</p>"},{"location":"#relationship-between-epbd-2024-and-standards","title":"Relationship between EPBD 2024 and Standards","text":"<p>The most recent revision of the EPBD was published in May 2024, further strengthening requirements and aligning with the EU's climate neutrality objectives. Member States are encouraged to consider applicable standards, particularly from the EPB standards list.</p> <p>17 of approximately 50 EPB standards are already ISO EN standards, resulting from collaboration between CEN and ISO. The other EPB standards are currently only available at the European level (CEN standards).</p>"},{"location":"#pybuildingenergy-the-python-library-for-building-performance-assessment","title":"pyBuildingEnergy: the python library for building performance assessment","text":"<p>pyBuildingEnergy aims to provide an assessment of building performance both in terms of energy and comfort. In this initial release, it is possible to assess the energy performance of the building using ISO EN 52106-1:2018. Additional modules will be added for a more comprehensive evaluation of performance, assessing ventilation, renewable energies, systems, etc. The actual calculation methods for the assessment of building performance are the following:</p> <ul> <li> <p>[x] the (sensible) energy need for heating and cooling, based on hourly or monthly calculations;</p> </li> <li> <p>[ ] the latent energy need for (de-)humidification, based on hourly or monthly calculations;</p> </li> <li> <p>[x] the internal temperature, based on hourly calculations;</p> </li> <li> <p>[x] the sensible heating and cooling load, based on hourly calculations;</p> </li> <li> <p>[ ] the moisture and latent heat load for (de-)humidification, based on hourly calculations;</p> </li> <li> <p>[ ] the design sensible heating or cooling load and design latent heat load using an hourly calculation interval;</p> </li> <li> <p>[ ] the conditions of the supply air to provide the necessary humidification and dehumidification.</p> </li> </ul> <p>The calculation methods can be used for residential or non-residential buildings, or a part of it, referred to as \"the building\" or the \"assessed object\". ISO EN 52016-1:2018 also contains specifications for the assessment of thermal zones in the building or in the part of a building. The calculations are performed per thermal zone. In the calculations, the thermal zones can be assumed to be thermally coupled or not. ISO EN 52016-1:2018 is applicable to buildings at the design stage, to new buildings after construction and to existing buildings in the use phase</p>"},{"location":"#weather-data","title":"Weather Data","text":"<p>The tool can use wather data coming from 2 main sources:</p> <ul> <li>pvgis api (https://re.jrc.ec.europa.eu/pvg_tools/en/) - PHOTOVOLTAIC GEOGRAPHICAL INFORMATION SYSTEM</li> <li>.epw file from https://www.ladybug.tools/epwmap/</li> </ul> <p>More details in the example folder</p>"},{"location":"#domestic-hot-water-dhw","title":"Domestic Hot Water - DHW","text":"<ul> <li>[x] Calculation of volume and energy need for domestic hot water according to ISO EN 12831-3. </li> <li>[] Assessment of thermal load based on the type of DHW system</li> </ul>"},{"location":"#primary-energy-for-heating","title":"Primary energy for heating","text":"<ul> <li>[x] Calculation of primary energy for heating according to ISO EN 15316-1:2018</li> </ul>"},{"location":"#limitations","title":"Limitations","text":"<p>The library is developed with the intent of demonstrating specific elements of calculation procedures in the relevant standards. It is not intended to replace the regulations but to complement them, as the latter are essential for understanding the calculation.  This library is meant to be used for demonstration and testing purposes and is therefore provided as open source, without protection against misuse or inappropriate use.</p> <p>The information and views set out in this document are those of the authors and do not necessarily reflect the official opinion of the European Union. Neither the European Union institutions and bodies nor any person acting on their behalf may be held responsible for the use that may be made of the information contained herein.</p>"},{"location":"#getting-started","title":"Getting Started","text":"<p>The following command will install the latest pyBuildinEnergy library</p> <pre><code>    pip install pybuildingenergy\n</code></pre> <p>The tool allows you to evaluate the performance of buildings in different ways: </p>"},{"location":"#building-inputs","title":"Building Inputs","text":"<ul> <li>for building inputs refer to <code>Building Inputs</code>: https://eurac-eebgroup.github.io/pybuildingenergy-docs/iso_52016_input/</li> <li>for heating system input (ISO EN 15316-1) refer to <code>Heating System Input</code>: https://eurac-eebgroup.github.io/pybuildingenergy-docs/iso_15316_input/</li> </ul>"},{"location":"#documentation","title":"Documentation","text":"<p>Check our new documentation here: <code>Documentation &lt;https://eurac-eebgroup.github.io/pybuildingenergy-docs/&gt;</code></p>"},{"location":"#example","title":"Example","text":"<p>Here some <code>Examples &lt;https://github.com/EURAC-EEBgroup/pyBuildingEnergy/tree/master/examples&gt;</code> on pybuildingenergy application. For more information .....</p>"},{"location":"#contributing-and-support","title":"Contributing and Support","text":"<p>Bug reports/Questions If you encounter a bug, kindly create a GitLab issue detailing the bug.  Please provide steps to reproduce the issue and ideally, include a snippet of code that triggers the bug.  If the bug results in an error, include the traceback. If it leads to unexpected behavior, specify the expected behavior.</p> <p>Code contributions We welcome and deeply appreciate contributions! Every contribution, no matter how small, makes a difference. Click here to find out more about contributing to the project.</p>"},{"location":"#acknowledgment","title":"Acknowledgment","text":"<p>This work was carried out within European projects:  Infinite - This project has received funding from the European Union\u2019s Horizon 2020 research and innovation programme under grant agreement No 958397,  Moderate - Horizon Europe research and innovation programme under grant agreement No 101069834,  with the aim of contributing to the development of open products useful for defining plausible scenarios for the decarbonization of the built environment</p> <p>Reagrding the DHW Calculation:  The work was developed using the regulations and results obtained from the spreadsheet created by the EPBCenter.</p>"},{"location":"#references","title":"References","text":"<ol> <li>EPB Center - The Energy Performance of Buildings Directive (EPBD)    https://epb.center/epb-standards/the-energy-performance-of-buildings-directive-epbd/</li> <li>REHVA Journal - \"The new EN ISO 52000 family of standards to assess the energy performance of buildings put in practice\"    https://www.rehva.eu/rehva-journal/chapter/the-new-en-iso-52000-family-of-standards-to-assess-the-energy-performance-of-buildings-put-in-practice</li> <li>European Commission - Energy Performance of Buildings Directive    https://energy.ec.europa.eu/topics/energy-efficiency/energy-performance-buildings/energy-performance-buildings-directive_en</li> <li>Directive (EU) 2024/1275 - Official text published in the Official Journal of the EU on May 8, 2024</li> <li>ISO EN 52010-1:2018 - Energy performance of buildings - External climatic conditions - Part 1: Conversion of climatic data for energy calculations</li> <li>ISO EN 52016-1:2018 - Energy performance of buildings - Energy needs for heating and cooling, internal temperatures and sensible and latent heat loads </li> <li>ISO EN 12831-3:2018 - Energy performance of buildings - Method for calculation of the design heat load - Part 3: Domestic hot water systems heat load and characterisation of needs, Module M8-2, M8-3</li> <li>ISO EN 15316-1:2018 - Energy performance of buildings \u2013 Method for calculation of system energy requirements and system efficiencies \u2013 Part 1: General and Energy performance expression, Module M3\u20131, M3\u20134, M3\u20139, M8\u20131</li> <li>ISO EN 16798-7  - Energy performance of buildings \u2013 Ventilation for buildings \u2013 Part 7: Calculation methods for the determination of air flow rates in buildings including infiltration (Module M5\u20135)</li> <li>ISO EN 16798-1 - Energy performance of buildings \u2014 Ventilation of buildings \u2014 Part 1: Indoor environmental input parameters for design and assessment of energy performance of buildings addressing indoor air quality, thermal environment, lighting and acoustics (Module M1\u20136)</li> <li>Directive (EU) 2024/1275 - Official text published in the Official Journal of the EU on May 8, 2024</li> </ol>"},{"location":"#authors","title":"Authors","text":"<ul> <li>Daniele Antonucci</li> <li>Ulrich Filippi Oberegger</li> </ul>"},{"location":"#license","title":"License","text":"<p>BSD 3-Clause License</p>"},{"location":"#version","title":"Version","text":"<p>0.2</p>"},{"location":"#maintainer","title":"Maintainer","text":"<p>Daniele Antonucci</p>"},{"location":"iso_15316/","title":"ISO 15316 - Introduction","text":""},{"location":"iso_15316/#introduction-to-en-iso-15316-1","title":"Introduction to EN ISO 15316-1","text":""},{"location":"iso_15316/#overview","title":"Overview","text":"<p>ISO 15316-1 (equivalent to EN 15316-1 in Europe) defines the framework and general principles for calculating the energy performance of building heating and domestic hot water systems. It provides a systematic, modular approach that allows engineers, researchers, and software tools to evaluate and compare energy efficiency across different system configurations.</p> <p>This standard is part of the broader Energy Performance of Buildings (EPB) suite developed under the EU Energy Performance of Buildings Directive (EPBD).</p>"},{"location":"iso_15316/#scope","title":"Scope","text":"<p>The standard covers water-based heating and DHW systems where heat is generated, distributed, and emitted to maintain indoor comfort. It applies to: - Emission systems (radiators, floor heating, fan coils, etc.) - Distribution systems (piping, manifolds, circulation) - Storage components (thermal buffers, DHW tanks) - Generation systems (boilers, heat pumps, cogeneration)</p> <p>It does not include ventilation-only or purely air-based systems, except when heated by water circuits.</p>"},{"location":"iso_15316/#methodological-structure","title":"Methodological Structure","text":"<p>EN 15316-1 introduces a modular structure, dividing the entire heating system into interconnected subsystems:</p> <ol> <li>Emission (C.2\u2013C.5) \u2013 heat transfer from water to the indoor space  </li> <li>Distribution \u2013 transport of heat through pipes, including losses and auxiliaries  </li> <li>Storage \u2013 intermediate energy buffering or recovery  </li> <li>Generation \u2013 production of useful heat from a fuel or electricity source  </li> </ol> <p>Each module has its own energy balance:</p> \\[ \\text{Energy In} = \\text{Useful Output} + \\text{Losses} - \\text{Recoverable Losses} - \\text{Auxiliaries} \\] <p>The calculation proceeds in the direction:</p> \\[ \\text{Energy Needs (Building)} \\rightarrow \\text{Delivered Heat (Emission)} \\rightarrow \\text{Distribution} \\rightarrow \\text{Generation} \\rightarrow \\text{Primary Energy Input} \\] <p>This enables transparent energy tracking and consistent efficiency assessment across technologies.</p>"},{"location":"iso_15316/#objectives","title":"Objectives","text":"<p>The main objectives of ISO 15316-1 are to: - Provide a consistent calculation structure for all sub-systems in heating and DHW installations. - Define input and output data exchange between modules. - Enable comparability between different system types (e.g., boilers vs. heat pumps). - Serve as the reference method for EPB-compliant national calculation procedures.</p>"},{"location":"iso_15316/#key-principles","title":"Key Principles","text":"<ul> <li>System boundary definition \u2013 explicit separation of emission, distribution, storage, and generation.  </li> <li>Energy flow consistency \u2013 all sub-systems connect via clear input/output relationships.  </li> <li>Recoverable vs. non-recoverable losses \u2013 internal gains can offset building demand.  </li> <li>Auxiliary energy \u2013 electric or mechanical support energy is always accounted for.  </li> <li>Adaptability \u2013 compatible with both monthly and hourly calculation time steps.</li> </ul>"},{"location":"iso_15316/#benefits","title":"Benefits","text":"<ul> <li>Harmonized methodology for energy performance certificates, design tools, and research.  </li> <li>Facilitates diagnostic comparison of subsystems (e.g., identifying excessive distribution losses).  </li> <li>Supports policy implementation under EPBD and national building codes.  </li> <li>Enhances reproducibility and transparency in simulation and benchmarking.</li> </ul>"},{"location":"iso_15316/#relationship-with-subsequent-parts","title":"Relationship with Subsequent Parts","text":"<p>Part 1 provides the general framework only. Detailed formulas and reference values for each sub-system are defined in:</p> <ul> <li>EN 15316-2 \u2013 Emission and control (M3-5) </li> <li>EN 15316-3 \u2013 Distribution and control (M3 -6)  </li> <li>EN 15316-4 \u2013 Generation systems (M3-8) for different generator: <ul> <li>EN 15316-4-1 \u2013 Combustion boilers (M3-8-1) </li> <li>EN 15316-4-2 \u2013 Heat pumps (M3-8-2) </li> <li>EN 15316-4-3 \u2013 Thermal solar and photovoltaic (M3-8-3) </li> <li>EN 15316-4-4 \u2013 On-site cogeneration (M3-8-4) </li> <li>EN 15316-4-5 \u2013 District Heating and Cooling (M3-8-5) </li> <li>EN 15316-4-9 \u2013 Direct electrical heater (M3-8-6) </li> <li>EN 15316-4-8 \u2013 Radiant heating and stoves (M3-8-8) </li> </ul> </li> <li>EN 15316-5 \u2013 Storage and control (M3-7)  </li> </ul>"},{"location":"iso_15316/#references","title":"References","text":"<ul> <li>EN 15316-1:2017 \u2013 Energy performance of buildings \u2014 Method for calculation of system energy requirements and system efficiencies \u2014 Part 1: General and energy performance expression. </li> <li>REHVA (2017) \u2014 Information Paper: CEN Standards for Heating and Domestic Hot Water Systems. </li> <li>CENSE Project (EU) \u2014 Application of the EPBD Calculation Framework.</li> </ul>"},{"location":"iso_15316_calculation_procedure/","title":"CALCULATION PROCEDURE","text":"Note: THE ACTUAL CALCULATION OF PRIMARY ENRGY USING THE ISO 15316-1 IS FOR A SINGLE ZONE, IT IS NOT YET IMPLEMENTED THE CALCULATION FOR MULTIPLE ZONES.  <p>The calculation procedure follows the direction from the energy need to the source (building energy need -&gt; primary energy)</p>"},{"location":"iso_15316_calculation_procedure/#description-of-functions","title":"Description of functions","text":"<p>Herunder explanation of what the script does and comments each function, with emphasis on: - assumptions, units of measurement and formulas used; - structure of input/output data; - flow of calculation for single step and time series.</p> <p>Standard of reference: the calculator follows the logic of the ISO 15316-1 for heating systems and supports 4 types of emission circuits (C.2, C.3, C.4, C.5). Building Energy Need: The building energy need is calculated using the module ISO 52016. For more information refers to the module ISO 52016.</p>"},{"location":"iso_15316_calculation_procedure/#1-overview","title":"1) Overview","text":"<ul> <li>Main class: <code>HeatingSystemCalculator</code></li> <li>Input: a dictionary <code>input_data</code> with parameters of emission, distribution and generation (primary).</li> <li>Tabular data:</li> <li><code>TB14</code> (DF): ISO table with \u0394T nominal and exponent n for the terminal (radiators, panels, etc.).     If not provided in <code>input_data[\"TB14\"]</code>, uses <code>TB14_backup</code> from <code>global_inputs</code>.</li> <li>Units (principali):</li> <li>Energy: kWh (exception: <code>Q_H</code> can arrive in Wh and is converted)</li> <li>Power: kW, Losses/Aux: kWh</li> <li>Volumetric flows: m\u00b3/h</li> <li>Temperature: \u00b0C</li> <li>c_w: specific heat of water in Wh/(kg\u00b7K) (\u22481.16)</li> <li>Output:</li> <li>for single step: dictionary with temperature, flow and energy on emission, distribution and generation;</li> <li>for time series: DataFrame hourly/temporal with the same structure.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#2-class-structure","title":"2) Class structure","text":"<pre><code>class HeatingSystemCalculator:\n    \\\"\\\"\\\"Calcolatore secondo ISO 15316-1 con 4 tipologie C.2\u2013C.5.\\\"\\\"\\\"\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#__init__self-input_data","title":"<code>__init__(self, input_data)</code>","text":"<ul> <li>What it does: saves the input, loads constants and parameters by calling <code>_load_constants()</code> and <code>_load_input_parameters()</code>.</li> <li>Attention: <code>input_data</code> guides everything (control policy, generator efficiency, external curves, etc.).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#3-loading-constants-and-parameters","title":"3) Loading constants and parameters","text":""},{"location":"iso_15316_calculation_procedure/#_load_constantsself","title":"<code>_load_constants(self)</code>","text":"<ul> <li>What it does: loads constants and parameters by calling <code>_load_constants()</code> and <code>_load_input_parameters()</code>. </li> <li>Details:</li> <li>If <code>input_data[\"TB14\"]</code> is a <code>pd.DataFrame</code>, uses it; otherwise uses <code>TB14_backup</code>.</li> <li>Set <code>c_w = 1.16</code> Wh/(kg\u00b7K).</li> <li>Why it is needed: <code>TB14</code> provides nominal \u0394T and exponent n to calculate the relationship power \u2194 \u0394T air-emitter.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_load_input_parametersself","title":"<code>_load_input_parameters(self)</code>","text":"<ul> <li>What it does: reads from the input dictionary the parameters of:</li> <li>Emission (secondary): type of emitter, nominal power, efficiency, mixing valve, type of temperature control (demand/external/constant), auxiliary powers, t operative, external secondary curve data.</li> <li>Distribution: recovery of losses, auxiliary powers, loss coefficient [W/K], service time, etc.</li> <li>Generation (primary): power at full load, maximum load factor, service time, hydraulic scheme (direct or independent), pump control, nominal \u0394T, optional setpoints, generator efficiency model (simple/parametric/manufacturer) and relative curves/parameters, primary circuit temperature control (Type A/B/C) and external primary curve.</li> <li>Important notes:</li> <li><code>selected_emm_cont_circuit</code> \u2208 {0,1,2,3} \u2192 C.2/C.3/C.4/C.5.</li> <li>Policy Q_H \u2264 0: <code>calc_when_QH_positive_only</code> + <code>off_compute_mode</code> (<code>idle</code>/<code>temps</code>/<code>full</code>) decide how to handle periods without load.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#4-default-tables-and-data","title":"4) Default tables and data","text":""},{"location":"iso_15316_calculation_procedure/#_default_emission_dataself","title":"<code>_default_emission_data(self)</code>","text":"<ul> <li>What it provides: limits/setpoint secondary (emission): T supply max, \u0394T max, T return desired, load factor with ON/OFF, T min supply.</li> <li>Why it is needed: it is needed to constrain the calculation of the emitter in function of the demand and the type C.2\u2013C.5.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_default_outdoor_dataself","title":"<code>_default_outdoor_data(self)</code>","text":"<ul> <li>What it provides: outdoor curve (secondary) defining min/max supply vs. min/max outdoor T..</li> <li>Usage: used by <code>calculate_circuit_node_temperature</code> when the control is \"based on outdoor\".</li> </ul>"},{"location":"iso_15316_calculation_procedure/#5-time-series-data","title":"5) Time series data","text":""},{"location":"iso_15316_calculation_procedure/#load_csv_dataself-csv_path_or_df","title":"<code>load_csv_data(self, csv_path_or_df)</code>","text":"<ul> <li>What it does: loads time series data from CSV/DataFrame with expected columns:</li> <li><code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> (alias supported).</li> <li>Logic:</li> <li>If <code>Q_H</code> is in Wh, creates <code>Q_H_kWh = Q_H / 1000</code>.</li> <li>Saves in <code>self.timeseries_data</code>.</li> <li>Returns: loaded DataFrame.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#6-emission-common-parameters","title":"6) Emission \u2014 common parameters","text":""},{"location":"iso_15316_calculation_procedure/#calculate_common_emission_parametersself-heating_needs_kwh-int","title":"<code>calculate_common_emission_parameters(self, heating_needs_kWh, \u03b8int)</code>","text":"<ul> <li>What it does: calculates common quantities for C.2\u2013C.5:</li> <li>net demand (after recoverable losses of system),</li> <li>average power emitted <code>\u03a6H_em_eff</code> (kW) on <code>tH_em_i_ON</code>,</li> <li>losses/inputs of emission, auxiliary powers,</li> <li>nominal parameters TB14: <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code>, nominal flow <code>V_H_em_nom</code>.</li> <li>Note:</li> <li><code>V_H_em_nom = \u03a6H_em_n / (\u0394\u03b8H_em_n * c_w)</code>.</li> <li>Calculates load factor \u03b2 and partial ON time for auxiliary powers.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#7-emission-models-c2c3c4c5","title":"7) Emission \u2014 models C.2/C.3/C.4/C.5","text":"<p>All use the non-linear relationship power \u2194 \u0394T air-emitter with exponent n from TB14.</p>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c2self-common_params-int-c2-constant-flow-constant-water-temperature","title":"<code>calculate_type_C2(self, common_params, \u03b8int)</code> \u2014 C.2: constant flow, constant water temperature","text":"<ul> <li>Uses <code>V_H_em_nom</code> as effective flow.</li> <li>Stima <code>\u0394\u03b8H_em_air_eff = \u0394\u03b8_air_nom * (\u03a6_eff/\u03a6_nom)^(1/n)</code>.</li> <li>Calculates <code>\u03b8H_em_avg</code>, then \u0394T water <code>\u0394\u03b8H_em_w_eff = \u03a6_eff / (c_w * V)</code> and from there supply/return emitter.</li> <li><code>\u03b8H_em_flw_min</code> include mixing offset if <code>MIX_EM=True</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c3self-common_params-int-c3-variable-flow-constant-water-temperature-return-limited","title":"<code>calculate_type_C3(self, common_params, \u03b8int)</code> \u2014 C.3: variable flow, constant water temperature (return limited)","text":"<ul> <li>Fixes <code>\u03b8H_em_ret_set</code> (\u2265 <code>\u03b8int</code>), limits supply (<code>\u03b8H_em_flw_max</code>, \u0394T_w_max).</li> <li>Determines <code>\u03b8H_em_flw</code> and <code>\u03b8H_em_ret</code> coherent and derives the flow from \u0394T water.</li> <li><code>\u03b8H_em_flw_min</code> include mixing offset.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c4self-common_params-int-c4-onoff-intermittent","title":"<code>calculate_type_C4(self, common_params, \u03b8int)</code> \u2014 C.4: ON\u2013OFF intermittent","text":"<ul> <li>Uses a duty cycle to ensure the energy hourly with power ON.</li> <li>Determines <code>\u03b8H_em_flw_calc</code> during ON (from TB14, \u03b2 required).</li> <li>Provides minimum flow for the distribution circuit.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c5self-common_params-int-c5-constant-flow-variable-exchange-bypass","title":"<code>calculate_type_C5(self, common_params, \u03b8int)</code> \u2014 C.5: constant flow, variable exchange (bypass)","text":"<ul> <li>Maintains nominal flow; the actual flow is the maximum between the calculation and the minimum set (<code>\u03b8H_em_flw_min_tz_i</code>).</li> <li>The output includes <code>\u03b8H_em_flw_min</code> (with mixing offset).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#8-circuit-node-temperature","title":"8) Circuit node temperature","text":""},{"location":"iso_15316_calculation_procedure/#calculate_circuit_node_temperatureself-ext-emission_results","title":"<code>calculate_circuit_node_temperature(self, \u03b8ext, emission_results)</code>","text":"<ul> <li>What it does: calculates the flow at the node <code>\u03b8H_nod_out</code> based on the secondary control type:</li> <li>Type 1 \u2013 Based on demand: uses <code>\u03b8H_em_flw_min</code> of the emission.</li> <li>Type 2 \u2013 Based on outdoor: uses the climate curve secondary.</li> <li>Type 3 \u2013 Constant temperature: uses <code>\u03b8em_flw_sahz_i</code> (constant).</li> <li>Output: <code>\u03b8H_nod_out</code> (\u00b0C).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#9-operating-conditions-secondary","title":"9) Operating conditions (secondary)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_operating_conditionsself-emission_results-common_params-int-h_nod_out","title":"<code>calculate_operating_conditions(self, emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"<ul> <li>What it does: combines the choice C.2/C.3/C.4/C.5 and the node to generate:</li> <li>temperature circuit: <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, flow <code>V_H_cr</code>;</li> <li>temperature distribution (between collector and emitter): <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>;</li> <li>load factor <code>\u03b2H_em</code> and minimum flow requested <code>\u03b8H_em_flw_min</code>;</li> <li>return emitter (used downstream).</li> <li>Note:</li> <li>C.4 introduces ON time and power calculation in ON;</li> <li>C.5 maintains minimum flow and calculates the return from the balance with constant flow.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#10-distribution","title":"10) Distribution","text":""},{"location":"iso_15316_calculation_procedure/#calculate_distributionself-h_dis_flw-h_dis_ret-int-qh_em_i_in","title":"<code>calculate_distribution(self, \u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"<ul> <li>What it does: estimates the distribution losses and auxiliary powers, the recoverable part and the required energy input from the distribution.</li> <li>Key formulas:</li> <li>Losses [kWh] \u2248 <code>((T_media - T_int) * U[W/K] / 1000) * t[h]</code></li> <li>Required input: <code>QH_dis_i_in = QH_dis_i_req + losses - aux - recoveries</code></li> <li>Distribution flow: <code>V_H_dis = QH_dis_i_in / (c_w * \u0394T_dis * t)</code></li> <li>Output: dictionary with losses/aux/recoveries and <code>V_H_dis</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#11-generator-efficiency-primary","title":"11) Generator efficiency (primary)","text":""},{"location":"iso_15316_calculation_procedure/#_efficiency_from_modelself-flw-ret-load_frac10","title":"<code>_efficiency_from_model(self, \u03b8flw, \u03b8ret, load_frac=1.0)</code>","text":"<ul> <li>What it does: returns the efficiency (%) according to the selected model:</li> <li>simple: heuristic in function of <code>\u03b8ret</code> (high condensation at low returns).</li> <li>parametric: piecewise linear model (parameters: <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>).</li> <li>manufacturer: curve 1D (\u03b7=f(Tret)) o 2D (\u03b7=f(Tflw,Tret)) con interpolazione bilineare.</li> <li>Note: clamp a [1, 110] %; fallback a modello semplice se curve non valide.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#12-primary-circuit-setpoint","title":"12) Primary circuit setpoint","text":""},{"location":"iso_15316_calculation_procedure/#_generator_flow_setpointself-ext-h_dis_flw_demand","title":"<code>_generator_flow_setpoint(self, \u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"<ul> <li>What it does: calculates the primary circuit setpoint based on the selected control:</li> <li>Type A \u2013 Outdoor: uses the primary curve (min/max vs T external).</li> <li>Type B \u2013 Demand: pursues the secondary demand (<code>\u03b8H_dis_flw</code>).</li> <li>Type C \u2013 Constant: uses <code>\u03b8HW_gen_flw_const</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#13-generation-primary","title":"13) Generation (primary)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_generationself-h_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"<code>calculate_generation(self, \u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"<ul> <li> <p>Purpose: Calculates the primary circuit thermal output, setpoints, and energy consumption according to the selected control strategy.</p> </li> <li> <p>Control types:</p> <p>-Type A \u2013 Outdoor: Uses the primary weather curve (supply temperature as a function of outdoor temperature). -Type B \u2013 Demand: Follows the secondary circuit demand (\u03b8H_dis_flw). -Type C \u2013 Constant: Uses a fixed setpoint \u03b8HW_gen_flw_const.</p> </li> <li> <p>Computation steps:</p> <p>1) Maximum capacity: max_output_g1 = P_full * LF_max * t Defines the maximum hourly energy the generator can deliver.</p> <p>2) Requested output: QH_gen_out = min(QH_dis_i_in, max_output_g1) Limits the generator\u2019s output to its capacity.</p> <p>3) Mass and volume flows: ms = \u03c1 * V_dis for the secondary side; primary flow depends on configuration.</p> <p>4) Hydraulic configurations:</p> <ul> <li>Direct: primary and secondary circuits are identical.</li> <li>Independent: computes \u0394T_p, determines the primary supply setpoint (Type A/B/C), applies primary line losses, calculates primary flow mp = Q * 1000 / (c_w * \u0394T), and optionally applies anti-dilution logic before finding the return temperature Tp_ret.</li> </ul> <p>5) Efficiency: Re-evaluated using the actual flow/return temperatures via the chosen generator efficiency model.</p> <p>6) Energy balance:</p> <ul> <li>Input energy: EHW_gen_in = (QH_gen_out * 100) / \u03b7</li> <li> <p>Auxiliary energy: EHW_gen_aux = EHW_gen_in * (aux_generator / 100)</p> </li> <li> <p>Recoverable generator losses: QW_gen_i_ls_rbl_H</p> </li> <li>Thermal outputs and split of useful (EH_gen_in) and waste (EWH_gen_in) energy.</li> </ul> </li> <li> <p>Output: A dictionary containing primary-side temperatures, mass/volume flows, efficiency, and energy consumption for the generator.</p> </li> </ul>"},{"location":"iso_15316_calculation_procedure/#14-single-step-execution","title":"14) Single step execution","text":""},{"location":"iso_15316_calculation_procedure/#compute_stepself-q_h_kwh-int-ext","title":"<code>compute_step(self, q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>Flow:</li> <li>Common emission parameters</li> <li>Emission C.2/C.3/C.4/C.5 (in base a <code>selected_emm_cont_circuit</code>)</li> <li>Calculation supply node (secondary)</li> <li>Operating conditions of the circuit</li> <li>Distribution</li> <li>Generation (primary)</li> <li>Composition of the output of the step (dictionary)</li> <li>Returns: all temperatures, flows and energies of the step.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#15-time-series-execution","title":"15) Time series execution","text":""},{"location":"iso_15316_calculation_procedure/#_temps_row_when_offself-int-ext","title":"<code>_temps_row_when_off(self, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>What it does: in absence of load (<code>Q_H \u2264 0</code>) and with policy <code>off_compute_mode='temps'</code>,   calculates only the temperatures significant keeping powers/flows=0.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#run_timeseriesself-dfnone","title":"<code>run_timeseries(self, df=None)</code>","text":"<ul> <li>What it does: executes the calculation on the entire DataFrame.</li> <li>Alias recognized:</li> <li><code>Q_H_kWh</code> \u2194 <code>Q_H</code>, <code>Q_h</code>, <code>Heating_needs</code></li> <li><code>T_op</code> \u2194 <code>T_int</code>, <code>theta_int</code></li> <li><code>T_ext</code> \u2194 <code>theta_ext</code></li> <li>Policy when <code>Q_H \u2264 0</code>:</li> <li><code>calc_when_QH_positive_only=False</code>: calculates the complete flow.</li> <li><code>True</code> with:<ul> <li><code>idle</code>: empty row (NaN/0) \u2014 see <code>_idle_row</code>.</li> <li><code>temps</code>: row only temperatures \u2014 see <code>_temps_row_when_off</code>.</li> <li><code>full</code>: complete calculation even with null load.</li> </ul> </li> <li>Returns: DataFrame indexed by timestamp with all columns.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#16-output-columns-extracted","title":"16) Output columns (extracted)","text":"<ul> <li>Inputs: <code>Q_h(kWh)</code>, <code>T_op(\u00b0C)</code>, <code>T_ext(\u00b0C)</code></li> <li>Emission: <code>\u03a6H_em_eff(kW)</code>, <code>\u03b8H_em_flow(\u00b0C)</code>, <code>\u03b8H_em_ret(\u00b0C)</code>, <code>V_H_em_eff(m3/h)</code>, <code>\u03b8H_em_flw_min_req(\u00b0C)</code></li> <li>Node/Circuit: <code>\u03b8H_nod_out(\u00b0C)</code>, <code>\u03b8H_cr_flw(\u00b0C)</code>, <code>\u03b8H_cr_ret(\u00b0C)</code>, <code>V_H_cr(m3/h)</code>, <code>\u03b2H_em(-)</code></li> <li>Distribution: <code>Q_w_dis_i_ls(kWh)</code>, <code>Q_w_dis_i_aux(kWh)</code>, <code>Q_w_dis_i_ls_rbl_H(kWh)</code>, <code>QH_dis_i_in(kWh)</code>, <code>V_H_dis(m3/h)</code></li> <li>Generation: <code>QH_gen_out(kWh)</code>, <code>\u03b8X_gen_cr_flw(\u00b0C)</code>, <code>\u03b8X_gen_cr_ret(\u00b0C)</code>, <code>V_H_gen(m3/h)</code>, <code>efficiency_gen(%)</code>, <code>EHW_gen_in(kWh)</code>, <code>EHW_gen_aux(kWh)</code></li> </ul>"},{"location":"iso_15316_calculation_procedure/#17-best-practices-and-notes","title":"17) Best practices and notes","text":"<ul> <li>Verify that <code>TB14</code> contains the rows for the emitter type (<code>emitter_type</code>) and the columns:</li> <li><code>Emitters_nominal_deltaTeta_Water_C</code>, <code>Emitters_nominale_deltaTeta_air_C</code>, <code>Emitters_exponent_n</code>.</li> <li>Ensure Q_H is provided in kWh (or Wh with automatic conversion).</li> <li>For independent circuits, evaluate:</li> <li><code>generator_nominal_deltaT</code>, <code>gen_flow_temp_control_type</code>, <code>\u03b8HW_gen_flw_const</code>,</li> <li><code>allow_dilution</code> and <code>primary_line_loss</code> if you want to model the primary hydraulic node with/without dilution.</li> <li>The efficiency model can be refined with manufacturer curves (1D/2D) for boilers/heat pumps.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#18-function-responsibility-mapping","title":"18) Function \u2192 responsibility mapping","text":"Function Main responsibility <code>_load_constants</code> Global constants and <code>TB14</code> <code>_load_input_parameters</code> Reading all parameters (emission, distribution, generation) <code>_default_emission_data</code>, <code>_default_outdoor_data</code> Default for limits/setpoint and secondary circuit curve <code>load_csv_data</code> Loading timeseries and energy normalization <code>calculate_common_emission_parameters</code> Common emission parameters (C.2\u2013C.5) <code>calculate_type_C2/C3/C4/C5</code> Emission models <code>calculate_circuit_node_temperature</code> Compute the secondary node (circuit) supply temperature \u03b8H_nod_out according to the selected secondary control policy: based on demand, outdoor, or constant. <code>calculate_operating_conditions</code> Temperature/portate circuito e distribuzione <code>calculate_distribution</code> Losses/auxiliaries/recoveries and distribution flow <code>_efficiency_from_model</code> Generator efficiency according to selected model <code>_generator_flow_setpoint</code> Setpoint mandata primaria (outdoor/demand/costante) <code>calculate_generation</code> Primary circuit balance: useful power, efficiency, consumptions <code>compute_step</code> Pipeline for a single step <code>_temps_row_when_off</code> Row \"only temperatures\" when Q_H\u22640 <code>run_timeseries</code> Execution on the entire time series"},{"location":"iso_15316_calculation_procedure/#flowchart-overview","title":"Flowchart (overview)","text":"<pre>\nflowchart TD\n  A[Start] --&gt; B[__init__]\n  B --&gt; C[_load_constants]\n  B --&gt; D[_load_input_parameters]\n  C --&gt; E{Execution?}\n  D --&gt; E\n\n  E --&gt;|single step| F[compute_step]\n  E --&gt;|timeseries| TS[run_timeseries]\n\n  subgraph Pipeline[\"Pipeline compute_step\"]\n    F --&gt; G[calculate_common_emission_parameters]\n    G --&gt; H{Tipo circuito?}\n    H --&gt;|C.2| I1[calculate_type_C2]\n    H --&gt;|C.3| I2[calculate_type_C3]\n    H --&gt;|C.4| I3[calculate_type_C4]\n    H --&gt;|C.5| I4[calculate_type_C5]\n    I1 --&gt; J[calculate_circuit_node_temperature]\n    I2 --&gt; J\n    I3 --&gt; J\n    I4 --&gt; J\n    J --&gt; K[calculate_operating_conditions]\n    K --&gt; L[calculate_distribution]\n    L --&gt; M[calculate_generation]\n    M --&gt; N[Compose outputs dict]\n  end\n\n  subgraph Timeseries[\"Timeseries run_timeseries\"]\n    TS --&gt; TS0{Row loop}\n    TS0 --&gt;|Q_H \u2264 0 AND policy=idle| T0[_idle_row]\n    TS0 --&gt;|Q_H \u2264 0 AND policy=temps| T1[_temps_row_when_off]\n    TS0 --&gt;|altrimenti| T2[compute_step]\n    T0 --&gt; T3[accumula risultati]\n    T1 --&gt; T3\n    T2 --&gt; T3\n  end\n\n  N --&gt; O[Return dict]\n  T3 --&gt; P[Return DataFrame]\n</pre>"},{"location":"iso_15316_calculation_procedure/#inputoutput-tables-main-functions","title":"Input/Output tables (main functions)","text":""},{"location":"iso_15316_calculation_procedure/#21-__init__input_data","title":"2.1 <code>__init__(input_data)</code>","text":"Field Type Description <code>input_data</code> dict Parameters of emission, distribution, generation, policy and tables. Output Initializes the instance and calls <code>_load_constants()</code> &amp; <code>_load_input_parameters()</code>."},{"location":"iso_15316_calculation_procedure/#22-_load_constants","title":"2.2 <code>_load_constants()</code>","text":"Field Type Description <code>input_data[\"TB14\"]</code> (optional) <code>pd.DataFrame</code> ISO table with nominal \u0394T/esponente; if missing uses <code>TB14_backup</code>. Side-effects <code>self.TB14</code> assigned; <code>self.c_w = 1.16</code>. Output No explicit return."},{"location":"iso_15316_calculation_procedure/#23-_load_input_parameters","title":"2.3 <code>_load_input_parameters()</code>","text":"Block Main keys Default (example) Emissione <code>emitter_type</code>, <code>nominal_power</code>, <code>emission_efficiency</code>, <code>mixing_valve</code>, <code>flow_temp_control_type</code>, <code>auxiliars_power</code>, <code>emission_operation_time</code>, <code>mixing_valve_delta</code>, <code>selected_emm_cont_circuit</code>, <code>heat_emission_data</code>, <code>outdoor_temp_data</code>, <code>constant_flow_temp</code> <code>Floor heating</code>, <code>8 kW</code>, <code>90%</code>, <code>True</code>, <code>Type 1</code>, <code>0 W</code>, <code>1 h</code>, <code>2 \u00b0C</code>, <code>0</code>, <code>42</code> Distribuzione <code>Heat_losses_recovered</code>, <code>distribution_loss_recovery</code>, <code>simplified_approach</code>, <code>distribution_aux_recovery</code>, <code>distribution_aux_power</code>, <code>distribution_loss_coeff</code>, <code>distribution_operation_time</code>, <code>recoverable_losses</code> <code>True</code>, <code>90%</code>, <code>80%</code>, <code>80%</code>, <code>30 W</code>, <code>48 W/K</code>, <code>1 h</code>, <code>0 kWh</code> Generazione <code>full_load_power</code>, <code>max_monthly_load_factor</code>, <code>tH_gen_i_ON</code>, <code>auxiliary_power_generator</code>, <code>fraction_of_auxiliary_power_generator</code>, <code>generator_circuit</code>, <code>speed_control_generator_pump</code>, <code>generator_nominal_deltaT</code>, <code>\u03b8HW_gen_flw_set</code>, <code>\u03b8HW_gen_ret_set</code>, <code>calc_when_QH_positive_only</code>, <code>fill_zeros_when_skipped</code>, <code>off_compute_mode</code>, <code>efficiency_model</code>, <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>, <code>manuf_curve_1d</code>, <code>manuf_curve_2d</code>, <code>gen_flow_temp_control_type</code>, <code>gen_outdoor_temp_data</code>, <code>\u03b8HW_gen_flw_const</code> <code>24 kW</code>, <code>100%</code>, <code>1 h</code>, <code>0%</code>, <code>40%</code>, <code>independent</code>, <code>variable</code>, <code>20 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>True</code>, <code>False</code>, <code>idle</code>, <code>simple</code>, <code>110%</code>, <code>95%</code>, <code>20 \u00b0C</code>, <code>50 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>Type A</code>, <code>curve 1D/2D</code>,<code>50 \u00b0C</code>"},{"location":"iso_15316_calculation_procedure/#24-_default_emission_data-_default_outdoor_data","title":"2.4 <code>_default_emission_data()</code> / <code>_default_outdoor_data()</code>","text":"Function Output Note <code>_default_emission_data</code> DF con <code>\u03b8H_em_flw_max_sahz_i</code>, <code>\u0394\u03b8H_em_w_max_sahz_i</code>, <code>\u03b8H_em_ret_req_sahz_i</code>, <code>\u03b2H_em_req_sahz_i</code>, <code>\u03b8H_em_flw_min_tz_i</code> <code>Limits/setpoint secondary circuit</code> <code>_default_outdoor_data</code> DF con <code>\u03b8ext_min_sahz_i</code>, <code>\u03b8ext_max_sahz_i</code>, <code>\u03b8em_flw_max_sahz_i</code>, <code>\u03b8em_flw_min_sahz_i</code> <code>Secondary circuit limits</code>"},{"location":"iso_15316_calculation_procedure/#25-load_csv_datacsv_path_or_df","title":"2.5 <code>load_csv_data(csv_path_or_df)</code>","text":"Input Type Description <code>csv_path_or_df</code> str / DataFrame Timeseries with columns (<code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> or aliases) Output DataFrame With optional <code>Q_H_kWh</code> added; saved in <code>self.timeseries_data</code>"},{"location":"iso_15316_calculation_procedure/#26-calculate_common_emission_parametersheating_needs_kwh-int","title":"2.6 <code>calculate_common_emission_parameters(heating_needs_kWh, \u03b8int)</code>","text":"Output (key) Description <code>QH_sys_out_hz_i</code> Net demand after recoveries <code>QH_em_i_in</code> Energy in at emission <code>\u03a6H_em_eff</code> Average power on interval (kW) <code>V_H_em_nom</code> Nominal flow (m\u00b3/h) <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code> Parameters from TB14"},{"location":"iso_15316_calculation_procedure/#27-calculate_type_c2-c3-c4-c5","title":"2.7 <code>calculate_type_C2 / C3 / C4 / C5</code>","text":"Function Principle Output Note <code>C2</code> Constant flow, constant water temperature <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C3</code> Variable flow, constant water temperature (return limited) <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C4</code> ON\u2013OFF (duty cycle) <code>\u03b8H_em_flw_calc</code>, <code>\u03b8H_em_flw_min</code>, ecc. <code>C5</code> Constant flow, variable heat exchange (bypass) <code>\u03b8H_em_flow=min</code>, <code>\u03b8H_em_ret\u2248</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code>"},{"location":"iso_15316_calculation_procedure/#28-calculate_circuit_node_temperatureext-emission_results","title":"2.8 <code>calculate_circuit_node_temperature(\u03b8ext, emission_results)</code>","text":"Control Logic Output Type 1 Demand \u2192 <code>\u03b8H_em_flw_min</code> <code>\u03b8H_nod_out</code> Type 2 Secondary circuit limits <code>\u03b8H_nod_out</code> Type 3 Constant (<code>\u03b8em_flw_sahz_i</code>) <code>\u03b8H_nod_out</code>"},{"location":"iso_15316_calculation_procedure/#29-calculate_operating_conditionsemission_results-common_params-int-h_nod_out","title":"2.9 <code>calculate_operating_conditions(emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"Case Output Note C.2 / C.3 / C.4 / C.5 <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, <code>V_H_cr</code>, <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>, <code>\u03b2H_em</code>, <code>\u03b8H_em_flw_min</code>, <code>\u03b8H_em_ret_eff</code>"},{"location":"iso_15316_calculation_procedure/#210-calculate_distributionh_dis_flw-h_dis_ret-int-qh_em_i_in","title":"2.10 <code>calculate_distribution(\u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"Output Meaning <code>Q_w_dis_i_ls</code>, <code>Q_w_dis_i_aux</code>, <code>Q_w_dis_i_ls_rbl_H</code> Losses, auxiliaries and recoverable (kWh) <code>QH_dis_i_req</code>, <code>QH_dis_i_in</code> Request and effective input to distribution <code>V_H_dis</code> Distribution volumetric flow (m\u00b3/h)"},{"location":"iso_15316_calculation_procedure/#211-_efficiency_from_modelflw-ret-load_frac","title":"2.11 <code>_efficiency_from_model(\u03b8flw, \u03b8ret, load_frac)</code>","text":"Model Description <code>simple</code> Efficiency as function of return temperature (condensation) <code>parametric</code> Piecewise linear with thresholds (<code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>) <code>manufacturer</code> Manufacturer curves 1D/2D with interpolation"},{"location":"iso_15316_calculation_procedure/#212-_generator_flow_setpointext-h_dis_flw_demand","title":"2.12 <code>_generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"Type Logic Type A Primary curve (outdoor) Type B Follow secondary demand Type C Constant"},{"location":"iso_15316_calculation_procedure/#213-calculate_generationh_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"2.13 <code>calculate_generation(\u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"Output Meaning <code>max_output_g1</code>, <code>QH_gen_out</code> Limit capacity and thermal output (kWh) <code>\u03b8X_gen_cr_flw</code>, <code>\u03b8X_gen_cr_ret</code> Primary circuit effective (\u00b0C) <code>V_H_gen</code> Primary circuit volumetric flow (m\u00b3/h) <code>efficiency_gen</code> Efficiency (%) <code>EHW_gen_in</code>, <code>EHW_gen_aux</code> Energy in ingress and auxiliaries (kWh) <code>QW_gen_i_ls_rbl_H</code> Recoverable losses (kWh) <code>QW_gen_out</code>, <code>QHW_gen_out</code>, <code>EH_gen_in</code>, <code>EWH_gen_in</code> Thermal balances"},{"location":"iso_15316_calculation_procedure/#214-compute_stepq_h_kwh-int-ext","title":"2.14 <code>compute_step(q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"Input Output <code>q_h_kWh</code>, <code>\u03b8int</code>, <code>\u03b8ext</code> Dictionary with emission, node/circuit, distribution, generation"},{"location":"iso_15316_calculation_procedure/#215-_temps_row_when_offint-ext","title":"2.15 <code>_temps_row_when_off(\u03b8int, \u03b8ext)</code>","text":"Purpose Output Row \"only temperature\" for <code>Q_H \u2264 0</code> Same keys, with powers/volumes=0"},{"location":"iso_15316_calculation_procedure/#216-run_timeseriesdfnone","title":"2.16 <code>run_timeseries(df=None)</code>","text":"Input Output <code>df</code> (optional) or <code>self.timeseries_data</code> DataFrame indexed by timestamp with results of each step"},{"location":"iso_15316_calculation_procedure/#modelling-suggestions","title":"Modelling suggestions","text":"<ul> <li>Verify consistency between emitter type and <code>TB14</code> rows.  </li> <li>For independent schemes, curate <code>generator_nominal_deltaT</code>, <code>primary_line_loss</code> and <code>allow_dilution</code>.  </li> <li>Use <code>manufacturer</code> with realistic manufacturer curves when available.</li> </ul>"},{"location":"iso_15316_generation_circuit/","title":"ISO 15316 - Generation Circuit","text":""},{"location":"iso_15316_generation_circuit/#generation","title":"GENERATION","text":"<p>The annex D of ISO 15316-1 standard provides the calculation procedure for the generation circuit. It is the general procedure that can be improved using the detailed standards for different type of generator, such as Heat pump, Combustion boilers, District heating and cooling, etc. </p> <p>There are 2 typed of generaiont circuit:</p> <p>1) Generation with DIRECT circuit withou hydraulic separtion 2) Generation with INDIPENDENT flow rate circuit, using the hydraulic separtion</p>"},{"location":"iso_15316_generation_circuit/#direct-circuit","title":"DIRECT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>The standard define no control to the circuit.  In the pybuildingenergy, the contol have been applied on the generator based on:</p> <pre><code>- 'Type A - Based on outdoor temperature': uses primary's own weather curve\n- 'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)\n- 'Type C - Constant temperature'       : uses self.\u03b8HW_gen_flw_const\n</code></pre> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> <p>No data</p> <p>System design data: </p> <p>No data</p> <p>Process control data</p> <p>No data</p> <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#independent-circuit","title":"INDEPENDENT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal generator power max_output_g1 kW - 0 to 10<sup>4</sup> Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) water (flow-return) dTp \u00b0C - 1..40 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system <p>System design data: </p> <p>No data</p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Generator pump speed control speed_control_generator_pump - - - Generator pump speed control, could be varaible or deltaT_constant <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Generation flow Temperature Tp_sup \u00b0C - - Generation flow Temperature Generation return Temperature Tp_ret \u00b0C - - Generation return Temperature Generation flow rate V_H_gen m3/h - - Generation flow rate"},{"location":"iso_15316_heating_circuit/","title":"ISO 15316 - Heating Circuit","text":""},{"location":"iso_15316_heating_circuit/#heating-circuit","title":"HEATING CIRCUIT","text":"<p>The library provides modules for evaluating 4 types of hydraulic circuits, where, based on Table C.1 of the standard, for each circuit it is identified which type of emission system to use and the type of control. as defined below: </p> Code Module Emitters Control C2 Constan mass flow rate and varying water temperature Radiators and Panels Heating curve, mixing valvew and variable generation temperature C3 Varying mass flow (constant temperature) Radiators, Panels, Heating coils Thermostatic valve, flow rate control with two way valve C4 ON-OFF and varying temperature Radiators and Panels On-Off control C5 Varying heat exchange Fan-coil, heating coils emitters with on-off blower  and continuos circulation 3 way by-pass valve control <p>All modules allow the us of a mixing valve to allow different temperatures in the different circuits. A distinction is made between:  - the emitter tmperature and flow rate; - the circuit temperature and flow rate; </p> <p>They differ where there is a mixing or by-pass 3 way valve in the circuit.</p>"},{"location":"iso_15316_heating_circuit/#system-type-and-input-parameters","title":"System type and input parameters","text":""},{"location":"iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators Heating Panels Control Parameters Heating curve flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maximum distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c3-varying-mass-flow-rate-and-constant-water-temperature","title":"C3 - varying mass flow rate and constant water temperature","text":"<p>This configuration is for sample heating circuit with varying mass flow rate and constant water temperature. </p> Figure 1: System C3_1 - Example of sample heating circuit varying mass flow rate.  Figure 1: System C3_1 - Example of sample heating circuit with series control (AHU coil).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators with thermostatic valve AHU coil with series control Panels with PID control Control Parameters Maximum flow/return \u0394\u03b8 Maximum flow temperature Target return temperature <p>Inputs required</p> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve Target return temperature \u03b8H_em_ret_req_sahz_i \u00b0C - - Desired return temperature of the emission circuit Maximum flow/return \u0394\u03b8 \u0394\u03b8H_em_w_max_sahz_i \u00b0C - - Maximum flow/return temperature difference of the emission circuit Maximum flow temperature \u03b8H_em_flw_max_sahz_i \u00b0C - - Maximum flow temperature of the emission circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c4-intermittent-flow-rate-module-on-off","title":"C4 - Intermittent flow rate module (ON-OFF)","text":"<p>This configuration is for sample heating circuit with intermittent flow rate and constant water temperature. </p> Figure 1: System C4 - Example of sample heating circuit with intermittent flow rate module (ON-OFF).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Desired load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c5-constant-flow-rate-and-variable-heat-exchange","title":"C5 - Constant flow rate and variable heat exchange","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  Figure 1: System C4 - Example of sample heating circuit with three way by-pass control.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Target load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Minimum flow temperature \u03b8H_em_flw_min_sahz_i \u00b0C - - Minimum flow temperature of the emission circuit for a zone i Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"iso_15316_input/","title":"ISO 15316 - Input","text":""},{"location":"iso_15316_input/#input_system_hvac-reference-setup-guide","title":"INPUT_SYSTEM_HVAC \u2014 Reference &amp; Setup Guide","text":"<p>This document explains every field in the <code>INPUT_SYSTEM_HVAC</code> configuration used by the heating system model (emitter \u2192 distribution \u2192 generator). It also shows how to customize control curves and upload your own emitter tables.</p> <p>Scope: space-heating only (cooling is ignored here). All powers are thermal unless stated otherwise.</p>"},{"location":"iso_15316_input/#inputs","title":"Inputs","text":"<pre><code>INPUT_SYSTEM_HVAC = {\n  # Emitter (room-side heat emission)\n  \"emitter_type\": ...,\n  \"nominal_power\": ...,\n  \"emission_efficiency\": ...,\n  \"flow_temp_control_type\": ...,\n  \"selected_emm_cont_circuit\": ...,\n  \"mixing_valve\": ...,\n  # (Optional) custom emitter tables\n  # \"TB14\": ...,\n  # \"heat_emission_data\": pd.DataFrame(...),\n  \"mixing_valve_delta\": ...,\n  # \"constant_flow_temp\": ...,\n\n  # Distribution (piping, auxiliaries)\n  \"heat_losses_recovered\": ...,\n  \"distribution_loss_recovery\": ...,\n  \"simplified_approach\": ...,\n  \"distribution_aux_recovery\": ...,\n  \"distribution_aux_power\": ...,\n  \"distribution_loss_coeff\": ...,\n  \"distribution_operation_time\": ...,\n\n  # Generator (boiler/HP/plant loop)\n  \"full_load_power\": ...,\n  \"max_monthly_load_factor\": ...,\n  \"tH_gen_i_ON\": ...,\n  \"auxiliary_power_generator\": ...,\n  \"fraction_of_auxiliary_power_generator\": ...,\n  \"generator_circuit\": ...,\n\n  # Generator flow-temperature control\n  \"gen_flow_temp_control_type\": ...,\n  \"gen_outdoor_temp_data\": pd.DataFrame(...),\n\n  \"speed_control_generator_pump\": ...,\n  \"generator_nominal_deltaT\": ...,\n  \"mixing_valve_delta\": ...,\n\n  # Optional explicit generator setpoints\n  # \"\u03b8HW_gen_flw_set\": ...,\n  # \"\u03b8HW_gen_ret_set\": ...,\n\n  # Efficiency model\n  \"efficiency_model\": ...,\n\n  # Calculation options\n  \"calc_when_QH_positive_only\": ...,\n  \"off_compute_mode\": ...,\n}\n</code></pre>"},{"location":"iso_15316_input/#emitter-block-room-side-heat-delivery","title":"Emitter block (room-side heat delivery)","text":"Field Type Example Meaning <code>emitter_type</code> <code>str</code> <code>\"Floor heating 1\"</code> Emitter family/preset. Used to pick default emission characteristics. <code>nominal_power</code> <code>float</code> <code>8</code> Nominal emitter power (kW thermal). Used for checks and backstops in emission calc. <code>emission_efficiency</code> <code>float</code> <code>90</code> Emission efficiency in % (heat delivered to room vs heat from circuit). <code>flow_temp_control_type</code> <code>str</code> <code>\"Type 2 - Based on outdoor temperature\"</code> How the emitter flow temperature is determined. See control strategies below. <code>selected_emm_cont_circuit</code> <code>int</code> <code>0</code> Index if multiple heating zones/circuits exist (0-based). <code>mixing_valve</code> <code>bool</code> <code>True</code> If a mixing valve is present on emitter circuit (affects achievable flow temp and differential). <code>mixing_valve_delta</code> <code>float</code> <code>2</code> \u00b0C delta used when mixing valve is active (typical blending margin). <code>constant_flow_temp</code> <code>float</code> (optional) <code>42</code> Overrides control curve with a constant emitter flow setpoint (\u00b0C). Commented by default."},{"location":"iso_15316_input/#optional-custom-emitter-tables","title":"Optional custom emitter tables","text":"<p>You can override internal presets using one or both of the following:</p> <ul> <li><code>TB14</code>: a custom structure/table with manufacturer data (e.g., output vs. \u0394T, flow temperature limits). Uncomment and provide your object to replace defaults.</li> <li><code>heat_emission_data</code>: a compact <code>pandas.DataFrame</code> describing key points for the emitter control for a given circuit. Example:</li> </ul> <pre><code>heat_emission_data = pd.DataFrame({\n    \"\u03b8H_em_flw_max_sahz_i\": [45],  # Max flow temp (\u00b0C) for space-heating zone i\n    \"\u0394\u03b8H_em_w_max_sahz_i\": [8],    # Max \u0394T flow-return (K) for zone i\n    \"\u03b8H_em_ret_req_sahz_i\": [20],  # Desired return temp (\u00b0C)\n    \"\u03b2H_em_req_sahz_i\": [80],      # Desired load factor at ON/OFF (%)\n    \"\u03b8H_em_flw_min_tz_i\": [28],    # Minimum flow temp (\u00b0C) for zone i\n}, index=[\n    \"Max flow temperature HZ1\",\n    \"Max \u0394\u03b8 flow / return HZ1\",\n    \"Desired return temperature HZ1\",\n    \"Desired load factor with ON-OFF for HZ1\",\n    \"Minimum flow temperature for HZ1\"\n])\n</code></pre> <p>Tip: If both <code>TB14</code> and <code>heat_emission_data</code> are provided, clarify which one your backend prioritizes to avoid ambiguity.</p>"},{"location":"iso_15316_input/#distribution-block-piping-network-auxiliaries","title":"Distribution block (piping network &amp; auxiliaries)","text":"Field Type Example Meaning <code>heat_losses_recovered</code> <code>bool</code> <code>True</code> If pipe losses are partly useful to the heated space. <code>distribution_loss_recovery</code> <code>float</code> <code>90</code> % of distribution losses recovered inside the conditioned volume. <code>simplified_approach</code> <code>float</code> <code>80</code> % shortcut for simplified loss approach (e.g., rule-of-thumb recovery or reduction). <code>distribution_aux_recovery</code> <code>float</code> <code>80</code> % of auxiliary power (pumps/controls) considered as useful internal gain. <code>distribution_aux_power</code> <code>float</code> <code>30</code> Auxiliary electric power (W) of distribution. <code>distribution_loss_coeff</code> <code>float</code> <code>48</code> Global distribution loss coefficient (W/K) or equivalent scalar used by model. <code>distribution_operation_time</code> <code>float</code> <code>1</code> Fraction of time distribution is active (0..1, per-step multiplier)."},{"location":"iso_15316_input/#generator-block-plant-production-side","title":"Generator block (plant production side)","text":"Field Type Example Meaning <code>full_load_power</code> <code>float</code> <code>27</code> Generator thermal capacity at full load (kW). <code>max_monthly_load_factor</code> <code>float</code> <code>100</code> % cap on monthly load factor (for derating/limitations). <code>tH_gen_i_ON</code> <code>float</code> <code>1</code> Minimum ON time (h) or start-up horizon used for cycling logic. <code>auxiliary_power_generator</code> <code>float</code> <code>0</code> % or W (per model) for generator auxiliary power; used in energy balances. <code>fraction_of_auxiliary_power_generator</code> <code>float</code> <code>40</code> % of generator auxiliaries credited as internal gains. <code>generator_circuit</code> <code>str</code> <code>\"independent\"</code> Hydraulic layout: <code>\"direct\"</code> or <code>\"independent\"</code> (primary/secondary with HX)."},{"location":"iso_15316_input/#generator-flow-temperature-control","title":"Generator flow-temperature control","text":"Field Type Example Meaning <code>gen_flow_temp_control_type</code> <code>str</code> <code>\"Type A - Based on outdoor temperature\"</code> Generator flow control strategy (see \u00a75). <code>gen_outdoor_temp_data</code> <code>pd.DataFrame</code> see below Outdoor reset curve for the generator flow temperature. <code>speed_control_generator_pump</code> <code>str</code> <code>\"variable\"</code> Pump control mode: <code>\"fixed\"</code> or <code>\"variable\"</code>. <code>generator_nominal_deltaT</code> <code>float</code> <code>20</code> Nominal \u0394T (K) across the generator loop. <code>mixing_valve_delta</code> <code>float</code> <code>2</code> If a mixing valve exists on primary, blending margin (\u00b0C). <code>\u03b8HW_gen_flw_set</code> <code>float</code> (opt) <code>50</code> Override: fixed generator flow temperature (\u00b0C). <code>\u03b8HW_gen_ret_set</code> <code>float</code> (opt) <code>40</code> Override: fixed generator return temperature (\u00b0C). <p>Example: outdoor reset table</p> <pre><code>gen_outdoor_temp_data = pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],   # cold design outdoor temp (\u00b0C)\n    \"\u03b8ext_max_gen\": [15],   # warm boundary (\u00b0C)\n    \"\u03b8flw_gen_max\": [60],   # flow setpoint at \u03b8ext_min_gen (\u00b0C)\n    \"\u03b8flw_gen_min\": [35],   # flow setpoint at \u03b8ext_max_gen (\u00b0C)\n}, index=[\"Generator curve\"])\n</code></pre> <p>The controller interpolates a target flow temperature between <code>(\u03b8ext_min_gen, \u03b8flw_gen_max)</code> and <code>(\u03b8ext_max_gen, \u03b8flw_gen_min)</code>. Values are clipped outside the range.</p>"},{"location":"iso_15316_input/#control-strategies-cheat-sheet","title":"Control strategies (cheat sheet)","text":""},{"location":"iso_15316_input/#emitter-flow_temp_control_type","title":"Emitter <code>flow_temp_control_type</code>","text":"<p>Common patterns (implementation-dependent; typical meanings): - Type 1 \u2013 Constant setpoint: use <code>constant_flow_temp</code> (\u00b0C). - Type 2 \u2013 Based on outdoor temperature: emitter flow is computed via an outdoor reset (may reuse the generator curve or a dedicated one). - Type 3 \u2013 Room feedback: modulate flow to maintain room operative temperature; requires a PI logic in the backend. - Type 4 \u2013 Return-limited: aim for a maximum return temperature (useful in condensing systems).</p> <p>Note: Your codebase may define the exact meanings of each \"Type N\". Ensure the UI/CLI lists allowed values.</p>"},{"location":"iso_15316_input/#52-generator-gen_flow_temp_control_type","title":"5.2 Generator <code>gen_flow_temp_control_type</code>","text":"<ul> <li>Type A \u2013 Based on outdoor temperature: uses <code>gen_outdoor_temp_data</code> (reset curve).  </li> <li>Type B \u2013 Constant: use <code>\u03b8HW_gen_flw_set</code> and optionally <code>\u03b8HW_gen_ret_set</code>.  </li> <li>Type C \u2013 Demand-following: track emitter request (requires coupling logic and min/max clamps).</li> </ul>"},{"location":"iso_15316_input/#efficiency-model","title":"Efficiency model","text":"Field Allowed Notes <code>efficiency_model</code> <code>\"simple\"</code>, <code>\"map\"</code>, <code>\"manufacturer\"</code> <code>\"simple\"</code> applies fixed or curve-based efficiencies. <code>\"map\"</code> uses performance maps. <code>\"manufacturer\"</code> expects detailed tables (COP/\u03b7 vs. temp/load). <p>Backends typically compute delivered heat, electric/primary energy, and auxiliary fractions accordingly.</p>"},{"location":"iso_15316_input/#calculation-options","title":"Calculation options","text":"Field Type Meaning <code>calc_when_QH_positive_only</code> <code>bool</code> If <code>True</code>, run generator/distribution only when building heating need <code>Q_H &gt; 0</code>. <code>off_compute_mode</code> <code>str</code> How to treat the system when off: <code>\"full\"</code> (still compute temps/losses), <code>\"idle\"</code> (minimal), or <code>\"temps\"</code> (only temperatures)."},{"location":"iso_15316_input/#units-conventions","title":"Units &amp; conventions","text":"<ul> <li>Temperatures in \u00b0C, \u0394T in K (numerically the same scale).</li> <li>Powers: <code>kW</code> for generator/emitter nominal; auxiliaries commonly in W (check your backend).</li> <li>Efficiencies and fractions input as percent (0\u2013100) unless otherwise specified.</li> <li>Curves are per-circuit unless stated global.</li> <li>Time base: typically hourly steps.</li> </ul>"},{"location":"iso_15316_input/#validation-checklist","title":"Validation checklist","text":"<ul> <li>[ ] <code>nominal_power</code> \u2264 <code>full_load_power</code> (kW).  </li> <li>[ ] <code>emission_efficiency</code> \u2208 [0, 100].  </li> <li>[ ] <code>distribution_loss_recovery</code>, <code>distribution_aux_recovery</code> \u2208 [0, 100].  </li> <li>[ ] <code>distribution_operation_time</code> \u2208 [0, 1].  </li> <li>[ ] Outdoor reset: <code>\u03b8flw_gen_max</code> \u2265 <code>\u03b8flw_gen_min</code>, <code>\u03b8ext_min_gen</code> &lt; <code>\u03b8ext_max_gen</code>.  </li> <li>[ ] If <code>constant_flow_temp</code> is set, control type must accept constants.  </li> <li>[ ] <code>generator_circuit</code> \u2208 {<code>\"direct\"</code>, <code>\"independent\"</code>}.  </li> <li>[ ] <code>speed_control_generator_pump</code> \u2208 {<code>\"fixed\"</code>, <code>\"variable\"</code>}.</li> </ul>"},{"location":"iso_15316_input/#minimal-working-example","title":"Minimal working example","text":"<pre><code>INPUT_SYSTEM_HVAC = {\n  # Emitter\n  \"emitter_type\": \"Floor heating 1\",\n  \"nominal_power\": 8,                  # kW\n  \"emission_efficiency\": 90,           # %\n  \"flow_temp_control_type\": \"Type 2 - Based on outdoor temperature\",\n  \"selected_emm_cont_circuit\": 0,\n  \"mixing_valve\": True,\n  \"mixing_valve_delta\": 2,\n\n  # Distribution\n  \"heat_losses_recovered\": True,\n  \"distribution_loss_recovery\": 90,    # %\n  \"simplified_approach\": 80,           # %\n  \"distribution_aux_recovery\": 80,     # %\n  \"distribution_aux_power\": 30,        # W\n  \"distribution_loss_coeff\": 48,       # W/K (model scalar)\n  \"distribution_operation_time\": 1.0,  # 0..1\n\n  # Generator\n  \"full_load_power\": 27,               # kW\n  \"max_monthly_load_factor\": 100,      # %\n  \"tH_gen_i_ON\": 1,                    # h\n  \"auxiliary_power_generator\": 0,      # (backend-defined units)\n  \"fraction_of_auxiliary_power_generator\": 40,  # %\n  \"generator_circuit\": \"independent\",\n\n  # Generator control\n  \"gen_flow_temp_control_type\": \"Type A - Based on outdoor temperature\",\n  \"gen_outdoor_temp_data\": pd.DataFrame({\n      \"\u03b8ext_min_gen\": [-7],\n      \"\u03b8ext_max_gen\": [15],\n      \"\u03b8flw_gen_max\": [60],\n      \"\u03b8flw_gen_min\": [35],\n  }, index=[\"Generator curve\"]),\n\n  \"speed_control_generator_pump\": \"variable\",\n  \"generator_nominal_deltaT\": 20,      # K\n  \"mixing_valve_delta\": 2,\n\n  # Efficiency\n  \"efficiency_model\": \"simple\",\n\n  # Options\n  \"calc_when_QH_positive_only\": False,\n  \"off_compute_mode\": \"full\",\n}\n</code></pre>"},{"location":"iso_15316_input/#advanced-customization-tips","title":"Advanced customization tips","text":"<ul> <li>Multiple heating circuits: use <code>selected_emm_cont_circuit</code> to switch presets, or pass a per-circuit <code>heat_emission_data</code> table.  </li> <li>Manufacturer curves: provide detailed COP/efficiency maps via <code>efficiency_model=\"manufacturer\"</code> and custom data structures.  </li> <li>Hydraulic separation: with <code>generator_circuit=\"independent\"</code>, remember the additional HX \u0394T and any mixing valve limits.  </li> <li>Low-temperature systems: ensure <code>\u03b8flw_gen_min</code> is compatible with emitter requirements; increase surface area or lower setpoints if needed.</li> </ul>"},{"location":"iso_15316_input/#glossary","title":"Glossary","text":"<ul> <li>Emitter: the device exchanging heat with the room (radiators, floor heating).  </li> <li>Distribution: pipes, valves, pumps between generator and emitters.  </li> <li>Generator: heat source (boiler, heat pump, plant loop).  </li> <li>Outdoor reset: a curve that sets flow temperature based on outdoor air temperature.  </li> <li>\u0394T (delta T): temperature difference (usually flow minus return).</li> </ul> <p>Prepared for integration with the ISO 15316/52016-based timeseries heating model.</p>"},{"location":"iso_15316_system_inputs/","title":"ISO 15316 - HVAC System inputs","text":""},{"location":"iso_15316_system_inputs/#hvac-system-inputs","title":"HVAC SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"iso_15316_system_inputs/#emission","title":"EMISSION","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</li> <li> <p>mixing valve delta: it is the offset temperature of the mixing valve in \u00b0C. It refers to the varaible mixing_valve_delta. </p> <ul> <li> <p>The offset refers to the temperature difference between the desired temperature and the actual temperature, which is applied when mixing hot and cold water.</p> </li> <li> <p>In this case, the parameter \u0394\u03b8H_em_mix_sahz_i represents the temperature offset applied by the mixing valve, with a default value set to 2\u00b0C (as defined in the code).</p> </li> <li> <p>This means that when the mixing valve is operating, it will allow a 2\u00b0C deviation from the desired temperature to account for system dynamics, such as heat losses, system inertia, or external temperature influences.</p> </li> </ul> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0 <p>heat_emission_data: it is the table that contains the data of the emission circuit. If it is not provided the default values are used and the emitter_type is set to the first one in the table. In the code we have the function <code>_default_emission_data()</code> that returns the default values. These values are default emission circuit parameters for the heating system\u2019s secondary side (the side connected to heating emitters, such as radiators or underfloor heating).  They represent nominal and operational setpoints for a single heating zone (HZ1), including flow/return temperatures and load control factors.</p> <p>Table 4: Emission circuit data</p> Parameter (column name) Description Default Value Unit <code>\u03b8H_em_flw_max_sahz_i</code> Maximum flow temperature for the heating emission circuit 45 \u00b0C <code>\u0394\u03b8H_em_w_max_sahz_i</code> Maximum water flow/return temperature difference 8 \u00b0C <code>\u03b8H_em_ret_req_sahz_i</code> Desired return temperature of the emission circuit 20 \u00b0C <code>\u03b2H_em_req_sahz_i</code> Desired load factor with ON/OFF control 80 % <code>\u03b8H_em_flw_min_tz_i</code> Minimum required flow temperature for the thermal zone 28 \u00b0C"},{"location":"iso_15316_system_inputs/#distribution","title":"DISTRIBUTION","text":"<p><pre><code># --- distribution ---\n'heat_losses_recovered': True,\n'distribution_loss_recovery': 90,\n'simplified_approach': 80,\n'distribution_aux_recovery': 80,\n'distribution_aux_power': 30,\n'distribution_loss_coeff': 48,\n'distribution_operation_time': 1,\n</code></pre> The parameters are used inside the class HeatingSystemCalculator as:</p> <pre><code>self.Heat_losses_recovered = inp.get('heat_losses_recovered', True)\nself.f_h_dist_i_ls = inp.get('distribution_loss_recovery', 90)  # %\nself.simplified_or_holistic_approach = inp.get('simplified_approach', 80)  # %\nself.f_h_dist_i_aux = inp.get('distribution_aux_recovery', 80)  # %\nself.W_H_dist_i_aux = inp.get('distribution_aux_power', 30)  # W\nself.Heat_loss_coefficent_dist = inp.get('distribution_loss_coeff', 48)  # W/K\nself.tH_dis_i_ON = inp.get('distribution_operation_time', 1)  # h\n</code></pre> <p>if data is not provided by the user, the default values are used.</p> <p>These parameters describe the thermal and electrical behavior of the heat distribution subsystem, which connects the generator to the emitters (secondary circuits). They define how heat losses, auxiliary energy use, and simplifications in the calculation are handled within the ISO 15316-1 framework.</p> Variable Description Default Unit <code>heat_losses_recovered</code> Boolean flag that defines whether distribution heat losses are considered recoverable in the building (e.g., heat lost in indoor piping contributes to heating). <code>True</code> \u2013 <code>distribution_loss_recovery</code> (<code>f_h_dist_i_ls</code>) Fraction of distribution losses that are recoverable (typically within the heated zone). <code>90</code> % <code>simplified_approach</code> (<code>simplified_or_holistic_approach</code>) Defines the calculation approach for recovered losses: a simplified method (<code>&gt; 0</code>) or a holistic method (<code>0</code> for detailed ISO modeling). <code>80</code> % <code>distribution_aux_recovery</code> (<code>f_h_dist_i_aux</code>) Fraction of auxiliary electrical power (e.g., pumps, valves) that is converted into useful heat and recovered within the heated space. <code>80</code> % <code>distribution_aux_power</code> (<code>W_H_dist_i_aux</code>) Rated auxiliary electrical power of the distribution system (e.g., circulation pumps). <code>30</code> W <code>distribution_loss_coeff</code> (<code>Heat_loss_coefficent_dist</code>) Overall heat loss coefficient of the distribution system, representing thermal losses per degree of temperature difference between the fluid and ambient air. <code>48</code> W/K <code>distribution_operation_time</code> (<code>tH_dis_i_ON</code>) Average operation time of the distribution system per time step (typically the same as the emission system). <code>1</code> h"},{"location":"iso_15316_system_inputs/#generation","title":"GENERATION","text":"<p>The generator is modelled using the following parameters:</p> <pre><code>    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"])\n    '\u03b8HW_gen_flw_const': 50.0\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20\n</code></pre> <p>That are: </p> <ul> <li>load power: it is the power of the generator in kW, defined in the product data. variable name: 'full_load_power'</li> <li>max monthly load factor: it is the maximum load factor of the generator in %.  variable_name: 'max_monthly_load_factor'</li> <li>tH_gen_i_ON: it is the time of the generator in ON state in hours. variable_name: 'tH_gen_i_ON'</li> </ul> <ul> <li>auxiliary power generator: Percentage of generator input energy used by auxiliary systems (generally 0-5 %).Increases total system energy input. variable_name: 'auxiliary_power_generator'</li> <li> <p>fraction of auxiliary power generator: it is the portion of auxiliary energy recovered as heat (generally 20\u201360%). Reduces auxiliary losses.variable_name: 'fraction_of_auxiliary_power_generator'.</p> <p> 1. <code>auxiliary_power_generator</code> This parameter defines how much additional electrical power (in %) is consumed by the generator\u2019s own auxiliary components, such as:</p> <ul> <li>Circulation pumps  </li> <li>Combustion or ventilation fans  </li> <li>Electronic controls and sensors  </li> <li>Ignition systems  </li> <li>Internal electronics (standby mode)</li> </ul> <p>Formula:</p> \\[ E_{HW,gen,aux} = E_{HW,gen,in} \\times \\frac{\\text{auxiliary\\_power\\_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( E_{HW,gen,in} \\): Generator input energy (kWh)  </li> <li>\\( E_{HW,gen,aux} \\): Auxiliary energy consumed (kWh)</li> </ul> <p> 2. <code>fraction_of_auxiliary_power_generator</code></p> <p>This parameter represents the fraction of auxiliary power that is recoverable as useful heat. Some auxiliary systems release heat that can be recovered by the generator\u2019s thermal circuit.</p> <p>For example: - Pump motors or internal electronics may release part of their heat to the water loop. - Fans or controllers might dissipate energy inside the generator casing.</p> <p>Formula:</p> \\[ Q_{W,gen,i,ls,rbl,H} = E_{HW,gen,aux} \\times \\frac{\\text{fraction_of_auxiliary_power_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( Q_{W,gen,i,ls,rbl,H} \\): Recovered auxiliary heat (kWh)</li> </ul> </li> </ul> <ul> <li>generator circuit: it is the circuit of the generator. It can be 'direct' or 'independent'. variable_name: 'generator_circuit'<ul> <li>Direct: the generator is connected to the primary circuit, no hydraulic separation primary = secondary</li> <li>Independent: the generator is connected to the secondary circuit, with hydraulic separator primary != secondary</li> </ul> </li> </ul> <p>The primary circuit supply temperature setpoint (Tp_sup_set), i.e., the flow temperature on the generator side (boiler, heat pump, etc.) is calculated using the function _generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand), according to the selected control strategy of the generation system</p> <p>It determines how hot the generator should make the supply water based on: - the outdoor temperature (\u03b8ext), and/or - the heating demand from the distribution/emission side (\u03b8H_dis_flw_demand), and/or - a fixed setpoint defined by the user.</p> <p>The input parameters of the function are:</p> <ul> <li>\u03b8ext: outdoor air temperature</li> <li>\u03b8H_dis_flw_demand: Flow temperature requested by the secondary circuit (distribution/emission side)</li> </ul> <p>with global inputs that are:</p> <ul> <li>df_gen_out_temp: Table defining the primary (generator) heating curve</li> <li> <p>gen_flow_temp_control_type: Type of control used to control the flow temperature of the generator.Defines which control strategy is used (\u201cType A\u201d, \u201cType B\u201d, \u201cType C\u201d):</p> <ul> <li>'Type A - Based on outdoor temperature': uses primary's own weather curve</li> <li>'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)</li> <li>'Type C - Constant temperature'       : uses \u03b8HW_gen_flw_const</li> </ul> </li> <li> <p>\u03b8HW_gen_flw_const: Constant flow temperature of the generator</p> </li> </ul> <p>The user should provide the information directly in the dictionary:</p> <pre><code>'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n'gen_outdoor_temp_data': pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],\n    \"\u03b8flw_gen_min\": [35],\n}, index=[\"Generator curve\"])\n'\u03b8HW_gen_flw_const': 50.0\n</code></pre> <p>where, in the code are defined as: </p> <p><pre><code>self.df_gen_out_temp = inp.get('gen_outdoor_temp_data', pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],   # \u00b0C, max primary supply\n    \"\u03b8flw_gen_min\": [35],   # \u00b0C, min primary supply\n}, index=[\"Generator curve\"]))\n\nself.gen_flow_temp_control_type = inp.get(\n    'gen_flow_temp_control_type',\n    'Type A - Based on outdoor temperature'   # 'Type A' | 'Type B' | 'Type C'\n)\n\nself.\u03b8HW_gen_flw_const = float(inp.get('\u03b8HW_gen_flw_const', 50.0))\n</code></pre> Explanation of the different type of control:</p> <ul> <li> Type A - Based on outdoor temperature. Climatic curve (outdoor compensation) <pre><code>if ctrl.startswith('Type A'):\n    if \u03b8ext_max != \u03b8ext_min:\n        Tp = \u03b8flw_min + (\u03b8flw_max - \u03b8flw_min) * (\u03b8ext_max - \u03b8ext) / (\u03b8ext_max - \u03b8ext_min)\n        return max(min(Tp, \u03b8flw_max), \u03b8flw_min)\n    return \u03b8flw_min\n</code></pre> Calculates the generator flow temperature linearly based on outdoor temperature. Equation: The generator flow temperature \\( T_{p, \\text{set}} \\) is calculated linearly based on the outdoor temperature \\( \\theta_{\\text{ext}} \\), following the formula:</li> </ul> \\[ T_{p, \\text{set}} = T_{\\text{flw}, \\text{min}} + \\left( T_{\\text{flw}, \\text{max}} - T_{\\text{flw}, \\text{min}} \\right) \\cdot \\frac{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}} \\right)}{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}, \\text{min}} \\right)} \\] <p>Where:</p> <ul> <li>\\( T_{\\text{flw}, \\text{min}} \\) = minimum flow temperature (e.g., 35\u00b0C)</li> <li>\\( T_{\\text{flw}, \\text{max}} \\) = maximum flow temperature (e.g., 60\u00b0C)</li> <li>\\( \\theta_{\\text{ext}} \\) = outdoor air temperature</li> <li>\\( \\theta_{\\text{ext}, \\text{min}} \\) = minimum outdoor temperature (e.g., -7\u00b0C)</li> <li>\\( \\theta_{\\text{ext}, \\text{max}} \\) = maximum outdoor temperature (e.g., 15\u00b0C) The calculated \\( T_{p, \\text{set}} \\) is then clamped between the minimum and maximum values:</li> </ul> \\[ T_{p, \\text{set}} = \\max\\left( \\min\\left( T_{p, \\text{set}}, T_{\\text{flw}, \\text{max}} \\right), T_{\\text{flw}, \\text{min}} \\right) \\] <p>\ud83d\udc49\ud83c\udffb Meaning: This is the typical weather-compensated control used (for example) in boilers and heat pumps. It automatically adjusts water temperature to the outdoor conditions for better efficiency and comfort. Example visualization of type A: <pre><code>Generator flow temperature (\u00b0C)\n\u2502\n\u2502    60\u00b0C \u2500\u2500\u2500\u2500\u2510\n\u2502              \\\n\u2502               \\\n\u2502                \\\n\u2502                 \\\n\u2502    35\u00b0C \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Outdoor temperature (\u00b0C)\n          -7          0           +15\n</code></pre></p> <ul> <li> <p> Type B - Based on demand. Follow secondary demand <pre><code>if ctrl.startswith('Type B'):\n    return float(\u03b8H_dis_flw_demand)\n</code></pre> Sets the generator supply temperature equal to the demand from the secondary (distribution/emission) side. \ud83d\udc49\ud83c\udffb Meaning: This is used in systems with hydraulic separation (e.g., with a buffer tank or heat exchanger) where the generator must match the needs of the secondary circuit dynamically. Example: If the radiator loop requests 45 \u00b0C \u2192 the generator must deliver exactly 45 \u00b0C to maintain balance.</p> </li> <li> <p> Type C - Constant temperature <pre><code>return float(self.\u03b8HW_gen_flw_const)\n</code></pre> Ignores weather and demand \u2014 the generator runs at a fixed supply temperature (e.g., 50 \u00b0C). \ud83d\udc49\ud83c\udffb Meaning: Simplest and oldest control type, often found in small or legacy heating systems. It offers no adaptation to weather or load, typically less efficient. Example: If the user defines a constant supply temperature of 50 \u00b0C \u2192 the generator will always deliver 50 \u00b0C, regardless of the demand from the secondary circuit.</p> </li> </ul> <ul> <li>speed control of generator pump: icontrols how \u0394T varies with system load (constant vs variable). It can be in the code 'variable' or 'deltaT_constant'. variable_name: 'speed_control_generator_pump'</li> <li> <p>Nominal water deltaT of generator: defines the nominal \u0394T at design (full load) \u2014 the reference used in thermal balance equations in \u00b0C. variable_name: 'generator_nominal_deltaT'. It is used if speed_control_of_generator_pump is 'deltaT_constant'.</p> <p>More info:</p> <ul> <li><code>\"deltaT_constant\"</code> \u2192 The pump maintains a fixed temperature difference (\u0394T) between flow and return.</li> <li>Example: The pump adjusts its speed so that \u0394T = 20 \u00b0C remains constant.</li> <li><code>\"variable\"</code> \u2192 The pump varies its speed dynamically according to the system load.</li> <li>When heating demand decreases, the water flow rate decreases.</li> <li>This leads to a smaller \u0394T at partial loads, improving efficiency.</li> </ul> <p>When <code>variable</code>, the temperature difference (\u0394T) decreases proportionally with the thermal load, which represents real modulating behavior of pumps and heat generators.</p> <p><code>generator_nominal_deltaT</code></p> <p>Defines the nominal temperature difference (\u0394T) between the generator flow and return at full-load conditions.</p> \\[ \\Delta T_{nom} = T_{flow,nominal} - T_{return,nominal} \\] <p>This is the design operating condition for the generator, used as a reference in calculations.</p> <p>Example:</p> <p>If <code>generator_nominal_deltaT = 20</code>, then at full load:</p> <ul> <li>Supply temperature = 60 \u00b0C  </li> <li>Return temperature = 40 \u00b0C \u2192 \u0394T = 20 \u00b0C  </li> </ul> <p>At partial load:</p> <ul> <li>If <code>speed_control_generator_pump = \"deltaT_constant\"</code> \u2192 \u0394T remains 20 \u00b0C.  </li> <li>If <code>speed_control_generator_pump = \"variable\"</code> \u2192 \u0394T may drop to 10\u201315 \u00b0C, depending on demand.</li> </ul> </li> </ul> <p>It is possible to define the optional primary setpoints (used if circuit is independent).</p> <ul> <li>\u03b8HW_gen_flw_set: flow temperature setpoint</li> <li>\u03b8HW_gen_ret_set: return temperature setpoint</li> </ul>"},{"location":"iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <pre><code>1) 'simple'       : linear heuristic vs. return temperature\n2) 'parametric'   : piecewise/threshold model\n3) 'manufacturer' : 1D (return) or 2D (flow/return) map\n</code></pre> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic</p> <p>1) Detect zero or negative heating demand</p> <p><pre><code>if float(qh) &lt;= 0:\n</code></pre> This means there is no heating required (or possibly cooling). Now the function checks which policy is set for such cases.</p> <p>2) Case 1 \u2014 Full simulation even when Q_H = 0 <pre><code>if not self.calc_when_QH_positive_only:\n    # Full calculation even with zero load\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n    ...\n</code></pre></p> <ul> <li>Here, the flag calc_when_QH_positive_only is False, so the user wants to compute everything even when there\u2019s no load.</li> <li> <p>It runs the complete thermal balance by calling: <pre><code>res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre> This means: compute system temperatures, efficiencies, flow rates, etc., as if the system were still active but with zero heating power.</p> </li> <li> <p>The results are appended to the output DataFrame as usual.</p> </li> </ul> <p>Use case: See how the system behaves under \u201cno load\u201d conditions (e.g., during shoulder months) \u2014 including standby losses or auxiliary power.</p> <p>3) Case 2 \u2014 Skip detailed calculation (calc_when_QH_positive_only = True)</p> <p>If this flag is True, the system should behave differently depending on how \u201coff periods\u201d are treated.</p> <p>There are three \u201coff modes\u201d controlled by self.off_compute_mode.</p> <ul> <li> <p> a) Mode: 'idle' \u2192 Minimal record  <pre><code>if self.off_compute_mode == 'idle':\n    res_row = {'timestamp': idx}\n    res_row.update(self._idle_row(0.0, float(\u03b8int), float(\u03b8ext)))\n</code></pre></p> <ul> <li>Produces a minimal output line using _idle_row().</li> <li>This function fills the row mostly with zeros or NaN values \u2014 representing that nothing is being calculated because the system is idle.</li> <li>Only basic fields like timestamp, indoor temperature, and outdoor temperature are kept.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For speed optimization when simulating a full year \u2014 avoids doing unnecessary physics calculations.</p> </li> <li> <p> b) Mode: 'temps' \u2192 Record only temperatures  <pre><code>elif self.off_compute_mode == 'temps':\n    res = self._temps_row_when_off(float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>This still computes temperatures (like circuit or node flow/return) using _temps_row_when_off(),</li> <li>but all energetic terms (flows, powers, losses) are set to zero.</li> <li>This way, you can visualize how the temperature control or mixing valves behave even with zero heating demand.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For continuous temperature mapping, useful when validating system controls or comfort conditions.</p> </li> <li> <p> c) Mode: 'full' \u2192 Full calculation despite Q_H = 0  <pre><code>elif self.off_compute_mode == 'full':\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>Similar to Case 1 but triggered explicitly by mode 'full' \u2014 performs a complete computation of all variables even if load = 0.</li> <li>This is a \u201cforce full calc\u201d inside the zero-demand policy.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: When testing or debugging; ensures identical data structure across all timesteps.</p> </li> </ul> <p>4) continue statements</p> <p>Each branch ends with continue \u2014 \u2192 meaning the loop moves to the next timestep immediately after handling this case. No further code in the timestep is executed once the \u201czero-load\u201d policy has been applied.</p> <p>General-physical interpretation </p> <p>This logic helps balance accuracy vs performance:</p> <p>In annual simulations (8760 hours), 70\u201390% of the time may have zero heating demand (e.g., in summer). Recomputing all hydraulic and thermal equations each hour would waste time.</p> <p>Therefore, this control allows skipping unnecessary computations or simplifying the result depending on your simulation purpose:</p> <ul> <li>\"idle\" \u2192 fastest</li> <li>\"temps\" \u2192 medium (keep comfort analysis)</li> <li>\"full\" \u2192 slowest but most complete</li> </ul> <p>Example of inputs system: <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n    'heat_emission_data' : pd.DataFrame({\n            \"\u03b8H_em_flw_max_sahz_i\": [45],\n            \"\u0394\u03b8H_em_w_max_sahz_i\": [8],\n            \"\u03b8H_em_ret_req_sahz_i\": [20],\n            \"\u03b2H_em_req_sahz_i\": [80],\n            \"\u03b8H_em_flw_min_tz_i\": [28],\n        }, index=[\n            \"Max flow temperature HZ1\",\n            \"Max \u0394\u03b8 flow / return HZ1\",\n            \"Desired return temperature HZ1\",\n            \"Desired load factor with ON-OFF for HZ1\",\n            \"Minimum flow temperature for HZ1\"\n        ])\n\n    # --- distribution ---\n    'heat_losses_recovered': True,\n    'distribution_loss_recovery': 90,\n    'simplified_approach': 80,\n    'distribution_aux_recovery': 80,\n    'distribution_aux_power': 30,\n    'distribution_loss_coeff': 48,\n    'distribution_operation_time': 1,\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n}\n</code></pre></p>"},{"location":"iso_52010/","title":"ISO 52010 - Calculation procedure","text":""},{"location":"iso_52010/#iso-52010-calculation-procedure","title":"ISO 52010 - Calculation procedure","text":"<pre><code>def Calculation_ISO_52010(building_object, path_weather_file, weather_source=\"pvgis\") -&gt; simdf_52010\n</code></pre>"},{"location":"iso_52010/#input","title":"Input","text":"Name Type Description <code>building_object</code> <code>dict</code> or object Building structure; if it is a mapping, a default set of orientations is used. Otherwise, the function reads <code>building_object.orientation_elements</code>. <code>path_weather_file</code> <code>str | PathLike</code> Path to an EPW weather file (used when <code>weather_source=\"epw\"</code>). <code>weather_source</code> <code>str</code> Selects the input weather pipeline. Supported values: <code>\"pvgis\"</code> (TMY fetch via PVGIS) or <code>\"epw\"</code> (local EPW)."},{"location":"iso_52010/#purpose","title":"Purpose","text":"<p>Implements the EN ISO 52010-1 processing pipeline to convert raw climatic data (EPW/PVGIS TMY) into simulation-ready time series and to compute solar irradiance on arbitrary surfaces plus window shading reduction factors. The function returns a wrapper around a <code>pandas.DataFrame</code> containing all derived variables.</p>"},{"location":"iso_52010/#how-it-works","title":"How it works","text":"<ol> <li> <p>Fetch raw weather </p> <ul> <li><code>pvgis</code> \u2192 <code>ISO52010.get_tmy_data_pvgis(building_object)</code> </li> <li><code>epw</code>   \u2192 <code>ISO52010.get_tmy_data_epw(path_weather_file)</code> The result exposes:  </li> <li><code>weather_data</code> \u2192 base <code>DataFrame</code> with hourly variables (UTC)  </li> <li><code>utc_offset</code>   \u2192 integer hours to shift from UTC to local time  </li> <li><code>latitude</code>, <code>longitude</code></li> </ul> </li> <li> <p>Normalize the time index </p> <ul> <li>If not a leap year (<code>len(sim_df) == 8760</code>), rebuild index to a nominal year 2009 using original month/day/hour.</li> <li>Apply <code>np.roll</code> by <code>utc_offset</code> to every column to align to local time.  </li> <li>Rename index axis from <code>time(UTC)</code> \u2192 <code>time(local)</code> and add helpers:  <ul> <li><code>day of year</code> (1\u2013365/366)  </li> <li><code>hour of day</code> (1\u201324, ISO52010 convention)</li> </ul> </li> </ul> </li> <li> <p>Define surface orientations (tilt/azimuth pairs) </p> <pre><code>HOR \u2192 (beta=0,   gamma=0)\nSV  \u2192 (beta=90,  gamma=0)\nEV  \u2192 (beta=90,  gamma=90)\nNV  \u2192 (beta=90,  gamma=180)\nWV  \u2192 (beta=90,  gamma=-90)\n</code></pre> <p>If <code>building_object</code> is a dict, the set <code>{'EV','HOR','SV','NV','WV'}</code> is used; otherwise <code>building_object.orientation_elements</code> is read.</p> </li> <li> <p>For each orientation </p> <ul> <li>Call <code>ISO52010.Solar_irradiance_calculation(...)</code> with: latitude, longitude, timezone, the selected (beta, gamma), input DHI (<code>Gd(h)</code>), DNI (<code>Gb(n)</code>), albedo, and a calendar built from the index.  </li> <li>Concatenate resulting columns (renamed):  <ul> <li><code>I_sol_tot_{ori}</code>, <code>I_sol_dif_{ori}</code>, <code>I_sol_dir_w_{ori}</code> </li> </ul> </li> <li>Compute window shading reduction factor with <code>ISO52010.Shading_reduction_factor_window(...)</code> and append its columns if present.</li> </ul> </li> <li> <p>Warm-up period     Prepend December to the beginning of the series to form a warm-up period:  </p> <pre><code>sim_df = pd.concat([sim_df[sim_df.index.month == 12], sim_df])\n</code></pre> </li> <li> <p>Return wrapper </p> </li> </ol> <pre><code>return simdf_52010(sim_df=sim_df)\n</code></pre>"},{"location":"iso_52010/#outputs","title":"Outputs","text":"Type Description <code>simdf_52010</code> Small wrapper carrying <code>sim_df: pd.DataFrame</code> with weather (local time), solar irradiances by orientation, shading factors, and utility calendar columns."},{"location":"iso_52010/#columns-added-by-the-procedure","title":"Columns Added by the Procedure","text":"<ul> <li>Calendar helpers: <code>day of year</code>, <code>hour of day</code> (1\u201324)  </li> <li>Solar (per orientation):  </li> <li><code>I_sol_tot_{ORI}</code> \u2192 total solar irradiance on the plane (W/m\u00b2)  </li> <li><code>I_sol_dif_{ORI}</code> \u2192 diffuse component on the plane (W/m\u00b2)  </li> <li><code>I_sol_dir_w_{ORI}</code> \u2192 direct beam on the plane adjusted by window incidence (W/m\u00b2)  </li> <li>Shading (when available): one or more <code>W_{window_name}</code> and <code>H_sun_{window_name}</code> series from <code>Shading_reduction_factor_window</code></li> </ul> <p>The base weather columns depend on the chosen source but typically include dry-bulb temperature, relative humidity, wind speed, DHI = <code>Gd(h)</code>, DNI = <code>Gb(n)</code>, and global horizontal.</p>"},{"location":"iso_52010/#orientation-angles","title":"Orientation &amp; Angles","text":"<ul> <li><code>beta</code> = tilt (0\u00b0 = horizontal, 90\u00b0 = vertical)  </li> <li><code>gamma</code> = azimuth (0\u00b0 = South, 90\u00b0 = East, 180\u00b0 = North, -90\u00b0/270\u00b0 = West)  </li> <li>Time index is local after the <code>utc_offset</code> roll.</li> </ul>"},{"location":"iso_52010/#notes","title":"Notes","text":"<ul> <li>Leap year handling: if <code>len(sim_df) &gt; 8760</code> (8784 hours), the index is left as-is and <code>n_days_year=366</code>.  </li> <li><code>np.roll</code> shifts all columns equally; ensure the source weather data are aligned and cyclical.  </li> <li>The warm-up prepend duplicates December; if you perform annual KPIs, exclude the first month accordingly.  </li> <li><code>Shading_reduction_factor_window</code> requires geometric window metadata inside <code>building_object</code>.</li> </ul>"},{"location":"iso_52010/#example","title":"Example","text":"<pre><code>sim = Calculation_ISO_52010(\n    building_object=my_building,\n    path_weather_file=\"../weather/rome.epw\",\n    weather_source=\"epw\"\n)\ndf = sim.sim_df\nprint(df.filter(like=\"I_sol_tot_\").head())\n</code></pre>"},{"location":"iso_52010/#reference","title":"Reference","text":"<ul> <li>EN ISO 52010-1:2017 \u2013 Energy performance of buildings \u2014 External climatic conditions </li> <li><code>Weather_data_bui</code> \u2013 convenience wrapper that returns a <code>simulation_df</code> built on top of this pipeline  </li> <li><code>ISO52010.Solar_irradiance_calculation</code> \u2013 solar geometry &amp; plane-of-array irradiance  </li> <li><code>ISO52010.Shading_reduction_factor_window</code> \u2013 window shading factors per orientation</li> </ul>"},{"location":"iso_52016/","title":"ISO 52016 - Introduction","text":""},{"location":"iso_52016/#iso-5201052016-building-thermal-simulation-module-level","title":"ISO 52010/52016 Building Thermal Simulation \u2013 Module-level","text":"<p>Standard alignment: ISO EN 52010-1 (climate/solar), ISO EN 52016-1 (zone balance), ISO EN 13789 (transmission &amp; unconditioned zones), ISO EN 16798-1/-7 (internal gains &amp; natural ventilation), ISO EN 15316-1 (calculation of system energy requirements and system efficiencies) License: MIT Version: 0.1 Authors: Daniele Antonucci, Ulrich Filippi Oberegger, Olga Somova</p> <p>This documentation explains each function\u2019s purpose, physics, inputs/outputs, algorithmic flow, and edge cases. All equations use SI unless otherwise stated.</p> <p>ISO EN 52016 is a key international standard that defines methods for the calculation of energy needs for heating and cooling, as well as the internal temperatures and sensible and latent heat loads of buildings. It is part of the ISO 52000 family, which provides a comprehensive framework for assessing the energy performance of buildings (EPB) in accordance with European energy efficiency directives.</p>"},{"location":"iso_52016/#purpose-and-scope","title":"Purpose and Scope","text":"<p>The standard provides detailed calculation procedures for:</p> <ul> <li>Hourly or monthly determination of energy needs for space heating and cooling;</li> <li>Evaluation of internal air temperatures in different thermal zones;</li> <li>Calculation of sensible and latent heat loads on the building;</li> <li>Assessment of the impact of building envelope characteristics, internal gains, solar gains, and ventilation.</li> </ul> <p>It replaces and extends earlier standards such as EN ISO 13790, aligning the methodology with modern requirements for dynamic simulation and integration into building energy performance assessments.</p>"},{"location":"iso_52016/#calculation-principles","title":"Calculation Principles","text":"<p>ISO EN 52016 introduces both hourly and monthly calculation methods:</p> <ul> <li>The hourly method offers a dynamic approach suitable for detailed analysis, design, and simulation tools.</li> <li>The monthly method provides simplified procedures for compliance checks and energy certification purposes.</li> </ul> <p>Key aspects considered in the calculations include:</p> <ul> <li>Thermal properties of opaque and transparent envelope elements;</li> <li>Solar and internal heat gains;</li> <li>Ventilation and infiltration rates;</li> <li>Thermal mass and dynamic effects;</li> <li>Zoning and adjacent space interactions.</li> </ul>"},{"location":"iso_52016/#relation-to-other-standards","title":"Relation to Other Standards","text":"<p>ISO EN 52016 works in coordination with:</p> <ul> <li>ISO 52010, which defines the calculation of solar and daylight quantities on building surfaces;</li> <li>ISO 52017, which provides the dynamic hourly simulation framework for the thermal behavior of buildings;</li> <li>ISO 52000-1, which establishes the overall energy performance assessment framework.</li> <li>and other, such asEN ISO 15316-1, EN ISO 16798-1/-7, etc Together, these standards ensure consistency between the physical modeling of buildings, system performance, and overall energy efficiency evaluation.</li> </ul> <p>By harmonizing calculation methods across Europe, ISO EN 52016 helps ensure that building energy performance is transparent, comparable, and technically robust, supporting sustainable design and policy implementation.</p>"},{"location":"iso_52016_adj_zone/","title":"ISO 52016 - Adjacent Zone","text":""},{"location":"iso_52016_adj_zone/#adjacent-zone","title":"Adjacent zone","text":"<p>The <code>adj_zone</code> dictionary provides all necessary geometric and physical properties of an adjacent unconditioned zone (e.g., attic, basement, or corridor) required to compute the transmission heat transfer coefficient according to ISO 13789.</p>"},{"location":"iso_52016_adj_zone/#adjacent-zone-input-adj_zone","title":"Adjacent Zone Input (<code>adj_zone</code>)","text":"<p>It is possible to simulate a not conditioned adjacent zone providing the following input: </p> <p>Example Structure: <pre><code>{\n    \"name\":\"adj_1\",\n    \"orientation_zone\": {\n        \"azimuth\": 0,\n    },\n    \"area_facade_elements\": np.array([20,60,30,30,50,50], dtype=object),\n    \"typology_elements\": np.array(['OP', 'OP', 'OP', 'OP', 'GR', 'OP'], dtype=object),\n    \"transmittance_U_elements\": np.array([0.82, 0.82, 0.82, 0.82, 0.51, 1.16], dtype=object),\n    \"orientation_elements\": np.array(['NV', 'SV', 'EV', 'WV', 'HOR', 'HOR'], dtype=object),\n    'volume': 300, \n    'building_type_class':'Residential_apartment',\n    'a_use':50 \n}\n</code></pre></p>"},{"location":"iso_52016_adj_zone/#field-descriptions","title":"Field Descriptions","text":"Key Type Description <code>name</code> <code>str</code> Identifier of the adjacent zone (e.g., <code>\"adj_1\"</code>). <code>orientation_zone.azimuth</code> <code>float</code> The azimuth angle (in degrees) of the unconditioned zone orientation. Used to determine the facing direction (0\u00b0 = South, 90\u00b0 = East, 180\u00b0 = North, 270\u00b0 = West). <code>area_facade_elements</code> <code>np.array[float]</code> Array of surface areas (m\u00b2) for each fa\u00e7ade element (walls, ground, horizontal slabs, etc.). <code>typology_elements</code> <code>np.array[str]</code> Surface type codes following ISO 13789/52016 conventions:  - <code>OP</code> = Opaque element (wall)  - <code>GR</code> = Ground-contact surface  - <code>HOR</code> = Horizontal surface (roof/floor) <code>transmittance_U_elements</code> <code>np.array[float]</code> U-values (W/m\u00b2\u00b7K) corresponding to each fa\u00e7ade element, representing their thermal transmittance. <code>orientation_elements</code> <code>np.array[str]</code> Orientation of each surface according to ISO 52016 notation:  - <code>NV</code> = North Vertical (north-facing wall)  - <code>SV</code> = South Vertical (south-facing wall)  - <code>EV</code> = East Vertical (east-facing wall)  - <code>WV</code> = West Vertical (west-facing wall)  - <code>HOR</code> = Horizontal (roof or floor) <code>volume</code> <code>float</code> Volume (m\u00b3) of the adjacent unconditioned zone. Used to estimate ventilation exchange with the external environment. <code>building_type_class</code> <code>str</code> Descriptive label for the building type (e.g., <code>\"Residential_apartment\"</code>, <code>\"Office\"</code>, <code>\"Warehouse\"</code>). Used for classification and potential lookup of empirical coefficients. <code>a_use</code> <code>float</code> Reference area of the adjacent zone (m\u00b2). May be used for normalization or reporting."},{"location":"iso_52016_adj_zone/#interpretation-of-orientation-codes","title":"Interpretation of Orientation Codes","text":"Code Meaning Typical Element Azimuth (\u00b0) NV North Vertical North-facing opaque wall 180 SV South Vertical South-facing opaque wall 0 EV East Vertical East-facing opaque wall 90 WV West Vertical West-facing opaque wall 270 HOR Horizontal Roof or ground-contact surface \u2014 GR Ground Floor or basement slab \u2014"},{"location":"iso_52016_adj_zone/#example-breakdown","title":"Example Breakdown","text":"<p>For the example above:</p> Element Typology Orientation Area (m\u00b2) U-Value (W/m\u00b2\u00b7K) Wall_1 OP NV 20 0.82 Wall_2 OP SV 60 0.82 Wall_3 OP EV 30 0.82 Wall_4 OP WV 30 0.82 Floor GR HOR 50 0.51 Roof OP HOR 50 1.16"},{"location":"iso_52016_adj_zone/#notes","title":"Notes","text":"<ul> <li>Arrays in the dictionary (<code>area_facade_elements</code>, <code>U_elements</code>, <code>orientation_elements</code>, etc.) must have the same length \u2014 one entry per building element.  </li> <li>The azimuth determines the active orientation for calculations (<code>NV</code>, <code>SV</code>, <code>EV</code>, <code>WV</code>, <code>HOR</code>).  </li> <li>Default ISO convention assumes 0\u00b0 = South, rotating clockwise (90\u00b0 = East, 180\u00b0 = North, 270\u00b0 = West).  </li> <li>Horizontal (<code>HOR</code>) and ground (<code>GR</code>) elements contribute to transmission but have no azimuth dependency.</li> </ul>"},{"location":"iso_52016_adj_zone/#summary","title":"Summary","text":"<p>The <code>adj_zone</code> input defines the geometry and thermal characteristics of an unconditioned adjacent space. It serves as the foundation for ISO 13789 calculations of: - Transmission losses through opaque and ground-contact elements. - Ventilation and exchange between conditioned and unconditioned spaces. - Monthly distribution and adjustment factors for unconditioned zones.</p> <p>In each not thermal adjacent zone the calcualtion of heat transfer coefficent by transmission is made using the function <code>transmission_heat_transfer_coefficient_ISO13789</code>, thta is based to the EN ISO 13789:2017 standard.</p>"},{"location":"iso_52016_adj_zone/#transmission-heat-transfer-coefficients-en-iso-13789","title":"Transmission heat transfer coefficients - EN ISO 13789","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(cls, adj_zone, n_ue=0.5, qui=0)\n</code></pre>"},{"location":"iso_52016_adj_zone/#inputs","title":"Inputs","text":"Name Type Description <code>adj_zone</code> <code>dict</code> Dictionary containing the geometric and physical properties of the adjacent (unconditioned) zone. Must include surface orientations, areas, U-values, and volume. <code>n_ue</code> <code>float</code>, default <code>0.5</code> Air change rate (h\u207b\u00b9) between the unconditioned zone and the external environment. <code>qui</code> <code>float</code>, default <code>0</code> Airflow rate (m\u00b3/h) between conditioned and unconditioned zones. Typically zero to avoid underestimating transmission."},{"location":"iso_52016_adj_zone/#purpose","title":"Purpose","text":"<p>This function implements the ISO 13789:2017 method for calculating the transmission heat transfer coefficient (<code>H_tr</code>) between conditioned, unconditioned, and external zones of a building.  </p> <p>It provides a quantitative measure of heat losses through building envelope elements and ventilation exchange with unconditioned spaces and the exterior.</p>"},{"location":"iso_52016_adj_zone/#how-it-works","title":"How it works","text":"<p>1) Identify Orientation</p> <p>The function uses the azimuth of the adjacent zone (<code>adj_zone[\"orientation_zone\"][\"azimuth\"]</code>) to map it to an orientation name (<code>NV</code>, <code>SV</code>, <code>EV</code>, <code>WV</code>) based on predefined azimuth angles:</p> Orientation Azimuth (\u00b0) NV 180 SV 0 EV 90 WV 270 <p>2) Extract Arrays</p> <p>From the <code>adj_zone</code> dictionary:   - <code>areas</code>: surface areas (m\u00b2)   - <code>U_values</code>: transmittances (W/m\u00b2K)   - <code>orientations</code>: list of orientation strings for each facade element</p> <p>3) Boolean Masks</p> <p>Two masks are defined to separate:   - <code>mask_selected</code>: surfaces facing the unconditioned zone   - <code>mask_others</code>: other external surfaces</p> <p>4) Transmission Losses</p> <ul> <li>Between conditioned and unconditioned zones: </li> </ul> \\[ H_{d,zt-ztu} = \\sum (A_i \\cdot U_i) \\text{ for selected orientation} \\] <ul> <li>From unconditioned zone to exterior: </li> </ul> \\[ H_{d,ztu-ext} = \\sum (A_i \\cdot U_i) \\text{ for other orientations} \\] <p>5) Ventilation Losses</p> <pre><code>Ventilation heat transfer coefficients are added according to ISO 13789:\n</code></pre> \\[ H_{ve,iu} = 0.33 \\times q_{iu} \\] \\[ H_{ve,ue} = 0.33 \\times q_{ue} \\] <pre><code>Where:\n- `\u03c1\u00b7cp = 0.33 Wh/(m\u00b3\u00b7K)` for air\n- `q_iu`: airflow between conditioned and unconditioned zones (m\u00b3/h)  \n- `q_ue = V_u \u00d7 n_ue`: airflow between unconditioned zone and exterior\n</code></pre> <p>6) Total Heat Transfer</p> \\[ H_{ue} = H_{d,ztu-ext} + H_{ve,ue} \\\\ H_{iu} = H_{d,zt-ztu} + H_{ve,iu} \\] \\[ H_{ztu,tot} = H_{ue} + H_{iu} \\] <p>7) Adjustment Factor (b\u208dztu\u208e\u2098)     The adjustment factor accounts for the ratio between losses to the exterior and total losses of the unconditioned zone:</p> \\[ b_{ztu,m} = \\frac{H_{ue}}{H_{ue} + H_{iu}} = \\frac{H_{ue}}{H_{ztu,tot}} \\tag{4.13} \\] <p>\\(b_{ztu,m}\\in[0,1]\\) measures how much the unconditioned zone is \u201canchored\u201d to the outside rather than to the conditioned neighbor.</p> <p>8) Distribution Factor (F\u208dztc\u208e\u2098)</p> <p>If multiple conditioned zones exist, the distribution factor allocates transmission between them:</p> \\[ F_{ztc,ztu,m} = \\frac{H_{ztc,i,ztu,m}}{\\sum_j H_{ztc,j,ztu,m}} \\] <p>Here it is set to <code>1.0</code> since only one conditioned zone is assumed.</p>"},{"location":"iso_52016_adj_zone/#physics","title":"Physics","text":"<p>The total heat transfer coefficient <code>H_tr</code> is computed as:</p> \\[ H_{tr} = H_d + H_g + H_u + H_a \\] <p>Where: - H_d: Transmission through external envelope (W/K) - H_g: Transmission through ground (W/K) - H_u: Transmission through unconditioned zones (W/K) - H_a: Transmission to adjacent buildings (W/K)  </p> <p>In this function, we focus on the unconditioned zone contribution (<code>H_u</code>).</p>"},{"location":"iso_52016_adj_zone/#output","title":"Output","text":"Variable Type Description <code>H_ztu_tot</code> <code>float</code> Total transmission heat transfer coefficient between the conditioned zone and the adjacent unconditioned zone (W/K). <code>b_ztu_m</code> <code>float</code> Monthly adjustment factor for the unconditioned adjacent zone (dimensionless). <code>F_ztc_ztu_m</code> <code>float</code> Distribution factor of the transmission coefficient between conditioned and unconditioned zones (dimensionless)."},{"location":"iso_52016_adj_zone/#example","title":"Example","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(BUI, adj_zone_name, n_ue=0.5, qui=0):\n    adj = get_adj_zone(BUI, adj_zone_name)\n    A = np.asarray(adj[\"area_facade_elements\"], dtype=float)\n    U = np.asarray(adj[\"transmittance_U_elements\"], dtype=float)\n    ORI = np.asarray(adj[\"orientation_elements\"])\n    # Define which orientations correspond to zt-ztu interface (project specific rule):\n    mask_interface = is_interface_to_conditioned_zone(ORI, adj, BUI)   # boolean mask\n    Hd_zt_ztu  = float(np.sum(A[mask_interface] * U[mask_interface]))   # Eq. (4.10)\n    Hd_ztu_ext = float(np.sum(A[~mask_interface] * U[~mask_interface])) # Eq. (4.11)\n\n    # Ventilation terms (Eq. 4.12)\n    Vu = float(adj[\"volume\"])\n    que = Vu * n_ue\n    Hve_ue = 0.33 * que\n    Hve_iu = 0.33 * float(qui)\n\n    Hue = Hd_ztu_ext + Hve_ue\n    Hiu = Hd_zt_ztu + Hve_iu\n    Hztu_tot = Hue + Hiu                                 # Eq. (4.12d)\n    b_ztu_m  = Hue / Hztu_tot if Hztu_tot &gt; 0 else 1.0   # Eq. (4.13)\n    return float(Hztu_tot), float(b_ztu_m)\n</code></pre> <ul> <li><code>H_ztu_tot</code> <code>[W\u00b7K\u207b\u00b9]</code> \u2014 total coupling of the unconditioned zone.</li> <li><code>b_ztu_m</code> <code>[-]</code> \u2014 monthly factor (in the current code computed once from static inputs).</li> <li><code>F_ztc_ztu_m</code> <code>[-]</code> \u2014 distribution factor (in the current code computed once from static inputs).</li> </ul> <p>Example Output:</p> <pre><code>H_ztu_tot = 78.45  # W/K\nb_ztu_m = 0.63\nF_ztc_ztu_m = 1.0\n</code></pre>"},{"location":"iso_52016_adj_zone/#practical-extraction-with-your-bui-structure","title":"Practical extraction with your <code>BUI</code> structure","text":"<ul> <li>For a given unconditioned zone <code>adj_i</code>:<ul> <li>Build sets:<ul> <li>\\(\\mathcal{E}_{zt{\\text -}ztu}\\): elements in <code>adj_i</code> whose <code>orientation_elements</code> match the interface direction to the conditioned zone (your code uses equality tests by <code>NV/SV/EV/WV/HOR</code>).</li> <li>\\(\\mathcal{E}_{ztu{\\text -}ext}\\): elements in <code>adj_i</code> not on the interface.</li> </ul> </li> <li>Use <code>adj_i.volume</code> \u2192 \\(V_u\\).  </li> <li>Pick <code>n_ue</code> from <code>df_n_ue</code> by air-tightness class or keep default <code>0.5 h\u207b\u00b9</code>.</li> </ul> </li> </ul>"},{"location":"iso_52016_adj_zone/#edge-cases","title":"Edge Cases","text":"<ul> <li>If <code>A</code>/<code>U</code> vectors contain dtype=object (as in your snippet), cast explicitly to <code>float</code>.</li> <li>If <code>Hztu_tot = 0</code> (degenerate geometry), define <code>b_ztu_m = 1.0</code> by convention (fully outdoor-anchored).</li> </ul>"},{"location":"iso_52016_adj_zone/#notes_1","title":"Notes","text":"<ul> <li><code>H_ztu_tot</code> increases with larger areas, higher U-values, or greater ventilation exchange.  </li> <li>Default <code>n_ue = 0.5</code> corresponds to \u201cwell-sealed joints, no ventilation openings\u201d (ISO 13789 Table 7).  </li> <li>The function currently handles one conditioned zone; for multiple zones, extend the <code>F_ztc_ztu_m</code> calculation.</li> </ul>"},{"location":"iso_52016_aeral_heat_capacity/","title":"ISO 52016 - Aeral heat capacity","text":""},{"location":"iso_52016_aeral_heat_capacity/#aeral-heat-capacity","title":"Aeral Heat capacity","text":"<pre><code>def Areal_heat_capacity_of_element(cls, building_object) -&gt; aeral_heat_capacity\n</code></pre>"},{"location":"iso_52016_aeral_heat_capacity/#parameters","title":"Parameters","text":"Name Type Description <code>building_object</code> <code>dict</code> Building model containing a list of surfaces in <code>building_surface</code> and global settings under <code>building</code>."},{"location":"iso_52016_aeral_heat_capacity/#required-fields","title":"Required Fields","text":"<p>On each surface in <code>building_surface</code>:</p> <ul> <li><code>ISO52016_type_string</code> \u2014 element type: <code>\"OP\"</code> (opaque), <code>\"W\"</code> (transparent), <code>\"GR\"</code> (ground-contact), <code>\"ADJ\"</code> (adjacent opaque).  </li> <li><code>thermal_capacity</code> \u2014 areal heat capacity (e.g., from ISO 52016 Table B.14).</li> </ul> <p>On the building object:</p> <ul> <li><code>building.construction_class</code> \u2014 construction mass class from ISO 52016 Table B.13:  </li> <li><code>class_i</code>, <code>class_e</code>, <code>class_ie</code>, <code>class_d</code>, <code>class_m</code>.</li> </ul>"},{"location":"iso_52016_aeral_heat_capacity/#purpose","title":"Purpose","text":"<p>Computes the areal heat capacity allocation per node for each building envelope element according to EN ISO 52016-1 (6.5.7) and Annex B tables (e.g., B.13 classes and B.14 capacities). The routine returns a 5\u00d7N matrix <code>kappa_pli_eli_</code> where: - rows (0..4) correspond to nodes <code>kpl1..kpl5</code> (external \u2192 internal or per the chosen nodal scheme), - columns (0..N-1) correspond to envelope elements, - entries hold the areal heat capacity assigned to each node/element.</p> <p>The node distribution depends on the construction mass class (<code>class_i</code>, <code>class_e</code>, <code>class_ie</code>, <code>class_d</code>, <code>class_m</code>).</p> <p>How it works</p> <ol> <li> <p>Collect element types and capacities </p> <ul> <li>Build <code>el_type</code> from <code>surface[\"ISO52016_type_string\"]</code>.  </li> <li>Build <code>list_kappa_el</code> from <code>surface[\"thermal_capacity\"]</code> (default 0 if missing).</li> </ul> </li> <li> <p>Initialize matrix </p> <pre><code>kappa_pli_eli_ : (5 \u00d7 N) zeros\nrows 0..4 \u2192 nodes kpl1..kpl5\ncols 0..N \u2192 elements\n</code></pre> </li> <li> <p>Distribute areal heat capacity by construction class (ISO 52016 Table B.13)</p> </li> <li> <p><code>class_i</code> \u2014 mass concentrated at internal side**</p> <ul> <li>Opaque/Adjacent (<code>OP</code>, <code>ADJ</code>): <code>kpl5 = km_eli</code> (node 4); others 0.  </li> <li>Ground (<code>GR</code>): <code>kpl5 = 1e6</code> (treated as very large capacity placeholder); <code>kpl3=kpl4=0</code>.</li> </ul> </li> <li> <p><code>class_e</code> \u2014 mass concentrated at external side**</p> <ul> <li>Opaque/Adjacent: <code>kpl1 = km_eli</code> (node 0).  </li> <li>Ground: <code>kpl3 = km_eli</code> (node 2).</li> </ul> </li> <li> <p><code>class_ie</code> \u2014 mass split internal/external**</p> <ul> <li>Opaque/Adjacent: <code>kpl1 = km_eli/2</code> and <code>kpl5 = km_eli/2</code>.  </li> <li>Ground: <code>kpl1 = km_eli/2</code> and <code>kpl5 = km_eli/2</code>.</li> </ul> </li> <li> <p><code>class_d</code> \u2014 mass equally distributed**</p> <ul> <li>Opaque/Adjacent: <code>kpl2 = kpl3 = kpl4 = km_eli/4</code> (nodes 1,2,3) and <code>kpl1 = kpl5 = km_eli/8</code> (nodes 0,4).  </li> <li>Ground: <code>kpl3 = km_eli/4</code> (node 2) and <code>kpl4 = km_eli/2</code> (node 3); <code>kpl5 = km_eli/4</code> (node 4).</li> </ul> </li> <li> <p><code>class_m</code> \u2014 mass concentrated mid-layer**</p> <ul> <li>Opaque/Adjacent: <code>kpl3 = km_eli</code> (node 2).  </li> <li>Ground: <code>kpl4 = km_eli</code> (node 3).</li> </ul> </li> <li> <p>Return value    Wrap <code>kappa_pli_eli_</code> in <code>aeral_heat_capacity(kappa_pli_eli=...)</code>.</p> </li> </ol>"},{"location":"iso_52016_aeral_heat_capacity/#node-indexing","title":"Node Indexing","text":"<p>The implementation uses a 5-node scheme (rows 0..4 \u2192 <code>kpl1..kpl5</code>). The physical mapping (external\u2194internal) should match your solver\u2019s convention. This function follows the same node positions as used elsewhere in your ISO 52016 implementation.</p>"},{"location":"iso_52016_aeral_heat_capacity/#outputs","title":"Outputs","text":"Type Contents <code>aeral_heat_capacity</code> Wrapper carrying <code>kappa_pli_eli</code> (shape 5 \u00d7 N). Each column is an element; rows are nodes <code>kpl1..kpl5</code>."},{"location":"iso_52016_aeral_heat_capacity/#example","title":"Example","text":"<pre><code>cap = Areal_heat_capacity_of_element(building_object=bui)\n\nM = cap.kappa_pli_eli  # shape 5 \u00d7 N\nprint(M.shape)         # e.g., (5, 12) for 12 elements\nprint(M[:, 0])         # node-wise capacities of the first element\n</code></pre>"},{"location":"iso_52016_aeral_heat_capacity/#notes","title":"Notes","text":"<ul> <li>Transparent elements (<code>type: \"transparent\"</code>) are excluded from mass allocation in several classes (as per code).  </li> <li>The ground element (<code>name: \"Slab to ground\"</code>) receives special handling: very large capacity in <code>class_i</code>, and specific node allocations in other classes.  </li> <li>If a surface lacks <code>thermal_capacity</code>, the corresponding entries remain 0. Provide values consistent with ISO 52016 Annex B tables.  </li> <li>Returned units follow your input <code>thermal_capacity</code> convention (often J/(m\u00b2\u00b7K) in standards; the original docstring mentions W/(m\u00b2\u00b7K) \u2014 ensure consistency across the toolchain).</li> </ul>"},{"location":"iso_52016_aeral_heat_capacity/#references","title":"References","text":"<ul> <li>EN ISO 52016-1 \u2014 Energy performance of buildings \u2014 Calculation of energy needs for heating and cooling.  \u00a76.5.7 (nodal method), Annex B (Tables B.13 construction classes, B.14 areal heat capacities).</li> </ul>"},{"location":"iso_52016_aggregate_surface/","title":"ISO 52016 - Aggregate Surfaces","text":""},{"location":"iso_52016_aggregate_surface/#aggregate-surface-same-orientation-","title":"Aggregate surface - same orientation -","text":"<pre><code>def _aggregate_surfaces_by_direction(cls, building_object)\n</code></pre>"},{"location":"iso_52016_aggregate_surface/#inputs","title":"Inputs","text":"Name Type Description <code>building_object</code> <code>dict</code> A dictionary-like building model that must contain a key <code>\"building_surface\"</code>, which is a list of surface definitions. Each surface should include ISO 52016 descriptors and physical properties (e.g., area, U-value, absorptance, etc.)."},{"location":"iso_52016_aggregate_surface/#purpose","title":"Purpose","text":"<p>This function aggregates (merges) multiple building surfaces that share the same orientation and ISO 52016 surface type into a single, equivalent surface. The goal is to simplify the building model so that heat transmission and solar radiation terms can be computed on aggregated surfaces instead of on many small, redundant ones.</p> <p>How It Works:</p> <ol> <li>Grouping (bucketing):    Surfaces are grouped by:</li> <li><code>ISO52016_type_string</code> (e.g., opaque wall, transparent window, etc.)</li> <li><code>ISO52016_orientation_string</code> (e.g., N, S, E, W, HOR)</li> <li><code>type</code> (transparent/opaque)</li> </ol> <p>\u2192 These three attributes form the aggregation key.</p> <ol> <li>Aggregation Rules:</li> <li>Additive fields: <ul> <li><code>area</code> </li> <li><code>thermal_capacity</code></li> </ul> </li> <li>Area-weighted average fields: <ul> <li><code>u_value</code> </li> <li><code>g_value</code> (only for transparent surfaces)  </li> <li><code>sky_view_factor</code> </li> <li><code>solar_absorptance</code> </li> <li><code>convective</code> and <code>radiative</code> heat transfer coefficients (internal and external)</li> </ul> </li> <li> <p>Name field:      The new aggregated surface name concatenates all original names (trimmed to 120 characters).</p> </li> <li> <p>Orientation Handling:    A simplified numeric orientation is reattached to each aggregated surface:</p> </li> <li>Default: <code>{azimuth: 0, tilt: 90}</code> (vertical)</li> <li> <p>If <code>ISO52016_orientation_string == \"HOR\"</code> \u2192 <code>{azimuth: 0, tilt: 0}</code> (horizontal)</p> </li> <li> <p>Output:    The method builds a new list of surfaces where each element represents one equivalent aggregated surface per direction and type.</p> </li> </ol>"},{"location":"iso_52016_aggregate_surface/#outputs","title":"Outputs","text":"Type Description <code>dict</code> A shallow copy of the input <code>building_object</code>, where <code>building_surface</code> has been replaced with a reduced list of aggregated surfaces."},{"location":"iso_52016_aggregate_surface/#example","title":"Example","text":"<p>If the input building object contains three south-facing opaque walls:</p> Surface Name Type ISO52016 Type Orientation Area (m\u00b2) U-Value (W/m\u00b2K) Wall_1 opaque Wall SV 10 0.30 Wall_2 opaque Wall SV 15 0.25 Wall_3 opaque Wall SV 5 0.40 <p>After aggregation, the function returns one equivalent surface:</p> New Name Type Orientation Area (m\u00b2) U-Value (W/m\u00b2K) Wall_1 + Wall_2 + Wall_3 opaque SV 30 0.30 <p>where the U-value is computed as  </p> \\[ U_{agg} = \\frac{\\sum (U_i \\times A_i)}{\\sum A_i} \\] <p>Example Usage <pre><code>building_object = ISO52016()._aggregate_surfaces_by_direction(building_object)\n\nfor surf in building_object[\"building_surface\"]:\n    print(f\"{surf['ISO52016_orientation_string']} | {surf['type']} | Area = {surf['area']:.1f} m\u00b2 | U = {surf['u_value']:.2f}\")\n</code></pre></p> <p>Example output: <pre><code>HOR | opaque | Area = 130.0 m\u00b2 | U = 2.20\nNV | opaque | Area = 30.0 m\u00b2 | U = 1.40\nSV | opaque | Area = 30.0 m\u00b2 | U = 1.40\nEV | opaque | Area = 30.0 m\u00b2 | U = 1.20\nWV | opaque | Area = 30.0 m\u00b2 | U = 1.20\nHOR | opaque | Area = 100.0 m\u00b2 | U = 1.60\nEV | transparent | Area = 4.0 m\u00b2 | U = 5.00\nWV | transparent | Area = 4.0 m\u00b2 | U = 5.00\n</code></pre></p>"},{"location":"iso_52016_aggregate_surface/#notes","title":"Notes","text":"<ul> <li>Aggregates surfaces sharing type + ISO orientation.</li> <li>Uses area-weighted averages for intensive properties.</li> <li>Returns a clean, compact list of equivalent surfaces .</li> </ul>"},{"location":"iso_52016_aggregate_surface/#advantages","title":"Advantages","text":"<ul> <li>Reduces model complexity for ISO 52016 energy balance computations.</li> <li>Speeds up simulation and simplifies reporting.</li> <li>Avoids double-counting of identical surfaces.</li> <li>Ensures consistent area-weighted physical properties.</li> </ul>"},{"location":"iso_52016_aggregate_surface/#limitations","title":"Limitations","text":"<ul> <li>Works only for dictionary-style <code>building_object</code>.  </li> <li>Orientation azimuth/tilt are currently placeholders, not exact averages.</li> <li> <p>Requires each surface to contain both:</p> <ul> <li><code>ISO52016_type_string</code> that is the <code>type</code>in the BUI dict</li> <li><code>ISO52016_orientation_string</code> that is the <code>orientation</code> in the BUI dict example:</li> </ul> <pre><code>        ..{\n            \"name\": \"Roof surface\",\n            \"type\": \"adj\",     # &lt;-----\n            \"area\": 130,\n            \"sky_view_factor\": 1.0,\n            \"u_value\": 2.2,\n            \"solar_absorptance\": 0.4,\n            \"thermal_capacity\": 741500.0,\n            \"orientation\": {   # &lt;-----\n                \"azimuth\": 0,\n                \"tilt\": 0\n            },\n            \"name_adj_zone\": None\n        }\n</code></pre> </li> </ul>"},{"location":"iso_52016_categorty_profile/","title":"ISO 52016 - Category profiles","text":""},{"location":"iso_52016_categorty_profile/#category-profile","title":"Category profile","text":""},{"location":"iso_52016_categorty_profile/#occupancts-lighting-appliance-ventilation-heating-cooling-profile","title":"Occupancts, Lighting, Appliance, Ventilation, Heating, Cooling profile","text":"<pre><code>def generate_category_profile(\n    cls,\n    building_object,\n    occupants_schedule_workdays,\n    occupants_schedule_weekend,\n    appliances_schedule_workdays,\n    appliances_schedule_weekend,\n    lighting_schedule_workdays,\n    lighting_schedule_weekend,\n)\n</code></pre>"},{"location":"iso_52016_categorty_profile/#inputs","title":"Inputs","text":"Parameter Type Description <code>building_object</code> <code>dict</code> Building model containing <code>building_type_class</code> and optional internal gain profiles. <code>occupants_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly occupancy profiles (24 values each). <code>appliances_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly appliance profiles. <code>lighting_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly lighting profiles."},{"location":"iso_52016_categorty_profile/#purpose","title":"Purpose","text":"<p>In building energy simulations \u2014 especially those following ISO 52016-1:2017 (Energy needs for heating and cooling, internal temperatures, and loads) or the broader EPB (Energy Performance of Buildings) framework \u2014 each thermal zone requires hourly profiles for occupancy, lighting, appliances, ventilation, heating, and cooling.  </p> <p>These profiles describe the temporal behavior of internal gains and system operation (e.g., when people are present, when lights are on, or when HVAC is active). This function automates the generation of such profiles by merging custom schedules (if defined within a building object) with default type-based schedules, ensuring every category has a valid 24-hour pattern.</p> <p>The default type-based schedules are define in the file: <code>table_iso_16798_1.py</code>, where typical profile are getting from the EN ISO 16798-1 standard.</p> <p><code>generate_category_profile()</code> builds a consistent set of hourly category profiles (weekday/weekend) for: - Occupancy - Appliances - Lighting - Ventilation - Heating - Cooling  </p> <p>It ensures that all schedules are properly defined, validated, and ready for use in energy balance, comfort, or control simulations.</p> <p>How it works?</p> <ol> <li> <p>Identify building type    Extracts the <code>building_type_class</code> from the input object to determine which default schedules to use.</p> </li> <li> <p>Load or fallback for each category </p> </li> <li>For occupants, appliances, and lighting:      If custom 24-hour profiles exist in <code>building_object[\"building_parameters\"][\"internal_gains\"]</code>, they are used directly.      Otherwise, defaults are taken from the provided schedule dictionaries.</li> <li> <p>For ventilation, heating, and cooling:      If no profiles are defined in the building object, they inherit the occupancy schedule as a fallback.</p> </li> <li> <p>Validation    Ensures that every schedule contains exactly 24 hourly values (one per hour of the day).</p> </li> <li> <p>Output assembly    Returns all category profiles in a structured dictionary format.</p> </li> </ol>"},{"location":"iso_52016_categorty_profile/#outputs","title":"Outputs","text":"<p><code>dict</code> \u2014 A complete set of hourly category profiles for use in thermal simulations, HVAC control logic, or internal gain estimation.</p> <pre><code>{\n    \"ventilation\": {\"weekday\": array(24), \"holiday\": array(24)},\n    \"heating\":     {\"weekday\": array(24), \"holiday\": array(24)},\n    \"cooling\":     {\"weekday\": array(24), \"holiday\": array(24)},\n    \"occupancy\":   {\"weekday\": array(24), \"holiday\": array(24)},\n    \"lighting\":    {\"weekday\": array(24), \"holiday\": array(24)},\n    \"appliances\":  {\"weekday\": array(24), \"holiday\": array(24)},\n}\n</code></pre> <p>Each category contains 24 hourly fractions for weekdays and weekends (holidays), typically in the range 0\u20131 or as relative intensity values.</p>"},{"location":"iso_52016_categorty_profile/#example","title":"Example","text":"<pre><code>profiles = generate_category_profile(\n    building_object=my_building,\n    occupants_schedule_workdays=OCCUPANTS_WD,\n    occupants_schedule_weekend=OCCUPANTS_WE,\n    appliances_schedule_workdays=APPLIANCES_WD,\n    appliances_schedule_weekend=APPLIANCES_WE,\n    lighting_schedule_workdays=LIGHTING_WD,\n    lighting_schedule_weekend=LIGHTING_WE,\n)\n\n# Example: access weekday lighting profile\nlighting_profile = profiles[\"lighting\"][\"weekday\"]\n</code></pre>"},{"location":"iso_52016_categorty_profile/#notes","title":"Notes","text":"<ul> <li>All profiles must contain exactly 24 numeric values.  </li> <li>Missing ventilation, heating, or cooling profiles automatically default to the occupancy profile.  </li> <li>Works as a preprocessing step to ensure that all internal gain and system schedules are complete and consistent before running the energy balance.</li> <li>This function is typically used in the preprocessing pipeline before running a dynamic energy simulation:</li> </ul> <p>The <code>**generate_category_profile()**</code> is based on the following functions:</p> <ul> <li><code>get_country_code_from_latlon</code></li> <li><code>HourlyProfileGenerator</code></li> </ul>"},{"location":"iso_52016_categorty_profile/#country-code-for-calendar-data","title":"Country code for calendar data","text":"<pre><code>def get_country_code_from_latlon(lat: float, lon: float, default: str = \"IT\") -&gt; str\n</code></pre>"},{"location":"iso_52016_categorty_profile/#parameters","title":"Parameters","text":"<ul> <li><code>lat</code>, <code>lon</code> (float): Geographic coordinates.</li> <li><code>default</code> (str): Fallback code returned on errors or when the API does not return a country code. Default is <code>\"IT\"</code>.</li> </ul>"},{"location":"iso_52016_categorty_profile/#purpose_1","title":"Purpose","text":"<p>Resolve a latitude/longitude to an ISO 3166-1 alpha-2 country code, using a reverse\u2011geocoding API (example: OpenCage).</p> <p>How it works: 1. Builds a request to the OpenCage API endpoint:    - <code>https://api.opencagedata.com/geocode/v1/json</code> 2. Sends the request with your API key (<code>YOUR_OPENCAGE_API_KEY</code> placeholder). 3. On success: extracts <code>ISO_3166-1_alpha2</code> from the first result\u2019s <code>components</code>. 4. On any failure (HTTP \u2260 200, empty results, missing code): returns <code>default</code>.</p>"},{"location":"iso_52016_categorty_profile/#notes-best-practices","title":"Notes &amp; Best Practices","text":"<ul> <li>API Key: Replace <code>\"YOUR_OPENCAGE_API_KEY\"</code> with a valid key (environment variable recommended).</li> <li>Rate Limits: Respect your provider\u2019s quota; implement caching if calling repeatedly.</li> <li>Fallback: Consider logging when the function falls back to <code>default</code> so you can inspect geocoding issues later.</li> <li>Alternative providers: You can switch to other reverse\u2011geocoding services (Nominatim, Google, etc.) by adjusting the request/response handling.</li> </ul>"},{"location":"iso_52016_categorty_profile/#generate-hourly-profiles","title":"Generate hourly profiles","text":"<pre><code>class HourlyProfileGenerator(\n    country: str = \"IT\",\n    num_months: int = 13,\n    start_year: int | None = None,\n    working_day_profile: np.ndarray | None = None,\n    holiday_profile: np.ndarray | None = None,\n    category_profiles: dict | None = None\n)\n</code></pre>"},{"location":"iso_52016_categorty_profile/#inputs_1","title":"Inputs","text":"<ul> <li><code>country</code>: ISO 2-letter country code used by <code>holidays</code> to determine national holidays.</li> <li><code>num_months</code>: How many months to generate (default: <code>13</code>).</li> <li><code>start_year</code>: Starting year for the window. If <code>None</code>, uses the previous calendar year for the December start.</li> <li><code>working_day_profile</code>, <code>holiday_profile</code>: Optional 24\u2011hour arrays to replace the built\u2011in defaults for all categories when <code>category_profiles</code> is omitted.</li> <li><code>category_profiles</code>: A dict providing per\u2011category profiles. Each value can be:</li> <li>a single 24\u2011array \u2192 applied to both weekday and holiday/weekend; or</li> <li>a pair <code>(weekday_24, holiday_24)</code>; or</li> <li>a dict <code>{ 'weekday': weekday_24, 'holiday': holiday_24 }</code>.</li> </ul> <p>Categories: <code>(\"ventilation\", \"heating\", \"cooling\", \"occupancy\", \"lighting\", \"appliances\")</code></p>"},{"location":"iso_52016_categorty_profile/#purpose_2","title":"Purpose","text":"<p>Generate a continuous hourly DataFrame (default: 13 months) with calendar flags (working day / weekend / holiday) and per\u2011category normalized profiles (0..1) for: <code>ventilation</code>, <code>heating</code>, <code>cooling</code>, <code>occupancy</code>, <code>lighting</code>, <code>appliances</code>.</p> <p>Key Concepts - Time span: starts at <code>December 1st</code> of <code>start_year</code> (or previous year if <code>None</code>) and covers <code>num_months</code> months (default 13). - Calendar logic: weekend = Saturday or Sunday; holiday set via the <code>holidays</code> library using <code>country</code>. - Profiles (0..1): Per-category 24\u2011value arrays are mapped to each hour of the day, switching between weekday and holiday/weekend versions. - Retro\u2011compatibility: If <code>category_profiles</code> is not provided, two default 24\u2011hour arrays (one for working days, one for holidays) are used for all categories. You can also pass legacy <code>working_day_profile</code>/<code>holiday_profile</code> to override those defaults.</p>"},{"location":"iso_52016_categorty_profile/#outputs_1","title":"Outputs","text":"<p><code>generate()</code> returns a <code>pandas.DataFrame</code> with columns:</p> <ul> <li><code>datetime</code>: hourly timestamps (timezone\u2011naive).</li> <li><code>date</code>, <code>hour</code>, <code>day_of_week</code>, <code>day_name</code>: common time breakdowns.</li> <li><code>is_holiday</code>, <code>is_weekend</code>, <code>is_working_day</code>, <code>holiday_name</code>.</li> <li>One column per category: <code>\"{category}_profile\"</code> (values in 0..1).</li> <li><code>profile_value</code>: retro\u2011compatibility alias (uses <code>occupancy_profile</code>).</li> <li><code>day_type</code>: <code>\"Working Day\"</code> or <code>\"Holiday/Weekend\"</code>.</li> </ul>"},{"location":"iso_52016_categorty_profile/#examples","title":"Examples","text":""},{"location":"iso_52016_categorty_profile/#a-minimal-generation","title":"A) Minimal generation","text":"<pre><code>from profiles import HourlyProfileGenerator\n\ngen = HourlyProfileGenerator(country=\"IT\")\ndf = gen.generate()\ngen.get_summary()\n\n# Inspect first rows\nprint(df.head())\n</code></pre>"},{"location":"iso_52016_categorty_profile/#b-custom-percategory-profiles","title":"B) Custom per\u2011category profiles","text":"<pre><code>import numpy as np\n\nv_wd = np.array([0]*6 + [1]*10 + [0.5]*8, dtype=float)      # ventilation - weekday\nv_hd = np.array([0]*8 + [0.5]*8 + [0]*8, dtype=float)       # ventilation - holiday/weekend\nocc_24 = np.array([1,1,1,1,1,1,0.5,0.5,0.5,0.1,0.1,0.1,0.2,0.2,0.2,0.2,0.5,0.5,0.5,0.8,0.8,0.8,1,1], dtype=float)\n\ncategory_profiles = {\n    \"ventilation\": {\"weekday\": v_wd, \"holiday\": v_hd},\n    \"occupancy\": occ_24,  # same WD/HD\n    # other categories will use defaults\n}\n\ngen = HourlyProfileGenerator(country=\"DE\", category_profiles=category_profiles)\ndf = gen.generate()\n</code></pre>"},{"location":"iso_52016_categorty_profile/#c-plot-daily-averages-with-weekendholiday-shading","title":"C) Plot daily averages with weekend/holiday shading","text":"<pre><code>fig = gen.plot_annual_profiles(\n    categories=[\"ventilation\", \"occupancy\", \"lighting\"],\n    freq=\"D\",\n    include_weekend_shading=True,\n    title=\"Annual Profiles \u2014 Daily Averages\"\n)\nfig.show()\n</code></pre>"},{"location":"iso_52016_categorty_profile/#d-resolve-a-country-code-from-coordinates","title":"D) Resolve a country code from coordinates","text":"<pre><code>from profiles import get_country_code_from_latlon\ncode = get_country_code_from_latlon(46.49, 11.33, default=\"IT\")\nprint(code)  # e.g., \"IT\" or fallback\n</code></pre>"},{"location":"iso_52016_categorty_profile/#error-handling-edge-cases-and-validation","title":"Error Handling, Edge Cases and Validation","text":"<ul> <li>Invalid profile shapes: raises <code>ValueError</code> for any 24\u2011hour array not equal to <code>(24,)</code>.</li> <li>Geocoding failures: returns the <code>default</code> country code; consider logging or retry strategies.</li> <li>Missing <code>generate()</code>: <code>get_summary()</code> / <code>plot_annual_profiles()</code> will raise if called before <code>generate()</code>.</li> <li>Holiday calendars: ensure <code>country</code> is supported by <code>holidays</code>; for custom calendars, precompute a boolean series and merge it into the DataFrame.</li> <li>Every 24\u2011array is validated to exactly 24 elements; otherwise a <code>ValueError</code> is raised.</li> </ul>"},{"location":"iso_52016_co2_equivalent/","title":"Calculation of CO\u2082 Equivalent (CO\u2082e) Emissions from an Energy Simulation","text":"<p>This document explains how to calculate CO\u2082-equivalent emissions (CO\u2082e) from the results of an energy simulation. The method aligns with ISO 52000, EN 15603, and GHG Protocol frameworks.</p>"},{"location":"iso_52016_co2_equivalent/#required-data-from-the-simulation","title":"\ud83d\udcca Required Data from the Simulation","text":"<p>For each energy carrier (electricity, natural gas, biomass, district heating, etc.), you need: - Final energy consumption (kWh, usually based on LHV) - (Optional) Exported energy (e.g., PV or CHP generation) - (Optional) Auxiliary information such as generator efficiencies or CHP heat/power split</p>"},{"location":"iso_52016_co2_equivalent/#calculation-settings","title":"\u2699\ufe0f Calculation Settings","text":""},{"location":"iso_52016_co2_equivalent/#emission-scopes","title":"Emission Scopes","text":"<ul> <li>Scope 1: Direct on-site fuel combustion (boilers, CHP, etc.)</li> <li>Scope 2: Purchased electricity, steam, heat, or cooling</li> <li>Scope 3 (optional): Upstream emissions (extraction, transport, T&amp;D losses)</li> </ul>"},{"location":"iso_52016_co2_equivalent/#electricity-method","title":"Electricity Method","text":"<ul> <li>Location-based: Average grid emission factor (annual or time-resolved)</li> <li>Market-based: Supplier-specific emission factor (residual mix)</li> </ul>"},{"location":"iso_52016_co2_equivalent/#general-formula","title":"\ud83e\uddee General Formula","text":"<p>For each energy carrier \\(i\\) and time step \\(t\\):</p> \\[ \\mathrm{CO_2e}_{i,t} = E_i(t) \\times \\mathrm{EF}_{i}^{comb}(t) + E_i(t) \\times \\mathrm{EF}_{i}^{upstream}(t) \\] <p>where: - \\(E_i(t)\\): energy consumption (kWh) - \\(\\mathrm{EF}_{i}^{comb}\\): direct combustion emission factor (kgCO\u2082e/kWh) - \\(\\mathrm{EF}_{i}^{upstream}\\): upstream emission factor (kgCO\u2082e/kWh)</p> <p>If emissions are split by gas species (CO\u2082, CH\u2084, N\u2082O):</p> \\[ \\mathrm{CO_2e} = \\mathrm{CO_2} + \\mathrm{CH_4} \\times \\mathrm{GWP}_{100,CH_4} + \\mathrm{N_2O} \\times \\mathrm{GWP}_{100,N_2O} \\]"},{"location":"iso_52016_co2_equivalent/#typical-emission-factors","title":"\ud83c\udf0d Typical Emission Factors","text":"Energy carrier Emission factor (kgCO\u2082e/kWh) Example source Electricity (EU grid) 0.25 ENTSO-E 2023 Natural gas (combustion) 0.202 IPCC 2006 Natural gas (upstream) 0.025 DEFRA 2023 Biomass (solid) 0 (biogenic) IPCC 2006 <p>\u26a0\ufe0f Always use emission factors consistent in region and year.</p>"},{"location":"iso_52016_co2_equivalent/#handling-on-site-generation","title":"\ud83d\udd0b Handling On-Site Generation","text":"<ul> <li>Self-consumed PV: reduces imported grid electricity.  </li> <li>Exported PV: should not be subtracted from consumption unless the reporting framework allows it.  </li> <li>CHP systems: allocate fuel emissions between heat and power using an efficiency- or substitution-based method.</li> </ul>"},{"location":"iso_52016_co2_equivalent/#example-calculation","title":"\ud83d\udcd8 Example Calculation","text":"Energy type Consumption (kWh) EF (kgCO\u2082e/kWh) Emissions (kgCO\u2082e) Electricity (grid) 10,000 0.25 2,500 Natural gas (comb.) 5,000 0.202 1,010 Natural gas (upstream) 5,000 0.025 125 Total \u2014 \u2014 3,635"},{"location":"iso_52016_co2_equivalent/#example-python-script","title":"\ud83d\udc0d Example Python Script","text":"<pre><code>import pandas as pd\n\n# Input data (final energy in kWh)\nenergy = pd.Series({\n    'electricity_grid': 10000,\n    'natural_gas': 5000,\n})\n\n# Emission factors (kgCO2e/kWh)\nEF = {\n    'electricity_grid': 0.25,   # Scope 2\n    'gas_combustion': 0.202,    # Scope 1\n    'gas_upstream': 0.025,      # Scope 3\n}\n\nco2e = {\n    'Scope2_electricity': energy['electricity_grid'] * EF['electricity_grid'],\n    'Scope1_gas': energy['natural_gas'] * EF['gas_combustion'],\n    'Scope3_gas_upstream': energy['natural_gas'] * EF['gas_upstream'],\n}\n\nco2e['Total'] = sum(co2e.values())\nprint(pd.Series(co2e).round(1))\n</code></pre>"},{"location":"iso_52016_input/","title":"ISO 52016 - Input","text":""},{"location":"iso_52016_input/#building-input-bui-structure","title":"Building Input (BUI) Structure","text":"<p>This document explains the BUI (Building Input) dictionary used for ISO\u202f52016 simulations. It defines the building geometry, surfaces, (general)systems, and operational parameters required to calculate hourly temperatures and energy needs.</p>"},{"location":"iso_52016_input/#structure-overview","title":"Structure Overview","text":"<pre><code>BUI = {\n    \"building\": {...},\n    \"adjacent_zones\": [...],\n    \"building_surface\": [...],\n    \"units\": {...},\n    \"building_parameters\": {...}\n}\n</code></pre> <p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre>"},{"location":"iso_52016_input/#main-building-metadata-building","title":"Main Building Metadata: <code>\"building\"</code>","text":"Key Type Description <code>name</code> str Building name or identifier. <code>azimuth_relative_to_true_north</code> float (\u00b0) Orientation of the building relative to north.  (0=N, 90=E, 180=S, 270=W) <code>latitude</code>, <code>longitude</code> float Coordinates (used for weather and solar position). <code>exposed_perimeter</code> float (m) External perimeter. <code>height</code> float (m) Building height (floor to roof). <code>wall_thickness</code> float (m) Average wall layer total thickness <code>n_floors</code> int Number of floors. <code>building_type_class</code> str Type of building (e.g., Residential_apartment, Office). <code>adj_zones_present</code> bool Whether unconditioned/adjacent zones exist. <code>number_adj_zone</code> int Number of adjacent zones. <code>net_floor_area</code> float (m\u00b2) Conditioned floor area. <code>construction_class</code> str Construction quality (e.g., class_i)."},{"location":"iso_52016_input/#adjoiningunconditioned-spaces-adjacent_zones","title":"Adjoining/Unconditioned Spaces: <code>\"adjacent_zones\"</code>","text":"<p>Defines zones adjacent to the conditioned area, used for ISO\u202f13789 transmission heat transfer.</p> <p>Each zone has:</p> Key Description <code>name</code> Zone name. <code>orientation_zone.azimuth</code> local azimuth of each adjacent unconditioned zone (\u00b0). <code>area_facade_elements</code> Areas of fa\u00e7ade elements (array, m\u00b2). <code>typology_elements</code> Element types: <code>OP</code> (opaque), <code>GR</code> (ground), etc. <code>transmittance_U_elements</code> U-values of each element (W/m\u00b2K). <code>orientation_elements</code> orientation code by element: <code>NV</code> North-vertical (\u22480\u00b0), <code>SV</code> South-vertical (\u2248180\u00b0),<code>EV</code> East-vertical (\u224890\u00b0),  <code>WV</code> West-vertical (\u2248270\u00b0),<code>HOR</code> horizontal (roof/slab). <code>volume</code> Zone air volume (m\u00b3). <code>building_type_class</code> Type of building zone (same taxonomy). <code>a_use</code> useful area of the adjacent zone ."},{"location":"iso_52016_input/#envelope-elements-building_surface","title":"Envelope Elements: <code>\"building_surface\"</code>","text":"<p>Describes all external and internal surfaces forming the building envelope.</p>"},{"location":"iso_52016_input/#common-attributes","title":"Common attributes","text":"Key Description <code>name</code> Surface name. <code>type</code> <code>\"opaque\"</code>, <code>\"transparent\"</code>, <code>\"adiabatic\"</code>, <code>\"adjacent\"</code>. <code>area</code> Surface area (m\u00b2). <code>sky_view_factor</code> Fraction of visible sky (0\u20131). <code>u_value</code> Thermal transmittance (W/m\u00b2K). <code>solar_absorptance</code> Fraction of solar radiation absorbed (0\u20131). <code>thermal_capacity</code> Surface thermal capacity (J/K). <code>orientation.azimuth</code> Azimuth (0\u202f=\u202fN, 90\u202f=\u202fE, 180\u202f=\u202fS, 270\u202f=\u202fW). <code>orientation.tilt</code> Tilt angle (0\u202f=\u202fhorizontal, 90\u202f=\u202fvertical). <code>name_adj_zone</code> Linked adjacent zone (if applicable)."},{"location":"iso_52016_input/#transparent-surfaces","title":"Transparent surfaces","text":"<p>Include window-specific attributes: | Key | Description | |------|-------------| | <code>g_value</code> | Solar transmittance of glazing. | | <code>height</code>, <code>width</code> | Window dimensions (m). | | <code>parapet</code> | Window sill height above floor (m). | | <code>shading</code>, <code>shading_type</code> | Boolean and type of shading (e.g., horizontal_overhang). | | <code>width_or_distance_of_shading_elements</code> | Distance or overhang width. | | <code>overhang_proprieties</code> | Additional geometric data for shading devices. |</p>"},{"location":"iso_52016_input/#unit-definitions-units","title":"Unit Definitions: <code>\"units\"</code>","text":"<p>Defines unit conventions for each physical quantity.</p> Key Example Meaning <code>area</code> <code>\"m\u00b2\"</code> Surface area unit. <code>u_value</code> <code>\"W/m\u00b2K\"</code> Heat transmittance. <code>thermal_capacity</code> <code>\"J/kgK\"</code> Heat storage capacity. <code>azimuth</code>, <code>tilt</code> <code>\"degrees\"</code> Orientation conventions. <code>internal_gain</code> <code>\"W/m\u00b2\"</code> Internal gain density. <code>internal_gain_profile</code> <code>\"Normalized 0\u20131\"</code> Profile normalization rule. <code>HVAC_profile</code> <code>\"0: off, 1: on\"</code> HVAC operating schedule encoding."},{"location":"iso_52016_input/#thermal-system-and-operational-settings-building_parameters","title":"Thermal, System, and Operational Settings: <code>\"building_parameters\"</code>","text":""},{"location":"iso_52016_input/#temperature-setpoints","title":"Temperature Setpoints","text":"Key Description <code>heating_setpoint</code>, <code>heating_setback</code> Comfort and setback temperatures (\u00b0C). <code>cooling_setpoint</code>, <code>cooling_setback</code> Cooling comfort and setback (\u00b0C). <code>units</code> <code>\"\u00b0C\"</code>."},{"location":"iso_52016_input/#system-capacities","title":"System Capacities","text":"Key Description <code>heating_capacity</code>, <code>cooling_capacity</code> Maximum system capacities (W). <code>units</code> <code>\"W\"</code>."},{"location":"iso_52016_input/#airflow-rates","title":"Airflow Rates","text":"Key Description <code>infiltration_rate</code> Airflow in air changes per hour (ACH). <code>units</code> <code>\"ACH\"</code>."},{"location":"iso_52016_input/#internal-gains","title":"Internal Gains","text":"<p>Each internal source (occupants, appliances, lighting) defines: | Key | Description | |------|-------------| | <code>name</code> | Gain type. | | <code>full_load</code> | Peak power density (W/m\u00b2). | | <code>weekday</code>, <code>weekend</code> | 24-hour normalized (0\u20131) schedules. |</p>"},{"location":"iso_52016_input/#construction","title":"Construction","text":"Key Description <code>wall_thickness</code> Wall thickness (m). <code>thermal_bridges</code> Linear thermal bridge coefficient (W/m\u00b7K)."},{"location":"iso_52016_input/#climate-parameters","title":"Climate Parameters","text":"Key Description <code>coldest_month</code> Index of coldest month (1\u202f=\u202fJan,\u202f12\u202f=\u202fDec)."},{"location":"iso_52016_input/#hvac-and-ventilation-profiles","title":"HVAC and Ventilation Profiles","text":"<p>Hourly normalized profiles for system operation:</p> Profile Description <code>heating_profile</code> 24\u2011hour on/off (0\u20131) heating activity. <code>cooling_profile</code> 24\u2011hour on/off cooling activity. <code>ventilation_profile</code> 24\u2011hour on/off ventilation schedule."},{"location":"iso_52016_input/#example-workflow","title":"Example Workflow","text":"<pre><code>from iso52016 import ISO52016\n\n# Validate input\nbui_checked, issues = ISO52016.sanitize_and_validate_BUI(BUI, fix=True)\n\n# Run hourly energy needs\nhourly, annual = ISO52016.Temperature_and_Energy_needs_calculation(\n    bui_checked, weather_source=\"pvgis\"\n)\n\nprint(annual)\n</code></pre>"},{"location":"iso_52016_input/#good-practices","title":"Good Practices","text":"<ul> <li>Always verify units and orientation angles before running simulations.  </li> <li>Ensure surface U-values and areas are consistent with geometry.  </li> <li>Normalize all profiles (0\u20131).  </li> <li>When <code>adj_zones_present</code> is <code>True</code>, populate valid adjacent zone data.  </li> <li>Latitude/longitude and azimuth are essential for solar radiation accuracy.</li> </ul>"},{"location":"iso_52016_input/#outputs-of-iso-52016","title":"Outputs of ISO\u202f52016","text":"<p>After running the calculation, typical outputs include: - Hourly heating/cooling needs (<code>Q_HC</code>, W) - Operative temperature (<code>T_op</code>, \u00b0C) - External temperature (<code>T_ext</code>, \u00b0C) - Annual heating/cooling energy (Wh/m\u00b2)</p>"},{"location":"iso_52016_input/#static-data-constants-global_inputspy","title":"Static data &amp; constants: <code>global_inputs.py</code>","text":""},{"location":"iso_52016_input/#purpose","title":"Purpose","text":"<ul> <li>Provide reference tables (e.g., ISO 13789 <code>n_ue</code> air-tightness classes) and thermophysical constants.</li> <li>Contain an emitter table <code>TB14</code> (\u0394T exponents).</li> </ul>"},{"location":"iso_52016_input/#key-objects","title":"Key Objects","text":"<ul> <li><code>periods</code>, <code>bui_types</code>, <code>months</code>: taxonomies.</li> <li><code>WATER_DENSITY = 1000</code> <code>[kg\u00b7m\u207b\u00b3]</code></li> <li><code>WATER_SPECIFIC_HEAT_CAPACITY = 0.00116</code> <code>[kWh\u00b7kg\u207b\u00b9\u00b7K\u207b\u00b9]</code> (\u2192 multiply by <code>kg</code> and <code>\u0394T</code> to get kWh)</li> <li><code>df_n_ue</code> \u2014 ISO 13789:2018 (Table 7) conventional air change rate between unconditioned space and exterior:</li> </ul> code description (air-tightness) <code>n_ue</code> [h\u207b\u00b9] 1 No doors/windows openings 0.1 2 All joints well sealed, no openings 0.5 3 Well sealed, small openings 1.0 4 Some localized open joints 3.0 5 Numerous open joints / large openings 10.0 <ul> <li><code>TB14</code> \u2014 emitter exponents and nominal \u0394T:<ul> <li>Radiator: <code>n=1.3</code>, <code>\u0394\u03b8_air=50\u00b0C</code>, <code>\u0394\u03b8_water=20\u00b0C</code></li> <li>Floor heating: <code>n=1.1</code>, <code>\u0394\u03b8_air=15\u00b0C</code>, <code>\u0394\u03b8_water=5\u00b0C</code></li> <li>Fan coil: <code>n=1.0</code>, <code>\u0394\u03b8_air=25\u00b0C</code>, <code>\u0394\u03b8_water=10\u00b0C</code></li> </ul> </li> </ul>"},{"location":"iso_52016_input/#usage-physics","title":"Usage &amp; Physics","text":"<ul> <li><code>n_ue</code> maps directly into adjacent unconditioned zone ventilation (see \u00a74.3), i.e. <code>que = V_u \u00b7 n_ue</code> <code>[m\u00b3\u00b7h\u207b\u00b9]</code>.</li> <li>Water constants are useful for DHW/emitters energy conversions (not used inside <code>ventilation.py</code> yet).</li> </ul>"},{"location":"iso_52016_input/#implementation-notes-robustness","title":"Implementation Notes &amp; Robustness","text":"<ul> <li>Type safety: many arrays in <code>BUI</code> are <code>dtype=object</code>. Cast to <code>np.asarray(..., dtype=float)</code> before algebra.</li> <li>Orientation logic: To identify interface elements for \\(H_{d,zt{\\text -}ztu}\\), define a clear mapping between <code>building_surface[*].name_adj_zone</code> and the <code>adjacent_zones[*].name</code> and use that to split \\(\\mathcal{E}_{zt{\\text -}ztu}\\) vs \\(\\mathcal{E}_{ztu{\\text -}ext}\\). Avoid relying only on cardinal labels like <code>NV/SV/...</code> when adjacency is explicit in the <code>BUI</code>.</li> <li>Units consistency: Eq. (4.12b) uses the common shortcut <code>0.33</code> <code>[Wh\u00b7m\u207b\u00b3\u00b7K\u207b\u00b9]</code> for flows in m\u00b3\u00b7h\u207b\u00b9. If you operate on SI <code>[s]</code>, convert accordingly \\( \\frac{\\rho c}{3600} \\).</li> <li>Altitude: The simple density correction used in Eq. (4.2) is adequate for building simulation. For high-altitude sites you may want a full barometric formula.</li> </ul>"},{"location":"iso_52016_input_check/","title":"Quality check","text":"ISO 52016 Input Check <p>The data provided before being used for the simulation are processed and evaluated to be considered fit for the simulation. This process includes a series of checks that allow to identify any potential errors.  The following controls are applied:</p>"},{"location":"iso_52016_input_check/#direction-from-orientation","title":"Direction from orientation","text":"<p>Function Name: <code>_dir_from_orientation(azimut:float, tilt:float) -&gt; str</code></p> <p>Purpose:  This function mapd the orientation of the surface (azimuth and tilt) and returns the direction of the surface.</p> <p>Return One of: <code>HOR</code> (horizontal), <code>NV</code>,<code>EV</code>, <code>SV</code>, <code>WV</code>(vertical faces; North, East, South, West) </p> <p>Validations &amp; rules - Tilt checks     - If <code>tilt == 0</code> (|\u0394| \u2264 1e-9): return <code>\"HOR\"</code>.     - If <code>tilt != 90</code> (|\u0394| &gt; 1e-6): uses a fallback threshold:         - <code>tilt &lt; 45 \u2192 \"HOR\"</code>         - <code>tilt \u2265 45 \u2192 \"NV\"</code> (treat as a generic vertical).</p> <ul> <li>Azimuth checks (only when considered vertical):<ul> <li>Normalize <code>azimuth % 360</code>.</li> <li>Exact snaps (|\u0394| \u2264 1e-6):<ul> <li><code>0</code> or <code>360</code> \u2192 <code>\"NV\"</code>, <code>90</code> \u2192 <code>\"EV\"</code>, <code>180</code> \u2192 <code>\"SV\"</code>, <code>270</code> \u2192 <code>\"WV\"</code>.</li> </ul> </li> <li>Otherwise: snap to the nearest of <code>[0,90,180,270]</code>.</li> </ul> </li> </ul> <p>Notes</p> <p>This function does not emit messages; it enforces interpretation by thresholds/snaps.</p>"},{"location":"iso_52016_input_check/#opaque-facade-areas-in-adjacent-zone","title":"Opaque facade areas in adjacent zone","text":"<p>Function Name: <code>_adj_op_area_in_dir(adj_zone: dict, dir_code: str) -&gt; float</code></p> <p>Purpose:  Compute the sum of opaque (\u201cOP\u201d) facade areas in <code>adj_zone</code> for the given direction code <code>(\"NV\"|\"EV\"|\"SV\"|\"WV\")</code>.</p> <p>Validations &amp; rules</p> <ul> <li> <p>Upper-cases and matches:</p> <ul> <li><code>typology_elements == \"OP\"</code> and </li> <li><code>orientation_elements == dir_code</code></li> </ul> </li> <li> <p>If no match: returns <code>0.0</code>.</p> </li> </ul> <p>Notes</p> <p>No messages; pure filtering/aggregation with safe default <code>0.0</code>.</p>"},{"location":"iso_52016_input_check/#check-heating-system-inputs","title":"Check heating system inputs","text":"<p>Function Name: <code>check_heating_system_inputs(system_input: dict) -&gt; dict</code></p> <p>Purpose:  Load and validate heating system configuration, selecting the correct TB14 table and ensuring compatible fields for generator control logic Example of TB14:</p> <pre><code>TB14 = pd.DataFrame({\n    \"Emitters_nominale_deltaTeta_air_C\": [50, 15, 25],\n    \"Emitters_exponent_n\": [1.3, 1.1, 1.0],\n    \"Emitters_nominal_deltaTeta_Water_C\": [20, 5, 10],\n}, index=[\"Radiator\", \"Floor heating\", \"Fan coil\"])\n</code></pre> <p>Returns</p> <pre><code>{\n  \"TB14_used\": pd.DataFrame,   # custom or default TB14\n  \"emitter_type\": str,         # validated (possibly auto-adjusted)\n  \"messages\": list[str],       # human-readable validations/fixes\n  \"config\": dict               # normalized config (may include auto-fixes)\n}\n</code></pre> <p>Validations &amp; auto-fix logic</p> <p>1) TB14 selection</p> <ul> <li>If <code>system_input[\"TB14\"]</code> is a<code>pd.DataFrame</code> \u2192 use it.<ul> <li>Message: <code>Custom TB14 table loaded from input</code>.</li> </ul> </li> <li>Else \u2192 fallback to <code>TB14_backup</code>.<ul> <li>Message: <code>Default TB14 table loaded from global_inputs.py</code>.</li> </ul> </li> </ul> <p>2) <code>emitter_type</code> presence in TB14 index</p> <ul> <li>If missing from <code>TB14.index</code> \u2192 auto-set to the first available index (or <code>None</code> if empty).<ul> <li>Message: <code>Emitter type '...' not found ... auto-set to '...'.</code></li> </ul> </li> <li>Else \u2192 keep as is.<ul> <li>Message: <code>Emitter type '...' found in TB14.</code></li> </ul> </li> </ul> <p>3) <code>gen_flow_temp_control_type</code> validation    - Allowed: <code>\"Type A\" | \"Type B\" | \"Type C\".</code>    - Type A requires <code>gen_outdoor_temp_data</code> as <code>pd.DataFrame</code>:       - If not a DataFrame \u2192 auto-switch to \"Type B\".          - Message: <code>For 'Type A' ... must be provided ... \u2192 switched to 'Type B'.</code>       - Else \u2192 <code>'gen_outdoor_temp_data' provided ...</code>.    - Type C requires numeric <code>\u03b8HW_gen_flw_const</code>:       - If missing/None \u2192 auto-set to <code>50.0</code>.       - Message: <code>\u26a0\ufe0f '\u03b8HW_gen_flw_const' not provided ...; setting it to 50.</code>    - Any other value \u2192 auto-set to \"Type B\".       - Message: <code>\u26a0\ufe0f Invalid value ... Setting to 'Type B'.</code></p> <p>Side effects Returns a normalized copy of the input config in \"config\"; original dict is not mutated by the function.</p>"},{"location":"iso_52016_input_check/#validation-and-optional-sanitation-of-a-bui-structure","title":"Validation and optional sanitation of a BUI structure","text":"<p>Function Name: <code>sanitize_and_validate_BUI(bui: dict, fix: bool = True, eps: float = 1e-6, defaults: dict | None = None) -&gt; tuple[dict, list[dict]]</code></p> <p>Purpose:  Deep validation and optional sanitation of a BUI structure (building, surfaces, adjacent zones, and their pairing). It can also re-balance areas and split surfaces to maintain geometric/physical consistency. There are 4 main controls: - Building-level checks - Surface-level checks - Adjacent zone checks - Adjacency pairing, window caps &amp; residual splitting</p> <p>Returns</p> <ul> <li><code>bui_clean</code>: deep-copied and possibly corrected BUI.</li> <li><code>issues</code>: list of structured messages:</li> </ul> <pre><code>{\"level\": \"ERROR|WARN|INFO\",\n \"path\": \"dot.notation or index path\",\n \"msg\": \"human-readable message\",\n \"fix_applied\": bool}\n</code></pre> <p>Defaults used when <code>defaults</code> is None</p> <pre><code>{\n  \"opaque_u_default\": 0.5,\n  \"transparent_u_default\": 1.6,\n  \"g_default\": 0.6\n}\n</code></pre>"},{"location":"iso_52016_input_check/#1-building-level-checks","title":"1) Building-level checks","text":"<ul> <li> <p>Keys: <code>net_floor_area</code>, <code>exposed_perimeter</code>, <code>height</code></p> </li> <li> <p>Must be numeric and &gt; 0.</p> </li> <li>If <code>fix</code> and value is exactly <code>0</code> \u2192 set to <code>max(eps, 1.0)</code> (\u26a0\ufe0f <code>WARN</code> with fix).</li> <li> <p>Else \u2192 <code>ERROR</code>.</p> </li> <li> <p><code>n_floors</code></p> </li> <li> <p>Must be numeric and &gt; 0.</p> </li> <li>If <code>fix</code> and value is exactly <code>0</code> \u2192 set to <code>1</code> (\u26a0\ufe0f <code>WARN</code> with fix).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul>"},{"location":"iso_52016_input_check/#2-surface-level-checks-building_surface","title":"2) Surface-level checks (<code>building_surface[*]</code>)","text":"<ul> <li>Type typos auto-corrected (<code>\"opque\"|\"opaqu\"|\"trasparent\"</code> \u2192 <code>\"opaque\"|\"transparent\"</code>) with <code>WARN</code>.</li> <li><code>type</code> must be in {<code>\"opaque\"</code>, <code>\"transparent\"</code>, <code>\"adiabatic\"</code>, <code>\"adjacent\"</code>} \u2192 else <code>ERROR</code>.</li> <li><code>area</code> must be numeric &gt; 0.</li> <li>If <code>fix</code> and <code>area</code> is exactly <code>0</code> \u2192 set to <code>max(eps, 1.0)</code> (\u26a0\ufe0f <code>WARN</code> with fix).</li> <li>Else \u2192 <code>ERROR</code>.</li> <li><code>sky_view_factor</code> must be in [0.0, 1.0].</li> <li>If <code>fix</code> and numeric \u2192 clipped into range (\u26a0\ufe0f <code>WARN</code>).</li> <li> <p>Else \u2192 <code>WARN</code>.</p> </li> <li> <p>Thermal properties</p> </li> <li>For <code>opaque/transparent</code>: <code>u_value</code> &gt; 0.<ul> <li>If invalid and <code>fix</code> \u2192 set to default (opaque_u_default or transparent_u_default) (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul> </li> <li> <p>For <code>transparent</code>: <code>g_value</code> &gt; 0.</p> <ul> <li>If invalid and <code>fix</code> \u2192 set to default (g_default) (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul> </li> <li> <p>Transparent dimensions</p> </li> <li><code>height &gt; 0</code>, <code>width &gt; 0.</code><ul> <li>If invalid and <code>fix</code> \u2192 set both to <code>1.0</code> (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul> </li> <li> <p><code>parapet</code> must be in <code>[0, height]</code> when both numeric.</p> <ul> <li>If out of range and <code>fix</code> \u2192 clamp to <code>[0, height]</code> (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>WARN</code>.</li> </ul> </li> <li> <p>Orientation recommendations</p> </li> <li><code>tilt</code> recommended in {0, 90}.<ul> <li>If numeric non-standard and <code>fix</code> \u2192 normalize to nearest of {0, 90} (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>WARN</code>.</li> </ul> </li> <li><code>azimuth</code> recommended in {0, 90, 180, 270}.<ul> <li>If numeric non-standard and <code>fix</code> \u2192 snap to nearest multiple of 90 (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>WARN</code>.</li> </ul> </li> </ul>"},{"location":"iso_52016_input_check/#3-adjacent-zones-checks-adjacent_zones","title":"3) Adjacent zones checks (adjacent_zones[*])","text":"<ul> <li><code>volume &gt; 0.</code></li> <li>If invalid and <code>fix</code> \u2192 set to <code>1.0</code> (\u26a0\ufe0f <code>WARN</code>).</li> <li> <p>Else \u2192 <code>ERROR</code>.</p> </li> <li> <p>Array length coherence across:</p> </li> <li> <p><code>area_facade_elements, typology_elements, transmittance_U_elements, orientation_elements.</code></p> <ul> <li>If lengths mismatch \u2192 <code>ERROR</code>.</li> </ul> </li> <li> <p><code>transmittance_U_elements</code> must be &gt; 0:</p> </li> <li>If invalid and <code>fix</code> \u2192 set invalid entries to <code>opaque_u_default</code> (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul>"},{"location":"iso_52016_input_check/#4-adjacency-pairing-window-caps-residual-splitting","title":"4) Adjacency pairing, window caps &amp; residual splitting","text":"<p>This stage ensures geometric consistency between:</p> <ul> <li>BUI vertical adjacent surfaces,</li> <li>the opaque (\u201cOP\u201d) areas declared in the adjacent zone on the same cardinal direction, and</li> <li>the transparent (windows) areas on the same direction.</li> </ul> <p>It operates in two passes (an inner while-loop and a later full pass), using the helpers:</p> <ul> <li><code>_azimuth_to_dir:</code> snap 0/90/180/270 \u2192<code>\"NV\"|\"EV\"|\"SV\"|\"WV\"</code>, else <code>None</code>.</li> <li><code>_dir_from_orientation:</code> more general mapper used later.</li> </ul> <p>4.1 For each vertical <code>building_surface</code> of type <code>\"adjacent\"</code> with <code>name_adj_zone</code>:</p> <ul> <li>Compute:  </li> <li><code>A_bui_orig</code>: area of the adjacent BUI surface.</li> <li> <p><code>A_adj_dir_cap</code>: sum of adjacent zone OP areas in the same direction.</p> </li> <li> <p>Cap OP area to BUI area:</p> </li> <li> <p>If <code>A_adj_dir_cap &gt; A_bui_orig + eps</code>:</p> <ul> <li>If <code>fix</code>: scale down those OP areas proportionally (\u26a0\ufe0f WARN with scale factor).</li> <li>Else: ERROR.</li> </ul> </li> </ul> <p>Window check on same direction</p> <ul> <li>Compute <code>A_win_dir</code> = sum of all vertical transparent surfaces in the same direction.</li> <li>Compute <code>diff = max(A_bui_orig - A_adj_dir_cap, 0).</code></li> <li>If <code>A_win_dir &gt; diff + eps</code>:<ul> <li>If <code>fix</code>: scale all those windows proportionally to sum to diff (\u26a0\ufe0f WARN with window scale factor).</li> <li>Else: <code>ERROR</code>.</li> </ul> </li> </ul> <p>Residual exterior creation</p> <ul> <li><code>diff_ext = max(A_bui_orig - A_adj_dir_cap, 0).</code></li> <li>If <code>diff_ext &gt; eps</code>:<ul> <li>If <code>fix</code>:<ul> <li>Append a new <code>\"opaque\"</code> surface with area <code>diff_ext</code> (same orientation, external),</li> <li>Shrink the <code>\"adjacent\"</code>surface area to <code>A_adj_dir_cap</code>.</li> <li>\u26a0\ufe0f <code>WARN</code> describing creation and resizing.</li> </ul> </li> <li>Else: <code>ERROR</code> (unallocated residual).</li> </ul> </li> </ul> <p>4.2 Final pass: split all <code>\"adjacent\"</code> verticals (consistency sweep)</p> <ul> <li> <p>For each <code>\"adjacent\"</code> vertical surface:</p> </li> <li> <p>Compute direction via <code>_dir_from_orientation</code>.</p> </li> <li>Fetch matching adjacent zone and compute <code>A_adj_dir</code> via <code>_adj_op_area_in_dir.</code></li> <li>Cap <code>A_adj_dir</code> to <code>A_bui</code> with <code>WARN</code> if it exceeds.</li> <li>If <code>diff = A_bui - A_adj_dir &gt; 1e-9</code>:<ul> <li>Shrink the \"adjacent\" area to A_adj_dir.</li> </ul> </li> </ul>"},{"location":"iso_52016_input_check/#thermal-and-adjacent-zone","title":"Thermal and Adjacent Zone","text":"<p>Uno degli errori pi\u00f9 caratteristici pu\u00f2 essere quello di immetere dei valori errati di superficie della parete di confine tra la zona termica e la zona non termica. Un esempio \u00e8 quello di dare dei valori pi\u00f9 alti della superificie della parete nella zona non termica rispetto alla superificie della parete nella zona termica. In questo caso se il controllo risulta essere negativo allora il tool imposta il valore del superificie della zona non termica uguale a quello della zona termica.  Qui voglio dire che sebbene la superficie di contatto \u00e8 la stessa pu`o succedere che la parete della zona termica sia o totlamente a contatto con la zon non termica o solamente una parte a contatto con la zona termica   </p>"},{"location":"iso_52016_input_check/#quality-check-of-system-input-check_heating_system_inputs","title":"Quality check of system input <code>check_heating_system_inputs</code>","text":"<p>This function validates and normalizes the input configuration for the heating system. It performs the following checks:</p> <ol> <li>TB14 Table: </li> <li>If a custom <code>TB14</code> DataFrame is provided, it is used.</li> <li> <p>Otherwise, the default <code>TB14</code> from <code>global_inputs.py</code> is used.</p> </li> <li> <p>Emitter Type Validation:</p> </li> <li> <p>If the <code>emitter_type</code> is not found in the selected <code>TB14</code> table, it is automatically set to the first available emitter type, and a warning message is generated.</p> </li> <li> <p>Generator Flow Temperature Control Type (<code>gen_flow_temp_control_type</code>):</p> </li> <li>Type A: Requires <code>gen_outdoor_temp_data</code> as a DataFrame. If not provided, it switches to <code>Type B</code> and generates a warning.</li> <li>Type C: If <code>\u03b8HW_gen_flw_const</code> is not provided, it defaults to <code>50</code> and a warning is shown.</li> <li>Invalid Control Type: Any other values are automatically set to <code>Type B</code>.</li> </ol> <p>The function returns: - The selected <code>TB14</code> table. - The validated <code>emitter_type</code>. - A list of messages about any changes or validations. - The normalized input configuration.</p>"},{"location":"iso_52016_node/","title":"ISO 52016 - Facade elements (nodes)","text":""},{"location":"iso_52016_node/#node-of-building-element","title":"Node of building element","text":"<p>The following two functions calculates the number of nodes to be used in opaque and transparent elements in the 5-node thermal network model.</p> <pre><code>def Number_of_nodes_element(cls, building_object) -&gt; numb_nodes_facade_elements\n</code></pre>"},{"location":"iso_52016_node/#parameters","title":"Parameters","text":"Name Type Description <code>building_object</code> <code>dict</code> Building model containing a list of surfaces under <code>building_surface</code>. Each element defines its physical type."},{"location":"iso_52016_node/#required-fields-in-building_objectbuilding_surface","title":"Required Fields in <code>building_object[\"building_surface\"]</code>","text":"Field Description <code>type</code> Element type string: \u2022 <code>\"opaque\"</code> or <code>\"OP\"</code> \u2192 Opaque element \u2022 <code>\"transparent\"</code> or <code>\"W\"</code> \u2192 Transparent element (window) \u2022 <code>\"adiabatic\"</code> \u2192 Internal/insulated partition with no heat flow."},{"location":"iso_52016_node/#purpose","title":"Purpose","text":"<p>Determines the number of thermal nodes for each building element, according to its type (opaque, transparent, or adiabatic). This step is part of the nodal network definition in EN ISO 52016-1:2017, used for energy balance and dynamic thermal simulations.</p>"},{"location":"iso_52016_node/#how-it-works","title":"How it works","text":"<ol> <li> <p>Initialize all elements as 5-node systems</p> <pre><code>el_list = len(building_object[\"building_surface\"])\nPln = np.full(el_list, 5)\n</code></pre> <p>ISO 52016 default: each opaque surface is modeled with 5 thermal nodes.</p> </li> <li> <p>Adjust per element type</p> <ul> <li>Transparent (<code>\"transparent\"</code>) \u2192 2 nodes (external/internal surfaces only).  </li> <li>Adiabatic (<code>\"adiabatic\"</code>) \u2192 0 nodes (no heat transfer).</li> </ul> <pre><code>for i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"transparent\":\n        Pln[i] = 2\n    elif surf[\"type\"] == \"adiabatic\":\n        Pln[i] = 0\n</code></pre> </li> <li> <p>Compute cumulative node index (<code>PlnSum</code>)</p> <p><pre><code>for Eli in range(1, el_list):\n    PlnSum[Eli] = PlnSum[Eli-1] + Pln[Eli-1]\n</code></pre> Each element\u2019s node sequence starts where the previous one ends.</p> </li> <li> <p>Compute the last node index (<code>Rn</code>)</p> <pre><code>Rn = PlnSum[-1] + Pln[-1] + 1\n</code></pre> <p>Adds one final node for matrix dimensioning in the solver.</p> </li> <li> <p>Return wrapper</p> <pre><code>return numb_nodes_facade_elements(Rn, Pln, PlnSum)\n</code></pre> </li> </ol> <p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre>"},{"location":"iso_52016_node/#output","title":"Output","text":"Variable Type Description <code>Rn</code> <code>int</code> Index of the last node in the complete nodal vector. Used for vector and matrix sizing. <code>Pln</code> <code>np.ndarray[int]</code> Array of the number of nodes per element: 5 for opaque, 2 for transparent, 0 for adiabatic. <code>PlnSum</code> <code>np.ndarray[int]</code> Sequential cumulative node indices for mapping all elements. <code>numb_nodes_facade_elements</code> <code>object</code> Wrapper containing <code>(Rn, Pln, PlnSum)</code>."},{"location":"iso_52016_node/#example","title":"Example","text":"<p><pre><code>building_object = {\n    \"building_surface\": [\n        {\"type\": \"opaque\"},\n        {\"type\": \"transparent\"},\n        {\"type\": \"opaque\"},\n        {\"type\": \"adiabatic\"}\n    ]\n}\n\nnodes = Number_of_nodes_element(building_object)\nprint(\"Rn:\", nodes.Rn)\nprint(\"Pln:\", nodes.Pln)\nprint(\"PlnSum:\", nodes.PlnSum)\n</code></pre> Example Output: <pre><code>Rn: 13\nPln: [5 2 5 0]\nPlnSum: [0 5 7 12]\n</code></pre></p>"},{"location":"iso_52016_node/#notes","title":"Notes","text":"<ul> <li>Opaque and adiabatic surfaces are both considered non-transparent; adiabatic ones simply have no conductive nodes.  </li> <li>The nodal indexing ensures continuous node numbering across all envelope elements \u2014 crucial for constructing the global heat transfer matrix.  </li> <li>ISO 52016 recommends 5 nodes for opaque elements (multi-layer walls/roofs) and 2 nodes for transparent elements (windows).  </li> <li>The function prepares data for the later calculation of heat capacity, conductance, and solar absorption matrices.</li> </ul>"},{"location":"iso_52016_node/#calculation-of-conduttance","title":"Calculation of conduttance","text":"<pre><code>def Conduttance_node_of_element(cls, building_object, lambda_gr=2.0) -&gt; conduttance_elements\n</code></pre>"},{"location":"iso_52016_node/#parameters_1","title":"Parameters","text":"Name Type Default Description <code>building_object</code> <code>dict</code> \u2014 Building structure containing the envelope elements in <code>building_surface</code>. <code>lambda_gr</code> <code>float</code> <code>2.0</code> Ground thermal conductivity (W/m\u00b7K), used for ground-contact elements (<code>GR</code>)."},{"location":"iso_52016_node/#required-fields-in-building_objectbuilding_surface_1","title":"Required Fields in <code>building_object[\"building_surface\"]</code>","text":"<p>Each surface element must include:</p> Field Description <code>ISO52016_type_string</code> ISO 52016 element type string: \u2022 <code>OP</code> = Opaque element \u2022 <code>W</code> = Transparent (window) \u2022 <code>GR</code> = Ground-contact \u2022 <code>AD</code> or <code>ADJ</code> = Adjacent wall <code>u_value</code> Overall thermal transmittance (W/m\u00b2\u00b7K). <code>convective_heat_transfer_coefficient_internal</code> Internal convective heat transfer coefficient (W/m\u00b2\u00b7K). <code>radiative_heat_transfer_coefficient_internal</code> Internal radiative heat transfer coefficient (W/m\u00b2\u00b7K). <code>area</code> Element surface area (m\u00b2). (optional) <code>convective_heat_transfer_coefficient_external</code> If not defined, default = 20 W/m\u00b2\u00b7K (ISO 13789). (optional) <code>radiative_heat_transfer_coefficient_external</code> If not defined, default = 4.14 W/m\u00b2\u00b7K (ISO 13789)."},{"location":"iso_52016_node/#purpose_1","title":"Purpose","text":"<p>Calculates the thermal conductance between the internal nodes (<code>pli</code> and <code>pli-1</code>) of each construction element in accordance with EN ISO 52016-1 (Section 6.5.7). It defines the inter-nodal conductances (W/m\u00b2\u00b7K) that represent the heat transfer capability through each layer of opaque, transparent, or ground-contact elements in the 5-node thermal network model.</p>"},{"location":"iso_52016_node/#how-it-works_1","title":"How it works","text":"<ol> <li> <p>Initialize constants and arrays</p> <ul> <li>Ground resistance:  </li> </ul> \\[ R_{gr} = \\frac{0.5}{\\lambda_{gr}} \\;(\\text{m}^2K/W) \\] <ul> <li>Build lists of:<ul> <li>element types (<code>el_type</code>),  </li> <li>U-values,  </li> <li>internal heat-transfer coefficients (<code>h_ci</code>, <code>h_ri</code>),  </li> <li>external coefficients (<code>h_ce</code>, <code>h_re</code>).</li> </ul> </li> </ul> </li> <li> <p>Assign external coefficients</p> <ul> <li>Default convective = 20 W/m\u00b2\u00b7K, radiative = 4.14 W/m\u00b2\u00b7K.  </li> <li>For adjacent elements (<code>AD</code>), both coefficients are set to 0 \u2192 no external exchange.</li> </ul> </li> <li> <p>Compute construction resistance </p> \\[R_{c,eli} = \\frac{1}{U_{eli}} - \\frac{1}{(h_{ci}+h_{ri})} - \\frac{1}{(h_{ce}+h_{re})}\\] <p>This represents the core conduction resistance of the element (m\u00b2\u00b7K/W).</p> </li> <li> <p>Distribute conductances among layers </p> <p>For each element i, the nodal conductances <code>h_pli_eli[layer, i]</code> are defined as:</p> <p>Layer 1 (node pair 1\u20132)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 6/R_c \\) <code>W</code> \\( h = 1/R_c \\) <code>GR</code> \\( h = 2/R_{gr} \\) <p>Layer 2 (node pair 2\u20133)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 3/R_c \\) <code>GR</code> \\( h = 1/(R_c/4 + R_{gr}/2) \\) <p>Layer 3 (node pair 3\u20134)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 3/R_c \\) <code>GR</code> \\( h = 2/R_c \\) <p>Layer 4 (node pair 4\u20135)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 6/R_c \\) <code>GR</code> \\( h = 4/R_c \\) </li> <li> <p>Return    The final 4\u00d7N matrix is wrapped in <code>conduttance_elements(h_pli_eli=h_pli_eli)</code>.</p> </li> </ol> <p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre>"},{"location":"iso_52016_node/#outputs","title":"Outputs","text":"Type Description <code>conduttance_elements</code> Wrapper object containing the matrix <code>h_pli_eli</code> (4\u00d7N) where N = number of envelope elements. Each row corresponds to a node pair (<code>pli</code>, <code>pli\u22121</code>) and each column to an element. Units: W/m\u00b2\u00b7K."},{"location":"iso_52016_node/#example_1","title":"Example","text":"<pre><code>h = Conduttance_node_of_element(building_object=bui, lambda_gr=2.0)\nH = h.h_pli_eli\nprint(H.shape)  # (4, N)\nprint(H[:, 0])  # conductance values for element #0\n</code></pre>"},{"location":"iso_52016_node/#notes_1","title":"Notes","text":"<ul> <li>For adjacent surfaces (<code>AD</code>), external heat-transfer coefficients are zero (no external exchange).  </li> <li>Ground-contact elements use simplified analytical correlations (ISO 13370).  </li> <li><code>R_c</code> is set to \u221e for \u201cAD\u201d elements \u2192 conductance = 0.  </li> <li>Default coefficients (20 W/m\u00b2\u00b7K, 4.14 W/m\u00b2\u00b7K) are consistent with ISO 13789 recommendations.  </li> <li>The 4 layers correspond to the 5-node surface temperature network used in ISO 52016.  </li> </ul>"},{"location":"iso_52016_node/#references","title":"References","text":"<ul> <li>EN ISO 52016-1:2017 \u2013 Energy performance of buildings \u2014 Calculation of energy needs for heating and cooling, Section 6.5.7.  </li> <li>EN ISO 13789:2017 \u2013 Thermal performance of buildings \u2014 Transmission and ventilation heat transfer coefficients \u2014 Calculation method.  </li> <li>EN ISO 13370:2017 \u2013 Heat transfer via the ground \u2014 Calculation methods (for ground-related resistances).</li> </ul>"},{"location":"iso_52016_overall_procedure/","title":"ISO 52016 - Overall procedure","text":""},{"location":"iso_52016_overall_procedure/#overall-procedure-energy-need-en-iso-52016","title":"Overall procedure - Energy Need EN ISO 52016","text":"<pre><code>@classmethod\ndef Temperature_and_Energy_needs_calculation(\n    cls,\n    building_object,\n    nrHCmodes=2,\n    c_int_per_A_us=10000,\n    f_int_c=0.4,\n    f_sol_c=0.1,\n    f_H_c=1,\n    f_C_c=1,\n    delta_Theta_er=11,\n    **kwargs,   # weather_source='pvgis' | 'epw', path_weather_file=... (when epw)\n)\n</code></pre> <p>This guide explains how the <code>Temperature_and_Energy_needs_calculation(...)</code> classmethod computes hourly operative temperatures and heating/cooling needs following ISO 52016:2017.  It walks through inputs, preprocessing, per\u2011timestep assembly of the linear system, HVAC setpoint logic, numerical safeguards, and outputs.</p>"},{"location":"iso_52016_overall_procedure/#inputs","title":"Inputs","text":""},{"location":"iso_52016_overall_procedure/#building-description-building_object","title":"Building description (<code>building_object</code>)","text":"<ul> <li><code>building.net_floor_area</code> (m\u00b2)</li> <li><code>building_parameters.temperature_setpoints</code></li> <li><code>heating_setpoint</code>, <code>heating_setback</code>, <code>cooling_setpoint</code>, <code>cooling_setback</code> (\u00b0C)</li> <li><code>building_parameters.system_capacities</code></li> <li><code>heating_capacity</code> (W), <code>cooling_capacity</code> (W)</li> <li><code>building_surface</code>: list of surfaces with fields (examples)</li> <li><code>type</code>: <code>\"opaque\" | \"transparent\" | \"adiabatic\" | \"adjacent\" | \"ground\"</code></li> <li><code>area</code> (m\u00b2), <code>u_value</code> (W/m\u00b2K) (if relevant), <code>thermal_capacity</code> (J/K) (optional)</li> <li><code>orientation = { azimuth, tilt }</code> with sky view factor <code>sky_view_factor \u2208 [0,1]</code></li> <li>windows: <code>g_value</code>, shading info (optional)</li> <li>optional adjacent zones block for coupling to unconditioned zones.</li> </ul>"},{"location":"iso_52016_overall_procedure/#model-parameters-function-arguments","title":"Model parameters (function arguments)","text":"<ul> <li><code>nrHCmodes</code> \u2014 modes evaluated: 1=free, 2=H or C, 3=both (default 2).</li> <li><code>c_int_per_A_us</code> \u2014 areal internal capacity (J/m\u00b2K) \u2192 multiplied by <code>net_floor_area</code> to get <code>C_int</code>.</li> <li><code>f_int_c</code>, <code>f_sol_c</code> \u2014 convective fractions for internal and solar gains.</li> <li><code>f_H_c</code>, <code>f_C_c</code> \u2014 convective fractions for heating and cooling system emission.</li> <li><code>delta_Theta_er</code> \u2014 \u0394T external air\u2013sky (\u00b0C) for radiative exchange on external surfaces.</li> <li><code>kwargs</code>: weather provider (<code>\"pvgis\"</code> or <code>\"epw\"</code>, with <code>path_weather_file</code> for EPW).</li> </ul>"},{"location":"iso_52016_overall_procedure/#purpose","title":"Purpose","text":"<p>Purpose: Solve the zone energy balance hour by hour:</p> \\[ \\underbrace{\\mathbf{A}}_{\\text{conduction + convection + radiation + capacities}}  \\cdot  \\underbrace{\\mathbf{X}}_{\\text{node temps}} = \\underbrace{\\mathbf{B}}_{\\text{weather + gains + HVAC}} \\] <ul> <li><code>X</code> contains the unknown temperatures at the air node (zone) and the conduction nodes for each surface.</li> <li>The solution is computed for up to three columns: free-floating, heating-upper, cooling-upper.</li> </ul>"},{"location":"iso_52016_overall_procedure/#1-weather-timebase","title":"1) Weather &amp; timebase","text":"<ol> <li>Choose weather source:<ul> <li><code>\"pvgis\"</code> \u2192 provider called without a file path.</li> <li><code>\"epw\"</code> \u2192 pass <code>path_weather_file</code> when provided.</li> </ul> </li> <li>Obtain <code>simulation_df</code> with hourly columns, e.g.:<ul> <li><code>T2m</code> (external temperature), global/direct/diffuse irradiance per orientation (<code>I_sol_tot_*</code>, <code>I_sol_dir_w_*</code>, <code>I_sol_dif_*</code>), wind speed, etc.</li> </ul> </li> <li><code>Tstepn = len(simulation_df)</code> \u2014 total hours simulated.</li> <li>Define <code>Dtime = 3600 s</code> for each hour (1\u2011hour step).</li> </ol>"},{"location":"iso_52016_overall_procedure/#2-surface-hydration-classification-and-aggregation","title":"2) Surface hydration, classification, and aggregation","text":"<ol> <li>Classify each surface:<ul> <li><code>\"GR\"</code>: ground (opaque with <code>sky_view_factor == 0</code>)</li> <li><code>\"AD\"</code>: adiabatic</li> <li><code>\"ADJ\"</code>: adjacent (opaque to unconditioned zone)</li> <li><code>\"W\"</code>: transparent (window)</li> <li><code>\"EXT\"</code>: other external opaque</li> </ul> </li> <li>Orientation string:<ul> <li>tilt 0 \u2192 <code>\"HOR\"</code>, tilt 90 \u2192 <code>\"NV\" | \"EV\" | \"SV\" | \"WV\"</code> based on azimuth, else heuristic (<code>HOR</code> for shallow tilts).</li> </ul> </li> <li>Hydrate coefficients if missing (typical defaults):<ul> <li>internal convection <code>h_ci</code> (facade/roof/ground/adiabatic)</li> <li>external convection <code>h_ce</code></li> <li>internal &amp; external radiation <code>h_re</code></li> </ul> </li> <li>Windows: collect <code>g_value</code> per surface (0 for non\u2011windows).</li> <li>Areas: build <code>area_elements</code> and total <code>area_elements_tot</code>.</li> <li>Aggregate by direction (optional internal step) to simplify the system, then rebuild arrays (types, orientations, <code>h_ci</code>, <code>h_ce</code>, <code>h_ri</code>, <code>h_re</code>, areas, <code>g_value</code>, <code>sky_view_factor</code>).</li> </ol>"},{"location":"iso_52016_overall_procedure/#3-zone-state-node-topology","title":"3) Zone state &amp; node topology","text":"<ol> <li>Node graph (<code>Number_of_nodes_element</code>):<ul> <li>Node index <code>0</code> \u2192 zone air/furniture.</li> <li>For each surface <code>eli</code> with <code>Pli</code> conduction nodes, the last node (<code>Pli-1</code>) is the internal surface node.</li> <li>Arrays: <code>Rn</code> (# of nodes), <code>Pln</code> (nodes per surface), <code>PlnSum</code> (overall number of nodes for all surfaces).</li> </ul> </li> <li>Capacities:<ul> <li>Zone capacity <code>C_int = c_int_per_A_us \u00d7 net_floor_area</code>.</li> <li>Lump adiabatic surface capacities into <code>C_int</code> (robustness).</li> <li>Per-surface areal capacities from <code>Areal_heat_capacity_of_element</code> \u2192 mapped into <code>C_state</code> at the corresponding node indices.</li> </ul> </li> <li>Conductances:<ul> <li>From <code>Conduttance_node_of_element</code> (array <code>h_pli_eli</code>) for intra\u2011element conduction links.</li> </ul> </li> <li>Radiative mean:<ul> <li>Internal mean radiative heat transfer coefficient (area\u2011weighted).</li> </ul> </li> </ol>"},{"location":"iso_52016_overall_procedure/#4-ground-thermal-bridges-and-solar-preparatory-data","title":"4) Ground, thermal bridges, and solar preparatory data","text":"<ol> <li>Ground model: <code>Temp_calculation_of_ground(building_object)</code> returns:<ul> <li>monthly ground temperature <code>Theta_gr_ve[1..12]</code></li> <li>equivalent resistance <code>R_gr_ve</code></li> <li>(and thermal bridge term <code>thermal_bridge_heat</code> if included in that structure).</li> </ul> </li> <li>Solar absorption:<ul> <li><code>Solar_absorption_of_element</code> \u2192 <code>a_sol_pli_eli</code> for outer nodes, and window transmission with <code>g_value</code>.</li> </ul> </li> <li>Shading:<ul> <li>Frame fraction <code>F_fr</code> (default 0.25 if unknown) reduces transparent area; optional obstacle factors per window column.</li> </ul> </li> </ol>"},{"location":"iso_52016_overall_procedure/#5-internal-and-ventilation-gains-profiles","title":"5) Internal and ventilation gains &amp; profiles","text":"<ol> <li>Build hourly profiles:<ul> <li><code>occupancy_profile</code>, <code>appliances_profile</code>, <code>lighting_profile</code></li> <li><code>heating_profile</code>, <code>cooling_profile</code>, <code>ventilation_profile</code></li> </ul> </li> <li>Fallbacks: if any H/C/ventilation profile is empty (all zero), use occupancy as a proxy to avoid a perpetually off system.</li> <li>Compute ventilation heat transfer <code>H_ve</code> each hour (function of outdoor T, wind, and profile).</li> <li>Compute internal gains (W) from building use and profiles.     Split convective vs radiative using <code>f_int_c</code>:<ul> <li>Convective part to air node</li> <li>Radiative part to internal surface nodes (area\u2011weighted)</li> </ul> </li> </ol>"},{"location":"iso_52016_overall_procedure/#6-adjacent-unconditioned-zones-if-any","title":"6) Adjacent (unconditioned) zones (if any)","text":"<ol> <li>If <code>adj_zones_present</code>:<ul> <li>Use ISO 13789 to calculate the transmission (<code>H_ztu</code>, <code>b_ztu</code>, <code>F_ztc_ztu_m</code>) per adjacent zone.</li> <li>Propagate an effective adjacent zone temperature <code>\u03b8_ztu(t)</code> each hour using:<ul> <li>previous indoor operative temperature,</li> <li>outdoor temperature,</li> <li>internal/solar gains in the unconditioned space,</li> <li>a growth limiter <code>c_ztu_h_max</code> (from tabulated guidance).</li> </ul> </li> </ul> </li> <li>For ADJ surfaces, use <code>\u03b8_ztu(t)</code> as the external boundary in the matrix assembly.</li> </ol>"},{"location":"iso_52016_overall_procedure/#7-pertimestep-assembly-iso-52016-equations","title":"7) Per\u2011timestep assembly (ISO 52016 equations)","text":"<p>At each hour t, assemble the system for up to 3 columns (free, heating-upper, cooling-upper):</p>"},{"location":"iso_52016_overall_procedure/#71-righthand-side-b-contributions","title":"7.1 Right\u2011hand side <code>B</code> contributions","text":"<p>For the zone air node (row 0):</p> <ul> <li>Capacitive carryover: <code>(C_int / \u0394t) \u00b7 \u03b8_old_air</code></li> <li>Ventilation: <code>H_ve \u00b7 T_out(t)</code></li> <li>Thermal bridges: <code>H_tb \u00b7 T_out(t)</code> (from ground/bridges model)</li> <li>Convective internal gains: <code>f_int_c \u00b7 \u03a6_int(t)</code></li> <li>Convective solar gains: <code>f_sol_c \u00b7 \u03a6_solar(t)</code></li> <li>Convective HVAC portion: <code>f_H_c\u00b7\u03a6_H + f_C_c\u00b7\u03a6_C</code> when the column represents an upper case with nonzero load</li> </ul> <p>For each internal surface node:</p> <ul> <li>Radiative gains assigned by area ratio: <code>(1 - f_int_c)\u00b7\u03a6_int + (1 - f_sol_c)\u00b7\u03a6_solar</code> divided by total internal area (W/m\u00b2 basis)</li> <li>Capacitive carryover of that node: <code>(\u03ba_pli,eli / \u0394t) \u00b7 \u03b8_old_node</code></li> </ul> <p>For each external surface node:</p> <ul> <li>External convection+radiation with outdoor air: <code>(h_ce + h_re) \u00b7 T_out(t)</code></li> <li>Sky radiation term: <code>- \u03c6_sky = - (sky_factor \u00b7 h_re \u00b7 \u0394T_er)</code></li> <li>Solar absorption term for the outer node: <code>a_sol_pli_eli \u00b7 I_sol_tot_orientation(t)</code></li> <li>For ADJ surfaces, use <code>T_adj_zone(t)</code> instead of <code>T_out(t)</code>.</li> <li>For GR surfaces, use <code>(1/R_gr) \u00b7 T_ground(month)</code>.</li> </ul>"},{"location":"iso_52016_overall_procedure/#72-matrix-a-contributions","title":"7.2 Matrix <code>A</code> contributions","text":"<ul> <li>Zone air row (0,0):<ul> <li>add <code>(C_int/\u0394t) + H_ve + H_tb + \u03a3 (A_eli\u00b7h_ci_eli)</code> </li> <li>subtract <code>A_eli\u00b7h_ci_eli</code> towards each internal surface node (coupling)</li> </ul> </li> <li> <p>Internal surface node:</p> <ul> <li>add own capacity term <code>(\u03ba/\u0394t)</code></li> <li> <p>add <code>h_ci_eli</code> (convective to air) and radiative coupling to all other internal surfaces via area\u2011weighted term:</p> \\[ h_{ri,eli} \\cdot \\sum_k \\left( \\frac{A_k}{A_\\text{int,tot}} \\right) \\] </li> <li> <p>subtract coupling to air node: <code>h_ci_eli</code></p> </li> <li>subtract radiative couplings to other internal surfaces via area ratios</li> <li>add conduction links <code>+h_{pli-1,eli}</code> to previous node and <code>+h_{pli,eli}</code> to next node; subtract the symmetric terms on neighbors</li> <li>External surface node:</li> <li>add <code>(h_ce + h_re)</code> for EXT/ADJ or <code>(1/R_gr)</code> for **GR`</li> <li>add own capacity term <code>(\u03ba/\u0394t)</code></li> <li>add conduction links to next/previous node (as above)</li> </ul> </li> </ul> <p>A small diagonal regularization is applied to keep <code>A</code> non\u2011singular.</p>"},{"location":"iso_52016_overall_procedure/#8-solve-the-systems-and-compute-operative-temperatures","title":"8) Solve the system(s) and compute operative temperatures","text":"<ol> <li>Check rank/conditioning; regularize if needed.</li> <li>Solve <code>A\u00b7X = B</code> for each column (free, heating-upper, cooling-upper).</li> <li>Extract:<ul> <li><code>\u03b8_int_air(t)</code> = <code>X[air_row, :]</code></li> <li><code>\u03b8_int_r_mn(t)</code> = area\u2011weighted average of internal surface node temperatures</li> <li><code>\u03b8_op(t)</code> = <code>0.5 \u00b7 (\u03b8_int_air + \u03b8_int_r_mn)</code> for each column.</li> </ul> </li> </ol>"},{"location":"iso_52016_overall_procedure/#9-hvac-setpoint-logic-iso-52016-6552","title":"9) HVAC setpoint logic (ISO 52016 \u00a76.5.5.2)","text":"<p>For each hour:</p> <ol> <li> <p>Determine active setpoints using <code>heating_profile</code>/<code>cooling_profile</code>:</p> <ul> <li>no heating \u2192 use heating setback; if special sentinel (e.g., <code>&lt; -995</code>), disable heating.</li> <li>no cooling \u2192 use cooling setback; if <code>&gt; +995</code>, disable cooling.</li> </ul> </li> <li> <p>Compare free operative temperature <code>\u03b8_op_free</code> with setpoints:</p> <ul> <li>If <code>\u03b8_op_free &lt; \u03b8_heat_set</code>: compute heating load using eq. (27):</li> </ul> \\[ \u03a6_{HC} = \u03a6_{H,\\text{max}} \\cdot \\frac{\u03b8_\\text{set} - \u03b8_{op,0}}{\u03b8_{op,H} - \u03b8_{op,0}} \\] <p>where <code>\u03b8_{op,H}</code> is the \u201cupper\u201d heating solution and clip to <code>heating_capacity</code>.</p> <ul> <li>If <code>\u03b8_op_free &gt; \u03b8_cool_set</code>: compute cooling load similarly (negative W), clip to <code>cooling_capacity</code>.</li> </ul> </li> <li> <p>If capacity is not saturated (partial load), reassemble with the actual HVAC load and resolve once so that the achieved <code>\u03b8_op</code> equals the setpoint (within tolerance).</p> </li> <li>Save <code>\u03a6_HC(t)</code> into the time series (<code>Q_HC</code>, positive for heating, negative for cooling) and record <code>\u03b8_op_act(t)</code>.</li> </ol>"},{"location":"iso_52016_overall_procedure/#10-energy-accounting-sankey-style-optional","title":"10) Energy accounting (Sankey-style, optional)","text":"<p>Per hour, accumulate Wh contributions:</p> <ul> <li>Inputs: <code>Heating</code>, <code>Internal gains</code>, <code>Solar &amp; free-gain</code></li> <li>Outputs: <code>Cooling (extracted)</code>, <code>Ventilation</code>, <code>Thermal bridges</code>, <code>Ground</code>, <code>Transmission by surface</code></li> <li>Storage: change in state energy (<code>\u2211 C_state \u00b7 \u0394\u03b8 / 3600</code>)</li> </ul> <p>At the end:</p> <ul> <li>Check balance: Inputs \u2248 Outputs + Storage (absorb small residuals into Storage if &lt;1% Inputs).</li> </ul>"},{"location":"iso_52016_overall_procedure/#11-build-outputs","title":"11) Build outputs","text":""},{"location":"iso_52016_overall_procedure/#111-hourly-results-after-warmup","title":"11.1 Hourly results (after warm\u2011up)","text":"<p>DataFrame columns:</p> <ul> <li><code>Q_HC</code> (W) \u2014 signed HVAC need (+: heating, \u2212: cooling)</li> <li><code>T_op</code> (\u00b0C) \u2014 achieved operative temperature</li> <li><code>T_ext</code> (\u00b0C) \u2014 outdoor temperature</li> <li>Convenience splits:<ul> <li><code>Q_H = max(Q_HC, 0)</code></li> <li><code>Q_C = max(-Q_HC, 0)</code></li> </ul> </li> </ul>"},{"location":"iso_52016_overall_procedure/#112-annual-aggregation","title":"11.2 Annual aggregation","text":"<ul> <li><code>Q_H_annual = \u03a3 Q_H \u00b7 \u0394t</code> (Wh)</li> <li><code>Q_C_annual = \u03a3 Q_C \u00b7 \u0394t</code> (Wh)</li> <li>Per-area KPIs (Wh/m\u00b2): divide by <code>building.net_floor_area</code>.</li> </ul>"},{"location":"iso_52016_overall_procedure/#12-units-conventions","title":"12) Units &amp; conventions","text":"<ul> <li>Temperature <code>\u03b8</code>: \u00b0C </li> <li>Power <code>\u03a6</code> / <code>Q</code>: W </li> <li>Energy: Wh (integration across hours)  </li> <li>Capacity <code>C</code>, <code>\u03ba</code>: J/K (areal capacities multiplied by area become J/K at node)</li> <li>Conductances <code>h_*</code>: W/m\u00b2K; when multiplied by area \u2192 W/K.</li> </ul>"},{"location":"iso_52016_overall_procedure/#13-numerical-stability-robustness","title":"13) Numerical stability &amp; robustness","text":"<ul> <li>Diagonal regularization of <code>A</code> (min diag value based on \u2225A\u2225\u221e) to avoid singularities.</li> <li>Warm\u2011up (e.g., first month) simulated and typically excluded from reporting to reduce initial transients.</li> <li>Limiters for adjacent-zone temperature growth (<code>c_ztu_h_max</code>) and ventilation sanity checks (non-negative, finite).</li> <li>Clamp microscopic residuals (|x| &lt; 1e\u20119 \u2192 0) in energy accounting.</li> </ul>"},{"location":"iso_52016_overall_procedure/#14-minimal-checklist-before-running","title":"14) Minimal checklist before running","text":"<ul> <li>Weather source set correctly; EPW file path valid if used.</li> <li>Surfaces have: <code>type</code>, <code>area</code>, <code>orientation</code>, <code>sky_view_factor</code>, and suitable <code>U</code>/<code>g_value</code> where relevant.</li> <li>Setpoints and capacities are present and in W/\u00b0C.</li> <li>Profiles are present or fallbacks enabled.</li> </ul>"},{"location":"iso_52016_overall_procedure/#15-worked-outline-pseudoalgorithm","title":"15) Worked outline (pseudo\u2011algorithm)","text":"<pre><code>get weather(sim_df), Tstepn\nclassify &amp; hydrate surfaces (types, orientation strings, h_ci/h_ce/h_ri/h_re, areas, g-values)\naggregate by direction (optional) \u2192 rebuild arrays\n\nnodes = Number_of_nodes_element(building_object)\nC_state[air] = c_int_per_A_us * net_floor_area (+ AD capacities)\nC_state[elem nodes] from Areal_heat_capacity_of_element\nprecompute: ground model, thermal bridges, conductances h_pli_eli, solar absorption a_sol_pli_eli\nbuild hourly profiles (H/C/vent/occ/app/light) with fallbacks\n\nfor each hour t:\n  assemble A, B for (free, heat-upper, cool-upper):\n    zone row: capacities, H_ve, H_tb, convective gains + HVAC convective chunk\n    internal nodes: capacities, conduction, convection to air, radiative coupling, gains (radiative chunks)\n    external nodes: capacities, boundary to outdoor/adj/ground, solar terms\n  solve \u2192 X (three columns)\n  compute T_op for each column\n  apply setpoint logic (eq. 27), clip to capacities, possibly reassemble with partial \u03a6_HC\n  write Q_HC(t), T_op_act(t)\n  accumulate energy terms (inputs/outputs/storage)\n\npost:\n  build hourly DataFrame (drop warm-up)\n  integrate Wh \u2192 annual totals and Wh/m\u00b2\n  return hourly_results, annual_results_df\n</code></pre>"},{"location":"iso_52016_overall_procedure/#16-interpretation-tips","title":"16) Interpretation tips","text":"<ul> <li><code>Q_HC</code> is need, not system energy use. Apply system efficiencies (e.g., seasonal COP/\u03b7) downstream to obtain consumption.</li> <li>If <code>T_op</code> frequently deviates from setpoints, the capacity is insufficient or profiles/weather are too demanding.</li> <li>Large storage swings indicate high thermal mass; near-zero annual storage is expected (balance closure).</li> </ul>"},{"location":"iso_52016_overall_procedure/#17-common-pitfalls-remedies","title":"17) Common pitfalls &amp; remedies","text":"<ul> <li>All-zero profiles \u2192 no HVAC action: enable fallbacks or fix schedules.</li> <li>Missing g-values \u2192 underestimated solar gains for windows: add <code>g_value</code>.</li> <li>Incorrect sky view factor \u2192 radiative cooling to sky misrepresented: ensure <code>0..1</code>.</li> <li>Singular matrix \u2192 add/verify capacities, check AD nodes, keep time step at 1h, allow diagonal regularization.</li> <li>Units confusion \u2192 check W vs Wh vs J/K; capacities are often mistaken for J/m\u00b2K without conversion.</li> </ul> <p>Note</p> <p>This document describes the computational steps implemented by the method and their physical meaning, aligned with ISO 52016 methodology (free-floating, upper-limit solutions, and setpoint-based interpolation with capacity clipping).</p> <p>This library was developed to showcase specific computational elements outlined in the relevant technical standards. It is designed to supplement, not replace, the official regulations, as these are crucial for understanding the underlying calculations. Intended for demonstration and testing purposes only, this library is distributed as open source without protections against misuse or misapplication.</p> <p>The opinions and information contained in this document belong to the authors and do not necessarily represent the official stance of the European Union. Neither the European Union's institutions and bodies, nor anyone acting on their behalf, shall bear responsibility for how the information herein is utilized.</p>"},{"location":"iso_52016_solar_absorption/","title":"ISO 52016 - Solar absorption","text":""},{"location":"iso_52016_solar_absorption/#solar-absorption-of-building-envelope-elements","title":"Solar absorption of building envelope elements","text":"<pre><code>def Solar_absorption_of_element(cls, building_object) -&gt; solar_absorption_elements\n</code></pre>"},{"location":"iso_52016_solar_absorption/#inputs","title":"Inputs","text":"Name Type Description <code>building_object</code> <code>dict</code> Building data structure that contains a list of surfaces under <code>building_surface</code>. Each surface must define <code>ISO52016_type_string</code> and optical parameters (<code>solar_absorptance</code> or <code>g_value</code>)."},{"location":"iso_52016_solar_absorption/#required-fields-in-building_objectbuilding_surface","title":"Required Fields in <code>building_object[\"building_surface\"]</code>","text":"<p>Each element in <code>building_surface</code> should include:</p> Field Description <code>ISO52016_type_string</code> <code>OP</code> = Opaque element \u2022 <code>W</code> = Transparent (window) \u2022 <code>GR</code> = Ground-contact \u2022 <code>AD</code> or <code>ADJ</code> = Adjacent wall <code>solar_absorptance</code> Solar absorptance coefficient (0\u20131) for opaque elements. <code>g_value</code> Solar energy transmittance (0\u20131) for transparent elements."},{"location":"iso_52016_solar_absorption/#purpose","title":"Purpose","text":"<p>Computes the solar absorption coefficients for each building envelope element in accordance with EN ISO 52016-1 solar heat gain modeling. The result is a 5\u00d7N matrix <code>a_sol_pli_eli</code> assigning solar absorption values to the nodal structure of each surface.</p>"},{"location":"iso_52016_solar_absorption/#how-it-works","title":"How it works","text":"<p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre> <ol> <li> <p>Determine number of envelope elements</p> <p><pre><code>el_list = len(building_object[\"building_surface\"])\n</code></pre> Creates an empty coefficient list <code>solar_abs_elements</code> of length N.</p> </li> <li> <p>Extract solar properties</p> <ul> <li>For each surface:<ul> <li>If <code>\"solar_absorptance\"</code> is defined and the element is not <code>\"AD\"</code> or <code>\"ADJ\"</code>, use its value.</li> <li>If <code>\"solar_absorptance\"</code> is missing, use the <code>\"g_value\"</code> (for transparent elements).</li> <li>If the element type is <code>\"AD\"</code> or <code>\"ADJ\"</code>, set absorptance = 0.0 (no solar gain through adjacent walls).</li> </ul> </li> </ul> </li> <li> <p>Create absorption matrix</p> <pre><code>a_sol_pli_eli = np.zeros((5, el_list))\na_sol_pli_eli[0, :] = solar_abs_elements\n</code></pre> <p>Only the first node (external surface) receives the solar absorptance value; deeper nodes remain zero.</p> </li> <li> <p>Return result</p> <pre><code>return solar_absorption_elements(a_sol_pli_eli=a_sol_pli_eli)\n</code></pre> </li> </ol>"},{"location":"iso_52016_solar_absorption/#outputs","title":"Outputs","text":"Type Description <code>solar_absorption_elements</code> Wrapper containing the 2D array <code>a_sol_pli_eli</code> (shape 5\u00d7N), where N = number of elements in <code>building_surface</code>."},{"location":"iso_52016_solar_absorption/#example","title":"Example","text":"<pre><code># Expected result:\na_sol_pli_eli = np.array([\n    [0. , 0.6, 0.6, 0.6, 0.6, 0.6, 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n])\n</code></pre>"},{"location":"iso_52016_solar_absorption/#notes","title":"Notes","text":"<ul> <li>Only external surfaces (node 0) receive solar absorption values, as solar radiation is applied to the outermost layer.  </li> <li>Adjacent elements (<code>\"AD\"</code> or <code>\"ADJ\"</code>) are excluded from solar absorption (set to zero).  </li> <li>Transparent elements (<code>\"W\"</code>) use <code>g_value</code> instead of <code>solar_absorptance</code>.  </li> <li>The 5\u00d7N output format is consistent with the 5-node thermal network defined in ISO 52016-1.</li> </ul>"},{"location":"iso_52016_solar_absorption/#references","title":"References","text":"<ul> <li>EN ISO 52016-1:2017 \u2013 Energy performance of buildings \u2013 Calculation of energy needs for heating and cooling. - Section 6.5.7 \u2013 Definition of solar absorptance and its application to surface nodes.</li> </ul>"},{"location":"iso_52016_ventilation/","title":"ISO 52016 - Ventilation","text":""},{"location":"iso_52016_ventilation/#ventilation-internal-gains-and-transmission-heat-transfer-between-adjacent-zones","title":"Ventilation, Internal Gains and Transmission Heat Transfer between Adjacent Zones","text":"<p>This module implements methods for evaluating heat transfer by ventilation and internal heat gains in thermally conditioned and unconditioned zones.</p> <p>It also includes an auxiliary function for computing transmission heat transfer coefficients between conditioned and adjacent zones, following ISO 13789.</p>"},{"location":"iso_52016_ventilation/#overview","title":"Overview","text":"<p>The module covers three main components:</p> <ol> <li>Ventilation heat transfer coefficient (<code>VentilationInternalGains.heat_transfer_coefficient_by_ventilation</code>):</li> <li>Evaluates the natural ventilation rate and corresponding heat transfer coefficient (<code>H_ve_nat</code>) using ISO 16798\u20117 (wind and temperature-driven airflow).</li> <li> <p>Supports a simplified occupancy-based ventilation model.</p> </li> <li> <p>Internal heat gains (<code>VentilationInternalGains.internal_gains</code>):</p> </li> <li> <p>Computes total internal heat gains from occupants, appliances, and optionally nearby unconditioned zones, using ISO 16798\u20111 and ISO 15316\u20111 formulations.</p> </li> <li> <p>Transmission between zones (<code>transmission_heat_transfer_coefficient_ISO13789</code>):</p> </li> <li>Calculates inter-zone transmission coefficients (<code>H_ztu_tot</code>, <code>b_ztu_m</code>) according to ISO 13789, accounting for heat exchanges between conditioned, unconditioned, and external environments.</li> </ol>"},{"location":"iso_52016_ventilation/#calculation-of-heat-transfer-coefficient-by-ventilation","title":"Calculation of heat transfer coefficient by ventilation","text":"<pre><code>@staticmethod\ndef heat_transfer_coefficient_by_ventilation(\n    building_object, Tz, Te, u_site, Rw_arg_i=None, c_air=1006, \n    rho_air=1.204, C_wnd=0.001, C_st=0.0035, rho_a_ref=1.204, altitude=None,\n    type_ventilation=\"temp_wind\", flowrate_person=1.4\n) -&gt; h_natural_vent:\n</code></pre>"},{"location":"iso_52016_ventilation/#inputs-main","title":"Inputs (main)","text":"<ul> <li><code>Tz</code> <code>[\u00b0C]</code> indoor air temperature (zone).</li> <li><code>Te</code> <code>[\u00b0C]</code> outdoor air temperature.</li> <li><code>u_site</code> <code>[m\u00b7s\u207b\u00b9]</code> local wind speed at site height (as per ISO 16798-7 assumptions).</li> <li><code>Rw_arg_i</code> <code>[-]</code> array of opening ratios per window (<code>0\u20261</code>). If <code>None</code>, defaults to <code>0.9</code>.</li> <li><code>C_wnd = 0.001</code> <code>[(m\u00b7s\u207b\u00b9)\u207b\u00b9]</code> wind coefficient (ISO 16798-7 Table 11).</li> <li><code>C_st = 0.0035</code> <code>[(m\u00b7s\u207b\u00b9)/(m\u00b7K)]</code> stack coefficient (ISO 16798-7 Table 11).</li> <li><code>rho_a_ref</code> <code>[kg\u00b7m\u207b\u00b3]</code> reference air density at ~20 \u00b0C; corrected with <code>altitude</code> if provided.</li> <li><code>type_ventilation</code>: <code>\"temp_wind\"</code> (ISO airing) or <code>\"occupancy\"</code> (area-based volumetric rule).</li> <li><code>flowrate_person</code> <code>[L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2]</code> used only in <code>\"occupancy\"</code> branch.</li> </ul>"},{"location":"iso_52016_ventilation/#purpose","title":"Purpose","text":"<p>Physical purpose: compute the ventilation heat transfer coefficient \\(H_{ve}\\) <code>[W\u00b7K\u207b\u00b9]</code> of the thermal zone either: - from natural ventilation (ISO 16798-7:2017, single-sided airing via windows, wind/stack), or - from occupancy-driven flow (simplified volumetric rate per floor area).</p>"},{"location":"iso_52016_ventilation/#physics","title":"Physics","text":"<p>Step A \u2014 Effective opening height (stack path) For each transparent surface: - parapet height \\(h_p\\) <code>[m]</code>, - window height \\(h_w\\) <code>[m]</code>, - path height (vertical center): \\(h_{path,i} = h_p + \\frac{h_w}{2}\\), - fa height: \\(h_{fa,i} = \\frac{h_w}{2}\\).</p> <p>The useful stack height:</p> \\[ h_{w,st} = \\max_i\\!\\left(h_{path,i} + \\frac{h_{fa,i}}{2}\\right) - \\min_i\\!\\left(h_{path,i} - \\frac{h_{fa,i}}{2}\\right) \\tag{4.1} \\] <p>Step B \u2014 Density correction If <code>altitude</code> present, a standard atmosphere relation updates \\(\\rho_{a,ref}\\). Outdoor density:</p> \\[ \\rho_{a,e} = \\rho_{a,ref}\\,\\frac{291.15}{273.15 + T_e} \\tag{4.2} \\] <p>Step C \u2014 Effective openable area </p> <p>For each window \\(i\\), geometric area \\(A_{w,i} = h_{w,i}\\,w_i\\). Open area \\(A_{w,i}^{open} = A_{w,i}\\,R_{w,i}\\) with \\(R_{w,i}\\in[0,1]\\). If <code>Rw_arg_i</code> is missing or length mismatches the number of windows, default \\(R_{w,i}=0.9\\).</p> \\[ A_{w,tot} = \\sum_i A_{w,i}^{open} \\tag{4.3} \\] <p>Step D \u2014 Airing volumetric flow (single-sided) </p> <p>Using ISO 16798-7 \u00a76.4.3.5.4:</p> \\[ q_v = 3600\\;\\frac{\\rho_{a,ref}}{\\rho_{a,e}}\\;\\frac{A_{w,tot}}{2}\\, \\left[\\max\\!\\Big(C_{wnd}\\,u_{site}^2,\\; C_{st}\\,h_{w,st}\\,\\lvert T_z-T_e\\rvert\\Big)\\right]^{1/2} \\quad [\\text{m}^3/\\text{h}] \\tag{4.4} \\] <p>Step E \u2014 Ventilation conductance</p> \\[ H_{ve} = \\frac{c_{air}\\,\\rho_{air}}{3600}\\;q_v \\quad [\\text{W\u00b7K}^{-1}] \\tag{4.5} \\] <p>Occupancy branch: area-based simplified rule (constant per hour)</p> \\[ H_{ve} = A_{use}\\cdot (3.6\\,\\dot v_{pers})\\cdot \\frac{c_{air}\\,\\rho_{air}}{3600} \\tag{4.6} \\] <p>with \\(\\dot v_{pers}\\) in <code>[L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2]</code> and <code>3.6</code> converting L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2 to m\u00b3\u00b7h\u207b\u00b9\u00b7m\u207b\u00b2.</p>"},{"location":"iso_52016_ventilation/#outputs","title":"Outputs","text":"<ul> <li><code>np.ndarray</code> of <code>H_ve_k_t</code> <code>[W\u00b7K\u207b\u00b9]</code> (scalar or time-series depending on inputs).</li> </ul>"},{"location":"iso_52016_ventilation/#example","title":"Example","text":"<pre><code>if type_ventilation == \"temp_wind\":\n    extract all windows -&gt; {height, width, parapet}\n    compute hw_path_i, hw_fa_i -&gt; hw_st  # Eq. (4.1)\n    density correction -&gt; rho_a_e        # Eq. (4.2)\n    aw_tot -&gt; Eq. (4.3)\n    qv -&gt; Eq. (4.4)\n    Hve -&gt; Eq. (4.5)\nelse:  # occupancy\n    A_use &lt;- building_object[\"building\"][\"net_floor_area\"]\n    Hve  &lt;- Eq. (4.6)\nreturn np.array(Hve)\n</code></pre>"},{"location":"iso_52016_ventilation/#edge-cases-validation","title":"Edge Cases &amp; Validation","text":"<ul> <li>No transparent surfaces \u2192 \\(A_{w,tot}=0\\) \u2192 \\(H_{ve}=0\\).</li> <li><code>Rw_arg_i</code> length mismatch \u2192 warning + default 0.9.</li> <li>Negative or null <code>u_site</code> accepted; <code>max(\u00b7)</code> ensures stack/wind pick the dominant driver.</li> </ul>"},{"location":"iso_52016_ventilation/#internal-gains-calculation","title":"Internal gains calculation","text":"<pre><code>def internal_gains(\n    cls, building_type_class, a_use, unconditioned_zones_nearby=False,\n    list_adj_zones=None, Fztc_ztu_m: float=1, b_ztu: float=1,\n    h_occup: float=1, h_app: float=1, h_light: float=1, h_dhw: float=1,\n    h_hvac: float=1, h_proc: float=1\n) -&gt; float:\n</code></pre>"},{"location":"iso_52016_ventilation/#inputs-main_1","title":"Inputs (main)","text":"<ul> <li><code>building_type_class</code>: key for the lookup table <code>internal_gains_occupants</code> (imported from <code>source.table_iso_16798_1</code>).</li> <li><code>a_use</code> <code>[m\u00b2]</code>: useful area of the conditioned zone.</li> <li><code>h_*</code> <code>[-]</code>: hourly multipliers (profiles) for each sub-component (currently occupants and appliances are used).</li> <li>Coupling params for unconditioned zones:<ul> <li><code>b_ztu</code> <code>[-]</code>: adjustment factor of the adjacent unconditioned zone (see \u00a74.4, Eq. (4.13)).</li> <li><code>Fztc_ztu_m</code> <code>[-]</code>: fractional path factor conditioned\u2192unconditioned in month <code>m</code> (lumped path coefficient).</li> <li><code>list_adj_zones</code>: number of adjacent zones (note: the current signature expects an int; see note below).</li> </ul> </li> </ul> <p>Note: The code uses <code>for zones in range(list_adj_zones)</code> \u2014 pass an <code>int</code>. If a list is desired in the future, change to <code>for z in list_adj_zones:</code>.</p>"},{"location":"iso_52016_ventilation/#purpose_1","title":"Purpose","text":"<p>Physical purpose: compute internal sensible gains \\(\\Phi_{int}\\) <code>[W]</code> in the thermally conditioned zone, possibly accounting for spillover to adjacent unconditioned zones.</p>"},{"location":"iso_52016_ventilation/#physics_1","title":"Physics","text":"<p>Let \\(q_{occ}\\) and \\(q_{app}\\) be the nominal density of internal gains <code>[W\u00b7m\u207b\u00b2]</code> for occupants/equipment per <code>building_type_class</code>.</p> <p>Base internal gains in the conditioned zone:</p> \\[ \\Phi_{int,z}(t) = \\big(q_{occ}\\,h_{occup}(t) + q_{app}\\,h_{app}(t)\\big)\\;A_{use} \\tag{4.7} \\] <p>Optional spillover to unconditioned adjacent zones (<code>unconditioned_zones_nearby = True</code>): The code currently adds a further term per adjacent zone combining a direct duplicated contribution and a fractional transfer modulated by \\((1-b_{ztu})\\,F_{ztc{\\text -}ztu,m}\\):</p> \\[ \\Phi_{int,z}^{eff}(t) = \\Phi_{int,z}(t) + \\sum_{j=1}^{N_{adj}} \\left[\\Phi_{int,z}(t) + \\big(1-b_{ztu}\\big)\\,F_{ztc{\\text -}ztu,m}\\,\\Phi_{int,z}(t)\\right] \\tag{4.8} \\]"},{"location":"iso_52016_ventilation/#output","title":"Output","text":"<ul> <li><code>float</code> <code>[W]</code> \u2014 instantaneous internal sensible gains for the conditioned zone with the current coupling rule.</li> </ul>"},{"location":"iso_52016_ventilation/#example_1","title":"Example","text":"<pre><code>q_occ = internal_gains_occupants[building_type_class]['occupants']\nq_app = internal_gains_occupants[building_type_class]['appliances']\nPhi_base = (q_occ*h_occup + q_app*h_app) * a_use        # Eq. (4.7)\nif unconditioned_zones_nearby:\n    Phi_eff = Phi_base\n    for _ in range(list_adj_zones):\n        Phi_eff += Phi_base + (1-b_ztu)*Fztc_ztu_m * Phi_base\n    return float(Phi_eff)\nelse:\n    return float(Phi_base)\n</code></pre>"},{"location":"iso_52016_ventilation/#integration-roadmap-future-enhancements","title":"Integration Roadmap (Future Enhancements)","text":"<ul> <li>Air leaks: integrate infiltration losses for cracks and envelope leakage tests.</li> <li>Cross ventilation: include simultaneous airflow paths between opposite fa\u00e7ades.</li> <li>Mechanical ventilation: handle forced air systems with user\u2011defined flow rates and recovery efficiency.</li> </ul>"},{"location":"iso_52016_ventilation/#references","title":"References","text":"<ul> <li>ISO\u202f52016\u20111:2017, \u00a7\u202f6.5.10\u202fVentilation and Heat Transfer Coefficients  </li> <li>ISO\u202f16798\u20117:2017, \u00a7\u202f6.4.3.5\u202fNatural Ventilation Airflow  </li> <li>ISO\u202f16798\u20111:2019, \u00a7\u202fM1\u2013M10 Internal Gains  </li> <li>ISO\u202f13789:2017, \u00a7\u202f7\u202fTransmission Heat Transfer Coefficients through Adjacent Spaces</li> </ul>"},{"location":"iso_52016_virtual_ground_temperature/","title":"ISO 52016 - Virtual ground temperature","text":""},{"location":"iso_52016_virtual_ground_temperature/#calculation-of-virtual-ground-temperature","title":"Calculation of virtual ground temperature","text":"<pre><code>def Temp_calculation_of_ground(\n    cls,\n    building_object,\n    lambda_gr=2.0,  # W/(m\u00b7K)\n    R_si=0.17,      # m\u00b2K/W (internal surface resistance)\n    R_se=0.04,      # m\u00b2K/W (external surface resistance for ground calc.)\n    psi_k=0.05,     # W/(m\u00b7K) linear transmittance wall/floor junction\n    **kwargs        # expects path_weather_file\n) -&gt; temp_ground\n</code></pre>"},{"location":"iso_52016_virtual_ground_temperature/#inputs","title":"Inputs","text":"Name Type Default Description <code>building_object</code> <code>dict</code> \u2014 Building data structure (geometry, envelope, setpoints). See Required fields below. <code>lambda_gr</code> <code>float</code> <code>2.0</code> Thermal conductivity of the ground, W/(m\u00b7K). <code>R_si</code> <code>float</code> <code>0.17</code> Internal surface resistance, m\u00b2K/W. <code>R_se</code> <code>float</code> <code>0.04</code> External surface resistance (as used for ground calc.), m\u00b2K/W. <code>psi_k</code> <code>float</code> <code>0.05</code> Linear thermal transmittance at the wall/floor junction, W/(m\u00b7K). <code>**kwargs['path_weather_file']</code> <code>str | PathLike</code> \u2014 Path to EPW used by <code>Calculation_ISO_52010</code> to retrieve ambient temperatures."},{"location":"iso_52016_virtual_ground_temperature/#required-fields-in-building_object","title":"Required Fields in <code>building_object</code>","text":"<ul> <li><code>building_parameters.temperature_setpoints.heating_setpoint</code> (\u00b0C)  </li> <li><code>building_parameters.temperature_setpoints.cooling_setpoint</code> (\u00b0C)  </li> <li><code>building_surface</code>: list of surfaces with at least <code>area</code>, <code>sky_view_factor</code> (used to detect floor-on-ground where <code>svf == 0</code>).  </li> <li><code>building.exposed_perimeter</code> (m)  </li> <li><code>building.wall_thickness</code> (m)  </li> <li>(Optional) <code>building.thermal_resistance_floor</code> (m\u00b2K/W). In the current code, <code>thermal_resistance_floor</code> is set to 5.3 m\u00b2K/W internally.  </li> <li>The function stores <code>building_parameters.coldest_month</code> (=1) for later reference.</li> </ul>"},{"location":"iso_52016_virtual_ground_temperature/#purpose","title":"Purpose","text":"<p>Computes the virtual ground temperature and related parameters for slab-on-ground (SoG) floors in accordance with ISO 13370:2017. The routine derives: - <code>R_gr_ve</code>: thermal resistance of the virtual ground layer below the floor, - <code>Theta_gr_ve</code>: monthly virtual ground temperatures seen by the floor, - <code>thermal_bridge_heat</code>: linear thermal bridge contribution at the wall\u2013floor junction.</p> <p>These quantities are used to model heat exchange with the ground in dynamic/steady-state building energy calculations.</p>"},{"location":"iso_52016_virtual_ground_temperature/#how-it-works","title":"How it works","text":"<ol> <li> <p>Reference ground resistance </p> \\[ R_{gr} = \\frac{0.5}{\\lambda_{gr}} \\quad (\\text{m}^2\\,K/W) \\] </li> <li> <p>External temperature statistics (monthly) from <code>Calculation_ISO_52010</code> (local time series):  </p> <ul> <li> <p><code>T2m</code> \u2192 monthly mean / min / max \u2192 amplitude of external temperature variations:  </p> \\[ A_e = \\frac{\\overline{T_{max}} - \\overline{T_{min}}}{2} \\] </li> <li> <p>Annual external mean: \\( \\overline{T_e} \\).</p> </li> </ul> </li> <li> <p>Internal temperature profile     Using active heating/cooling setpoints from the building object:  </p> <ul> <li> <p>Annual mean:  \\( \\overline{T_i} = (T_{set,h} + T_{set,c})/2 \\) </p> </li> <li> <p>Amplitude:  \\( A_i = (T_{set,c} - T_{set,h})/2 \\) </p> </li> <li> <p>With coldest month = 1 (January), monthly internal temperature is:</p> <p>\\( T_{i,m} = \\overline{T_i} - A_i \\cos\\left(\\tfrac{2\\pi (m - m_c)}{12}\\right) \\)</p> </li> </ul> </li> <li> <p>Identify slab-on-ground area (<code>sog_area</code>)     The code searches <code>building_surface</code> for the element with <code>sky_view_factor == 0</code> and uses its <code>area</code> as the contact area with ground.</p> </li> <li> <p>Characteristic floor dimension     With exposed perimeter <code>P</code> and floor area <code>A</code>:</p> \\[ B' = \\frac{A}{0.5 P} \\] </li> <li> <p>Equivalent ground thickness </p> \\[ d_t = t_{wall} + \\lambda_{gr} (R_{floor} + R_{se}) \\] <p>where <code>R_floor</code> = 5.3 m\u00b2K/W in this implementation.</p> </li> <li> <p>Slab-on-ground transmittance \\( U_{sog} \\) (ISO 13370 \u00a78):  </p> <ul> <li> <p>If \\( d_t &lt; B' \\) (un/ moderately insulated):</p> \\[ U_{sog} = \\frac{2\\lambda_{gr}}{\\pi B' + d_t} \\ln\\!\\left(\\frac{\\pi B'}{d_t} + 1\\right) \\] </li> <li> <p>Else (well insulated):  </p> \\[ U_{sog} = \\frac{\\lambda_{gr}}{0.457 B' + d_t} \\] </li> </ul> </li> <li> <p>Virtual layer resistance </p> \\[ R_{gr,ve} = \\frac{1}{U_{sog}} - R_{si} - R_{floor} - R_{gr} \\] </li> <li> <p>Linear thermal bridges </p> \\[ H_{TB} = P \\cdot \\psi_k \\quad (\\text{W/K}) \\] </li> <li> <p>Steady-state &amp; periodic ground heat transfer coefficients </p> <ul> <li> <p>Steady-state: \\( H_{ss} = A\\,U_{sog} + P\\,\\psi_k \\) </p> </li> <li> <p>Periodic terms (with <code>periodic_penetration_depth = 3.2 m</code>):  </p> </li> <li> <p>Internal-side periodic:  </p> \\[ H_{pi} = A\\, \\frac{\\lambda_{gr}}{d_t} \\sqrt{\\frac{2}{(1 + \\delta)^2 + 1}} \\quad \\text{with } \\delta = \\frac{\\text{ppd}}{d_t} \\] </li> <li> <p>External-side periodic:  </p> \\[ H_{pe} = 0.37\\, P\\, \\lambda_{gr} \\ln\\!\\left(\\frac{\\text{ppd}}{d_t} + 1\\right) \\] </li> </ul> </li> <li> <p>Average heat-flow rate (monthly) </p> \\[ \\dot{Q}_{avg} = H_{ss}(\\overline{T_i} - \\overline{T_e}) + Q_{per,i}(m) + Q_{per,e}(m) \\] <p>with phase shifts <code>a_tl = 0</code> (internal) and <code>b_tl = 1</code> (external).</p> </li> <li> <p>Virtual ground temperature </p> \\[ \\Theta_{gr,ve}(m) = T_{i,m} - \\frac{ \\dot{Q}_{avg}(m) - P\\,\\psi_k (\\overline{T_i} - \\overline{T_e}) }{A\\, U_{sog}} \\] </li> </ol>"},{"location":"iso_52016_virtual_ground_temperature/#outputs","title":"Outputs","text":"<p>The function returns a <code>temp_ground</code> wrapper with:</p> <ul> <li><code>R_gr_ve</code> (float, m\u00b2K/W) \u2013 virtual ground-layer thermal resistance below the floor slab.  </li> <li><code>Theta_gr_ve</code> (np.ndarray length 12, \u00b0C) \u2013 monthly virtual ground temperatures as \u201cseen\u201d by the slab.  </li> <li><code>thermal_bridge_heat</code> (float, W/K) \u2013 heat transfer coefficient due to thermal bridges along the exposed perimeter (<code>exposed_perimeter \u00d7 psi_k</code>).</li> </ul>"},{"location":"iso_52016_virtual_ground_temperature/#example","title":"Example","text":"<pre><code>tg = Temp_calculation_of_ground(\n    building_object=bui,\n    lambda_gr=2.0,\n    R_si=0.17, R_se=0.04,\n    psi_k=0.05,\n    path_weather_file=\"../weather/rome.epw\",\n)\nprint(tg.R_gr_ve)        # m\u00b2K/W\nprint(tg.Theta_gr_ve)    # array of 12 monthly temperatures (\u00b0C)\nprint(tg.thermal_bridge_heat)  # W/K\n</code></pre>"},{"location":"iso_52016_virtual_ground_temperature/#notes","title":"Notes","text":"<ul> <li>The procedure is explicitly for slab-on-ground floors and conditioned buildings (not for purely unheated spaces).  </li> <li>The floor thermal resistance is fixed to 5.3 m\u00b2K/W in the code; adjust if your model requires a different construction.  </li> <li>Monthly external temperatures are derived from <code>T2m</code> in the ISO 52010 weather pipeline; ensure your EPW/PVGIS mapping provides <code>T2m</code>.  </li> <li><code>coldest_month</code> is set to January (1); adapt for different climates if necessary.  </li> <li>The sog area is inferred using <code>sky_view_factor == 0</code> on a surface; verify this convention matches your data.  </li> </ul>"},{"location":"iso_52016_virtual_ground_temperature/#references","title":"References","text":"<ul> <li>ISO 13370:2017 \u2014 Thermal performance of buildings \u2014 Heat transfer via the ground \u2014 Calculation methods </li> <li>EN ISO 52010-1:2017 \u2014 External climatic conditions \u2014 Solar &amp; meteorological data for energy calculations</li> </ul>"},{"location":"weather_data/","title":"Weather Data","text":"<pre><code>def Weather_data_bui(cls, building_object, path_weather_file, weather_source=\"pvgis\") -&gt; simulation_df\n</code></pre>"},{"location":"weather_data/#parameters","title":"Parameters","text":"Name Type Default Description <code>building_object</code> <code>dict</code> \u2014 Building data structure used by the ISO 52010 routine for site/geometry context. <code>path_weather_file</code> <code>str | PathLike</code> \u2014 Path to the EPW file, e.g., <code>../User/documents/epw/athens.epw</code>. <code>weather_source</code> <code>str</code> <code>\"pvgis\"</code> Weather pipeline selector. Supported values: <code>\"pvgis\"</code>, <code>\"epw\"</code>. (Both branches currently call the same processor.)"},{"location":"weather_data/#purpose","title":"Purpose","text":"<p>Fetches and prepares weather time series for a building simulation by invoking an ISO 52010-compliant pre-processor and returning a small wrapper that carries the resulting <code>pandas.DataFrame</code>.</p> <p>The weather data can be retrieved in two ways:</p> <ol> <li>through the pvgis website <code>(https://joint-research-centre.ec.europa.eu/photovoltaic-geographical-information-system-pvgis_en)</code>. In this case, you only need to provide the latitude and longitude of the site to retrieve the data directly from the pvgis API</li> <li>through a file epw. The user can provide a meteo file type epw downloadable also from: <code>https://www.ladybug.tools/epwmap/</code></li> </ol>"},{"location":"weather_data/#how-it-works","title":"How it works:","text":"<ol> <li>Calls the ISO 52010 pipeline <pre><code>Calculation_ISO_52010(building_object, path_weather_file, weather_source=weather_source).sim_df\n</code></pre>    wraps the result in a <code>pandas.DataFrame</code> called <code>sim_df</code>.</li> <li>Ensures a proper time index    Casts the index to a <code>pd.DatetimeIndex</code>, so downstream code can rely on hourly timestamps.</li> <li>Returns a lightweight wrapper <pre><code>return simulation_df(simulation_df=sim_df)\n</code></pre></li> </ol>"},{"location":"weather_data/#output","title":"Output","text":"Type Description <code>simulation_df</code> Wrapper object containing <code>simulation_df=sim_df</code>, where <code>sim_df</code> is a <code>pandas.DataFrame</code> indexed by <code>DatetimeIndex</code> with the weather variables produced by the ISO 52010 workflow."},{"location":"weather_data/#typical-sim_df-columns","title":"Typical <code>sim_df</code> Columns","text":"<p>Exact columns depend on your <code>Calculation_ISO_52010</code> implementation, but commonly include:</p> <ul> <li>Dry-bulb temperature, relative humidity, wind speed</li> <li>Solar irradiance terms (e.g., direct/diffuse/global or plane-of-array)</li> <li>Sky temperature / longwave terms if modeled</li> </ul> <p>Non-weather operational drivers (occupancy, setpoints) are not constructed here; this function only prepares weather data.</p>"},{"location":"weather_data/#notes","title":"Notes","text":"<ul> <li><code>weather_source=\"pvgis\"</code> and <code>weather_source=\"epw\"</code> currently execute the same code path. Add branching logic later if you need different parsing or metadata handling.</li> <li>The index is expected to be continuous hourly. If your EPW contains gaps or DST shifts, ensure the ISO 52010 routine resolves them.</li> <li>Units follow standard EPW / ISO 52010 conventions (\u00b0C, W/m\u00b2, m/s, %). Verify if you add custom variables.</li> </ul>"},{"location":"weather_data/#example","title":"Example","text":"<pre><code>sim = Weather_data_bui(\n    building_object=my_building,\n    path_weather_file=\"../data/weather/rome.epw\",\n    weather_source=\"epw\",\n)\ndf = sim.simulation_df            # unwrap the DataFrame\nprint(df.index[:24])              # first day (hourly)\nprint(df.columns.tolist()[:8])    # peek at columns\n</code></pre>"},{"location":"weather_data/#reference","title":"Reference","text":"<ul> <li>EN ISO 52010-1 \u2013 Calculation of solar &amp; daylight quantities for building energy needs</li> <li>Project class/type: <code>simulation_df</code></li> <li>Weather preprocessing class: <code>Calculation_ISO_52010</code></li> </ul>"},{"location":"it/","title":"pybuildingenergy","text":"<p>Welcome to pybuildingenergy documentation!</p> <p>..</p>"},{"location":"it/iso_15316/","title":"Introduction to ISO 15316-1 / EN 15316-1","text":""},{"location":"it/iso_15316_heating_circuit/","title":"Heating circuit.","text":"<p>The library provides modules for evaluating 4 types of hydraulic circuits, where, based on Table C.1 of the standard, for each circuit it is identified which type of emission system to use and the type of control. as defined below: </p> Code Module Emitters Control C2 Constan mass flow rate and varying water temperature Radiators and Panels Heating curve, mixing valvew and variable generation temperature C3 Varying mass flow (constant temperature) Radiators, Panels, Heating coils Thermostatic valve, flow rate control with two way valve C4 ON-OFF and varying temperature Radiators and Panels On-Off control C5 Varying heat exchange Fan-coil, heating coils emitters with on-off blower  and continuos circulation 3 way by-pass valve control <p>All modules allow the us of a mixing valve to allow different temperatures in the different circuits. A distinction is made between:  - the emitter tmperature and flow rate; - the circuit temperature and flow rate; </p> <p>They differ where there is a mixing or by-pass 3 way valve in the circuit.</p>"},{"location":"it/iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> System Application Control Parameters Radiators Heating curve, flow/return \u0394\u03b8 Heating panel Heating curve, flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"it/iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design temperature flow return \u0394\u03b8 - nominal delta T water \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-50 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours maximum Distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"it/iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"it/iso_15316_input/","title":"INPUT_SYSTEM_HVAC \u2014 Reference &amp; Setup Guide","text":"<p>This document explains every field in the <code>INPUT_SYSTEM_HVAC</code> configuration used by the heating system model (emitter \u2192 distribution \u2192 generator). It also shows how to customize control curves and upload your own emitter tables.</p> <p>Scope: space-heating only (cooling is ignored here). All powers are thermal unless stated otherwise.</p>"},{"location":"it/iso_15316_input/#1-high-level-structure","title":"1) High-level structure","text":"<pre><code>INPUT_SYSTEM_HVAC = {\n  # Emitter (room-side heat emission)\n  \"emitter_type\": ...,\n  \"nominal_power\": ...,\n  \"emission_efficiency\": ...,\n  \"flow_temp_control_type\": ...,\n  \"selected_emm_cont_circuit\": ...,\n  \"mixing_valve\": ...,\n  # (Optional) custom emitter tables\n  # \"TB14\": ...,\n  # \"heat_emission_data\": pd.DataFrame(...),\n  \"mixing_valve_delta\": ...,\n  # \"constant_flow_temp\": ...,\n\n  # Distribution (piping, auxiliaries)\n  \"heat_losses_recovered\": ...,\n  \"distribution_loss_recovery\": ...,\n  \"simplified_approach\": ...,\n  \"distribution_aux_recovery\": ...,\n  \"distribution_aux_power\": ...,\n  \"distribution_loss_coeff\": ...,\n  \"distribution_operation_time\": ...,\n\n  # Generator (boiler/HP/plant loop)\n  \"full_load_power\": ...,\n  \"max_monthly_load_factor\": ...,\n  \"tH_gen_i_ON\": ...,\n  \"auxiliary_power_generator\": ...,\n  \"fraction_of_auxiliary_power_generator\": ...,\n  \"generator_circuit\": ...,\n\n  # Generator flow-temperature control\n  \"gen_flow_temp_control_type\": ...,\n  \"gen_outdoor_temp_data\": pd.DataFrame(...),\n\n  \"speed_control_generator_pump\": ...,\n  \"generator_nominal_deltaT\": ...,\n  \"mixing_valve_delta\": ...,\n\n  # Optional explicit generator setpoints\n  # \"\u03b8HW_gen_flw_set\": ...,\n  # \"\u03b8HW_gen_ret_set\": ...,\n\n  # Efficiency model\n  \"efficiency_model\": ...,\n\n  # Calculation options\n  \"calc_when_QH_positive_only\": ...,\n  \"off_compute_mode\": ...,\n}\n</code></pre>"},{"location":"it/iso_15316_input/#2-emitter-block-room-side-heat-delivery","title":"2) Emitter block (room-side heat delivery)","text":"Field Type Example Meaning <code>emitter_type</code> <code>str</code> <code>\"Floor heating 1\"</code> Emitter family/preset. Used to pick default emission characteristics. <code>nominal_power</code> <code>float</code> <code>8</code> Nominal emitter power (kW thermal). Used for checks and backstops in emission calc. <code>emission_efficiency</code> <code>float</code> <code>90</code> Emission efficiency in % (heat delivered to room vs heat from circuit). <code>flow_temp_control_type</code> <code>str</code> <code>\"Type 2 - Based on outdoor temperature\"</code> How the emitter flow temperature is determined. See control strategies below. <code>selected_emm_cont_circuit</code> <code>int</code> <code>0</code> Index if multiple heating zones/circuits exist (0-based). <code>mixing_valve</code> <code>bool</code> <code>True</code> If a mixing valve is present on emitter circuit (affects achievable flow temp and differential). <code>mixing_valve_delta</code> <code>float</code> <code>2</code> \u00b0C delta used when mixing valve is active (typical blending margin). <code>constant_flow_temp</code> <code>float</code> (optional) <code>42</code> Overrides control curve with a constant emitter flow setpoint (\u00b0C). Commented by default."},{"location":"it/iso_15316_input/#21-optional-custom-emitter-tables","title":"2.1 Optional custom emitter tables","text":"<p>You can override internal presets using one or both of the following:</p> <ul> <li><code>TB14</code>: a custom structure/table with manufacturer data (e.g., output vs. \u0394T, flow temperature limits). Uncomment and provide your object to replace defaults.</li> <li><code>heat_emission_data</code>: a compact <code>pandas.DataFrame</code> describing key points for the emitter control for a given circuit. Example:</li> </ul> <pre><code>heat_emission_data = pd.DataFrame({\n    \"\u03b8H_em_flw_max_sahz_i\": [45],  # Max flow temp (\u00b0C) for space-heating zone i\n    \"\u0394\u03b8H_em_w_max_sahz_i\": [8],    # Max \u0394T flow-return (K) for zone i\n    \"\u03b8H_em_ret_req_sahz_i\": [20],  # Desired return temp (\u00b0C)\n    \"\u03b2H_em_req_sahz_i\": [80],      # Desired load factor at ON/OFF (%)\n    \"\u03b8H_em_flw_min_tz_i\": [28],    # Minimum flow temp (\u00b0C) for zone i\n}, index=[\n    \"Max flow temperature HZ1\",\n    \"Max \u0394\u03b8 flow / return HZ1\",\n    \"Desired return temperature HZ1\",\n    \"Desired load factor with ON-OFF for HZ1\",\n    \"Minimum flow temperature for HZ1\"\n])\n</code></pre> <p>Tip: If both <code>TB14</code> and <code>heat_emission_data</code> are provided, clarify which one your backend prioritizes to avoid ambiguity.</p>"},{"location":"it/iso_15316_input/#3-distribution-block-piping-network-auxiliaries","title":"3) Distribution block (piping network &amp; auxiliaries)","text":"Field Type Example Meaning <code>heat_losses_recovered</code> <code>bool</code> <code>True</code> If pipe losses are partly useful to the heated space. <code>distribution_loss_recovery</code> <code>float</code> <code>90</code> % of distribution losses recovered inside the conditioned volume. <code>simplified_approach</code> <code>float</code> <code>80</code> % shortcut for simplified loss approach (e.g., rule-of-thumb recovery or reduction). <code>distribution_aux_recovery</code> <code>float</code> <code>80</code> % of auxiliary power (pumps/controls) considered as useful internal gain. <code>distribution_aux_power</code> <code>float</code> <code>30</code> Auxiliary electric power (W) of distribution. <code>distribution_loss_coeff</code> <code>float</code> <code>48</code> Global distribution loss coefficient (W/K) or equivalent scalar used by model. <code>distribution_operation_time</code> <code>float</code> <code>1</code> Fraction of time distribution is active (0..1, per-step multiplier)."},{"location":"it/iso_15316_input/#4-generator-block-plant-production-side","title":"4) Generator block (plant production side)","text":"Field Type Example Meaning <code>full_load_power</code> <code>float</code> <code>27</code> Generator thermal capacity at full load (kW). <code>max_monthly_load_factor</code> <code>float</code> <code>100</code> % cap on monthly load factor (for derating/limitations). <code>tH_gen_i_ON</code> <code>float</code> <code>1</code> Minimum ON time (h) or start-up horizon used for cycling logic. <code>auxiliary_power_generator</code> <code>float</code> <code>0</code> % or W (per model) for generator auxiliary power; used in energy balances. <code>fraction_of_auxiliary_power_generator</code> <code>float</code> <code>40</code> % of generator auxiliaries credited as internal gains. <code>generator_circuit</code> <code>str</code> <code>\"independent\"</code> Hydraulic layout: <code>\"direct\"</code> or <code>\"independent\"</code> (primary/secondary with HX)."},{"location":"it/iso_15316_input/#41-generator-flow-temperature-control","title":"4.1 Generator flow-temperature control","text":"Field Type Example Meaning <code>gen_flow_temp_control_type</code> <code>str</code> <code>\"Type A - Based on outdoor temperature\"</code> Generator flow control strategy (see \u00a75). <code>gen_outdoor_temp_data</code> <code>pd.DataFrame</code> see below Outdoor reset curve for the generator flow temperature. <code>speed_control_generator_pump</code> <code>str</code> <code>\"variable\"</code> Pump control mode: <code>\"fixed\"</code> or <code>\"variable\"</code>. <code>generator_nominal_deltaT</code> <code>float</code> <code>20</code> Nominal \u0394T (K) across the generator loop. <code>mixing_valve_delta</code> <code>float</code> <code>2</code> If a mixing valve exists on primary, blending margin (\u00b0C). <code>\u03b8HW_gen_flw_set</code> <code>float</code> (opt) <code>50</code> Override: fixed generator flow temperature (\u00b0C). <code>\u03b8HW_gen_ret_set</code> <code>float</code> (opt) <code>40</code> Override: fixed generator return temperature (\u00b0C). <p>Example: outdoor reset table</p> <pre><code>gen_outdoor_temp_data = pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],   # cold design outdoor temp (\u00b0C)\n    \"\u03b8ext_max_gen\": [15],   # warm boundary (\u00b0C)\n    \"\u03b8flw_gen_max\": [60],   # flow setpoint at \u03b8ext_min_gen (\u00b0C)\n    \"\u03b8flw_gen_min\": [35],   # flow setpoint at \u03b8ext_max_gen (\u00b0C)\n}, index=[\"Generator curve\"])\n</code></pre> <p>The controller interpolates a target flow temperature between <code>(\u03b8ext_min_gen, \u03b8flw_gen_max)</code> and <code>(\u03b8ext_max_gen, \u03b8flw_gen_min)</code>. Values are clipped outside the range.</p>"},{"location":"it/iso_15316_input/#5-control-strategies-cheat-sheet","title":"5) Control strategies (cheat sheet)","text":""},{"location":"it/iso_15316_input/#51-emitter-flow_temp_control_type","title":"5.1 Emitter <code>flow_temp_control_type</code>","text":"<p>Common patterns (implementation-dependent; typical meanings): - Type 1 \u2013 Constant setpoint: use <code>constant_flow_temp</code> (\u00b0C). - Type 2 \u2013 Based on outdoor temperature: emitter flow is computed via an outdoor reset (may reuse the generator curve or a dedicated one). - Type 3 \u2013 Room feedback: modulate flow to maintain room operative temperature; requires a PI logic in the backend. - Type 4 \u2013 Return-limited: aim for a maximum return temperature (useful in condensing systems).</p> <p>Note: Your codebase may define the exact meanings of each \"Type N\". Ensure the UI/CLI lists allowed values.</p>"},{"location":"it/iso_15316_input/#6-efficiency-model","title":"6) Efficiency model","text":"Field Allowed Notes <code>efficiency_model</code> <code>\"simple\"</code>, <code>\"map\"</code>, <code>\"manufacturer\"</code> <code>\"simple\"</code> applies fixed or curve-based efficiencies. <code>\"map\"</code> uses performance maps. <code>\"manufacturer\"</code> expects detailed tables (COP/\u03b7 vs. temp/load). <p>Backends typically compute delivered heat, electric/primary energy, and auxiliary fractions accordingly.</p>"},{"location":"it/iso_15316_input/#7-calculation-options","title":"7) Calculation options","text":"Field Type Meaning <code>calc_when_QH_positive_only</code> <code>bool</code> If <code>True</code>, run generator/distribution only when building heating need <code>Q_H &gt; 0</code>. <code>off_compute_mode</code> <code>str</code> How to treat the system when off: <code>\"full\"</code> (still compute temps/losses), <code>\"idle\"</code> (minimal), or <code>\"temps\"</code> (only temperatures)."},{"location":"it/iso_15316_input/#8-units-conventions","title":"8) Units &amp; conventions","text":"<ul> <li>Temperatures in \u00b0C, \u0394T in K (numerically the same scale).</li> <li>Powers: <code>kW</code> for generator/emitter nominal; auxiliaries commonly in W (check your backend).</li> <li>Efficiencies and fractions input as percent (0\u2013100) unless otherwise specified.</li> <li>Curves are per-circuit unless stated global.</li> <li>Time base: typically hourly steps.</li> </ul>"},{"location":"it/iso_15316_input/#9-validation-checklist","title":"9) Validation checklist","text":"<ul> <li>[ ] <code>nominal_power</code> \u2264 <code>full_load_power</code> (kW).  </li> <li>[ ] <code>emission_efficiency</code> \u2208 [0, 100].  </li> <li>[ ] <code>distribution_loss_recovery</code>, <code>distribution_aux_recovery</code> \u2208 [0, 100].  </li> <li>[ ] <code>distribution_operation_time</code> \u2208 [0, 1].  </li> <li>[ ] Outdoor reset: <code>\u03b8flw_gen_max</code> \u2265 <code>\u03b8flw_gen_min</code>, <code>\u03b8ext_min_gen</code> &lt; <code>\u03b8ext_max_gen</code>.  </li> <li>[ ] If <code>constant_flow_temp</code> is set, control type must accept constants.  </li> <li>[ ] <code>generator_circuit</code> \u2208 {<code>\"direct\"</code>, <code>\"independent\"</code>}.  </li> <li>[ ] <code>speed_control_generator_pump</code> \u2208 {<code>\"fixed\"</code>, <code>\"variable\"</code>}.</li> </ul>"},{"location":"it/iso_15316_input/#10-minimal-working-example","title":"10) Minimal working example","text":"<pre><code>INPUT_SYSTEM_HVAC = {\n  # Emitter\n  \"emitter_type\": \"Floor heating 1\",\n  \"nominal_power\": 8,                  # kW\n  \"emission_efficiency\": 90,           # %\n  \"flow_temp_control_type\": \"Type 2 - Based on outdoor temperature\",\n  \"selected_emm_cont_circuit\": 0,\n  \"mixing_valve\": True,\n  \"mixing_valve_delta\": 2,\n\n  # Distribution\n  \"heat_losses_recovered\": True,\n  \"distribution_loss_recovery\": 90,    # %\n  \"simplified_approach\": 80,           # %\n  \"distribution_aux_recovery\": 80,     # %\n  \"distribution_aux_power\": 30,        # W\n  \"distribution_loss_coeff\": 48,       # W/K (model scalar)\n  \"distribution_operation_time\": 1.0,  # 0..1\n\n  # Generator\n  \"full_load_power\": 27,               # kW\n  \"max_monthly_load_factor\": 100,      # %\n  \"tH_gen_i_ON\": 1,                    # h\n  \"auxiliary_power_generator\": 0,      # (backend-defined units)\n  \"fraction_of_auxiliary_power_generator\": 40,  # %\n  \"generator_circuit\": \"independent\",\n\n  # Generator control\n  \"gen_flow_temp_control_type\": \"Type A - Based on outdoor temperature\",\n  \"gen_outdoor_temp_data\": pd.DataFrame({\n      \"\u03b8ext_min_gen\": [-7],\n      \"\u03b8ext_max_gen\": [15],\n      \"\u03b8flw_gen_max\": [60],\n      \"\u03b8flw_gen_min\": [35],\n  }, index=[\"Generator curve\"]),\n\n  \"speed_control_generator_pump\": \"variable\",\n  \"generator_nominal_deltaT\": 20,      # K\n  \"mixing_valve_delta\": 2,\n\n  # Efficiency\n  \"efficiency_model\": \"simple\",\n\n  # Options\n  \"calc_when_QH_positive_only\": False,\n  \"off_compute_mode\": \"full\",\n}\n</code></pre>"},{"location":"it/iso_15316_input/#11-advanced-customization-tips","title":"11) Advanced customization tips","text":"<ul> <li>Multiple heating circuits: use <code>selected_emm_cont_circuit</code> to switch presets, or pass a per-circuit <code>heat_emission_data</code> table.  </li> <li>Manufacturer curves: provide detailed COP/efficiency maps via <code>efficiency_model=\"manufacturer\"</code> and custom data structures.  </li> <li>Hydraulic separation: with <code>generator_circuit=\"independent\"</code>, remember the additional HX \u0394T and any mixing valve limits.  </li> <li>Low-temperature systems: ensure <code>\u03b8flw_gen_min</code> is compatible with emitter requirements; increase surface area or lower setpoints if needed.</li> </ul>"},{"location":"it/iso_15316_input/#12-troubleshooting","title":"12) Troubleshooting","text":"<ul> <li>The system never meets setpoint: check <code>full_load_power</code> (kW) and <code>nominal_power</code> vs the building peak load. Verify flow-temp curve (too low?).  </li> <li>Return temperature too high: reduce <code>\u0394\u03b8H_em_w_max_sahz_i</code> or decrease flow temperature; consider increasing emitter area.  </li> <li>Unrealistic distribution losses: revisit <code>distribution_loss_coeff</code> and recovery factors.  </li> <li>Short cycling: increase <code>tH_gen_i_ON</code> and/or use variable-speed pumps.  </li> <li>Fixed temps ignored: ensure the selected control type actually uses <code>constant_flow_temp</code> or explicit <code>\u03b8HW_gen_*</code> setpoints.</li> </ul>"},{"location":"it/iso_15316_input/#13-glossary","title":"13) Glossary","text":"<ul> <li>Emitter: the device exchanging heat with the room (radiators, floor heating).  </li> <li>Distribution: pipes, valves, pumps between generator and emitters.  </li> <li>Generator: heat source (boiler, heat pump, plant loop).  </li> <li>Outdoor reset: a curve that sets flow temperature based on outdoor air temperature.  </li> <li>\u0394T (delta T): temperature difference (usually flow minus return).</li> </ul> <p>Prepared for integration with the ISO 15316/52016-based timeseries heating model.</p>"},{"location":"it/iso_15316_system_inputs/#system-inputs","title":"SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"it/iso_15316_system_inputs/#emitter","title":"EMITTER","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li> <p>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</p> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0"},{"location":"it/iso_15316_system_inputs/#generator","title":"GENERATOR","text":""},{"location":"it/iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <p>1) 'simple'       : linear heuristic vs. return temperature 2) 'parametric'   : piecewise/threshold model 3) 'manufacturer' : 1D (return) or 2D (flow/return) map</p> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic </p> <p>Example of input systems:  <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n}\n</code></pre></p>"},{"location":"it/iso_52010/","title":"<code>Calculation_ISO_52010(building_object, path_weather_file, weather_source=\"pvgis\")</code>","text":""},{"location":"it/iso_52010/#function-signature","title":"\ud83d\udcd8 Function Signature","text":"<pre><code>def Calculation_ISO_52010(building_object, path_weather_file, weather_source=\"pvgis\") -&gt; simdf_52010\n</code></pre>"},{"location":"it/iso_52010/#parameters","title":"\ud83d\udce5 Parameters","text":"Name Type Description <code>building_object</code> <code>dict</code> or object Building structure; if it is a mapping, a default set of orientations is used. Otherwise, the function reads <code>building_object.orientation_elements</code>. <code>path_weather_file</code> <code>str | PathLike</code> Path to an EPW weather file (used when <code>weather_source=\"epw\"</code>). <code>weather_source</code> <code>str</code> Selects the input weather pipeline. Supported values: <code>\"pvgis\"</code> (TMY fetch via PVGIS) or <code>\"epw\"</code> (local EPW)."},{"location":"it/iso_52010/#what-the-function-does-step-by-step","title":"\ud83e\udde0 What the Function Does (Step-by-step)","text":"<ol> <li>Fetch raw weather </li> <li><code>pvgis</code> \u2192 <code>ISO52010.get_tmy_data_pvgis(building_object)</code> </li> <li><code>epw</code>   \u2192 <code>ISO52010.get_tmy_data_epw(path_weather_file)</code>    The result exposes:  </li> <li><code>weather_data</code> \u2192 base <code>DataFrame</code> with hourly variables (UTC)  </li> <li><code>utc_offset</code>   \u2192 integer hours to shift from UTC to local time  </li> <li> <p><code>latitude</code>, <code>longitude</code></p> </li> <li> <p>Normalize the time index </p> </li> <li>If not a leap year (<code>len(sim_df) == 8760</code>), rebuild index to a nominal year 2009 using original month/day/hour.</li> <li>Apply <code>np.roll</code> by <code>utc_offset</code> to every column to align to local time.  </li> <li> <p>Rename index axis from <code>time(UTC)</code> \u2192 <code>time(local)</code> and add helpers:  </p> <ul> <li><code>day of year</code> (1\u2013365/366)  </li> <li><code>hour of day</code> (1\u201324, ISO52010 convention)</li> </ul> </li> <li> <p>Define surface orientations (tilt/azimuth pairs) <pre><code>HOR \u2192 (beta=0,   gamma=0)\nSV  \u2192 (beta=90,  gamma=0)\nEV  \u2192 (beta=90,  gamma=90)\nNV  \u2192 (beta=90,  gamma=180)\nWV  \u2192 (beta=90,  gamma=-90)\n</code></pre>    If <code>building_object</code> is a dict, the set <code>{'EV','HOR','SV','NV','WV'}</code> is used; otherwise <code>building_object.orientation_elements</code> is read.</p> </li> <li> <p>For each orientation </p> </li> <li>Call <code>ISO52010.Solar_irradiance_calculation(...)</code> with: latitude, longitude, timezone, the selected (beta, gamma), input DHI (<code>Gd(h)</code>), DNI (<code>Gb(n)</code>), albedo, and a calendar built from the index.  </li> <li>Concatenate resulting columns (renamed):  <ul> <li><code>I_sol_tot_{ori}</code>, <code>I_sol_dif_{ori}</code>, <code>I_sol_dir_w_{ori}</code> </li> </ul> </li> <li> <p>Compute window shading reduction factor with <code>ISO52010.Shading_reduction_factor_window(...)</code> and append its columns if present.</p> </li> <li> <p>Warm-up period    Prepend December to the beginning of the series to form a warm-up period: <pre><code>sim_df = pd.concat([sim_df[sim_df.index.month == 12], sim_df])\n</code></pre></p> </li> <li> <p>Return wrapper <pre><code>return simdf_52010(sim_df=sim_df)\n</code></pre></p> </li> </ol>"},{"location":"it/iso_52010/#returns","title":"\ud83d\udce4 Returns","text":"Type Description <code>simdf_52010</code> Small wrapper carrying <code>sim_df: pd.DataFrame</code> with weather (local time), solar irradiances by orientation, shading factors, and utility calendar columns."},{"location":"it/iso_52010/#columns-added-by-the-procedure","title":"\ud83e\uddfe Columns Added by the Procedure","text":"<ul> <li>Calendar helpers: <code>day of year</code>, <code>hour of day</code> (1\u201324)  </li> <li>Solar (per orientation):  </li> <li><code>I_sol_tot_{ORI}</code> \u2192 total solar irradiance on the plane (W/m\u00b2)  </li> <li><code>I_sol_dif_{ORI}</code> \u2192 diffuse component on the plane (W/m\u00b2)  </li> <li><code>I_sol_dir_w_{ORI}</code> \u2192 direct beam on the plane adjusted by window incidence (W/m\u00b2)  </li> <li>Shading (when available): one or more <code>W_{window_name}</code> and <code>H_sun_{window_name}</code> series from <code>Shading_reduction_factor_window</code></li> </ul> <p>The base weather columns depend on the chosen source but typically include dry-bulb temperature, relative humidity, wind speed, DHI = <code>Gd(h)</code>, DNI = <code>Gb(n)</code>, and global horizontal.</p>"},{"location":"it/iso_52010/#orientation-angles","title":"\ud83d\udcd0 Orientation &amp; Angles","text":"<ul> <li><code>beta</code> = tilt (0\u00b0 = horizontal, 90\u00b0 = vertical)  </li> <li><code>gamma</code> = azimuth (0\u00b0 = South, 90\u00b0 = East, 180\u00b0 = North, -90\u00b0/270\u00b0 = West)  </li> <li>Time index is local after the <code>utc_offset</code> roll.</li> </ul>"},{"location":"it/iso_52010/#notes-assumptions","title":"\u26a0\ufe0f Notes &amp; Assumptions","text":"<ul> <li>Leap year handling: if <code>len(sim_df) &gt; 8760</code> (8784 hours), the index is left as-is and <code>n_days_year=366</code>.  </li> <li><code>np.roll</code> shifts all columns equally; ensure the source weather data are aligned and cyclical.  </li> <li>The warm-up prepend duplicates December; if you perform annual KPIs, exclude the first month accordingly.  </li> <li><code>Shading_reduction_factor_window</code> requires geometric window metadata inside <code>building_object</code>.</li> </ul>"},{"location":"it/iso_52010/#example","title":"\ud83e\uddea Example","text":"<pre><code>sim = Calculation_ISO_52010(\n    building_object=my_building,\n    path_weather_file=\"../weather/rome.epw\",\n    weather_source=\"epw\"\n)\ndf = sim.sim_df\nprint(df.filter(like=\"I_sol_tot_\").head())\n</code></pre>"},{"location":"it/iso_52010/#related","title":"\ud83d\udcda Related","text":"<ul> <li>EN ISO 52010-1:2017 \u2013 Energy performance of buildings \u2014 External climatic conditions </li> <li><code>Weather_data_bui</code> \u2013 convenience wrapper that returns a <code>simulation_df</code> built on top of this pipeline  </li> <li><code>ISO52010.Solar_irradiance_calculation</code> \u2013 solar geometry &amp; plane-of-array irradiance  </li> <li><code>ISO52010.Shading_reduction_factor_window</code> \u2013 window shading factors per orientation</li> </ul>"},{"location":"it/iso_52016_adj_zone/","title":"Adjacent zone","text":"<p>The <code>adj_zone</code> dictionary provides all necessary geometric and physical properties of an adjacent unconditioned zone (e.g., attic, basement, or corridor) required to compute the transmission heat transfer coefficient according to ISO 13789.</p>"},{"location":"it/iso_52016_adj_zone/#transmission_heat_transfer_coefficient_iso13789adj_zone-n_ue05-qui0","title":"<code>transmission_heat_transfer_coefficient_ISO13789(adj_zone, n_ue=0.5, qui=0)</code>","text":""},{"location":"it/iso_52016_adj_zone/#function-signature","title":"Function Signature","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(cls, adj_zone, n_ue=0.5, qui=0)\n</code></pre>"},{"location":"it/iso_52016_adj_zone/#parameters","title":"Parameters","text":"Name Type Description <code>adj_zone</code> <code>dict</code> Dictionary containing the geometric and physical properties of the adjacent (unconditioned) zone. Must include surface orientations, areas, U-values, and volume. <code>n_ue</code> <code>float</code>, default <code>0.5</code> Air change rate (h\u207b\u00b9) between the unconditioned zone and the external environment. <code>qui</code> <code>float</code>, default <code>0</code> Airflow rate (m\u00b3/h) between conditioned and unconditioned zones. Typically zero to avoid underestimating transmission."},{"location":"it/iso_52016_adj_zone/#returns","title":"Returns","text":"Variable Type Description <code>H_ztu_tot</code> <code>float</code> Total transmission heat transfer coefficient between the conditioned zone and the adjacent unconditioned zone (W/K). <code>b_ztu_m</code> <code>float</code> Monthly adjustment factor for the unconditioned adjacent zone (dimensionless). <code>F_ztc_ztu_m</code> <code>float</code> Distribution factor of the transmission coefficient between conditioned and unconditioned zones (dimensionless)."},{"location":"it/iso_52016_adj_zone/#physical-background","title":"Physical Background","text":"<p>The total heat transfer coefficient <code>H_tr</code> is computed as:</p> \\[ H_{tr} = H_d + H_g + H_u + H_a \\] <p>Where: - H_d: Transmission through external envelope (W/K) - H_g: Transmission through ground (W/K) - H_u: Transmission through unconditioned zones (W/K) - H_a: Transmission to adjacent buildings (W/K)  </p> <p>In this function, we focus on the unconditioned zone contribution (<code>H_u</code>).</p>"},{"location":"it/iso_52016_adj_zone/#step-by-step-algorithm","title":"\ud83d\udd22 Step-by-Step Algorithm","text":""},{"location":"it/iso_52016_adj_zone/#1-identify-orientation","title":"1\ufe0f\u20e3 Identify Orientation","text":"<p>The function uses the azimuth of the adjacent zone (<code>adj_zone[\"orientation_zone\"][\"azimuth\"]</code>) to map it to an orientation name (<code>NV</code>, <code>SV</code>, <code>EV</code>, <code>WV</code>) based on predefined azimuth angles:</p> Orientation Azimuth (\u00b0) NV 180 SV 0 EV 90 WV 270"},{"location":"it/iso_52016_adj_zone/#2-extract-arrays","title":"2\ufe0f\u20e3 Extract Arrays","text":"<p>From the <code>adj_zone</code> dictionary: - <code>areas</code>: surface areas (m\u00b2) - <code>U_values</code>: transmittances (W/m\u00b2K) - <code>orientations</code>: list of orientation strings for each facade element</p>"},{"location":"it/iso_52016_adj_zone/#3-boolean-masks","title":"3\ufe0f\u20e3 Boolean Masks","text":"<p>Two masks are defined to separate: - <code>mask_selected</code>: surfaces facing the unconditioned zone - <code>mask_others</code>: other external surfaces</p>"},{"location":"it/iso_52016_adj_zone/#4-transmission-losses","title":"4\ufe0f\u20e3 Transmission Losses","text":"<ul> <li>Between conditioned and unconditioned zones:   [ H_{d,zt-ztu} = \\sum (A_i \\cdot U_i) \\text{ for selected orientation} ]</li> <li>From unconditioned zone to exterior:   [ H_{d,ztu-ext} = \\sum (A_i \\cdot U_i) \\text{ for other orientations} ]</li> </ul>"},{"location":"it/iso_52016_adj_zone/#5-ventilation-losses","title":"5\ufe0f\u20e3 Ventilation Losses","text":"<p>Ventilation heat transfer coefficients are added according to ISO 13789:</p> <p>[ H_{ve,iu} = 0.33 \\times q_{iu} ] [ H_{ve,ue} = 0.33 \\times q_{ue} ]</p> <p>Where: - <code>\u03c1\u00b7cp = 0.33 Wh/(m\u00b3\u00b7K)</code> for air - <code>q_iu</code>: airflow between conditioned and unconditioned zones (m\u00b3/h) - <code>q_ue = V_u \u00d7 n_ue</code>: airflow between unconditioned zone and exterior</p>"},{"location":"it/iso_52016_adj_zone/#6-total-heat-transfer","title":"6\ufe0f\u20e3 Total Heat Transfer","text":"\\[ H_{ue} = H_{d,ztu-ext} + H_{ve,ue} \\\\ H_{iu} = H_{d,zt-ztu} + H_{ve,iu} \\] \\[ H_{ztu,tot} = H_{ue} + H_{iu} \\]"},{"location":"it/iso_52016_adj_zone/#7-adjustment-factor-bztum","title":"7\ufe0f\u20e3 Adjustment Factor (b\u208dztu\u208e\u2098)","text":"<p>The adjustment factor accounts for the ratio between losses to the exterior and total losses of the unconditioned zone:</p> \\[ b_{ztu,m} = \\frac{H_{ue}}{H_{ue} + H_{iu}} \\]"},{"location":"it/iso_52016_adj_zone/#8-distribution-factor-fztcm","title":"8\ufe0f\u20e3 Distribution Factor (F\u208dztc\u208e\u2098)","text":"<p>If multiple conditioned zones exist, the distribution factor allocates transmission between them:</p> \\[ F_{ztc,ztu,m} = \\frac{H_{ztc,i,ztu,m}}{\\sum_j H_{ztc,j,ztu,m}} \\] <p>Here it is set to <code>1.0</code> since only one conditioned zone is assumed.</p>"},{"location":"it/iso_52016_adj_zone/#example-output","title":"\u2705 Example Output","text":"<pre><code>H_ztu_tot = 78.45  # W/K\nb_ztu_m = 0.63\nF_ztc_ztu_m = 1.0\n</code></pre>"},{"location":"it/iso_52016_adj_zone/#notes_1","title":"\ud83e\udde9 Notes","text":"<ul> <li><code>H_ztu_tot</code> increases with larger areas, higher U-values, or greater ventilation exchange.  </li> <li>Default <code>n_ue = 0.5</code> corresponds to \u201cwell-sealed joints, no ventilation openings\u201d (ISO 13789 Table 7).  </li> <li>The function currently handles one conditioned zone; for multiple zones, extend the <code>F_ztc_ztu_m</code> calculation.</li> </ul>"},{"location":"it/iso_52016_adj_zone/#references","title":"References","text":"<ul> <li>ISO 13789:2017 \u2013 Thermal performance of buildings \u2013 Transmission and ventilation heat transfer coefficients \u2013 Calculation method </li> </ul>"},{"location":"it/iso_52016_aeral_heat_capacity/","title":"Aeral Heat capacity","text":""},{"location":"it/iso_52016_aeral_heat_capacity/#function","title":"Function:","text":"<p><code>Areal_heat_capacity_of_element(building_object)</code></p>"},{"location":"it/iso_52016_aeral_heat_capacity/#purpose","title":"Purpose","text":"<p>Computes the areal heat capacity allocation per node for each building envelope element according to EN ISO 52016-1 (6.5.7) and Annex B tables (e.g., B.13 classes and B.14 capacities). The routine returns a 5\u00d7N matrix <code>kappa_pli_eli_</code> where: - rows (0..4) correspond to nodes <code>kpl1..kpl5</code> (external \u2192 internal or per the chosen nodal scheme), - columns (0..N-1) correspond to envelope elements, - entries hold the areal heat capacity assigned to each node/element.</p> <p>The node distribution depends on the construction mass class (<code>class_i</code>, <code>class_e</code>, <code>class_ie</code>, <code>class_d</code>, <code>class_m</code>).</p>"},{"location":"it/iso_52016_aeral_heat_capacity/#function-signature","title":"Function Signature","text":"<pre><code>def Areal_heat_capacity_of_element(cls, building_object) -&gt; aeral_heat_capacity\n</code></pre>"},{"location":"it/iso_52016_aeral_heat_capacity/#required-fields","title":"Required Fields","text":"<p>On each surface in <code>building_surface</code>: - <code>ISO52016_type_string</code> \u2014 element type: <code>\"OP\"</code> (opaque), <code>\"W\"</code> (transparent), <code>\"GR\"</code> (ground-contact), <code>\"ADJ\"</code> (adjacent opaque). - <code>thermal_capacity</code> \u2014 areal heat capacity (e.g., from ISO 52016 Table B.14).</p> <p>On the building object: - <code>building.construction_class</code> \u2014 construction mass class from ISO 52016 Table B.13:   - <code>class_i</code>, <code>class_e</code>, <code>class_ie</code>, <code>class_d</code>, <code>class_m</code>.</p>"},{"location":"it/iso_52016_aeral_heat_capacity/#returns","title":"Returns","text":"Type Contents <code>aeral_heat_capacity</code> Wrapper carrying <code>kappa_pli_eli</code> (shape 5 \u00d7 N). Each column is an element; rows are nodes <code>kpl1..kpl5</code>."},{"location":"it/iso_52016_aeral_heat_capacity/#method-outline","title":"Method Outline","text":"<ol> <li> <p>Collect element types and capacities </p> </li> <li> <p>Build <code>el_type</code> from <code>surface[\"ISO52016_type_string\"]</code>.  </p> </li> <li> <p>Build <code>list_kappa_el</code> from <code>surface[\"thermal_capacity\"]</code> (default 0 if missing).</p> </li> <li> <p>Initialize matrix </p> </li> </ol> <pre><code>kappa_pli_eli_ : (5 \u00d7 N) zeros\nrows 0..4 \u2192 nodes kpl1..kpl5\ncols 0..N \u2192 elements\n</code></pre> <ol> <li>Distribute areal heat capacity by construction class (ISO 52016 Table B.13)</li> </ol> <p>#### <code>class_i</code> \u2014 mass concentrated at internal side</p> <ul> <li>Opaque/Adjacent (<code>OP</code>, <code>ADJ</code>): <code>kpl5 = km_eli</code> (node 4); others 0.  </li> <li>Ground (<code>GR</code>): <code>kpl5 = 1e6</code> (treated as very large capacity placeholder); <code>kpl3=kpl4=0</code>.</li> </ul> <p>#### <code>class_e</code> \u2014 mass concentrated at external side    - Opaque/Adjacent: <code>kpl1 = km_eli</code> (node 0).    - Ground: <code>kpl3 = km_eli</code> (node 2).</p> <p>#### <code>class_ie</code> \u2014 mass split internal/external    - Opaque/Adjacent: <code>kpl1 = km_eli/2</code> and <code>kpl5 = km_eli/2</code>.    - Ground: <code>kpl1 = km_eli/2</code> and <code>kpl5 = km_eli/2</code>.</p> <p>#### <code>class_d</code> \u2014 mass equally distributed    - Opaque/Adjacent: <code>kpl2 = kpl3 = kpl4 = km_eli/4</code> (nodes 1,2,3) and <code>kpl1 = kpl5 = km_eli/8</code> (nodes 0,4).    - Ground: <code>kpl3 = km_eli/4</code> (node 2) and <code>kpl4 = km_eli/2</code> (node 3); <code>kpl5 = km_eli/4</code> (node 4).</p> <p>#### <code>class_m</code> \u2014 mass concentrated mid-layer    - Opaque/Adjacent: <code>kpl3 = km_eli</code> (node 2).    - Ground: <code>kpl4 = km_eli</code> (node 3).</p> <ol> <li>Return value    Wrap <code>kappa_pli_eli_</code> in <code>aeral_heat_capacity(kappa_pli_eli=...)</code>.</li> </ol>"},{"location":"it/iso_52016_aeral_heat_capacity/#node-indexing","title":"\ud83d\udcd0 Node Indexing","text":"<p>The implementation uses a 5-node scheme (rows 0..4 \u2192 <code>kpl1..kpl5</code>). The physical mapping (external\u2194internal) should match your solver\u2019s convention. This function follows the same node positions as used elsewhere in your ISO 52016 implementation.</p>"},{"location":"it/iso_52016_aeral_heat_capacity/#example-pseudo","title":"\ud83e\uddea Example (pseudo)","text":"<pre><code>cap = Areal_heat_capacity_of_element(building_object=bui)\n\nM = cap.kappa_pli_eli  # shape 5 \u00d7 N\nprint(M.shape)         # e.g., (5, 12) for 12 elements\nprint(M[:, 0])         # node-wise capacities of the first element\n</code></pre>"},{"location":"it/iso_52016_aeral_heat_capacity/#notes","title":"\ud83e\udde9 Notes","text":"<ul> <li>Transparent elements (<code>\"W\"</code>) are excluded from mass allocation in several classes (as per code).  </li> <li>The ground element (<code>\"GR\"</code>) receives special handling: very large capacity in <code>class_i</code>, and specific node allocations in other classes.  </li> <li>If a surface lacks <code>thermal_capacity</code>, the corresponding entries remain 0. Provide values consistent with ISO 52016 Annex B tables.  </li> <li>Returned units follow your input <code>thermal_capacity</code> convention (often J/(m\u00b2\u00b7K) in standards; the original docstring mentions W/(m\u00b2\u00b7K) \u2014 ensure consistency across the toolchain).</li> </ul>"},{"location":"it/iso_52016_aeral_heat_capacity/#references","title":"\ud83d\udcda References","text":"<ul> <li>EN ISO 52016-1 \u2014 Energy performance of buildings \u2014 Calculation of energy needs for heating and cooling.  </li> <li>\u00a76.5.7 (nodal method), Annex B (Tables B.13 construction classes, B.14 areal heat capacities).</li> </ul>"},{"location":"it/iso_52016_aggregate_surface/","title":"<code>_aggregate_surfaces_by_direction(building_object)</code>","text":""},{"location":"it/iso_52016_aggregate_surface/#purpose","title":"Purpose","text":"<p>This function aggregates (merges) multiple building surfaces that share the same orientation and ISO 52016 surface type into a single, equivalent surface. The goal is to simplify the building model so that heat transmission and solar radiation terms can be computed on aggregated surfaces instead of on many small, redundant ones.</p>"},{"location":"it/iso_52016_aggregate_surface/#function-signature","title":"\ud83d\udcd8 Function Signature","text":"<pre><code>def _aggregate_surfaces_by_direction(cls, building_object)\n</code></pre>"},{"location":"it/iso_52016_aggregate_surface/#parameters","title":"\ud83d\udce5 Parameters","text":"Name Type Description <code>building_object</code> <code>dict</code> A dictionary-like building model that must contain a key <code>\"building_surface\"</code>, which is a list of surface definitions. Each surface should include ISO 52016 descriptors and physical properties (e.g., area, U-value, absorptance, etc.)."},{"location":"it/iso_52016_aggregate_surface/#returns","title":"\ud83d\udce4 Returns","text":"Type Description <code>dict</code> A shallow copy of the input <code>building_object</code>, where <code>building_surface</code> has been replaced with a reduced list of aggregated surfaces."},{"location":"it/iso_52016_aggregate_surface/#how-it-works","title":"\u2699\ufe0f How It Works","text":"<ol> <li>Grouping (bucketing):    Surfaces are grouped by:</li> <li><code>ISO52016_type_string</code> (e.g., opaque wall, transparent window, etc.)</li> <li><code>ISO52016_orientation_string</code> (e.g., N, S, E, W, HOR)</li> <li><code>type</code> (transparent/opaque)</li> </ol> <p>\u2192 These three attributes form the aggregation key.</p> <ol> <li>Aggregation Rules:</li> <li>Additive fields: <ul> <li><code>area</code> </li> <li><code>thermal_capacity</code></li> </ul> </li> <li>Area-weighted average fields: <ul> <li><code>u_value</code> </li> <li><code>g_value</code> (only for transparent surfaces)  </li> <li><code>sky_view_factor</code> </li> <li><code>solar_absorptance</code> </li> <li><code>convective</code> and <code>radiative</code> heat transfer coefficients (internal and external)</li> </ul> </li> <li> <p>Name field:      The new aggregated surface name concatenates all original names (trimmed to 120 characters).</p> </li> <li> <p>Orientation Handling:    A simplified numeric orientation is reattached to each aggregated surface:</p> </li> <li>Default: <code>{azimuth: 0, tilt: 90}</code> (vertical)</li> <li> <p>If <code>ISO52016_orientation_string == \"HOR\"</code> \u2192 <code>{azimuth: 0, tilt: 0}</code> (horizontal)</p> </li> <li> <p>Output:    The method builds a new list of surfaces where each element represents one equivalent aggregated surface per direction and type.</p> </li> </ol>"},{"location":"it/iso_52016_aggregate_surface/#aggregation-example","title":"\ud83e\uddee Aggregation Example","text":"<p>If the input building object contains three south-facing opaque walls:</p> Surface Name Type ISO52016 Type Orientation Area (m\u00b2) U-Value (W/m\u00b2K) Wall_1 opaque Wall SV 10 0.30 Wall_2 opaque Wall SV 15 0.25 Wall_3 opaque Wall SV 5 0.40 <p>After aggregation, the function returns one equivalent surface:</p> New Name Type Orientation Area (m\u00b2) U-Value (W/m\u00b2K) Wall_1 + Wall_2 + Wall_3 opaque SV 30 0.30 <p>where the U-value is computed as [ U_{agg} = \\frac{\\sum (U_i \\times A_i)}{\\sum A_i} ]</p>"},{"location":"it/iso_52016_aggregate_surface/#advantages","title":"\u2705 Advantages","text":"<ul> <li>Reduces model complexity for ISO 52016 energy balance computations.</li> <li>Speeds up simulation and simplifies reporting.</li> <li>Avoids double-counting of identical surfaces.</li> <li>Ensures consistent area-weighted physical properties.</li> </ul>"},{"location":"it/iso_52016_aggregate_surface/#limitations","title":"\u26a0\ufe0f Limitations","text":"<ul> <li>Works only for dictionary-style <code>building_object</code>.  </li> <li>Requires each surface to contain both:</li> <li><code>ISO52016_type_string</code></li> <li><code>ISO52016_orientation_string</code></li> <li>Orientation azimuth/tilt are currently placeholders, not exact averages.</li> <li>Does not yet support sub-zonal aggregation (e.g., multiple zones).</li> </ul>"},{"location":"it/iso_52016_aggregate_surface/#example-usage","title":"\ud83d\udcc2 Example Usage","text":"<pre><code>aggregated_building = BuildingProcessor._aggregate_surfaces_by_direction(building_object)\n\nfor surf in aggregated_building[\"building_surface\"]:\n    print(f\"{surf['ISO52016_orientation_string']} | {surf['type']} | Area = {surf['area']:.1f} m\u00b2 | U = {surf['u_value']:.2f}\")\n</code></pre> <p>Example output: <pre><code>SV | opaque      | Area = 30.0 m\u00b2 | U = 0.30\nNV | transparent | Area = 12.0 m\u00b2 | U = 1.10\nHOR | opaque     | Area = 20.0 m\u00b2 | U = 0.15\n</code></pre></p>"},{"location":"it/iso_52016_aggregate_surface/#key-takeaways","title":"\ud83e\udde9 Key Takeaways","text":"<ul> <li>Aggregates surfaces sharing type + ISO orientation.</li> <li>Uses area-weighted averages for intensive properties.</li> <li>Returns a clean, compact list of equivalent surfaces for simplified energy balance calculations.</li> </ul>"},{"location":"it/iso_52016_categorty_profile/#function-generate_category_profile","title":"Function: <code>generate_category_profile()</code>","text":""},{"location":"it/iso_52016_categorty_profile/#context","title":"Context","text":"<p>In building energy simulations \u2014 especially those following ISO 52016-1:2017 (Energy needs for heating and cooling, internal temperatures, and loads) or the broader EPB (Energy Performance of Buildings) framework \u2014 each thermal zone requires hourly profiles for occupancy, lighting, appliances, ventilation, heating, and cooling.  </p> <p>These profiles describe the temporal behavior of internal gains and system operation (e.g., when people are present, when lights are on, or when HVAC is active). This function automates the generation of such profiles by merging custom schedules (if defined within a building object) with default type-based schedules, ensuring every category has a valid 24-hour pattern.</p> <p>The default type-based schedules are define in the file: <code>table_iso_16798_1.py</code>, where typical profile are getting from the EN ISO 16798-1 standard.</p>"},{"location":"it/iso_52016_categorty_profile/#purpose","title":"Purpose","text":"<p><code>generate_category_profile()</code> builds a consistent set of hourly category profiles (weekday/weekend) for: - Occupancy - Appliances - Lighting - Ventilation - Heating - Cooling  </p> <p>It ensures that all schedules are properly defined, validated, and ready for use in energy balance, comfort, or control simulations.</p>"},{"location":"it/iso_52016_categorty_profile/#function-signature","title":"Function signature","text":"<pre><code>generate_category_profile(\n    cls,\n    building_object,\n    occupants_schedule_workdays,\n    occupants_schedule_weekend,\n    appliances_schedule_workdays,\n    appliances_schedule_weekend,\n    lighting_schedule_workdays,\n    lighting_schedule_weekend,\n)\n</code></pre>"},{"location":"it/iso_52016_categorty_profile/#how-it-works","title":"How it works","text":"<ol> <li> <p>Identify building type    Extracts the <code>building_type_class</code> from the input object to determine which default schedules to use.</p> </li> <li> <p>Load or fallback for each category </p> </li> <li>For occupants, appliances, and lighting:      If custom 24-hour profiles exist in <code>building_object[\"building_parameters\"][\"internal_gains\"]</code>, they are used directly.      Otherwise, defaults are taken from the provided schedule dictionaries.</li> <li> <p>For ventilation, heating, and cooling:      If no profiles are defined in the building object, they inherit the occupancy schedule as a fallback.</p> </li> <li> <p>Validation    Ensures that every schedule contains exactly 24 hourly values (one per hour of the day).</p> </li> <li> <p>Output assembly    Returns all category profiles in a structured dictionary format.</p> </li> </ol>"},{"location":"it/iso_52016_categorty_profile/#returned-structure","title":"Returned structure","text":"<pre><code>{\n    \"ventilation\": {\"weekday\": array(24), \"holiday\": array(24)},\n    \"heating\":     {\"weekday\": array(24), \"holiday\": array(24)},\n    \"cooling\":     {\"weekday\": array(24), \"holiday\": array(24)},\n    \"occupancy\":   {\"weekday\": array(24), \"holiday\": array(24)},\n    \"lighting\":    {\"weekday\": array(24), \"holiday\": array(24)},\n    \"appliances\":  {\"weekday\": array(24), \"holiday\": array(24)},\n}\n</code></pre> <p>Each category contains 24 hourly fractions for weekdays and weekends (holidays), typically in the range 0\u20131 or as relative intensity values.</p>"},{"location":"it/iso_52016_categorty_profile/#parameters","title":"Parameters","text":"Parameter Type Description <code>building_object</code> <code>dict</code> Building model containing <code>building_type_class</code> and optional internal gain profiles. <code>occupants_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly occupancy profiles (24 values each). <code>appliances_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly appliance profiles. <code>lighting_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly lighting profiles."},{"location":"it/iso_52016_categorty_profile/#returns","title":"Returns","text":"<p><code>dict</code> \u2014 A complete set of hourly category profiles for use in thermal simulations, HVAC control logic, or internal gain estimation.</p>"},{"location":"it/iso_52016_categorty_profile/#notes","title":"Notes","text":"<ul> <li>All profiles must contain exactly 24 numeric values.  </li> <li>Missing ventilation, heating, or cooling profiles automatically default to the occupancy profile.  </li> <li>Designed for integration with ISO 52016-1-based or EPB-based building energy models.  </li> <li>Works as a preprocessing step to ensure that all internal gain and system schedules are complete and consistent before running the energy balance.</li> </ul>"},{"location":"it/iso_52016_categorty_profile/#integration-example","title":"Integration Example","text":"<p>This function is typically used in the preprocessing pipeline before running a dynamic energy simulation: 1. Import building geometry, envelope, and system parameters. 2. Generate category profiles using <code>generate_category_profile()</code>. 3. Feed the resulting hourly profiles into a thermal or energy balance model. 4. Compute heating/cooling needs and comfort metrics following ISO 52016-1.</p>"},{"location":"it/iso_52016_input_check/","title":"Validate inputs","text":"<p>The inputs need to have a certain format to be used for the simulation.  Hereunder the list of the checks and validations applied to the inputs:</p>"},{"location":"it/iso_52016_input_check/#_1","title":"Quality check","text":""},{"location":"it/iso_52016_node/","title":"Node of building element","text":"<p>The following two functions calculates the number of nodes to be used in opaque and transparent elements in the 5-node thermal network model.</p>"},{"location":"it/iso_52016_node/#function-number_of_nodes_elementbuilding_object","title":"Function: <code>Number_of_nodes_element(building_object)</code>","text":""},{"location":"it/iso_52016_node/#function-signature","title":"Function Signature","text":"<pre><code>def Number_of_nodes_element(cls, building_object) -&gt; numb_nodes_facade_elements\n</code></pre>"},{"location":"it/iso_52016_node/#returns","title":"Returns","text":"Variable Type Description <code>Rn</code> <code>int</code> Index of the last node in the complete nodal vector. Used for vector and matrix sizing. <code>Pln</code> <code>np.ndarray[int]</code> Array of the number of nodes per element: 5 for opaque, 2 for transparent, 0 for adiabatic. <code>PlnSum</code> <code>np.ndarray[int]</code> Sequential cumulative node indices for mapping all elements. <code>numb_nodes_facade_elements</code> <code>object</code> Wrapper containing <code>(Rn, Pln, PlnSum)</code>."},{"location":"it/iso_52016_node/#method-overview","title":"Method Overview","text":"<ol> <li>Initialize all elements as 5-node systems</li> </ol> <p><pre><code>el_list = len(building_object[\"building_surface\"])\nPln = np.full(el_list, 5)\n</code></pre>    ISO 52016 default: each opaque surface is modeled with 5 thermal nodes.</p> <ol> <li> <p>Adjust per element type</p> </li> <li> <p>Transparent (<code>\"transparent\"</code>) \u2192 2 nodes (external/internal surfaces only).  </p> </li> <li>Adiabatic (<code>\"adiabatic\"</code>) \u2192 0 nodes (no heat transfer).</li> </ol> <pre><code>for i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"transparent\":\n        Pln[i] = 2\n    elif surf[\"type\"] == \"adiabatic\":\n        Pln[i] = 0\n</code></pre> <ol> <li>Compute cumulative node index (<code>PlnSum</code>)</li> </ol> <p><pre><code>for Eli in range(1, el_list):\n    PlnSum[Eli] = PlnSum[Eli-1] + Pln[Eli-1]\n</code></pre>    Each element\u2019s node sequence starts where the previous one ends.</p> <ol> <li>Compute the last node index (<code>Rn</code>)</li> </ol> <p><pre><code>Rn = PlnSum[-1] + Pln[-1] + 1\n</code></pre>    Adds one final node for matrix dimensioning in the solver.</p> <ol> <li>Return wrapper</li> </ol> <pre><code>return numb_nodes_facade_elements(Rn, Pln, PlnSum)\n</code></pre>"},{"location":"it/iso_52016_node/#example","title":"Example","text":"<p><pre><code>building_object = {\n    \"building_surface\": [\n        {\"type\": \"opaque\"},\n        {\"type\": \"transparent\"},\n        {\"type\": \"opaque\"},\n        {\"type\": \"adiabatic\"}\n    ]\n}\n\nnodes = Number_of_nodes_element(building_object)\nprint(\"Rn:\", nodes.Rn)\nprint(\"Pln:\", nodes.Pln)\nprint(\"PlnSum:\", nodes.PlnSum)\n</code></pre> Output: <pre><code>Rn: 13\nPln: [5 2 5 0]\nPlnSum: [0 5 7 12]\n</code></pre></p>"},{"location":"it/iso_52016_node/#function","title":"Function:","text":"<p><code>Conduttance_node_of_element(building_object, lambda_gr=2.0)</code></p>"},{"location":"it/iso_52016_node/#function-signature_1","title":"Function Signature","text":"<pre><code>def Conduttance_node_of_element(cls, building_object, lambda_gr=2.0) -&gt; conduttance_elements\n</code></pre>"},{"location":"it/iso_52016_node/#required-fields-in-building_objectbuilding_surface_1","title":"Required Fields in <code>building_object[\"building_surface\"]</code>","text":"<p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre> <p>Each surface element must include:</p> Field Description <code>ISO52016_type_string</code> ISO 52016 element type string: \u2022 <code>OP</code> = Opaque element \u2022 <code>W</code> = Transparent (window) \u2022 <code>GR</code> = Ground-contact \u2022 <code>AD</code> or <code>ADJ</code> = Adjacent wall <code>u_value</code> Overall thermal transmittance (W/m\u00b2\u00b7K). <code>convective_heat_transfer_coefficient_internal</code> Internal convective heat transfer coefficient (W/m\u00b2\u00b7K). <code>radiative_heat_transfer_coefficient_internal</code> Internal radiative heat transfer coefficient (W/m\u00b2\u00b7K). <code>area</code> Element surface area (m\u00b2). (optional) <code>convective_heat_transfer_coefficient_external</code> If not defined, default = 20 W/m\u00b2\u00b7K (ISO 13789). (optional) <code>radiative_heat_transfer_coefficient_external</code> If not defined, default = 4.14 W/m\u00b2\u00b7K (ISO 13789)."},{"location":"it/iso_52016_node/#returns_1","title":"Returns","text":"Type Description <code>conduttance_elements</code> Wrapper object containing the matrix <code>h_pli_eli</code> (4\u00d7N) where N = number of envelope elements. Each row corresponds to a node pair (<code>pli</code>, <code>pli\u22121</code>) and each column to an element. Units: W/m\u00b2\u00b7K."},{"location":"it/iso_52016_node/#method-overview_1","title":"Method Overview","text":"<ol> <li> <p>Initialize constants and arrays</p> <ul> <li>Ground resistance:  </li> </ul> \\[ R_{gr} = \\frac{0.5}{\\lambda_{gr}} \\;(\\text{m}^2K/W) \\] </li> <li> <p>Build lists of:</p> <ul> <li>element types (<code>el_type</code>),  </li> <li>U-values,  </li> <li>internal heat-transfer coefficients (<code>h_ci</code>, <code>h_ri</code>),  </li> <li>external coefficients (<code>h_ce</code>, <code>h_re</code>).</li> </ul> </li> <li> <p>Assign external coefficients</p> </li> <li> <p>Default convective = 20 W/m\u00b2\u00b7K, radiative = 4.14 W/m\u00b2\u00b7K.  </p> </li> <li> <p>For adjacent elements (<code>AD</code>), both coefficients are set to 0 \u2192 no external exchange.</p> </li> <li> <p>Compute construction resistance </p> \\[R_{c,eli} = \\frac{1}{U_{eli}} - \\frac{1}{(h_{ci}+h_{ri})} - \\frac{1}{(h_{ce}+h_{re})}\\] <p>This represents the core conduction resistance of the element (m\u00b2\u00b7K/W).</p> </li> <li> <p>Distribute conductances among layers </p> </li> </ol> <p>For each element i, the nodal conductances <code>h_pli_eli[layer, i]</code> are defined as:</p> <p>Layer 1 (node pair 1\u20132)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 6/R_c \\) <code>W</code> \\( h = 1/R_c \\) <code>GR</code> \\( h = 2/R_{gr} \\) <p>Layer 2 (node pair 2\u20133)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 3/R_c \\) <code>GR</code> \\( h = 1/(R_c/4 + R_{gr}/2) \\) <p>Layer 3 (node pair 3\u20134)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 3/R_c \\) <code>GR</code> \\( h = 2/R_c \\) <p>Layer 4 (node pair 4\u20135)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 6/R_c \\) <code>GR</code> \\( h = 4/R_c \\) <ol> <li>Return    The final 4\u00d7N matrix is wrapped in <code>conduttance_elements(h_pli_eli=h_pli_eli)</code>.</li> </ol>"},{"location":"it/iso_52016_solar_absorption/","title":"Solar absorption of bbuilding element","text":""},{"location":"it/iso_52016_solar_absorption/#function-solar_absorption_of_elementbuilding_object","title":"Function: <code>Solar_absorption_of_element(building_object)</code>","text":""},{"location":"it/iso_52016_solar_absorption/#function-signature","title":"Function Signature","text":"<pre><code>def Solar_absorption_of_element(cls, building_object) -&gt; solar_absorption_elements\n</code></pre>"},{"location":"it/iso_52016_solar_absorption/#parameters","title":"Parameters","text":"Name Type Description <code>building_object</code> <code>dict</code> Building data structure that contains a list of surfaces under <code>building_surface</code>. Each surface must define <code>ISO52016_type_string</code> and optical parameters (<code>solar_absorptance</code> or <code>g_value</code>)."},{"location":"it/iso_52016_solar_absorption/#required-fields-in-building_objectbuilding_surface","title":"Required Fields in <code>building_object[\"building_surface\"]</code>","text":"<p>Each element in <code>building_surface</code> should include: | Field | Description | |--------|-------------| | <code>ISO52016_type_string</code> | ISO 52016 element type string: \u2022 <code>OP</code> \u2013 Opaque element \u2022 <code>W</code> \u2013 Transparent (window) \u2022 <code>GR</code> \u2013 Ground-contact \u2022 <code>AD</code> or <code>ADJ</code> \u2013 Adjacent opaque element | | <code>solar_absorptance</code> | Solar absorptance coefficient (0\u20131) for opaque elements. | | <code>g_value</code> | Solar energy transmittance (0\u20131) for transparent elements. |</p>"},{"location":"it/iso_52016_solar_absorption/#returns","title":"Returns","text":"Type Description <code>solar_absorption_elements</code> Wrapper containing the 2D array <code>a_sol_pli_eli</code> (shape 5\u00d7N), where N = number of elements in <code>building_surface</code>."},{"location":"it/iso_52016_solar_absorption/#method-overview","title":"Method Overview","text":"<ol> <li>Determine number of envelope elements</li> </ol> <p><pre><code>el_list = len(building_object[\"building_surface\"])\n</code></pre>    Creates an empty coefficient list <code>solar_abs_elements</code> of length N.</p> <ol> <li>Extract solar properties</li> <li> <p>For each surface:</p> <ul> <li>If <code>\"solar_absorptance\"</code> is defined and the element is not <code>\"AD\"</code> or <code>\"ADJ\"</code>, use its value.</li> <li>If <code>\"solar_absorptance\"</code> is missing, use the <code>\"g_value\"</code> (for transparent elements).</li> <li>If the element type is <code>\"AD\"</code> or <code>\"ADJ\"</code>, set absorptance = 0.0 (no solar gain through adjacent walls).</li> </ul> </li> <li> <p>Create absorption matrix</p> </li> </ol> <p><pre><code>a_sol_pli_eli = np.zeros((5, el_list))\na_sol_pli_eli[0, :] = solar_abs_elements\n</code></pre>    Only the first node (external surface) receives the solar absorptance value; deeper nodes remain zero.</p> <ol> <li>Return result</li> </ol> <pre><code>return solar_absorption_elements(a_sol_pli_eli=a_sol_pli_eli)\n</code></pre>"},{"location":"it/iso_52016_solar_absorption/#example","title":"\ud83d\udcca Example","text":"<pre><code>inputs = {\n    \"type\": [\"GR\", \"OP\", \"OP\", \"OP\", \"OP\", \"OP\", \"W\", \"W\", \"W\", \"W\"],\n    \"a_sol\": [0, 0.6, 0.6, 0.6, 0.6, 0.6, 0, 0, 0, 0],\n}\n\n# Expected result:\na_sol_pli_eli = np.array([\n    [0. , 0.6, 0.6, 0.6, 0.6, 0.6, 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n])\n</code></pre>"},{"location":"it/iso_52016_solar_absorption/#notes","title":"\ud83e\udde9 Notes","text":"<ul> <li>Only external surfaces (node 0) receive solar absorption values, as solar radiation is applied to the outermost layer.  </li> <li>Adjacent elements (<code>\"AD\"</code> or <code>\"ADJ\"</code>) are excluded from solar absorption (set to zero).  </li> <li>Transparent elements (<code>\"W\"</code>) use <code>g_value</code> instead of <code>solar_absorptance</code>.  </li> <li>The 5\u00d7N output format is consistent with the 5-node thermal network defined in ISO 52016-1.</li> </ul>"},{"location":"it/iso_52016_solar_absorption/#references","title":"\ud83d\udcda References","text":"<ul> <li>EN ISO 52016-1:2017 \u2013 Energy performance of buildings \u2013 Calculation of energy needs for heating and cooling.  </li> <li>Section 6.5.7 \u2013 Definition of solar absorptance and its application to surface nodes.</li> </ul>"},{"location":"it/iso_52016_ventilation/","title":"Ventilation and Internal Gains Module \u2014 README","text":"<p>This module implements key ISO-based methods for evaluating heat transfer by ventilation and internal heat gains in thermally conditioned and unconditioned zones.</p> <p>It also includes an auxiliary function for computing transmission heat transfer coefficients between conditioned and adjacent zones, following ISO 13789.</p>"},{"location":"it/iso_52016_ventilation/#1-overview","title":"1) Overview","text":"<p>The module covers three main components:</p> <ol> <li>Ventilation heat transfer coefficient (<code>VentilationInternalGains.heat_transfer_coefficient_by_ventilation</code>):</li> <li>Evaluates the natural ventilation rate and corresponding heat transfer coefficient (<code>H_ve_nat</code>) using ISO 16798\u20117 (wind and temperature-driven airflow).</li> <li> <p>Supports a simplified occupancy-based ventilation model.</p> </li> <li> <p>Internal heat gains (<code>VentilationInternalGains.internal_gains</code>):</p> </li> <li> <p>Computes total internal heat gains from occupants, appliances, and optionally nearby unconditioned zones, using ISO 16798\u20111 and ISO 15316\u20111 formulations.</p> </li> <li> <p>Transmission between zones (<code>transmission_heat_transfer_coefficient_ISO13789</code>):</p> </li> <li>Calculates inter-zone transmission coefficients (<code>H_ztu_tot</code>, <code>b_ztu_m</code>) according to ISO 13789, accounting for heat exchanges between conditioned, unconditioned, and external environments.</li> </ol>"},{"location":"it/iso_52016_ventilation/#2-class-and-function-summary","title":"2) Class and Function Summary","text":""},{"location":"it/iso_52016_ventilation/#21-dataclass-h_natural_vent","title":"2.1 Dataclass: <code>h_natural_vent</code>","text":"<p><pre><code>@dataclass\nclass h_natural_vent:\n    H_ve_nat: np.ndarray\n</code></pre> Stores the ventilation heat transfer coefficient array (<code>H_ve_nat</code>, in W/K).</p>"},{"location":"it/iso_52016_ventilation/#22-class-ventilationinternalgains","title":"2.2 Class: <code>VentilationInternalGains</code>","text":""},{"location":"it/iso_52016_ventilation/#constructor","title":"Constructor","text":"<p><pre><code>VentilationInternalGains(building_object)\n</code></pre> - Parameters   - <code>building_object</code>: dictionary or object with building geometry and surface data (windows, net floor area, etc.).</p>"},{"location":"it/iso_52016_ventilation/#23-method-heat_transfer_coefficient_by_ventilation","title":"2.3 Method: <code>heat_transfer_coefficient_by_ventilation(...)</code>","text":""},{"location":"it/iso_52016_ventilation/#purpose","title":"Purpose","text":"<p>Computes the heat transfer coefficient by ventilation (<code>H_ve_nat</code>) for the thermal zone.</p>"},{"location":"it/iso_52016_ventilation/#signature","title":"Signature","text":"<pre><code>@staticmethod\ndef heat_transfer_coefficient_by_ventilation(\n    building_object, Tz, Te, u_site,\n    Rw_arg_i=None, c_air=1006, rho_air=1.204,\n    C_wnd=0.001, C_st=0.0035, rho_a_ref=1.204,\n    altitude=None, type_ventilation=\"temp_wind\",\n    flowrate_person=1.4\n) -&gt; h_natural_vent\n</code></pre>"},{"location":"it/iso_52016_ventilation/#modes","title":"Modes","text":"<ol> <li>Natural ventilation (<code>type_ventilation=\"temp_wind\"</code>)</li> <li>Based on ISO 16798\u20117 (2017) section 6.4.3.5.4.</li> <li>Uses wind speed (<code>u_site</code>) and indoor/outdoor temperature difference (<code>|Tz \u2013 Te|</code>) to estimate air exchange through windows.</li> <li>Airflow rate formula:      \\n\\[ q_v = 3600 * \\frac{\\rho_{ref}}{\\rho_e} * \\frac{A_w}{2} * \\sqrt{ \\max(C_{wnd} u_{site}^2, C_{st} h_{st} |T_z - T_e|) } \\]\\n</li> <li> <p>Key variables:</p> <ul> <li><code>C_wnd</code> (wind coefficient): 0.001 (1/m\u00b7s)</li> <li><code>C_st</code> (stack effect coefficient): 0.0035 ((m/s)/(m\u00b7K))</li> <li><code>h_st</code>: effective stack height = max(height tops) \u2013 min(height bottoms)</li> <li><code>\u03c1_a_ref</code>: reference air density at 20\u202f\u00b0C (adjusted for altitude if provided)</li> <li><code>A_w</code>: effective open window area (sum over windows \u00d7 opening ratio <code>Rw_arg_i</code>)</li> </ul> </li> <li> <p>The heat transfer coefficient is finally computed as:      \\n\\[ H_{ve} = \\frac{c_{air} \\rho_{air} q_v}{3600} \\; [W/K] \\]\\n</p> </li> <li> <p>Occupancy-based ventilation (<code>type_ventilation=\"occupancy\"</code>)</p> </li> <li>Simplified method scaling ventilation to floor area and occupant activity:      \\n\\[ H_{ve} = A_{use} (3.6\u00b7flowrate_{person}) \u03c1_{air} c_{air} / 3600 \\]\\n</li> <li>Typical <code>flowrate_person</code> = 1.4\u202fl/(s\u00b7m\u00b2).</li> </ol>"},{"location":"it/iso_52016_ventilation/#returns","title":"Returns","text":"<ul> <li><code>np.ndarray</code>: array of ventilation heat transfer coefficients (<code>H_ve_nat</code>, in W/K).</li> </ul>"},{"location":"it/iso_52016_ventilation/#notes","title":"Notes","text":"<ul> <li>Handles altitude correction for air density.</li> <li>Issues warnings if <code>Rw_arg_i</code> length does not match window count (defaults to 0.9 opening ratio).</li> <li>Supports both window-driven and occupancy-driven modes.</li> </ul>"},{"location":"it/iso_52016_ventilation/#24-method-internal_gains","title":"2.4 Method: <code>internal_gains(...)</code>","text":""},{"location":"it/iso_52016_ventilation/#purpose_1","title":"Purpose","text":"<p>Calculates internal heat gains to the conditioned zone according to ISO 16798\u20111 and ISO 15316\u20111.</p>"},{"location":"it/iso_52016_ventilation/#signature_1","title":"Signature","text":"<pre><code>def internal_gains(\n    cls, building_type_class, a_use,\n    unconditioned_zones_nearby=False, list_adj_zones=None,\n    Fztc_ztu_m=1, b_ztu=1,\n    h_occup=1, h_app=1, h_light=1, h_dhw=1,\n    h_hvac=1, h_proc=1\n)\n</code></pre>"},{"location":"it/iso_52016_ventilation/#formula","title":"Formula","text":"\\[ \u03a6_{int,z,t} = (q_{int,occ}\u00b7h_{occup} + q_{int,app}\u00b7h_{app})\u00b7A_{use} \\] <p>If unconditioned zones exist: [ \u03a6_{int,z,t} += \u03a6_{int,dir,z,t} + (1-b_{ztu})\u00b7F_{ztc,ztu,m}\u00b7\u03a6_{int,dir,z,t} ]</p>"},{"location":"it/iso_52016_ventilation/#parameters","title":"Parameters","text":"<ul> <li><code>building_type_class</code>: key identifying building type (e.g. Residential_apartment, Office, etc.).</li> <li><code>a_use</code>: usable area (m\u00b2).</li> <li><code>unconditioned_zones_nearby</code>: whether adjacent unconditioned zones exist.</li> <li><code>list_adj_zones</code>: number of adjacent zones.</li> <li><code>Fztc_ztu_m</code>, <code>b_ztu</code>: ISO\u202f13789 coupling factors for conditioned/unconditioned zone exchange.</li> <li><code>h_*</code>: hourly activity multipliers for occupancy, appliances, lighting, etc.</li> </ul>"},{"location":"it/iso_52016_ventilation/#returns_1","title":"Returns","text":"<ul> <li><code>float</code>: internal gains in watts (<code>\u03a6_int_z_t</code>).</li> </ul>"},{"location":"it/iso_52016_ventilation/#3-typical-workflow","title":"3) Typical Workflow","text":"<ol> <li> <p>Ventilation Heat Transfer <pre><code>Hve = VentilationInternalGains.heat_transfer_coefficient_by_ventilation(\n    building_object=my_bui,\n    Tz=21, Te=5, u_site=3.5,\n    type_ventilation=\"temp_wind\"\n)\n</code></pre></p> </li> <li> <p>Internal Gains <pre><code>gains = VentilationInternalGains(my_bui).internal_gains(\n    building_type_class=\"Residential_apartment\",\n    a_use=120,\n    h_occup=0.8, h_app=0.6\n)\n</code></pre></p> </li> </ol>"},{"location":"it/iso_52016_ventilation/#4-integration-roadmap-future-enhancements","title":"4) Integration Roadmap (Future Enhancements)","text":"<ul> <li>Air leaks: integrate infiltration losses for cracks and envelope leakage tests.</li> <li>Cross ventilation: include simultaneous airflow paths between opposite fa\u00e7ades.</li> <li>Mechanical ventilation: handle forced air systems with user\u2011defined flow rates and recovery efficiency.</li> </ul>"},{"location":"it/iso_52016_ventilation/#5-dependencies","title":"5) Dependencies","text":"<pre><code>pip install numpy\n</code></pre> <ul> <li>NumPy: numerical arrays and vectorized math.</li> <li>(Optional) pandas, warnings \u2014 if extending data handling.</li> </ul>"},{"location":"it/iso_52016_ventilation/#6-references","title":"6) References","text":"<ul> <li>ISO\u202f52016\u20111:2017, \u00a7\u202f6.5.10\u202fVentilation and Heat Transfer Coefficients  </li> <li>ISO\u202f16798\u20117:2017, \u00a7\u202f6.4.3.5\u202fNatural Ventilation Airflow  </li> <li>ISO\u202f16798\u20111:2019, \u00a7\u202fM1\u2013M10 Internal Gains  </li> <li>ISO\u202f13789:2017, \u00a7\u202f7\u202fTransmission Heat Transfer Coefficients through Adjacent Spaces</li> </ul>"},{"location":"it/iso_52016_ventilation/#license","title":"License","text":"<p>Use and modify freely for research and educational purposes. When integrating into software distributions, ensure ISO content references are properly cited.</p>"},{"location":"it/iso_52016_virtual_ground_temperature/","title":"<code>Temp_calculation_of_ground(building_object, lambda_gr=2.0, R_si=0.17, R_se=0.04, psi_k=0.05, **kwargs)</code>","text":""},{"location":"it/iso_52016_virtual_ground_temperature/#function-signature","title":"\ud83d\udcd8 Function Signature","text":"<pre><code>def Temp_calculation_of_ground(\n    cls,\n    building_object,\n    lambda_gr=2.0,  # W/(m\u00b7K)\n    R_si=0.17,      # m\u00b2K/W (internal surface resistance)\n    R_se=0.04,      # m\u00b2K/W (external surface resistance for ground calc.)\n    psi_k=0.05,     # W/(m\u00b7K) linear transmittance wall/floor junction\n    **kwargs        # expects path_weather_file\n) -&gt; temp_ground\n</code></pre>"},{"location":"it/iso_52016_virtual_ground_temperature/#parameters","title":"\ud83d\udce5 Parameters","text":"Name Type Default Description <code>building_object</code> <code>dict</code> \u2014 Building data structure (geometry, envelope, setpoints). See Required fields below. <code>lambda_gr</code> <code>float</code> <code>2.0</code> Thermal conductivity of the ground, W/(m\u00b7K). <code>R_si</code> <code>float</code> <code>0.17</code> Internal surface resistance, m\u00b2K/W. <code>R_se</code> <code>float</code> <code>0.04</code> External surface resistance (as used for ground calc.), m\u00b2K/W. <code>psi_k</code> <code>float</code> <code>0.05</code> Linear thermal transmittance at the wall/floor junction, W/(m\u00b7K). <code>**kwargs['path_weather_file']</code> <code>str | PathLike</code> \u2014 Path to EPW used by <code>Calculation_ISO_52010</code> to retrieve ambient temperatures."},{"location":"it/iso_52016_virtual_ground_temperature/#required-fields-in-building_object","title":"\u2705 Required Fields in <code>building_object</code>","text":"<ul> <li><code>building_parameters.temperature_setpoints.heating_setpoint</code> (\u00b0C)  </li> <li><code>building_parameters.temperature_setpoints.cooling_setpoint</code> (\u00b0C)  </li> <li><code>building_surface</code>: list of surfaces with at least <code>area</code>, <code>sky_view_factor</code> (used to detect floor-on-ground where <code>svf == 0</code>).  </li> <li><code>building.exposed_perimeter</code> (m)  </li> <li><code>building.wall_thickness</code> (m)  </li> <li>(Optional) <code>building.thermal_resistance_floor</code> (m\u00b2K/W). In the current code, <code>thermal_resistance_floor</code> is set to 5.3 m\u00b2K/W internally.  </li> <li>The function stores <code>building_parameters.coldest_month</code> (=1) for later reference.</li> </ul>"},{"location":"it/iso_52016_virtual_ground_temperature/#returns","title":"\ud83d\udce4 Returns","text":"<p>The function returns a <code>temp_ground</code> wrapper with: - <code>R_gr_ve</code> (float, m\u00b2K/W) \u2013 virtual ground-layer thermal resistance below the floor slab. - <code>Theta_gr_ve</code> (np.ndarray length 12, \u00b0C) \u2013 monthly virtual ground temperatures as \u201cseen\u201d by the slab. - <code>thermal_bridge_heat</code> (float, W/K) \u2013 heat transfer coefficient due to thermal bridges along the exposed perimeter (<code>exposed_perimeter \u00d7 psi_k</code>).</p>"},{"location":"it/iso_52016_virtual_ground_temperature/#method-overview-iso-13370-steps","title":"\ud83d\udd22 Method Overview (ISO 13370 Steps)","text":"<ol> <li> <p>Reference ground resistance    [ R_{gr} = \\frac{0.5}{\\lambda_{gr}} \\quad (\\text{m}^2\\,K/W) ]</p> </li> <li> <p>External temperature statistics (monthly) from <code>Calculation_ISO_52010</code> (local time series):  </p> </li> <li><code>T2m</code> \u2192 monthly mean / min / max \u2192 amplitude of external temperature variations:      [ A_e = \\frac{\\overline{T_{max}} - \\overline{T_{min}}}{2} ]  </li> <li> <p>Annual external mean: \\( \\overline{T_e} \\).</p> </li> <li> <p>Internal temperature profile    Using active heating/cooling setpoints from the building object:  </p> </li> <li>Annual mean: \\( \\overline{T_i} = (T_{set,h} + T_{set,c})/2 \\) </li> <li>Amplitude: \\( A_i = (T_{set,c} - T_{set,h})/2 \\) </li> <li> <p>With coldest month = 1 (January), monthly internal temperature is:      [ T_{i,m} = \\overline{T_i} - A_i \\cos\\left(\\tfrac{2\\pi (m - m_c)}{12}\\right) ]</p> </li> <li> <p>Identify slab-on-ground area (<code>sog_area</code>)    The code searches <code>building_surface</code> for the element with <code>sky_view_factor == 0</code> and uses its <code>area</code> as the contact area with ground.</p> </li> <li> <p>Characteristic floor dimension    With exposed perimeter <code>P</code> and floor area <code>A</code>:    [ B' = \\frac{A}{0.5 P} ]</p> </li> <li> <p>Equivalent ground thickness    [ d_t = t_{wall} + \\lambda_{gr} (R_{floor} + R_{se}) ]    where <code>R_floor</code> = 5.3 m\u00b2K/W in this implementation.</p> </li> <li> <p>Slab-on-ground transmittance \\( U_{sog} \\) (ISO 13370 \u00a78):  </p> </li> <li>If \\( d_t &lt; B' \\) (un/ moderately insulated):      [ U_{sog} = \\frac{2\\lambda_{gr}}{\\pi B' + d_t} \\ln!\\left(\\frac{\\pi B'}{d_t} + 1\\right) ]</li> <li> <p>Else (well insulated):      [ U_{sog} = \\frac{\\lambda_{gr}}{0.457 B' + d_t} ]</p> </li> <li> <p>Virtual layer resistance    [ R_{gr,ve} = \\frac{1}{U_{sog}} - R_{si} - R_{floor} - R_{gr} ]</p> </li> <li> <p>Linear thermal bridges    [ H_{TB} = P \\cdot \\psi_k \\quad (\\text{W/K}) ]</p> </li> <li> <p>Steady-state &amp; periodic ground heat transfer coefficients </p> <ul> <li>Steady-state: \\( H_{ss} = A\\,U_{sog} + P\\,\\psi_k \\) </li> <li>Periodic terms (with <code>periodic_penetration_depth = 3.2 m</code>):  </li> <li>Internal-side periodic:     [ H_{pi} = A\\, \\frac{\\lambda_{gr}}{d_t} \\sqrt{\\frac{2}{(1 + \\delta)^2 + 1}} \\quad \\text{with } \\delta = \\frac{\\text{ppd}}{d_t} ]  </li> <li>External-side periodic:     [ H_{pe} = 0.37\\, P\\, \\lambda_{gr} \\ln!\\left(\\frac{\\text{ppd}}{d_t} + 1\\right) ]</li> </ul> </li> <li> <p>Average heat-flow rate (monthly)     [ \\dot{Q}{avg} = H{ss}(\\overline{T_i} - \\overline{T_e}) + Q_{per,i}(m) + Q_{per,e}(m) ]     with phase shifts <code>a_tl = 0</code> (internal) and <code>b_tl = 1</code> (external).</p> </li> <li> <p>Virtual ground temperature     [ \\Theta_{gr,ve}(m) = T_{i,m} - \\frac{ \\dot{Q}{avg}(m) - P\\,\\psi_k (\\overline{T_i} - \\overline{T_e}) }{A\\, U{sog}} ]</p> </li> </ol>"},{"location":"it/iso_52016_virtual_ground_temperature/#example-pseudocode","title":"\ud83e\uddea Example (pseudocode)","text":"<pre><code>tg = Temp_calculation_of_ground(\n    building_object=bui,\n    lambda_gr=2.0,\n    R_si=0.17, R_se=0.04,\n    psi_k=0.05,\n    path_weather_file=\"../weather/rome.epw\",\n)\nprint(tg.R_gr_ve)        # m\u00b2K/W\nprint(tg.Theta_gr_ve)    # array of 12 monthly temperatures (\u00b0C)\nprint(tg.thermal_bridge_heat)  # W/K\n</code></pre>"},{"location":"it/iso_52016_virtual_ground_temperature/#notes-assumptions","title":"\ud83e\udde9 Notes &amp; Assumptions","text":"<ul> <li>The procedure is explicitly for slab-on-ground floors and conditioned buildings (not for purely unheated spaces).  </li> <li>The floor thermal resistance is fixed to 5.3 m\u00b2K/W in the code; adjust if your model requires a different construction.  </li> <li>Monthly external temperatures are derived from <code>T2m</code> in the ISO 52010 weather pipeline; ensure your EPW/PVGIS mapping provides <code>T2m</code>.  </li> <li><code>coldest_month</code> is set to January (1); adapt for different climates if necessary.  </li> <li>The sog area is inferred using <code>sky_view_factor == 0</code> on a surface; verify this convention matches your data.  </li> </ul>"},{"location":"it/iso_52016_virtual_ground_temperature/#standards-references","title":"\ud83d\udcda Standards &amp; References","text":"<ul> <li>ISO 13370:2017 \u2014 Thermal performance of buildings \u2014 Heat transfer via the ground \u2014 Calculation methods </li> <li>EN ISO 52010-1:2017 \u2014 External climatic conditions \u2014 Solar &amp; meteorological data for energy calculations</li> </ul>"},{"location":"it/weather_data/","title":"<code>Weather_data_bui(building_object, path_weather_file, weather_source=\"pvgis\")</code>","text":""},{"location":"it/weather_data/#purpose","title":"Purpose","text":"<p>Builds the simulation input time series (hourly index) by combining weather (via ISO 52010 preprocessing) with operational profiles for: - Internal gains (through occupancy level scalars) - Ventilation/comfort (through comfort level scalars) - Heating &amp; cooling setpoints and setbacks (weekday/weekend logic)</p> <p>The output is a single <code>DataFrame</code> usable as a driver for dynamic energy calculations.</p>"},{"location":"it/weather_data/#function-signature","title":"\ud83d\udcd8 Function Signature","text":"<pre><code>def Weather_data_bui(cls, building_object, path_weather_file, weather_source=\"pvgis\") -&gt; simulation_df\n</code></pre>"},{"location":"it/weather_data/#parameters","title":"\ud83d\udce5 Parameters","text":"Name Type Default Description <code>building_object</code> <code>dict</code> \u2014 Building data structure created via <code>Building</code> or <code>Buildings_from_dictionary</code>. Must include the operational fields listed below. <code>path_weather_file</code> <code>str | PathLike</code> \u2014 Path to the EPW weather file (e.g., <code>../User/documents/epw/athens.epw</code>). Used as the source for ISO 52010 processing. <code>weather_source</code> <code>str</code> <code>\"pvgis\"</code> Source for weather processing. Supported: <code>\"pvgis\"</code> or <code>\"epw\"</code>. Both branches call <code>Calculation_ISO_52010(...).sim_df</code>."},{"location":"it/weather_data/#required-fields-in-building_object","title":"\u2705 Required Fields in <code>building_object</code>","text":"<p>These keys are read to construct weekday/weekend schedules and setpoints. Examples in brackets:</p> <ul> <li><code>occ_level_wd</code>: occupancy scaling profile for workdays (e.g., 0\u20131 array)  </li> <li><code>occ_level_we</code>: occupancy scaling profile for weekends </li> <li><code>comf_level_wd</code>: ventilation/comfort scaling profile for workdays </li> <li><code>comf_level_we</code>: ventilation/comfort scaling profile for weekends </li> <li><code>heating_setpoint</code>: e.g., <code>20</code> (\u00b0C)  </li> <li><code>heating_setback</code>: e.g., <code>10</code> (\u00b0C)  </li> <li><code>cooling_setpoint</code>: e.g., <code>26</code> (\u00b0C)  </li> <li><code>cooling_setback</code>: e.g., <code>20</code> (\u00b0C)</li> </ul> <p>These profiles are typically 24-element arrays (hourly) applied per weekday/weekend; monthly or seasonal variants can be handled upstream if needed.</p>"},{"location":"it/weather_data/#what-the-function-does","title":"\ud83e\udde0 What the Function Does","text":"<ol> <li>Weather preprocessing (ISO 52010):    Calls <code>Calculation_ISO_52010(building_object, path_weather_file, weather_source).sim_df</code> and wraps the result as a <code>pandas.DataFrame</code>.</li> <li>Datetime index:    The resulting <code>DataFrame</code> index is coerced to a <code>pd.DatetimeIndex</code> (hourly).</li> <li>Return object:    Returns a wrapper <code>simulation_df(simulation_df=sim_df)</code> exposing the preprocessed time series for the rest of the simulation pipeline.</li> </ol>"},{"location":"it/weather_data/#returns","title":"\ud83d\udce4 Returns","text":"Type Description <code>simulation_df</code> A simple wrapper object holding <code>simulation_df=sim_df</code>, where <code>sim_df</code> is an hourly <code>pandas.DataFrame</code> with weather variables (ISO 52010 processed) and operational fields (occupancy/comfort scalars and setpoints/setbacks)."},{"location":"it/weather_data/#typical-contents-of-sim_df","title":"\ud83d\udcd1 Typical Contents of <code>sim_df</code>","text":"<p>Exact columns depend on your <code>Calculation_ISO_52010</code> implementation and template, but they commonly include:</p> <ul> <li>Weather (ISO 52010): outdoor dry-bulb temperature, direct/diffuse/global irradiance (plane-of-array as applicable), wind speed, relative humidity, etc.  </li> <li>Operational scalars: <code>occ_level</code> and <code>comf_level</code> per timestamp (derived from <code>*_wd</code>/<code>*_we</code>)  </li> <li>HVAC controls: <code>heating_setpoint</code>, <code>heating_setback</code>, <code>cooling_setpoint</code>, <code>cooling_setback</code></li> </ul> <p>If your pipeline attaches weekday/weekend profiles later, these may be added downstream; otherwise enrich <code>sim_df</code> at this stage.</p>"},{"location":"it/weather_data/#notes-assumptions","title":"\ud83e\udde9 Notes &amp; Assumptions","text":"<ul> <li><code>weather_source=\"pvgis\"</code> and <code>weather_source=\"epw\"</code> currently execute the same code path, both using <code>Calculation_ISO_52010(...).sim_df</code>. If source-specific logic is needed (e.g., PVGIS metadata vs raw EPW), add a dedicated branch.  </li> <li>The function does not perform unit conversion on setpoints; ensure temperatures are in \u00b0C and schedules are unitless fractions (0\u20131).  </li> <li>The <code>DatetimeIndex</code> in <code>sim_df</code> must be continuous hourly; fill gaps upstream if the EPW file is incomplete.  </li> <li>Holiday/special-day profiles are not handled here; plug them in upstream/downstream if required.</li> </ul>"},{"location":"it/weather_data/#example","title":"\ud83e\uddea Example","text":"<pre><code>sim = Weather_data_bui(\n    building_object=my_building,\n    path_weather_file=\"../data/weather/rome.epw\",\n    weather_source=\"epw\"\n)\ndf = sim.simulation_df  # unwrap if your wrapper exposes as attribute\nprint(df.index[:24])    # first day (hourly)\nprint(df.columns)       # check available drivers\n</code></pre>"},{"location":"it/weather_data/#error-handling-tips","title":"\ud83d\udea8 Error Handling Tips","text":"<ul> <li>Missing keys in <code>building_object</code>: validate profiles and setpoints before calling.  </li> <li>Bad EPW path: verify <code>path_weather_file</code> exists and is a valid EPW.  </li> <li>Timezone/daylight saving: ensure the ISO 52010 routine aligns the index with local convention if needed.  </li> </ul>"},{"location":"it/weather_data/#related","title":"\ud83d\udcda Related","text":"<ul> <li><code>Calculation_ISO_52010</code>: solar geometry &amp; irradiance processing per EN ISO 52010-1.  </li> <li>Occupancy &amp; ventilation schedule builders used to form <code>occ_level</code> and <code>comf_level</code>.  </li> </ul>"},{"location":"","title":"Home","text":"<p>Please cite us if you use this library:  </p>    Introduction: EPBD Requirements for ISO EN 52000 and ISO EN 15316 Standards  Note:  !!! New version available !!! New features:  - Calculation of multizona considering adiabiatic walls between zones with the same use destination - Calculation with non heated zones  -"},{"location":"#iso-en-52000-overarching-standards","title":"ISO EN 52000 - Overarching Standards","text":"<p>The EPBD Directive 2018 (and confirmed in the 2024 revision) requires Member States to describe their national calculation methodology following the national annexes of the \"overarching\" standards, namely: ISO EN 52000-1, 52003-1, 52010-1, 52016-1, and 52018-1, developed under mandate M/480 given to CEN (European Committee for Standardization).</p> <p>Important: This provision does not constitute mandatory legal codification of these standards. However, the obligation to describe the national methodology following the annexes of the overarching standards will push Member States to explain where and why they deviate from these standards, leading to greater recognition and promotion of the EPB standards set.</p> <p>The ISO EN 52000 overarching standards are:</p> <ol> <li>ISO EN 52000-1: General framework and procedures for EPB assessment</li> <li>ISO EN 52003-1: Indicators, requirements, ratings and certificates</li> <li>ISO EN 52010-1: Internal environmental parameters</li> <li>ISO EN 52016-1: Internal temperatures and energy needs for heating/cooling</li> <li>ISO EN 52018-1: Indicators for overall energy performance</li> </ol>"},{"location":"#new-epbd-recast-methodology","title":"New EPBD Recast Methodology","text":"<p>The new EPBD recast provides an update on building performance assessment through a methodology that must consider various factors such as the building\u2019s thermal characteristics, the use of renewable energy sources, building automation and control systems, ventilation, cooling, energy recovery, etc. The methodology should represent actual operating conditions, use measured energy for accuracy and comparability, and be based on hourly or sub-hourly intervals to account for variable conditions significantly impacting system performance, including internal conditions.</p> <p>The energy performance of a building shall be expressed by a numeric indicator of primary energy use per unit of reference floor area per year, in kWh/(m\u00b2.y), for energy performance certification and compliance with minimum energy performance requirements. Numeric indicators of final energy use per unit of reference floor area per year, in kWh/(m\u00b2.y), and energy needs according to ISO EN 52000 in kWh/(m\u00b2.y) shall also be used. The applied methodology for determining energy performance must be transparent, open to innovation, and reflect best practices, particularly from additional indicators.</p> <p>Member States shall describe their national calculation methodology based on Annex A of the key European standards on energy performance of buildings.</p>"},{"location":"#en-15316-heating-and-cooling-systems","title":"EN 15316 - Heating and Cooling Systems","text":"<p>The EN 15316 series covers the calculation method for system energy requirements and system efficiencies. This family of standards is an integral part of the EPB set and covers:</p>"},{"location":"#en-15316-modular-structure","title":"EN 15316 Modular Structure:","text":"<ul> <li>EN 15316-1: General and expression of energy performance (Modules M3-1, M3-4, M3-9, M8-1, M8-4)</li> <li>EN 15316-2: Emission systems (heating and cooling)</li> <li>EN 15316-3: Distribution systems (DHW, heating, cooling)</li> <li>EN 15316-4-X: Heat generation systems:<ul> <li>4-1: Combustion boilers</li> <li>4-2: Heat pumps</li> <li>4-3: Solar thermal and photovoltaic systems</li> <li>4-4: Cogeneration systems</li> <li>4-5: District heating</li> <li>4-7: Biomass</li> </ul> </li> <li>EN 15316-5: Storage systems</li> </ul> <p>For space heating, applicable standards include EN 15316-1, EN 15316-2-1, EN 15316-2-3 and the appropriate parts of EN 15316-4 depending on the system type, including losses and control aspects.</p>"},{"location":"#relationship-between-epbd-2024-and-standards","title":"Relationship between EPBD 2024 and Standards","text":"<p>The most recent revision of the EPBD was published in May 2024, further strengthening requirements and aligning with the EU's climate neutrality objectives. Member States are encouraged to consider applicable standards, particularly from the EPB standards list.</p> <p>17 of approximately 50 EPB standards are already ISO EN standards, resulting from collaboration between CEN and ISO. The other EPB standards are currently only available at the European level (CEN standards).</p>"},{"location":"#pybuildingenergy-the-python-library-for-building-performance-assessment","title":"pyBuildingEnergy: the python library for building performance assessment","text":"<p>pyBuildingEnergy aims to provide an assessment of building performance both in terms of energy and comfort. In this initial release, it is possible to assess the energy performance of the building using ISO EN 52106-1:2018. Additional modules will be added for a more comprehensive evaluation of performance, assessing ventilation, renewable energies, systems, etc. The actual calculation methods for the assessment of building performance are the following:</p> <ul> <li> <p>[x] the (sensible) energy need for heating and cooling, based on hourly or monthly calculations;</p> </li> <li> <p>[ ] the latent energy need for (de-)humidification, based on hourly or monthly calculations;</p> </li> <li> <p>[x] the internal temperature, based on hourly calculations;</p> </li> <li> <p>[x] the sensible heating and cooling load, based on hourly calculations;</p> </li> <li> <p>[ ] the moisture and latent heat load for (de-)humidification, based on hourly calculations;</p> </li> <li> <p>[ ] the design sensible heating or cooling load and design latent heat load using an hourly calculation interval;</p> </li> <li> <p>[ ] the conditions of the supply air to provide the necessary humidification and dehumidification.</p> </li> </ul> <p>The calculation methods can be used for residential or non-residential buildings, or a part of it, referred to as \"the building\" or the \"assessed object\". ISO EN 52016-1:2018 also contains specifications for the assessment of thermal zones in the building or in the part of a building. The calculations are performed per thermal zone. In the calculations, the thermal zones can be assumed to be thermally coupled or not. ISO EN 52016-1:2018 is applicable to buildings at the design stage, to new buildings after construction and to existing buildings in the use phase</p>"},{"location":"#weather-data","title":"Weather Data","text":"<p>The tool can use wather data coming from 2 main sources:</p> <ul> <li>pvgis api (https://re.jrc.ec.europa.eu/pvg_tools/en/) - PHOTOVOLTAIC GEOGRAPHICAL INFORMATION SYSTEM</li> <li>.epw file from https://www.ladybug.tools/epwmap/</li> </ul> <p>More details in the example folder</p>"},{"location":"#domestic-hot-water-dhw","title":"Domestic Hot Water - DHW","text":"<ul> <li>[x] Calculation of volume and energy need for domestic hot water according to ISO EN 12831-3. </li> <li>[] Assessment of thermal load based on the type of DHW system</li> </ul>"},{"location":"#primary-energy-for-heating","title":"Primary energy for heating","text":"<ul> <li>[x] Calculation of primary energy for heating according to ISO EN 15316-1:2018</li> </ul>"},{"location":"#limitations","title":"Limitations","text":"<p>The library is developed with the intent of demonstrating specific elements of calculation procedures in the relevant standards. It is not intended to replace the regulations but to complement them, as the latter are essential for understanding the calculation.  This library is meant to be used for demonstration and testing purposes and is therefore provided as open source, without protection against misuse or inappropriate use.</p> <p>The information and views set out in this document are those of the authors and do not necessarily reflect the official opinion of the European Union. Neither the European Union institutions and bodies nor any person acting on their behalf may be held responsible for the use that may be made of the information contained herein.</p>"},{"location":"#getting-started","title":"Getting Started","text":"<p>The following command will install the latest pyBuildinEnergy library</p> <pre><code>    pip install pybuildingenergy\n</code></pre> <p>The tool allows you to evaluate the performance of buildings in different ways: </p>"},{"location":"#building-inputs","title":"Building Inputs","text":"<ul> <li>for building inputs refer to <code>Building Inputs</code>: https://eurac-eebgroup.github.io/pybuildingenergy-docs/iso_52016_input/</li> <li>for heating system input (ISO EN 15316-1) refer to <code>Heating System Input</code>: https://eurac-eebgroup.github.io/pybuildingenergy-docs/iso_15316_input/</li> </ul>"},{"location":"#documentation","title":"Documentation","text":"<p>Check our new documentation here: <code>Documentation &lt;https://eurac-eebgroup.github.io/pybuildingenergy-docs/&gt;</code></p>"},{"location":"#example","title":"Example","text":"<p>Here some <code>Examples &lt;https://github.com/EURAC-EEBgroup/pyBuildingEnergy/tree/master/examples&gt;</code> on pybuildingenergy application. For more information .....</p>"},{"location":"#contributing-and-support","title":"Contributing and Support","text":"<p>Bug reports/Questions If you encounter a bug, kindly create a GitLab issue detailing the bug.  Please provide steps to reproduce the issue and ideally, include a snippet of code that triggers the bug.  If the bug results in an error, include the traceback. If it leads to unexpected behavior, specify the expected behavior.</p> <p>Code contributions We welcome and deeply appreciate contributions! Every contribution, no matter how small, makes a difference. Click here to find out more about contributing to the project.</p>"},{"location":"#acknowledgment","title":"Acknowledgment","text":"<p>This work was carried out within European projects:  Infinite - This project has received funding from the European Union\u2019s Horizon 2020 research and innovation programme under grant agreement No 958397,  Moderate - Horizon Europe research and innovation programme under grant agreement No 101069834,  with the aim of contributing to the development of open products useful for defining plausible scenarios for the decarbonization of the built environment</p> <p>Reagrding the DHW Calculation:  The work was developed using the regulations and results obtained from the spreadsheet created by the EPBCenter.</p>"},{"location":"#references","title":"References","text":"<ol> <li>EPB Center - The Energy Performance of Buildings Directive (EPBD)    https://epb.center/epb-standards/the-energy-performance-of-buildings-directive-epbd/</li> <li>REHVA Journal - \"The new EN ISO 52000 family of standards to assess the energy performance of buildings put in practice\"    https://www.rehva.eu/rehva-journal/chapter/the-new-en-iso-52000-family-of-standards-to-assess-the-energy-performance-of-buildings-put-in-practice</li> <li>European Commission - Energy Performance of Buildings Directive    https://energy.ec.europa.eu/topics/energy-efficiency/energy-performance-buildings/energy-performance-buildings-directive_en</li> <li>Directive (EU) 2024/1275 - Official text published in the Official Journal of the EU on May 8, 2024</li> <li>ISO EN 52010-1:2018 - Energy performance of buildings - External climatic conditions - Part 1: Conversion of climatic data for energy calculations</li> <li>ISO EN 52016-1:2018 - Energy performance of buildings - Energy needs for heating and cooling, internal temperatures and sensible and latent heat loads </li> <li>ISO EN 12831-3:2018 - Energy performance of buildings - Method for calculation of the design heat load - Part 3: Domestic hot water systems heat load and characterisation of needs, Module M8-2, M8-3</li> <li>ISO EN 15316-1:2018 - Energy performance of buildings \u2013 Method for calculation of system energy requirements and system efficiencies \u2013 Part 1: General and Energy performance expression, Module M3\u20131, M3\u20134, M3\u20139, M8\u20131</li> <li>ISO EN 16798-7  - Energy performance of buildings \u2013 Ventilation for buildings \u2013 Part 7: Calculation methods for the determination of air flow rates in buildings including infiltration (Module M5\u20135)</li> <li>ISO EN 16798-1 - Energy performance of buildings \u2014 Ventilation of buildings \u2014 Part 1: Indoor environmental input parameters for design and assessment of energy performance of buildings addressing indoor air quality, thermal environment, lighting and acoustics (Module M1\u20136)</li> <li>Directive (EU) 2024/1275 - Official text published in the Official Journal of the EU on May 8, 2024</li> </ol>"},{"location":"#authors","title":"Authors","text":"<ul> <li>Daniele Antonucci</li> <li>Ulrich Filippi Oberegger</li> </ul>"},{"location":"#license","title":"License","text":"<p>BSD 3-Clause License</p>"},{"location":"#version","title":"Version","text":"<p>0.2</p>"},{"location":"#maintainer","title":"Maintainer","text":"<p>Daniele Antonucci</p>"},{"location":"iso_15316/","title":"ISO 15316 - Introduction","text":""},{"location":"iso_15316/#introduction-to-en-iso-15316-1","title":"Introduction to EN ISO 15316-1","text":""},{"location":"iso_15316/#overview","title":"Overview","text":"<p>ISO 15316-1 (equivalent to EN 15316-1 in Europe) defines the framework and general principles for calculating the energy performance of building heating and domestic hot water systems. It provides a systematic, modular approach that allows engineers, researchers, and software tools to evaluate and compare energy efficiency across different system configurations.</p> <p>This standard is part of the broader Energy Performance of Buildings (EPB) suite developed under the EU Energy Performance of Buildings Directive (EPBD).</p>"},{"location":"iso_15316/#scope","title":"Scope","text":"<p>The standard covers water-based heating and DHW systems where heat is generated, distributed, and emitted to maintain indoor comfort. It applies to: - Emission systems (radiators, floor heating, fan coils, etc.) - Distribution systems (piping, manifolds, circulation) - Storage components (thermal buffers, DHW tanks) - Generation systems (boilers, heat pumps, cogeneration)</p> <p>It does not include ventilation-only or purely air-based systems, except when heated by water circuits.</p>"},{"location":"iso_15316/#methodological-structure","title":"Methodological Structure","text":"<p>EN 15316-1 introduces a modular structure, dividing the entire heating system into interconnected subsystems:</p> <ol> <li>Emission (C.2\u2013C.5) \u2013 heat transfer from water to the indoor space  </li> <li>Distribution \u2013 transport of heat through pipes, including losses and auxiliaries  </li> <li>Storage \u2013 intermediate energy buffering or recovery  </li> <li>Generation \u2013 production of useful heat from a fuel or electricity source  </li> </ol> <p>Each module has its own energy balance:</p> \\[ \\text{Energy In} = \\text{Useful Output} + \\text{Losses} - \\text{Recoverable Losses} - \\text{Auxiliaries} \\] <p>The calculation proceeds in the direction:</p> \\[ \\text{Energy Needs (Building)} \\rightarrow \\text{Delivered Heat (Emission)} \\rightarrow \\text{Distribution} \\rightarrow \\text{Generation} \\rightarrow \\text{Primary Energy Input} \\] <p>This enables transparent energy tracking and consistent efficiency assessment across technologies.</p>"},{"location":"iso_15316/#objectives","title":"Objectives","text":"<p>The main objectives of ISO 15316-1 are to: - Provide a consistent calculation structure for all sub-systems in heating and DHW installations. - Define input and output data exchange between modules. - Enable comparability between different system types (e.g., boilers vs. heat pumps). - Serve as the reference method for EPB-compliant national calculation procedures.</p>"},{"location":"iso_15316/#key-principles","title":"Key Principles","text":"<ul> <li>System boundary definition \u2013 explicit separation of emission, distribution, storage, and generation.  </li> <li>Energy flow consistency \u2013 all sub-systems connect via clear input/output relationships.  </li> <li>Recoverable vs. non-recoverable losses \u2013 internal gains can offset building demand.  </li> <li>Auxiliary energy \u2013 electric or mechanical support energy is always accounted for.  </li> <li>Adaptability \u2013 compatible with both monthly and hourly calculation time steps.</li> </ul>"},{"location":"iso_15316/#benefits","title":"Benefits","text":"<ul> <li>Harmonized methodology for energy performance certificates, design tools, and research.  </li> <li>Facilitates diagnostic comparison of subsystems (e.g., identifying excessive distribution losses).  </li> <li>Supports policy implementation under EPBD and national building codes.  </li> <li>Enhances reproducibility and transparency in simulation and benchmarking.</li> </ul>"},{"location":"iso_15316/#relationship-with-subsequent-parts","title":"Relationship with Subsequent Parts","text":"<p>Part 1 provides the general framework only. Detailed formulas and reference values for each sub-system are defined in:</p> <ul> <li>EN 15316-2 \u2013 Emission and control (M3-5) </li> <li>EN 15316-3 \u2013 Distribution and control (M3 -6)  </li> <li>EN 15316-4 \u2013 Generation systems (M3-8) for different generator: <ul> <li>EN 15316-4-1 \u2013 Combustion boilers (M3-8-1) </li> <li>EN 15316-4-2 \u2013 Heat pumps (M3-8-2) </li> <li>EN 15316-4-3 \u2013 Thermal solar and photovoltaic (M3-8-3) </li> <li>EN 15316-4-4 \u2013 On-site cogeneration (M3-8-4) </li> <li>EN 15316-4-5 \u2013 District Heating and Cooling (M3-8-5) </li> <li>EN 15316-4-9 \u2013 Direct electrical heater (M3-8-6) </li> <li>EN 15316-4-8 \u2013 Radiant heating and stoves (M3-8-8) </li> </ul> </li> <li>EN 15316-5 \u2013 Storage and control (M3-7)  </li> </ul>"},{"location":"iso_15316/#references","title":"References","text":"<ul> <li>EN 15316-1:2017 \u2013 Energy performance of buildings \u2014 Method for calculation of system energy requirements and system efficiencies \u2014 Part 1: General and energy performance expression. </li> <li>REHVA (2017) \u2014 Information Paper: CEN Standards for Heating and Domestic Hot Water Systems. </li> <li>CENSE Project (EU) \u2014 Application of the EPBD Calculation Framework.</li> </ul>"},{"location":"iso_15316_calculation_procedure/","title":"CALCULATION PROCEDURE","text":"Note: THE ACTUAL CALCULATION OF PRIMARY ENRGY USING THE ISO 15316-1 IS FOR A SINGLE ZONE, IT IS NOT YET IMPLEMENTED THE CALCULATION FOR MULTIPLE ZONES.  <p>The calculation procedure follows the direction from the energy need to the source (building energy need -&gt; primary energy)</p>"},{"location":"iso_15316_calculation_procedure/#description-of-functions","title":"Description of functions","text":"<p>Herunder explanation of what the script does and comments each function, with emphasis on: - assumptions, units of measurement and formulas used; - structure of input/output data; - flow of calculation for single step and time series.</p> <p>Standard of reference: the calculator follows the logic of the ISO 15316-1 for heating systems and supports 4 types of emission circuits (C.2, C.3, C.4, C.5). Building Energy Need: The building energy need is calculated using the module ISO 52016. For more information refers to the module ISO 52016.</p>"},{"location":"iso_15316_calculation_procedure/#1-overview","title":"1) Overview","text":"<ul> <li>Main class: <code>HeatingSystemCalculator</code></li> <li>Input: a dictionary <code>input_data</code> with parameters of emission, distribution and generation (primary).</li> <li>Tabular data:</li> <li><code>TB14</code> (DF): ISO table with \u0394T nominal and exponent n for the terminal (radiators, panels, etc.).     If not provided in <code>input_data[\"TB14\"]</code>, uses <code>TB14_backup</code> from <code>global_inputs</code>.</li> <li>Units (principali):</li> <li>Energy: kWh (exception: <code>Q_H</code> can arrive in Wh and is converted)</li> <li>Power: kW, Losses/Aux: kWh</li> <li>Volumetric flows: m\u00b3/h</li> <li>Temperature: \u00b0C</li> <li>c_w: specific heat of water in Wh/(kg\u00b7K) (\u22481.16)</li> <li>Output:</li> <li>for single step: dictionary with temperature, flow and energy on emission, distribution and generation;</li> <li>for time series: DataFrame hourly/temporal with the same structure.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#2-class-structure","title":"2) Class structure","text":"<pre><code>class HeatingSystemCalculator:\n    \\\"\\\"\\\"Calcolatore secondo ISO 15316-1 con 4 tipologie C.2\u2013C.5.\\\"\\\"\\\"\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#__init__self-input_data","title":"<code>__init__(self, input_data)</code>","text":"<ul> <li>What it does: saves the input, loads constants and parameters by calling <code>_load_constants()</code> and <code>_load_input_parameters()</code>.</li> <li>Attention: <code>input_data</code> guides everything (control policy, generator efficiency, external curves, etc.).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#3-loading-constants-and-parameters","title":"3) Loading constants and parameters","text":""},{"location":"iso_15316_calculation_procedure/#_load_constantsself","title":"<code>_load_constants(self)</code>","text":"<ul> <li>What it does: loads constants and parameters by calling <code>_load_constants()</code> and <code>_load_input_parameters()</code>. </li> <li>Details:</li> <li>If <code>input_data[\"TB14\"]</code> is a <code>pd.DataFrame</code>, uses it; otherwise uses <code>TB14_backup</code>.</li> <li>Set <code>c_w = 1.16</code> Wh/(kg\u00b7K).</li> <li>Why it is needed: <code>TB14</code> provides nominal \u0394T and exponent n to calculate the relationship power \u2194 \u0394T air-emitter.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_load_input_parametersself","title":"<code>_load_input_parameters(self)</code>","text":"<ul> <li>What it does: reads from the input dictionary the parameters of:</li> <li>Emission (secondary): type of emitter, nominal power, efficiency, mixing valve, type of temperature control (demand/external/constant), auxiliary powers, t operative, external secondary curve data.</li> <li>Distribution: recovery of losses, auxiliary powers, loss coefficient [W/K], service time, etc.</li> <li>Generation (primary): power at full load, maximum load factor, service time, hydraulic scheme (direct or independent), pump control, nominal \u0394T, optional setpoints, generator efficiency model (simple/parametric/manufacturer) and relative curves/parameters, primary circuit temperature control (Type A/B/C) and external primary curve.</li> <li>Important notes:</li> <li><code>selected_emm_cont_circuit</code> \u2208 {0,1,2,3} \u2192 C.2/C.3/C.4/C.5.</li> <li>Policy Q_H \u2264 0: <code>calc_when_QH_positive_only</code> + <code>off_compute_mode</code> (<code>idle</code>/<code>temps</code>/<code>full</code>) decide how to handle periods without load.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#4-default-tables-and-data","title":"4) Default tables and data","text":""},{"location":"iso_15316_calculation_procedure/#_default_emission_dataself","title":"<code>_default_emission_data(self)</code>","text":"<ul> <li>What it provides: limits/setpoint secondary (emission): T supply max, \u0394T max, T return desired, load factor with ON/OFF, T min supply.</li> <li>Why it is needed: it is needed to constrain the calculation of the emitter in function of the demand and the type C.2\u2013C.5.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_default_outdoor_dataself","title":"<code>_default_outdoor_data(self)</code>","text":"<ul> <li>What it provides: outdoor curve (secondary) defining min/max supply vs. min/max outdoor T..</li> <li>Usage: used by <code>calculate_circuit_node_temperature</code> when the control is \"based on outdoor\".</li> </ul>"},{"location":"iso_15316_calculation_procedure/#5-time-series-data","title":"5) Time series data","text":""},{"location":"iso_15316_calculation_procedure/#load_csv_dataself-csv_path_or_df","title":"<code>load_csv_data(self, csv_path_or_df)</code>","text":"<ul> <li>What it does: loads time series data from CSV/DataFrame with expected columns:</li> <li><code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> (alias supported).</li> <li>Logic:</li> <li>If <code>Q_H</code> is in Wh, creates <code>Q_H_kWh = Q_H / 1000</code>.</li> <li>Saves in <code>self.timeseries_data</code>.</li> <li>Returns: loaded DataFrame.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#6-emission-common-parameters","title":"6) Emission \u2014 common parameters","text":""},{"location":"iso_15316_calculation_procedure/#calculate_common_emission_parametersself-heating_needs_kwh-int","title":"<code>calculate_common_emission_parameters(self, heating_needs_kWh, \u03b8int)</code>","text":"<ul> <li>What it does: calculates common quantities for C.2\u2013C.5:</li> <li>net demand (after recoverable losses of system),</li> <li>average power emitted <code>\u03a6H_em_eff</code> (kW) on <code>tH_em_i_ON</code>,</li> <li>losses/inputs of emission, auxiliary powers,</li> <li>nominal parameters TB14: <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code>, nominal flow <code>V_H_em_nom</code>.</li> <li>Note:</li> <li><code>V_H_em_nom = \u03a6H_em_n / (\u0394\u03b8H_em_n * c_w)</code>.</li> <li>Calculates load factor \u03b2 and partial ON time for auxiliary powers.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#7-emission-models-c2c3c4c5","title":"7) Emission \u2014 models C.2/C.3/C.4/C.5","text":"<p>All use the non-linear relationship power \u2194 \u0394T air-emitter with exponent n from TB14.</p>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c2self-common_params-int-c2-constant-flow-constant-water-temperature","title":"<code>calculate_type_C2(self, common_params, \u03b8int)</code> \u2014 C.2: constant flow, constant water temperature","text":"<ul> <li>Uses <code>V_H_em_nom</code> as effective flow.</li> <li>Stima <code>\u0394\u03b8H_em_air_eff = \u0394\u03b8_air_nom * (\u03a6_eff/\u03a6_nom)^(1/n)</code>.</li> <li>Calculates <code>\u03b8H_em_avg</code>, then \u0394T water <code>\u0394\u03b8H_em_w_eff = \u03a6_eff / (c_w * V)</code> and from there supply/return emitter.</li> <li><code>\u03b8H_em_flw_min</code> include mixing offset if <code>MIX_EM=True</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c3self-common_params-int-c3-variable-flow-constant-water-temperature-return-limited","title":"<code>calculate_type_C3(self, common_params, \u03b8int)</code> \u2014 C.3: variable flow, constant water temperature (return limited)","text":"<ul> <li>Fixes <code>\u03b8H_em_ret_set</code> (\u2265 <code>\u03b8int</code>), limits supply (<code>\u03b8H_em_flw_max</code>, \u0394T_w_max).</li> <li>Determines <code>\u03b8H_em_flw</code> and <code>\u03b8H_em_ret</code> coherent and derives the flow from \u0394T water.</li> <li><code>\u03b8H_em_flw_min</code> include mixing offset.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c4self-common_params-int-c4-onoff-intermittent","title":"<code>calculate_type_C4(self, common_params, \u03b8int)</code> \u2014 C.4: ON\u2013OFF intermittent","text":"<ul> <li>Uses a duty cycle to ensure the energy hourly with power ON.</li> <li>Determines <code>\u03b8H_em_flw_calc</code> during ON (from TB14, \u03b2 required).</li> <li>Provides minimum flow for the distribution circuit.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c5self-common_params-int-c5-constant-flow-variable-exchange-bypass","title":"<code>calculate_type_C5(self, common_params, \u03b8int)</code> \u2014 C.5: constant flow, variable exchange (bypass)","text":"<ul> <li>Maintains nominal flow; the actual flow is the maximum between the calculation and the minimum set (<code>\u03b8H_em_flw_min_tz_i</code>).</li> <li>The output includes <code>\u03b8H_em_flw_min</code> (with mixing offset).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#8-circuit-node-temperature","title":"8) Circuit node temperature","text":""},{"location":"iso_15316_calculation_procedure/#calculate_circuit_node_temperatureself-ext-emission_results","title":"<code>calculate_circuit_node_temperature(self, \u03b8ext, emission_results)</code>","text":"<ul> <li>What it does: calculates the flow at the node <code>\u03b8H_nod_out</code> based on the secondary control type:</li> <li>Type 1 \u2013 Based on demand: uses <code>\u03b8H_em_flw_min</code> of the emission.</li> <li>Type 2 \u2013 Based on outdoor: uses the climate curve secondary.</li> <li>Type 3 \u2013 Constant temperature: uses <code>\u03b8em_flw_sahz_i</code> (constant).</li> <li>Output: <code>\u03b8H_nod_out</code> (\u00b0C).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#9-operating-conditions-secondary","title":"9) Operating conditions (secondary)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_operating_conditionsself-emission_results-common_params-int-h_nod_out","title":"<code>calculate_operating_conditions(self, emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"<ul> <li>What it does: combines the choice C.2/C.3/C.4/C.5 and the node to generate:</li> <li>temperature circuit: <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, flow <code>V_H_cr</code>;</li> <li>temperature distribution (between collector and emitter): <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>;</li> <li>load factor <code>\u03b2H_em</code> and minimum flow requested <code>\u03b8H_em_flw_min</code>;</li> <li>return emitter (used downstream).</li> <li>Note:</li> <li>C.4 introduces ON time and power calculation in ON;</li> <li>C.5 maintains minimum flow and calculates the return from the balance with constant flow.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#10-distribution","title":"10) Distribution","text":""},{"location":"iso_15316_calculation_procedure/#calculate_distributionself-h_dis_flw-h_dis_ret-int-qh_em_i_in","title":"<code>calculate_distribution(self, \u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"<ul> <li>What it does: estimates the distribution losses and auxiliary powers, the recoverable part and the required energy input from the distribution.</li> <li>Key formulas:</li> <li>Losses [kWh] \u2248 <code>((T_media - T_int) * U[W/K] / 1000) * t[h]</code></li> <li>Required input: <code>QH_dis_i_in = QH_dis_i_req + losses - aux - recoveries</code></li> <li>Distribution flow: <code>V_H_dis = QH_dis_i_in / (c_w * \u0394T_dis * t)</code></li> <li>Output: dictionary with losses/aux/recoveries and <code>V_H_dis</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#11-generator-efficiency-primary","title":"11) Generator efficiency (primary)","text":""},{"location":"iso_15316_calculation_procedure/#_efficiency_from_modelself-flw-ret-load_frac10","title":"<code>_efficiency_from_model(self, \u03b8flw, \u03b8ret, load_frac=1.0)</code>","text":"<ul> <li>What it does: returns the efficiency (%) according to the selected model:</li> <li>simple: heuristic in function of <code>\u03b8ret</code> (high condensation at low returns).</li> <li>parametric: piecewise linear model (parameters: <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>).</li> <li>manufacturer: curve 1D (\u03b7=f(Tret)) o 2D (\u03b7=f(Tflw,Tret)) con interpolazione bilineare.</li> <li>Note: clamp a [1, 110] %; fallback a modello semplice se curve non valide.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#12-primary-circuit-setpoint","title":"12) Primary circuit setpoint","text":""},{"location":"iso_15316_calculation_procedure/#_generator_flow_setpointself-ext-h_dis_flw_demand","title":"<code>_generator_flow_setpoint(self, \u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"<ul> <li>What it does: calculates the primary circuit setpoint based on the selected control:</li> <li>Type A \u2013 Outdoor: uses the primary curve (min/max vs T external).</li> <li>Type B \u2013 Demand: pursues the secondary demand (<code>\u03b8H_dis_flw</code>).</li> <li>Type C \u2013 Constant: uses <code>\u03b8HW_gen_flw_const</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#13-generation-primary","title":"13) Generation (primary)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_generationself-h_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"<code>calculate_generation(self, \u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"<ul> <li> <p>Purpose: Calculates the primary circuit thermal output, setpoints, and energy consumption according to the selected control strategy.</p> </li> <li> <p>Control types:</p> <p>-Type A \u2013 Outdoor: Uses the primary weather curve (supply temperature as a function of outdoor temperature). -Type B \u2013 Demand: Follows the secondary circuit demand (\u03b8H_dis_flw). -Type C \u2013 Constant: Uses a fixed setpoint \u03b8HW_gen_flw_const.</p> </li> <li> <p>Computation steps:</p> <p>1) Maximum capacity: max_output_g1 = P_full * LF_max * t Defines the maximum hourly energy the generator can deliver.</p> <p>2) Requested output: QH_gen_out = min(QH_dis_i_in, max_output_g1) Limits the generator\u2019s output to its capacity.</p> <p>3) Mass and volume flows: ms = \u03c1 * V_dis for the secondary side; primary flow depends on configuration.</p> <p>4) Hydraulic configurations:</p> <ul> <li>Direct: primary and secondary circuits are identical.</li> <li>Independent: computes \u0394T_p, determines the primary supply setpoint (Type A/B/C), applies primary line losses, calculates primary flow mp = Q * 1000 / (c_w * \u0394T), and optionally applies anti-dilution logic before finding the return temperature Tp_ret.</li> </ul> <p>5) Efficiency: Re-evaluated using the actual flow/return temperatures via the chosen generator efficiency model.</p> <p>6) Energy balance:</p> <ul> <li>Input energy: EHW_gen_in = (QH_gen_out * 100) / \u03b7</li> <li> <p>Auxiliary energy: EHW_gen_aux = EHW_gen_in * (aux_generator / 100)</p> </li> <li> <p>Recoverable generator losses: QW_gen_i_ls_rbl_H</p> </li> <li>Thermal outputs and split of useful (EH_gen_in) and waste (EWH_gen_in) energy.</li> </ul> </li> <li> <p>Output: A dictionary containing primary-side temperatures, mass/volume flows, efficiency, and energy consumption for the generator.</p> </li> </ul>"},{"location":"iso_15316_calculation_procedure/#14-single-step-execution","title":"14) Single step execution","text":""},{"location":"iso_15316_calculation_procedure/#compute_stepself-q_h_kwh-int-ext","title":"<code>compute_step(self, q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>Flow:</li> <li>Common emission parameters</li> <li>Emission C.2/C.3/C.4/C.5 (in base a <code>selected_emm_cont_circuit</code>)</li> <li>Calculation supply node (secondary)</li> <li>Operating conditions of the circuit</li> <li>Distribution</li> <li>Generation (primary)</li> <li>Composition of the output of the step (dictionary)</li> <li>Returns: all temperatures, flows and energies of the step.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#15-time-series-execution","title":"15) Time series execution","text":""},{"location":"iso_15316_calculation_procedure/#_temps_row_when_offself-int-ext","title":"<code>_temps_row_when_off(self, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>What it does: in absence of load (<code>Q_H \u2264 0</code>) and with policy <code>off_compute_mode='temps'</code>,   calculates only the temperatures significant keeping powers/flows=0.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#run_timeseriesself-dfnone","title":"<code>run_timeseries(self, df=None)</code>","text":"<ul> <li>What it does: executes the calculation on the entire DataFrame.</li> <li>Alias recognized:</li> <li><code>Q_H_kWh</code> \u2194 <code>Q_H</code>, <code>Q_h</code>, <code>Heating_needs</code></li> <li><code>T_op</code> \u2194 <code>T_int</code>, <code>theta_int</code></li> <li><code>T_ext</code> \u2194 <code>theta_ext</code></li> <li>Policy when <code>Q_H \u2264 0</code>:</li> <li><code>calc_when_QH_positive_only=False</code>: calculates the complete flow.</li> <li><code>True</code> with:<ul> <li><code>idle</code>: empty row (NaN/0) \u2014 see <code>_idle_row</code>.</li> <li><code>temps</code>: row only temperatures \u2014 see <code>_temps_row_when_off</code>.</li> <li><code>full</code>: complete calculation even with null load.</li> </ul> </li> <li>Returns: DataFrame indexed by timestamp with all columns.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#16-output-columns-extracted","title":"16) Output columns (extracted)","text":"<ul> <li>Inputs: <code>Q_h(kWh)</code>, <code>T_op(\u00b0C)</code>, <code>T_ext(\u00b0C)</code></li> <li>Emission: <code>\u03a6H_em_eff(kW)</code>, <code>\u03b8H_em_flow(\u00b0C)</code>, <code>\u03b8H_em_ret(\u00b0C)</code>, <code>V_H_em_eff(m3/h)</code>, <code>\u03b8H_em_flw_min_req(\u00b0C)</code></li> <li>Node/Circuit: <code>\u03b8H_nod_out(\u00b0C)</code>, <code>\u03b8H_cr_flw(\u00b0C)</code>, <code>\u03b8H_cr_ret(\u00b0C)</code>, <code>V_H_cr(m3/h)</code>, <code>\u03b2H_em(-)</code></li> <li>Distribution: <code>Q_w_dis_i_ls(kWh)</code>, <code>Q_w_dis_i_aux(kWh)</code>, <code>Q_w_dis_i_ls_rbl_H(kWh)</code>, <code>QH_dis_i_in(kWh)</code>, <code>V_H_dis(m3/h)</code></li> <li>Generation: <code>QH_gen_out(kWh)</code>, <code>\u03b8X_gen_cr_flw(\u00b0C)</code>, <code>\u03b8X_gen_cr_ret(\u00b0C)</code>, <code>V_H_gen(m3/h)</code>, <code>efficiency_gen(%)</code>, <code>EHW_gen_in(kWh)</code>, <code>EHW_gen_aux(kWh)</code></li> </ul>"},{"location":"iso_15316_calculation_procedure/#17-best-practices-and-notes","title":"17) Best practices and notes","text":"<ul> <li>Verify that <code>TB14</code> contains the rows for the emitter type (<code>emitter_type</code>) and the columns:</li> <li><code>Emitters_nominal_deltaTeta_Water_C</code>, <code>Emitters_nominale_deltaTeta_air_C</code>, <code>Emitters_exponent_n</code>.</li> <li>Ensure Q_H is provided in kWh (or Wh with automatic conversion).</li> <li>For independent circuits, evaluate:</li> <li><code>generator_nominal_deltaT</code>, <code>gen_flow_temp_control_type</code>, <code>\u03b8HW_gen_flw_const</code>,</li> <li><code>allow_dilution</code> and <code>primary_line_loss</code> if you want to model the primary hydraulic node with/without dilution.</li> <li>The efficiency model can be refined with manufacturer curves (1D/2D) for boilers/heat pumps.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#18-function-responsibility-mapping","title":"18) Function \u2192 responsibility mapping","text":"Function Main responsibility <code>_load_constants</code> Global constants and <code>TB14</code> <code>_load_input_parameters</code> Reading all parameters (emission, distribution, generation) <code>_default_emission_data</code>, <code>_default_outdoor_data</code> Default for limits/setpoint and secondary circuit curve <code>load_csv_data</code> Loading timeseries and energy normalization <code>calculate_common_emission_parameters</code> Common emission parameters (C.2\u2013C.5) <code>calculate_type_C2/C3/C4/C5</code> Emission models <code>calculate_circuit_node_temperature</code> Compute the secondary node (circuit) supply temperature \u03b8H_nod_out according to the selected secondary control policy: based on demand, outdoor, or constant. <code>calculate_operating_conditions</code> Temperature/portate circuito e distribuzione <code>calculate_distribution</code> Losses/auxiliaries/recoveries and distribution flow <code>_efficiency_from_model</code> Generator efficiency according to selected model <code>_generator_flow_setpoint</code> Setpoint mandata primaria (outdoor/demand/costante) <code>calculate_generation</code> Primary circuit balance: useful power, efficiency, consumptions <code>compute_step</code> Pipeline for a single step <code>_temps_row_when_off</code> Row \"only temperatures\" when Q_H\u22640 <code>run_timeseries</code> Execution on the entire time series"},{"location":"iso_15316_calculation_procedure/#flowchart-overview","title":"Flowchart (overview)","text":"<pre>\nflowchart TD\n  A[Start] --&gt; B[__init__]\n  B --&gt; C[_load_constants]\n  B --&gt; D[_load_input_parameters]\n  C --&gt; E{Execution?}\n  D --&gt; E\n\n  E --&gt;|single step| F[compute_step]\n  E --&gt;|timeseries| TS[run_timeseries]\n\n  subgraph Pipeline[\"Pipeline compute_step\"]\n    F --&gt; G[calculate_common_emission_parameters]\n    G --&gt; H{Tipo circuito?}\n    H --&gt;|C.2| I1[calculate_type_C2]\n    H --&gt;|C.3| I2[calculate_type_C3]\n    H --&gt;|C.4| I3[calculate_type_C4]\n    H --&gt;|C.5| I4[calculate_type_C5]\n    I1 --&gt; J[calculate_circuit_node_temperature]\n    I2 --&gt; J\n    I3 --&gt; J\n    I4 --&gt; J\n    J --&gt; K[calculate_operating_conditions]\n    K --&gt; L[calculate_distribution]\n    L --&gt; M[calculate_generation]\n    M --&gt; N[Compose outputs dict]\n  end\n\n  subgraph Timeseries[\"Timeseries run_timeseries\"]\n    TS --&gt; TS0{Row loop}\n    TS0 --&gt;|Q_H \u2264 0 AND policy=idle| T0[_idle_row]\n    TS0 --&gt;|Q_H \u2264 0 AND policy=temps| T1[_temps_row_when_off]\n    TS0 --&gt;|altrimenti| T2[compute_step]\n    T0 --&gt; T3[accumula risultati]\n    T1 --&gt; T3\n    T2 --&gt; T3\n  end\n\n  N --&gt; O[Return dict]\n  T3 --&gt; P[Return DataFrame]\n</pre>"},{"location":"iso_15316_calculation_procedure/#inputoutput-tables-main-functions","title":"Input/Output tables (main functions)","text":""},{"location":"iso_15316_calculation_procedure/#21-__init__input_data","title":"2.1 <code>__init__(input_data)</code>","text":"Field Type Description <code>input_data</code> dict Parameters of emission, distribution, generation, policy and tables. Output Initializes the instance and calls <code>_load_constants()</code> &amp; <code>_load_input_parameters()</code>."},{"location":"iso_15316_calculation_procedure/#22-_load_constants","title":"2.2 <code>_load_constants()</code>","text":"Field Type Description <code>input_data[\"TB14\"]</code> (optional) <code>pd.DataFrame</code> ISO table with nominal \u0394T/esponente; if missing uses <code>TB14_backup</code>. Side-effects <code>self.TB14</code> assigned; <code>self.c_w = 1.16</code>. Output No explicit return."},{"location":"iso_15316_calculation_procedure/#23-_load_input_parameters","title":"2.3 <code>_load_input_parameters()</code>","text":"Block Main keys Default (example) Emissione <code>emitter_type</code>, <code>nominal_power</code>, <code>emission_efficiency</code>, <code>mixing_valve</code>, <code>flow_temp_control_type</code>, <code>auxiliars_power</code>, <code>emission_operation_time</code>, <code>mixing_valve_delta</code>, <code>selected_emm_cont_circuit</code>, <code>heat_emission_data</code>, <code>outdoor_temp_data</code>, <code>constant_flow_temp</code> <code>Floor heating</code>, <code>8 kW</code>, <code>90%</code>, <code>True</code>, <code>Type 1</code>, <code>0 W</code>, <code>1 h</code>, <code>2 \u00b0C</code>, <code>0</code>, <code>42</code> Distribuzione <code>Heat_losses_recovered</code>, <code>distribution_loss_recovery</code>, <code>simplified_approach</code>, <code>distribution_aux_recovery</code>, <code>distribution_aux_power</code>, <code>distribution_loss_coeff</code>, <code>distribution_operation_time</code>, <code>recoverable_losses</code> <code>True</code>, <code>90%</code>, <code>80%</code>, <code>80%</code>, <code>30 W</code>, <code>48 W/K</code>, <code>1 h</code>, <code>0 kWh</code> Generazione <code>full_load_power</code>, <code>max_monthly_load_factor</code>, <code>tH_gen_i_ON</code>, <code>auxiliary_power_generator</code>, <code>fraction_of_auxiliary_power_generator</code>, <code>generator_circuit</code>, <code>speed_control_generator_pump</code>, <code>generator_nominal_deltaT</code>, <code>\u03b8HW_gen_flw_set</code>, <code>\u03b8HW_gen_ret_set</code>, <code>calc_when_QH_positive_only</code>, <code>fill_zeros_when_skipped</code>, <code>off_compute_mode</code>, <code>efficiency_model</code>, <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>, <code>manuf_curve_1d</code>, <code>manuf_curve_2d</code>, <code>gen_flow_temp_control_type</code>, <code>gen_outdoor_temp_data</code>, <code>\u03b8HW_gen_flw_const</code> <code>24 kW</code>, <code>100%</code>, <code>1 h</code>, <code>0%</code>, <code>40%</code>, <code>independent</code>, <code>variable</code>, <code>20 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>True</code>, <code>False</code>, <code>idle</code>, <code>simple</code>, <code>110%</code>, <code>95%</code>, <code>20 \u00b0C</code>, <code>50 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>Type A</code>, <code>curve 1D/2D</code>,<code>50 \u00b0C</code>"},{"location":"iso_15316_calculation_procedure/#24-_default_emission_data-_default_outdoor_data","title":"2.4 <code>_default_emission_data()</code> / <code>_default_outdoor_data()</code>","text":"Function Output Note <code>_default_emission_data</code> DF con <code>\u03b8H_em_flw_max_sahz_i</code>, <code>\u0394\u03b8H_em_w_max_sahz_i</code>, <code>\u03b8H_em_ret_req_sahz_i</code>, <code>\u03b2H_em_req_sahz_i</code>, <code>\u03b8H_em_flw_min_tz_i</code> <code>Limits/setpoint secondary circuit</code> <code>_default_outdoor_data</code> DF con <code>\u03b8ext_min_sahz_i</code>, <code>\u03b8ext_max_sahz_i</code>, <code>\u03b8em_flw_max_sahz_i</code>, <code>\u03b8em_flw_min_sahz_i</code> <code>Secondary circuit limits</code>"},{"location":"iso_15316_calculation_procedure/#25-load_csv_datacsv_path_or_df","title":"2.5 <code>load_csv_data(csv_path_or_df)</code>","text":"Input Type Description <code>csv_path_or_df</code> str / DataFrame Timeseries with columns (<code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> or aliases) Output DataFrame With optional <code>Q_H_kWh</code> added; saved in <code>self.timeseries_data</code>"},{"location":"iso_15316_calculation_procedure/#26-calculate_common_emission_parametersheating_needs_kwh-int","title":"2.6 <code>calculate_common_emission_parameters(heating_needs_kWh, \u03b8int)</code>","text":"Output (key) Description <code>QH_sys_out_hz_i</code> Net demand after recoveries <code>QH_em_i_in</code> Energy in at emission <code>\u03a6H_em_eff</code> Average power on interval (kW) <code>V_H_em_nom</code> Nominal flow (m\u00b3/h) <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code> Parameters from TB14"},{"location":"iso_15316_calculation_procedure/#27-calculate_type_c2-c3-c4-c5","title":"2.7 <code>calculate_type_C2 / C3 / C4 / C5</code>","text":"Function Principle Output Note <code>C2</code> Constant flow, constant water temperature <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C3</code> Variable flow, constant water temperature (return limited) <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C4</code> ON\u2013OFF (duty cycle) <code>\u03b8H_em_flw_calc</code>, <code>\u03b8H_em_flw_min</code>, ecc. <code>C5</code> Constant flow, variable heat exchange (bypass) <code>\u03b8H_em_flow=min</code>, <code>\u03b8H_em_ret\u2248</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code>"},{"location":"iso_15316_calculation_procedure/#28-calculate_circuit_node_temperatureext-emission_results","title":"2.8 <code>calculate_circuit_node_temperature(\u03b8ext, emission_results)</code>","text":"Control Logic Output Type 1 Demand \u2192 <code>\u03b8H_em_flw_min</code> <code>\u03b8H_nod_out</code> Type 2 Secondary circuit limits <code>\u03b8H_nod_out</code> Type 3 Constant (<code>\u03b8em_flw_sahz_i</code>) <code>\u03b8H_nod_out</code>"},{"location":"iso_15316_calculation_procedure/#29-calculate_operating_conditionsemission_results-common_params-int-h_nod_out","title":"2.9 <code>calculate_operating_conditions(emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"Case Output Note C.2 / C.3 / C.4 / C.5 <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, <code>V_H_cr</code>, <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>, <code>\u03b2H_em</code>, <code>\u03b8H_em_flw_min</code>, <code>\u03b8H_em_ret_eff</code>"},{"location":"iso_15316_calculation_procedure/#210-calculate_distributionh_dis_flw-h_dis_ret-int-qh_em_i_in","title":"2.10 <code>calculate_distribution(\u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"Output Meaning <code>Q_w_dis_i_ls</code>, <code>Q_w_dis_i_aux</code>, <code>Q_w_dis_i_ls_rbl_H</code> Losses, auxiliaries and recoverable (kWh) <code>QH_dis_i_req</code>, <code>QH_dis_i_in</code> Request and effective input to distribution <code>V_H_dis</code> Distribution volumetric flow (m\u00b3/h)"},{"location":"iso_15316_calculation_procedure/#211-_efficiency_from_modelflw-ret-load_frac","title":"2.11 <code>_efficiency_from_model(\u03b8flw, \u03b8ret, load_frac)</code>","text":"Model Description <code>simple</code> Efficiency as function of return temperature (condensation) <code>parametric</code> Piecewise linear with thresholds (<code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>) <code>manufacturer</code> Manufacturer curves 1D/2D with interpolation"},{"location":"iso_15316_calculation_procedure/#212-_generator_flow_setpointext-h_dis_flw_demand","title":"2.12 <code>_generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"Type Logic Type A Primary curve (outdoor) Type B Follow secondary demand Type C Constant"},{"location":"iso_15316_calculation_procedure/#213-calculate_generationh_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"2.13 <code>calculate_generation(\u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"Output Meaning <code>max_output_g1</code>, <code>QH_gen_out</code> Limit capacity and thermal output (kWh) <code>\u03b8X_gen_cr_flw</code>, <code>\u03b8X_gen_cr_ret</code> Primary circuit effective (\u00b0C) <code>V_H_gen</code> Primary circuit volumetric flow (m\u00b3/h) <code>efficiency_gen</code> Efficiency (%) <code>EHW_gen_in</code>, <code>EHW_gen_aux</code> Energy in ingress and auxiliaries (kWh) <code>QW_gen_i_ls_rbl_H</code> Recoverable losses (kWh) <code>QW_gen_out</code>, <code>QHW_gen_out</code>, <code>EH_gen_in</code>, <code>EWH_gen_in</code> Thermal balances"},{"location":"iso_15316_calculation_procedure/#214-compute_stepq_h_kwh-int-ext","title":"2.14 <code>compute_step(q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"Input Output <code>q_h_kWh</code>, <code>\u03b8int</code>, <code>\u03b8ext</code> Dictionary with emission, node/circuit, distribution, generation"},{"location":"iso_15316_calculation_procedure/#215-_temps_row_when_offint-ext","title":"2.15 <code>_temps_row_when_off(\u03b8int, \u03b8ext)</code>","text":"Purpose Output Row \"only temperature\" for <code>Q_H \u2264 0</code> Same keys, with powers/volumes=0"},{"location":"iso_15316_calculation_procedure/#216-run_timeseriesdfnone","title":"2.16 <code>run_timeseries(df=None)</code>","text":"Input Output <code>df</code> (optional) or <code>self.timeseries_data</code> DataFrame indexed by timestamp with results of each step"},{"location":"iso_15316_calculation_procedure/#modelling-suggestions","title":"Modelling suggestions","text":"<ul> <li>Verify consistency between emitter type and <code>TB14</code> rows.  </li> <li>For independent schemes, curate <code>generator_nominal_deltaT</code>, <code>primary_line_loss</code> and <code>allow_dilution</code>.  </li> <li>Use <code>manufacturer</code> with realistic manufacturer curves when available.</li> </ul>"},{"location":"iso_15316_generation_circuit/","title":"ISO 15316 - Generation Circuit","text":""},{"location":"iso_15316_generation_circuit/#generation","title":"GENERATION","text":"<p>The annex D of ISO 15316-1 standard provides the calculation procedure for the generation circuit. It is the general procedure that can be improved using the detailed standards for different type of generator, such as Heat pump, Combustion boilers, District heating and cooling, etc. </p> <p>There are 2 typed of generaiont circuit:</p> <p>1) Generation with DIRECT circuit withou hydraulic separtion 2) Generation with INDIPENDENT flow rate circuit, using the hydraulic separtion</p>"},{"location":"iso_15316_generation_circuit/#direct-circuit","title":"DIRECT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>The standard define no control to the circuit.  In the pybuildingenergy, the contol have been applied on the generator based on:</p> <pre><code>- 'Type A - Based on outdoor temperature': uses primary's own weather curve\n- 'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)\n- 'Type C - Constant temperature'       : uses self.\u03b8HW_gen_flw_const\n</code></pre> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> <p>No data</p> <p>System design data: </p> <p>No data</p> <p>Process control data</p> <p>No data</p> <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#independent-circuit","title":"INDEPENDENT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal generator power max_output_g1 kW - 0 to 10<sup>4</sup> Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) water (flow-return) dTp \u00b0C - 1..40 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system <p>System design data: </p> <p>No data</p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Generator pump speed control speed_control_generator_pump - - - Generator pump speed control, could be varaible or deltaT_constant <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Generation flow Temperature Tp_sup \u00b0C - - Generation flow Temperature Generation return Temperature Tp_ret \u00b0C - - Generation return Temperature Generation flow rate V_H_gen m3/h - - Generation flow rate"},{"location":"iso_15316_heating_circuit/","title":"ISO 15316 - Heating Circuit","text":""},{"location":"iso_15316_heating_circuit/#heating-circuit","title":"HEATING CIRCUIT","text":"<p>The library provides modules for evaluating 4 types of hydraulic circuits, where, based on Table C.1 of the standard, for each circuit it is identified which type of emission system to use and the type of control. as defined below: </p> Code Module Emitters Control C2 Constan mass flow rate and varying water temperature Radiators and Panels Heating curve, mixing valvew and variable generation temperature C3 Varying mass flow (constant temperature) Radiators, Panels, Heating coils Thermostatic valve, flow rate control with two way valve C4 ON-OFF and varying temperature Radiators and Panels On-Off control C5 Varying heat exchange Fan-coil, heating coils emitters with on-off blower  and continuos circulation 3 way by-pass valve control <p>All modules allow the us of a mixing valve to allow different temperatures in the different circuits. A distinction is made between:  - the emitter tmperature and flow rate; - the circuit temperature and flow rate; </p> <p>They differ where there is a mixing or by-pass 3 way valve in the circuit.</p>"},{"location":"iso_15316_heating_circuit/#system-type-and-input-parameters","title":"System type and input parameters","text":""},{"location":"iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators Heating Panels Control Parameters Heating curve flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maximum distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c3-varying-mass-flow-rate-and-constant-water-temperature","title":"C3 - varying mass flow rate and constant water temperature","text":"<p>This configuration is for sample heating circuit with varying mass flow rate and constant water temperature. </p> Figure 1: System C3_1 - Example of sample heating circuit varying mass flow rate.  Figure 1: System C3_1 - Example of sample heating circuit with series control (AHU coil).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators with thermostatic valve AHU coil with series control Panels with PID control Control Parameters Maximum flow/return \u0394\u03b8 Maximum flow temperature Target return temperature <p>Inputs required</p> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve Target return temperature \u03b8H_em_ret_req_sahz_i \u00b0C - - Desired return temperature of the emission circuit Maximum flow/return \u0394\u03b8 \u0394\u03b8H_em_w_max_sahz_i \u00b0C - - Maximum flow/return temperature difference of the emission circuit Maximum flow temperature \u03b8H_em_flw_max_sahz_i \u00b0C - - Maximum flow temperature of the emission circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c4-intermittent-flow-rate-module-on-off","title":"C4 - Intermittent flow rate module (ON-OFF)","text":"<p>This configuration is for sample heating circuit with intermittent flow rate and constant water temperature. </p> Figure 1: System C4 - Example of sample heating circuit with intermittent flow rate module (ON-OFF).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Desired load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c5-constant-flow-rate-and-variable-heat-exchange","title":"C5 - Constant flow rate and variable heat exchange","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  Figure 1: System C4 - Example of sample heating circuit with three way by-pass control.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Target load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Minimum flow temperature \u03b8H_em_flw_min_sahz_i \u00b0C - - Minimum flow temperature of the emission circuit for a zone i Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"iso_15316_input/","title":"ISO 15316 - Input","text":""},{"location":"iso_15316_input/#input_system_hvac-reference-setup-guide","title":"INPUT_SYSTEM_HVAC \u2014 Reference &amp; Setup Guide","text":"<p>This document explains every field in the <code>INPUT_SYSTEM_HVAC</code> configuration used by the heating system model (emitter \u2192 distribution \u2192 generator). It also shows how to customize control curves and upload your own emitter tables.</p> <p>Scope: space-heating only (cooling is ignored here). All powers are thermal unless stated otherwise.</p>"},{"location":"iso_15316_input/#inputs","title":"Inputs","text":"<pre><code>INPUT_SYSTEM_HVAC = {\n  # Emitter (room-side heat emission)\n  \"emitter_type\": ...,\n  \"nominal_power\": ...,\n  \"emission_efficiency\": ...,\n  \"flow_temp_control_type\": ...,\n  \"selected_emm_cont_circuit\": ...,\n  \"mixing_valve\": ...,\n  # (Optional) custom emitter tables\n  # \"TB14\": ...,\n  # \"heat_emission_data\": pd.DataFrame(...),\n  \"mixing_valve_delta\": ...,\n  # \"constant_flow_temp\": ...,\n\n  # Distribution (piping, auxiliaries)\n  \"heat_losses_recovered\": ...,\n  \"distribution_loss_recovery\": ...,\n  \"simplified_approach\": ...,\n  \"distribution_aux_recovery\": ...,\n  \"distribution_aux_power\": ...,\n  \"distribution_loss_coeff\": ...,\n  \"distribution_operation_time\": ...,\n\n  # Generator (boiler/HP/plant loop)\n  \"full_load_power\": ...,\n  \"max_monthly_load_factor\": ...,\n  \"tH_gen_i_ON\": ...,\n  \"auxiliary_power_generator\": ...,\n  \"fraction_of_auxiliary_power_generator\": ...,\n  \"generator_circuit\": ...,\n\n  # Generator flow-temperature control\n  \"gen_flow_temp_control_type\": ...,\n  \"gen_outdoor_temp_data\": pd.DataFrame(...),\n\n  \"speed_control_generator_pump\": ...,\n  \"generator_nominal_deltaT\": ...,\n  \"mixing_valve_delta\": ...,\n\n  # Optional explicit generator setpoints\n  # \"\u03b8HW_gen_flw_set\": ...,\n  # \"\u03b8HW_gen_ret_set\": ...,\n\n  # Efficiency model\n  \"efficiency_model\": ...,\n\n  # Calculation options\n  \"calc_when_QH_positive_only\": ...,\n  \"off_compute_mode\": ...,\n}\n</code></pre>"},{"location":"iso_15316_input/#emitter-block-room-side-heat-delivery","title":"Emitter block (room-side heat delivery)","text":"Field Type Example Meaning <code>emitter_type</code> <code>str</code> <code>\"Floor heating 1\"</code> Emitter family/preset. Used to pick default emission characteristics. <code>nominal_power</code> <code>float</code> <code>8</code> Nominal emitter power (kW thermal). Used for checks and backstops in emission calc. <code>emission_efficiency</code> <code>float</code> <code>90</code> Emission efficiency in % (heat delivered to room vs heat from circuit). <code>flow_temp_control_type</code> <code>str</code> <code>\"Type 2 - Based on outdoor temperature\"</code> How the emitter flow temperature is determined. See control strategies below. <code>selected_emm_cont_circuit</code> <code>int</code> <code>0</code> Index if multiple heating zones/circuits exist (0-based). <code>mixing_valve</code> <code>bool</code> <code>True</code> If a mixing valve is present on emitter circuit (affects achievable flow temp and differential). <code>mixing_valve_delta</code> <code>float</code> <code>2</code> \u00b0C delta used when mixing valve is active (typical blending margin). <code>constant_flow_temp</code> <code>float</code> (optional) <code>42</code> Overrides control curve with a constant emitter flow setpoint (\u00b0C). Commented by default."},{"location":"iso_15316_input/#optional-custom-emitter-tables","title":"Optional custom emitter tables","text":"<p>You can override internal presets using one or both of the following:</p> <ul> <li><code>TB14</code>: a custom structure/table with manufacturer data (e.g., output vs. \u0394T, flow temperature limits). Uncomment and provide your object to replace defaults.</li> <li><code>heat_emission_data</code>: a compact <code>pandas.DataFrame</code> describing key points for the emitter control for a given circuit. Example:</li> </ul> <pre><code>heat_emission_data = pd.DataFrame({\n    \"\u03b8H_em_flw_max_sahz_i\": [45],  # Max flow temp (\u00b0C) for space-heating zone i\n    \"\u0394\u03b8H_em_w_max_sahz_i\": [8],    # Max \u0394T flow-return (K) for zone i\n    \"\u03b8H_em_ret_req_sahz_i\": [20],  # Desired return temp (\u00b0C)\n    \"\u03b2H_em_req_sahz_i\": [80],      # Desired load factor at ON/OFF (%)\n    \"\u03b8H_em_flw_min_tz_i\": [28],    # Minimum flow temp (\u00b0C) for zone i\n}, index=[\n    \"Max flow temperature HZ1\",\n    \"Max \u0394\u03b8 flow / return HZ1\",\n    \"Desired return temperature HZ1\",\n    \"Desired load factor with ON-OFF for HZ1\",\n    \"Minimum flow temperature for HZ1\"\n])\n</code></pre> <p>Tip: If both <code>TB14</code> and <code>heat_emission_data</code> are provided, clarify which one your backend prioritizes to avoid ambiguity.</p>"},{"location":"iso_15316_input/#distribution-block-piping-network-auxiliaries","title":"Distribution block (piping network &amp; auxiliaries)","text":"Field Type Example Meaning <code>heat_losses_recovered</code> <code>bool</code> <code>True</code> If pipe losses are partly useful to the heated space. <code>distribution_loss_recovery</code> <code>float</code> <code>90</code> % of distribution losses recovered inside the conditioned volume. <code>simplified_approach</code> <code>float</code> <code>80</code> % shortcut for simplified loss approach (e.g., rule-of-thumb recovery or reduction). <code>distribution_aux_recovery</code> <code>float</code> <code>80</code> % of auxiliary power (pumps/controls) considered as useful internal gain. <code>distribution_aux_power</code> <code>float</code> <code>30</code> Auxiliary electric power (W) of distribution. <code>distribution_loss_coeff</code> <code>float</code> <code>48</code> Global distribution loss coefficient (W/K) or equivalent scalar used by model. <code>distribution_operation_time</code> <code>float</code> <code>1</code> Fraction of time distribution is active (0..1, per-step multiplier)."},{"location":"iso_15316_input/#generator-block-plant-production-side","title":"Generator block (plant production side)","text":"Field Type Example Meaning <code>full_load_power</code> <code>float</code> <code>27</code> Generator thermal capacity at full load (kW). <code>max_monthly_load_factor</code> <code>float</code> <code>100</code> % cap on monthly load factor (for derating/limitations). <code>tH_gen_i_ON</code> <code>float</code> <code>1</code> Minimum ON time (h) or start-up horizon used for cycling logic. <code>auxiliary_power_generator</code> <code>float</code> <code>0</code> % or W (per model) for generator auxiliary power; used in energy balances. <code>fraction_of_auxiliary_power_generator</code> <code>float</code> <code>40</code> % of generator auxiliaries credited as internal gains. <code>generator_circuit</code> <code>str</code> <code>\"independent\"</code> Hydraulic layout: <code>\"direct\"</code> or <code>\"independent\"</code> (primary/secondary with HX)."},{"location":"iso_15316_input/#generator-flow-temperature-control","title":"Generator flow-temperature control","text":"Field Type Example Meaning <code>gen_flow_temp_control_type</code> <code>str</code> <code>\"Type A - Based on outdoor temperature\"</code> Generator flow control strategy (see \u00a75). <code>gen_outdoor_temp_data</code> <code>pd.DataFrame</code> see below Outdoor reset curve for the generator flow temperature. <code>speed_control_generator_pump</code> <code>str</code> <code>\"variable\"</code> Pump control mode: <code>\"fixed\"</code> or <code>\"variable\"</code>. <code>generator_nominal_deltaT</code> <code>float</code> <code>20</code> Nominal \u0394T (K) across the generator loop. <code>mixing_valve_delta</code> <code>float</code> <code>2</code> If a mixing valve exists on primary, blending margin (\u00b0C). <code>\u03b8HW_gen_flw_set</code> <code>float</code> (opt) <code>50</code> Override: fixed generator flow temperature (\u00b0C). <code>\u03b8HW_gen_ret_set</code> <code>float</code> (opt) <code>40</code> Override: fixed generator return temperature (\u00b0C). <p>Example: outdoor reset table</p> <pre><code>gen_outdoor_temp_data = pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],   # cold design outdoor temp (\u00b0C)\n    \"\u03b8ext_max_gen\": [15],   # warm boundary (\u00b0C)\n    \"\u03b8flw_gen_max\": [60],   # flow setpoint at \u03b8ext_min_gen (\u00b0C)\n    \"\u03b8flw_gen_min\": [35],   # flow setpoint at \u03b8ext_max_gen (\u00b0C)\n}, index=[\"Generator curve\"])\n</code></pre> <p>The controller interpolates a target flow temperature between <code>(\u03b8ext_min_gen, \u03b8flw_gen_max)</code> and <code>(\u03b8ext_max_gen, \u03b8flw_gen_min)</code>. Values are clipped outside the range.</p>"},{"location":"iso_15316_input/#control-strategies-cheat-sheet","title":"Control strategies (cheat sheet)","text":""},{"location":"iso_15316_input/#emitter-flow_temp_control_type","title":"Emitter <code>flow_temp_control_type</code>","text":"<p>Common patterns (implementation-dependent; typical meanings): - Type 1 \u2013 Constant setpoint: use <code>constant_flow_temp</code> (\u00b0C). - Type 2 \u2013 Based on outdoor temperature: emitter flow is computed via an outdoor reset (may reuse the generator curve or a dedicated one). - Type 3 \u2013 Room feedback: modulate flow to maintain room operative temperature; requires a PI logic in the backend. - Type 4 \u2013 Return-limited: aim for a maximum return temperature (useful in condensing systems).</p> <p>Note: Your codebase may define the exact meanings of each \"Type N\". Ensure the UI/CLI lists allowed values.</p>"},{"location":"iso_15316_input/#52-generator-gen_flow_temp_control_type","title":"5.2 Generator <code>gen_flow_temp_control_type</code>","text":"<ul> <li>Type A \u2013 Based on outdoor temperature: uses <code>gen_outdoor_temp_data</code> (reset curve).  </li> <li>Type B \u2013 Constant: use <code>\u03b8HW_gen_flw_set</code> and optionally <code>\u03b8HW_gen_ret_set</code>.  </li> <li>Type C \u2013 Demand-following: track emitter request (requires coupling logic and min/max clamps).</li> </ul>"},{"location":"iso_15316_input/#efficiency-model","title":"Efficiency model","text":"Field Allowed Notes <code>efficiency_model</code> <code>\"simple\"</code>, <code>\"map\"</code>, <code>\"manufacturer\"</code> <code>\"simple\"</code> applies fixed or curve-based efficiencies. <code>\"map\"</code> uses performance maps. <code>\"manufacturer\"</code> expects detailed tables (COP/\u03b7 vs. temp/load). <p>Backends typically compute delivered heat, electric/primary energy, and auxiliary fractions accordingly.</p>"},{"location":"iso_15316_input/#calculation-options","title":"Calculation options","text":"Field Type Meaning <code>calc_when_QH_positive_only</code> <code>bool</code> If <code>True</code>, run generator/distribution only when building heating need <code>Q_H &gt; 0</code>. <code>off_compute_mode</code> <code>str</code> How to treat the system when off: <code>\"full\"</code> (still compute temps/losses), <code>\"idle\"</code> (minimal), or <code>\"temps\"</code> (only temperatures)."},{"location":"iso_15316_input/#units-conventions","title":"Units &amp; conventions","text":"<ul> <li>Temperatures in \u00b0C, \u0394T in K (numerically the same scale).</li> <li>Powers: <code>kW</code> for generator/emitter nominal; auxiliaries commonly in W (check your backend).</li> <li>Efficiencies and fractions input as percent (0\u2013100) unless otherwise specified.</li> <li>Curves are per-circuit unless stated global.</li> <li>Time base: typically hourly steps.</li> </ul>"},{"location":"iso_15316_input/#validation-checklist","title":"Validation checklist","text":"<ul> <li>[ ] <code>nominal_power</code> \u2264 <code>full_load_power</code> (kW).  </li> <li>[ ] <code>emission_efficiency</code> \u2208 [0, 100].  </li> <li>[ ] <code>distribution_loss_recovery</code>, <code>distribution_aux_recovery</code> \u2208 [0, 100].  </li> <li>[ ] <code>distribution_operation_time</code> \u2208 [0, 1].  </li> <li>[ ] Outdoor reset: <code>\u03b8flw_gen_max</code> \u2265 <code>\u03b8flw_gen_min</code>, <code>\u03b8ext_min_gen</code> &lt; <code>\u03b8ext_max_gen</code>.  </li> <li>[ ] If <code>constant_flow_temp</code> is set, control type must accept constants.  </li> <li>[ ] <code>generator_circuit</code> \u2208 {<code>\"direct\"</code>, <code>\"independent\"</code>}.  </li> <li>[ ] <code>speed_control_generator_pump</code> \u2208 {<code>\"fixed\"</code>, <code>\"variable\"</code>}.</li> </ul>"},{"location":"iso_15316_input/#minimal-working-example","title":"Minimal working example","text":"<pre><code>INPUT_SYSTEM_HVAC = {\n  # Emitter\n  \"emitter_type\": \"Floor heating 1\",\n  \"nominal_power\": 8,                  # kW\n  \"emission_efficiency\": 90,           # %\n  \"flow_temp_control_type\": \"Type 2 - Based on outdoor temperature\",\n  \"selected_emm_cont_circuit\": 0,\n  \"mixing_valve\": True,\n  \"mixing_valve_delta\": 2,\n\n  # Distribution\n  \"heat_losses_recovered\": True,\n  \"distribution_loss_recovery\": 90,    # %\n  \"simplified_approach\": 80,           # %\n  \"distribution_aux_recovery\": 80,     # %\n  \"distribution_aux_power\": 30,        # W\n  \"distribution_loss_coeff\": 48,       # W/K (model scalar)\n  \"distribution_operation_time\": 1.0,  # 0..1\n\n  # Generator\n  \"full_load_power\": 27,               # kW\n  \"max_monthly_load_factor\": 100,      # %\n  \"tH_gen_i_ON\": 1,                    # h\n  \"auxiliary_power_generator\": 0,      # (backend-defined units)\n  \"fraction_of_auxiliary_power_generator\": 40,  # %\n  \"generator_circuit\": \"independent\",\n\n  # Generator control\n  \"gen_flow_temp_control_type\": \"Type A - Based on outdoor temperature\",\n  \"gen_outdoor_temp_data\": pd.DataFrame({\n      \"\u03b8ext_min_gen\": [-7],\n      \"\u03b8ext_max_gen\": [15],\n      \"\u03b8flw_gen_max\": [60],\n      \"\u03b8flw_gen_min\": [35],\n  }, index=[\"Generator curve\"]),\n\n  \"speed_control_generator_pump\": \"variable\",\n  \"generator_nominal_deltaT\": 20,      # K\n  \"mixing_valve_delta\": 2,\n\n  # Efficiency\n  \"efficiency_model\": \"simple\",\n\n  # Options\n  \"calc_when_QH_positive_only\": False,\n  \"off_compute_mode\": \"full\",\n}\n</code></pre>"},{"location":"iso_15316_input/#advanced-customization-tips","title":"Advanced customization tips","text":"<ul> <li>Multiple heating circuits: use <code>selected_emm_cont_circuit</code> to switch presets, or pass a per-circuit <code>heat_emission_data</code> table.  </li> <li>Manufacturer curves: provide detailed COP/efficiency maps via <code>efficiency_model=\"manufacturer\"</code> and custom data structures.  </li> <li>Hydraulic separation: with <code>generator_circuit=\"independent\"</code>, remember the additional HX \u0394T and any mixing valve limits.  </li> <li>Low-temperature systems: ensure <code>\u03b8flw_gen_min</code> is compatible with emitter requirements; increase surface area or lower setpoints if needed.</li> </ul>"},{"location":"iso_15316_input/#glossary","title":"Glossary","text":"<ul> <li>Emitter: the device exchanging heat with the room (radiators, floor heating).  </li> <li>Distribution: pipes, valves, pumps between generator and emitters.  </li> <li>Generator: heat source (boiler, heat pump, plant loop).  </li> <li>Outdoor reset: a curve that sets flow temperature based on outdoor air temperature.  </li> <li>\u0394T (delta T): temperature difference (usually flow minus return).</li> </ul> <p>Prepared for integration with the ISO 15316/52016-based timeseries heating model.</p>"},{"location":"iso_15316_system_inputs/","title":"ISO 15316 - HVAC System inputs","text":""},{"location":"iso_15316_system_inputs/#hvac-system-inputs","title":"HVAC SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"iso_15316_system_inputs/#emission","title":"EMISSION","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</li> <li> <p>mixing valve delta: it is the offset temperature of the mixing valve in \u00b0C. It refers to the varaible mixing_valve_delta. </p> <ul> <li> <p>The offset refers to the temperature difference between the desired temperature and the actual temperature, which is applied when mixing hot and cold water.</p> </li> <li> <p>In this case, the parameter \u0394\u03b8H_em_mix_sahz_i represents the temperature offset applied by the mixing valve, with a default value set to 2\u00b0C (as defined in the code).</p> </li> <li> <p>This means that when the mixing valve is operating, it will allow a 2\u00b0C deviation from the desired temperature to account for system dynamics, such as heat losses, system inertia, or external temperature influences.</p> </li> </ul> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0 <p>heat_emission_data: it is the table that contains the data of the emission circuit. If it is not provided the default values are used and the emitter_type is set to the first one in the table. In the code we have the function <code>_default_emission_data()</code> that returns the default values. These values are default emission circuit parameters for the heating system\u2019s secondary side (the side connected to heating emitters, such as radiators or underfloor heating).  They represent nominal and operational setpoints for a single heating zone (HZ1), including flow/return temperatures and load control factors.</p> <p>Table 4: Emission circuit data</p> Parameter (column name) Description Default Value Unit <code>\u03b8H_em_flw_max_sahz_i</code> Maximum flow temperature for the heating emission circuit 45 \u00b0C <code>\u0394\u03b8H_em_w_max_sahz_i</code> Maximum water flow/return temperature difference 8 \u00b0C <code>\u03b8H_em_ret_req_sahz_i</code> Desired return temperature of the emission circuit 20 \u00b0C <code>\u03b2H_em_req_sahz_i</code> Desired load factor with ON/OFF control 80 % <code>\u03b8H_em_flw_min_tz_i</code> Minimum required flow temperature for the thermal zone 28 \u00b0C"},{"location":"iso_15316_system_inputs/#distribution","title":"DISTRIBUTION","text":"<p><pre><code># --- distribution ---\n'heat_losses_recovered': True,\n'distribution_loss_recovery': 90,\n'simplified_approach': 80,\n'distribution_aux_recovery': 80,\n'distribution_aux_power': 30,\n'distribution_loss_coeff': 48,\n'distribution_operation_time': 1,\n</code></pre> The parameters are used inside the class HeatingSystemCalculator as:</p> <pre><code>self.Heat_losses_recovered = inp.get('heat_losses_recovered', True)\nself.f_h_dist_i_ls = inp.get('distribution_loss_recovery', 90)  # %\nself.simplified_or_holistic_approach = inp.get('simplified_approach', 80)  # %\nself.f_h_dist_i_aux = inp.get('distribution_aux_recovery', 80)  # %\nself.W_H_dist_i_aux = inp.get('distribution_aux_power', 30)  # W\nself.Heat_loss_coefficent_dist = inp.get('distribution_loss_coeff', 48)  # W/K\nself.tH_dis_i_ON = inp.get('distribution_operation_time', 1)  # h\n</code></pre> <p>if data is not provided by the user, the default values are used.</p> <p>These parameters describe the thermal and electrical behavior of the heat distribution subsystem, which connects the generator to the emitters (secondary circuits). They define how heat losses, auxiliary energy use, and simplifications in the calculation are handled within the ISO 15316-1 framework.</p> Variable Description Default Unit <code>heat_losses_recovered</code> Boolean flag that defines whether distribution heat losses are considered recoverable in the building (e.g., heat lost in indoor piping contributes to heating). <code>True</code> \u2013 <code>distribution_loss_recovery</code> (<code>f_h_dist_i_ls</code>) Fraction of distribution losses that are recoverable (typically within the heated zone). <code>90</code> % <code>simplified_approach</code> (<code>simplified_or_holistic_approach</code>) Defines the calculation approach for recovered losses: a simplified method (<code>&gt; 0</code>) or a holistic method (<code>0</code> for detailed ISO modeling). <code>80</code> % <code>distribution_aux_recovery</code> (<code>f_h_dist_i_aux</code>) Fraction of auxiliary electrical power (e.g., pumps, valves) that is converted into useful heat and recovered within the heated space. <code>80</code> % <code>distribution_aux_power</code> (<code>W_H_dist_i_aux</code>) Rated auxiliary electrical power of the distribution system (e.g., circulation pumps). <code>30</code> W <code>distribution_loss_coeff</code> (<code>Heat_loss_coefficent_dist</code>) Overall heat loss coefficient of the distribution system, representing thermal losses per degree of temperature difference between the fluid and ambient air. <code>48</code> W/K <code>distribution_operation_time</code> (<code>tH_dis_i_ON</code>) Average operation time of the distribution system per time step (typically the same as the emission system). <code>1</code> h"},{"location":"iso_15316_system_inputs/#generation","title":"GENERATION","text":"<p>The generator is modelled using the following parameters:</p> <pre><code>    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"])\n    '\u03b8HW_gen_flw_const': 50.0\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20\n</code></pre> <p>That are: </p> <ul> <li>load power: it is the power of the generator in kW, defined in the product data. variable name: 'full_load_power'</li> <li>max monthly load factor: it is the maximum load factor of the generator in %.  variable_name: 'max_monthly_load_factor'</li> <li>tH_gen_i_ON: it is the time of the generator in ON state in hours. variable_name: 'tH_gen_i_ON'</li> </ul> <ul> <li>auxiliary power generator: Percentage of generator input energy used by auxiliary systems (generally 0-5 %).Increases total system energy input. variable_name: 'auxiliary_power_generator'</li> <li> <p>fraction of auxiliary power generator: it is the portion of auxiliary energy recovered as heat (generally 20\u201360%). Reduces auxiliary losses.variable_name: 'fraction_of_auxiliary_power_generator'.</p> <p> 1. <code>auxiliary_power_generator</code> This parameter defines how much additional electrical power (in %) is consumed by the generator\u2019s own auxiliary components, such as:</p> <ul> <li>Circulation pumps  </li> <li>Combustion or ventilation fans  </li> <li>Electronic controls and sensors  </li> <li>Ignition systems  </li> <li>Internal electronics (standby mode)</li> </ul> <p>Formula:</p> \\[ E_{HW,gen,aux} = E_{HW,gen,in} \\times \\frac{\\text{auxiliary\\_power\\_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( E_{HW,gen,in} \\): Generator input energy (kWh)  </li> <li>\\( E_{HW,gen,aux} \\): Auxiliary energy consumed (kWh)</li> </ul> <p> 2. <code>fraction_of_auxiliary_power_generator</code></p> <p>This parameter represents the fraction of auxiliary power that is recoverable as useful heat. Some auxiliary systems release heat that can be recovered by the generator\u2019s thermal circuit.</p> <p>For example: - Pump motors or internal electronics may release part of their heat to the water loop. - Fans or controllers might dissipate energy inside the generator casing.</p> <p>Formula:</p> \\[ Q_{W,gen,i,ls,rbl,H} = E_{HW,gen,aux} \\times \\frac{\\text{fraction_of_auxiliary_power_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( Q_{W,gen,i,ls,rbl,H} \\): Recovered auxiliary heat (kWh)</li> </ul> </li> </ul> <ul> <li>generator circuit: it is the circuit of the generator. It can be 'direct' or 'independent'. variable_name: 'generator_circuit'<ul> <li>Direct: the generator is connected to the primary circuit, no hydraulic separation primary = secondary</li> <li>Independent: the generator is connected to the secondary circuit, with hydraulic separator primary != secondary</li> </ul> </li> </ul> <p>The primary circuit supply temperature setpoint (Tp_sup_set), i.e., the flow temperature on the generator side (boiler, heat pump, etc.) is calculated using the function _generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand), according to the selected control strategy of the generation system</p> <p>It determines how hot the generator should make the supply water based on: - the outdoor temperature (\u03b8ext), and/or - the heating demand from the distribution/emission side (\u03b8H_dis_flw_demand), and/or - a fixed setpoint defined by the user.</p> <p>The input parameters of the function are:</p> <ul> <li>\u03b8ext: outdoor air temperature</li> <li>\u03b8H_dis_flw_demand: Flow temperature requested by the secondary circuit (distribution/emission side)</li> </ul> <p>with global inputs that are:</p> <ul> <li>df_gen_out_temp: Table defining the primary (generator) heating curve</li> <li> <p>gen_flow_temp_control_type: Type of control used to control the flow temperature of the generator.Defines which control strategy is used (\u201cType A\u201d, \u201cType B\u201d, \u201cType C\u201d):</p> <ul> <li>'Type A - Based on outdoor temperature': uses primary's own weather curve</li> <li>'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)</li> <li>'Type C - Constant temperature'       : uses \u03b8HW_gen_flw_const</li> </ul> </li> <li> <p>\u03b8HW_gen_flw_const: Constant flow temperature of the generator</p> </li> </ul> <p>The user should provide the information directly in the dictionary:</p> <pre><code>'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n'gen_outdoor_temp_data': pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],\n    \"\u03b8flw_gen_min\": [35],\n}, index=[\"Generator curve\"])\n'\u03b8HW_gen_flw_const': 50.0\n</code></pre> <p>where, in the code are defined as: </p> <p><pre><code>self.df_gen_out_temp = inp.get('gen_outdoor_temp_data', pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],   # \u00b0C, max primary supply\n    \"\u03b8flw_gen_min\": [35],   # \u00b0C, min primary supply\n}, index=[\"Generator curve\"]))\n\nself.gen_flow_temp_control_type = inp.get(\n    'gen_flow_temp_control_type',\n    'Type A - Based on outdoor temperature'   # 'Type A' | 'Type B' | 'Type C'\n)\n\nself.\u03b8HW_gen_flw_const = float(inp.get('\u03b8HW_gen_flw_const', 50.0))\n</code></pre> Explanation of the different type of control:</p> <ul> <li> Type A - Based on outdoor temperature. Climatic curve (outdoor compensation) <pre><code>if ctrl.startswith('Type A'):\n    if \u03b8ext_max != \u03b8ext_min:\n        Tp = \u03b8flw_min + (\u03b8flw_max - \u03b8flw_min) * (\u03b8ext_max - \u03b8ext) / (\u03b8ext_max - \u03b8ext_min)\n        return max(min(Tp, \u03b8flw_max), \u03b8flw_min)\n    return \u03b8flw_min\n</code></pre> Calculates the generator flow temperature linearly based on outdoor temperature. Equation: The generator flow temperature \\( T_{p, \\text{set}} \\) is calculated linearly based on the outdoor temperature \\( \\theta_{\\text{ext}} \\), following the formula:</li> </ul> \\[ T_{p, \\text{set}} = T_{\\text{flw}, \\text{min}} + \\left( T_{\\text{flw}, \\text{max}} - T_{\\text{flw}, \\text{min}} \\right) \\cdot \\frac{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}} \\right)}{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}, \\text{min}} \\right)} \\] <p>Where:</p> <ul> <li>\\( T_{\\text{flw}, \\text{min}} \\) = minimum flow temperature (e.g., 35\u00b0C)</li> <li>\\( T_{\\text{flw}, \\text{max}} \\) = maximum flow temperature (e.g., 60\u00b0C)</li> <li>\\( \\theta_{\\text{ext}} \\) = outdoor air temperature</li> <li>\\( \\theta_{\\text{ext}, \\text{min}} \\) = minimum outdoor temperature (e.g., -7\u00b0C)</li> <li>\\( \\theta_{\\text{ext}, \\text{max}} \\) = maximum outdoor temperature (e.g., 15\u00b0C) The calculated \\( T_{p, \\text{set}} \\) is then clamped between the minimum and maximum values:</li> </ul> \\[ T_{p, \\text{set}} = \\max\\left( \\min\\left( T_{p, \\text{set}}, T_{\\text{flw}, \\text{max}} \\right), T_{\\text{flw}, \\text{min}} \\right) \\] <p>\ud83d\udc49\ud83c\udffb Meaning: This is the typical weather-compensated control used (for example) in boilers and heat pumps. It automatically adjusts water temperature to the outdoor conditions for better efficiency and comfort. Example visualization of type A: <pre><code>Generator flow temperature (\u00b0C)\n\u2502\n\u2502    60\u00b0C \u2500\u2500\u2500\u2500\u2510\n\u2502              \\\n\u2502               \\\n\u2502                \\\n\u2502                 \\\n\u2502    35\u00b0C \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Outdoor temperature (\u00b0C)\n          -7          0           +15\n</code></pre></p> <ul> <li> <p> Type B - Based on demand. Follow secondary demand <pre><code>if ctrl.startswith('Type B'):\n    return float(\u03b8H_dis_flw_demand)\n</code></pre> Sets the generator supply temperature equal to the demand from the secondary (distribution/emission) side. \ud83d\udc49\ud83c\udffb Meaning: This is used in systems with hydraulic separation (e.g., with a buffer tank or heat exchanger) where the generator must match the needs of the secondary circuit dynamically. Example: If the radiator loop requests 45 \u00b0C \u2192 the generator must deliver exactly 45 \u00b0C to maintain balance.</p> </li> <li> <p> Type C - Constant temperature <pre><code>return float(self.\u03b8HW_gen_flw_const)\n</code></pre> Ignores weather and demand \u2014 the generator runs at a fixed supply temperature (e.g., 50 \u00b0C). \ud83d\udc49\ud83c\udffb Meaning: Simplest and oldest control type, often found in small or legacy heating systems. It offers no adaptation to weather or load, typically less efficient. Example: If the user defines a constant supply temperature of 50 \u00b0C \u2192 the generator will always deliver 50 \u00b0C, regardless of the demand from the secondary circuit.</p> </li> </ul> <ul> <li>speed control of generator pump: icontrols how \u0394T varies with system load (constant vs variable). It can be in the code 'variable' or 'deltaT_constant'. variable_name: 'speed_control_generator_pump'</li> <li> <p>Nominal water deltaT of generator: defines the nominal \u0394T at design (full load) \u2014 the reference used in thermal balance equations in \u00b0C. variable_name: 'generator_nominal_deltaT'. It is used if speed_control_of_generator_pump is 'deltaT_constant'.</p> <p>More info:</p> <ul> <li><code>\"deltaT_constant\"</code> \u2192 The pump maintains a fixed temperature difference (\u0394T) between flow and return.</li> <li>Example: The pump adjusts its speed so that \u0394T = 20 \u00b0C remains constant.</li> <li><code>\"variable\"</code> \u2192 The pump varies its speed dynamically according to the system load.</li> <li>When heating demand decreases, the water flow rate decreases.</li> <li>This leads to a smaller \u0394T at partial loads, improving efficiency.</li> </ul> <p>When <code>variable</code>, the temperature difference (\u0394T) decreases proportionally with the thermal load, which represents real modulating behavior of pumps and heat generators.</p> <p><code>generator_nominal_deltaT</code></p> <p>Defines the nominal temperature difference (\u0394T) between the generator flow and return at full-load conditions.</p> \\[ \\Delta T_{nom} = T_{flow,nominal} - T_{return,nominal} \\] <p>This is the design operating condition for the generator, used as a reference in calculations.</p> <p>Example:</p> <p>If <code>generator_nominal_deltaT = 20</code>, then at full load:</p> <ul> <li>Supply temperature = 60 \u00b0C  </li> <li>Return temperature = 40 \u00b0C \u2192 \u0394T = 20 \u00b0C  </li> </ul> <p>At partial load:</p> <ul> <li>If <code>speed_control_generator_pump = \"deltaT_constant\"</code> \u2192 \u0394T remains 20 \u00b0C.  </li> <li>If <code>speed_control_generator_pump = \"variable\"</code> \u2192 \u0394T may drop to 10\u201315 \u00b0C, depending on demand.</li> </ul> </li> </ul> <p>It is possible to define the optional primary setpoints (used if circuit is independent).</p> <ul> <li>\u03b8HW_gen_flw_set: flow temperature setpoint</li> <li>\u03b8HW_gen_ret_set: return temperature setpoint</li> </ul>"},{"location":"iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <pre><code>1) 'simple'       : linear heuristic vs. return temperature\n2) 'parametric'   : piecewise/threshold model\n3) 'manufacturer' : 1D (return) or 2D (flow/return) map\n</code></pre> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic</p> <p>1) Detect zero or negative heating demand</p> <p><pre><code>if float(qh) &lt;= 0:\n</code></pre> This means there is no heating required (or possibly cooling). Now the function checks which policy is set for such cases.</p> <p>2) Case 1 \u2014 Full simulation even when Q_H = 0 <pre><code>if not self.calc_when_QH_positive_only:\n    # Full calculation even with zero load\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n    ...\n</code></pre></p> <ul> <li>Here, the flag calc_when_QH_positive_only is False, so the user wants to compute everything even when there\u2019s no load.</li> <li> <p>It runs the complete thermal balance by calling: <pre><code>res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre> This means: compute system temperatures, efficiencies, flow rates, etc., as if the system were still active but with zero heating power.</p> </li> <li> <p>The results are appended to the output DataFrame as usual.</p> </li> </ul> <p>Use case: See how the system behaves under \u201cno load\u201d conditions (e.g., during shoulder months) \u2014 including standby losses or auxiliary power.</p> <p>3) Case 2 \u2014 Skip detailed calculation (calc_when_QH_positive_only = True)</p> <p>If this flag is True, the system should behave differently depending on how \u201coff periods\u201d are treated.</p> <p>There are three \u201coff modes\u201d controlled by self.off_compute_mode.</p> <ul> <li> <p> a) Mode: 'idle' \u2192 Minimal record  <pre><code>if self.off_compute_mode == 'idle':\n    res_row = {'timestamp': idx}\n    res_row.update(self._idle_row(0.0, float(\u03b8int), float(\u03b8ext)))\n</code></pre></p> <ul> <li>Produces a minimal output line using _idle_row().</li> <li>This function fills the row mostly with zeros or NaN values \u2014 representing that nothing is being calculated because the system is idle.</li> <li>Only basic fields like timestamp, indoor temperature, and outdoor temperature are kept.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For speed optimization when simulating a full year \u2014 avoids doing unnecessary physics calculations.</p> </li> <li> <p> b) Mode: 'temps' \u2192 Record only temperatures  <pre><code>elif self.off_compute_mode == 'temps':\n    res = self._temps_row_when_off(float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>This still computes temperatures (like circuit or node flow/return) using _temps_row_when_off(),</li> <li>but all energetic terms (flows, powers, losses) are set to zero.</li> <li>This way, you can visualize how the temperature control or mixing valves behave even with zero heating demand.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For continuous temperature mapping, useful when validating system controls or comfort conditions.</p> </li> <li> <p> c) Mode: 'full' \u2192 Full calculation despite Q_H = 0  <pre><code>elif self.off_compute_mode == 'full':\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>Similar to Case 1 but triggered explicitly by mode 'full' \u2014 performs a complete computation of all variables even if load = 0.</li> <li>This is a \u201cforce full calc\u201d inside the zero-demand policy.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: When testing or debugging; ensures identical data structure across all timesteps.</p> </li> </ul> <p>4) continue statements</p> <p>Each branch ends with continue \u2014 \u2192 meaning the loop moves to the next timestep immediately after handling this case. No further code in the timestep is executed once the \u201czero-load\u201d policy has been applied.</p> <p>General-physical interpretation </p> <p>This logic helps balance accuracy vs performance:</p> <p>In annual simulations (8760 hours), 70\u201390% of the time may have zero heating demand (e.g., in summer). Recomputing all hydraulic and thermal equations each hour would waste time.</p> <p>Therefore, this control allows skipping unnecessary computations or simplifying the result depending on your simulation purpose:</p> <ul> <li>\"idle\" \u2192 fastest</li> <li>\"temps\" \u2192 medium (keep comfort analysis)</li> <li>\"full\" \u2192 slowest but most complete</li> </ul> <p>Example of inputs system: <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n    'heat_emission_data' : pd.DataFrame({\n            \"\u03b8H_em_flw_max_sahz_i\": [45],\n            \"\u0394\u03b8H_em_w_max_sahz_i\": [8],\n            \"\u03b8H_em_ret_req_sahz_i\": [20],\n            \"\u03b2H_em_req_sahz_i\": [80],\n            \"\u03b8H_em_flw_min_tz_i\": [28],\n        }, index=[\n            \"Max flow temperature HZ1\",\n            \"Max \u0394\u03b8 flow / return HZ1\",\n            \"Desired return temperature HZ1\",\n            \"Desired load factor with ON-OFF for HZ1\",\n            \"Minimum flow temperature for HZ1\"\n        ])\n\n    # --- distribution ---\n    'heat_losses_recovered': True,\n    'distribution_loss_recovery': 90,\n    'simplified_approach': 80,\n    'distribution_aux_recovery': 80,\n    'distribution_aux_power': 30,\n    'distribution_loss_coeff': 48,\n    'distribution_operation_time': 1,\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n}\n</code></pre></p>"},{"location":"iso_52010/","title":"ISO 52010 - Calculation procedure","text":""},{"location":"iso_52010/#iso-52010-calculation-procedure","title":"ISO 52010 - Calculation procedure","text":"<pre><code>def Calculation_ISO_52010(building_object, path_weather_file, weather_source=\"pvgis\") -&gt; simdf_52010\n</code></pre>"},{"location":"iso_52010/#input","title":"Input","text":"Name Type Description <code>building_object</code> <code>dict</code> or object Building structure; if it is a mapping, a default set of orientations is used. Otherwise, the function reads <code>building_object.orientation_elements</code>. <code>path_weather_file</code> <code>str | PathLike</code> Path to an EPW weather file (used when <code>weather_source=\"epw\"</code>). <code>weather_source</code> <code>str</code> Selects the input weather pipeline. Supported values: <code>\"pvgis\"</code> (TMY fetch via PVGIS) or <code>\"epw\"</code> (local EPW)."},{"location":"iso_52010/#purpose","title":"Purpose","text":"<p>Implements the EN ISO 52010-1 processing pipeline to convert raw climatic data (EPW/PVGIS TMY) into simulation-ready time series and to compute solar irradiance on arbitrary surfaces plus window shading reduction factors. The function returns a wrapper around a <code>pandas.DataFrame</code> containing all derived variables.</p>"},{"location":"iso_52010/#how-it-works","title":"How it works","text":"<ol> <li> <p>Fetch raw weather </p> <ul> <li><code>pvgis</code> \u2192 <code>ISO52010.get_tmy_data_pvgis(building_object)</code> </li> <li><code>epw</code>   \u2192 <code>ISO52010.get_tmy_data_epw(path_weather_file)</code> The result exposes:  </li> <li><code>weather_data</code> \u2192 base <code>DataFrame</code> with hourly variables (UTC)  </li> <li><code>utc_offset</code>   \u2192 integer hours to shift from UTC to local time  </li> <li><code>latitude</code>, <code>longitude</code></li> </ul> </li> <li> <p>Normalize the time index </p> <ul> <li>If not a leap year (<code>len(sim_df) == 8760</code>), rebuild index to a nominal year 2009 using original month/day/hour.</li> <li>Apply <code>np.roll</code> by <code>utc_offset</code> to every column to align to local time.  </li> <li>Rename index axis from <code>time(UTC)</code> \u2192 <code>time(local)</code> and add helpers:  <ul> <li><code>day of year</code> (1\u2013365/366)  </li> <li><code>hour of day</code> (1\u201324, ISO52010 convention)</li> </ul> </li> </ul> </li> <li> <p>Define surface orientations (tilt/azimuth pairs) </p> <pre><code>HOR \u2192 (beta=0,   gamma=0)\nSV  \u2192 (beta=90,  gamma=0)\nEV  \u2192 (beta=90,  gamma=90)\nNV  \u2192 (beta=90,  gamma=180)\nWV  \u2192 (beta=90,  gamma=-90)\n</code></pre> <p>If <code>building_object</code> is a dict, the set <code>{'EV','HOR','SV','NV','WV'}</code> is used; otherwise <code>building_object.orientation_elements</code> is read.</p> </li> <li> <p>For each orientation </p> <ul> <li>Call <code>ISO52010.Solar_irradiance_calculation(...)</code> with: latitude, longitude, timezone, the selected (beta, gamma), input DHI (<code>Gd(h)</code>), DNI (<code>Gb(n)</code>), albedo, and a calendar built from the index.  </li> <li>Concatenate resulting columns (renamed):  <ul> <li><code>I_sol_tot_{ori}</code>, <code>I_sol_dif_{ori}</code>, <code>I_sol_dir_w_{ori}</code> </li> </ul> </li> <li>Compute window shading reduction factor with <code>ISO52010.Shading_reduction_factor_window(...)</code> and append its columns if present.</li> </ul> </li> <li> <p>Warm-up period     Prepend December to the beginning of the series to form a warm-up period:  </p> <pre><code>sim_df = pd.concat([sim_df[sim_df.index.month == 12], sim_df])\n</code></pre> </li> <li> <p>Return wrapper </p> </li> </ol> <pre><code>return simdf_52010(sim_df=sim_df)\n</code></pre>"},{"location":"iso_52010/#outputs","title":"Outputs","text":"Type Description <code>simdf_52010</code> Small wrapper carrying <code>sim_df: pd.DataFrame</code> with weather (local time), solar irradiances by orientation, shading factors, and utility calendar columns."},{"location":"iso_52010/#columns-added-by-the-procedure","title":"Columns Added by the Procedure","text":"<ul> <li>Calendar helpers: <code>day of year</code>, <code>hour of day</code> (1\u201324)  </li> <li>Solar (per orientation):  </li> <li><code>I_sol_tot_{ORI}</code> \u2192 total solar irradiance on the plane (W/m\u00b2)  </li> <li><code>I_sol_dif_{ORI}</code> \u2192 diffuse component on the plane (W/m\u00b2)  </li> <li><code>I_sol_dir_w_{ORI}</code> \u2192 direct beam on the plane adjusted by window incidence (W/m\u00b2)  </li> <li>Shading (when available): one or more <code>W_{window_name}</code> and <code>H_sun_{window_name}</code> series from <code>Shading_reduction_factor_window</code></li> </ul> <p>The base weather columns depend on the chosen source but typically include dry-bulb temperature, relative humidity, wind speed, DHI = <code>Gd(h)</code>, DNI = <code>Gb(n)</code>, and global horizontal.</p>"},{"location":"iso_52010/#orientation-angles","title":"Orientation &amp; Angles","text":"<ul> <li><code>beta</code> = tilt (0\u00b0 = horizontal, 90\u00b0 = vertical)  </li> <li><code>gamma</code> = azimuth (0\u00b0 = South, 90\u00b0 = East, 180\u00b0 = North, -90\u00b0/270\u00b0 = West)  </li> <li>Time index is local after the <code>utc_offset</code> roll.</li> </ul>"},{"location":"iso_52010/#notes","title":"Notes","text":"<ul> <li>Leap year handling: if <code>len(sim_df) &gt; 8760</code> (8784 hours), the index is left as-is and <code>n_days_year=366</code>.  </li> <li><code>np.roll</code> shifts all columns equally; ensure the source weather data are aligned and cyclical.  </li> <li>The warm-up prepend duplicates December; if you perform annual KPIs, exclude the first month accordingly.  </li> <li><code>Shading_reduction_factor_window</code> requires geometric window metadata inside <code>building_object</code>.</li> </ul>"},{"location":"iso_52010/#example","title":"Example","text":"<pre><code>sim = Calculation_ISO_52010(\n    building_object=my_building,\n    path_weather_file=\"../weather/rome.epw\",\n    weather_source=\"epw\"\n)\ndf = sim.sim_df\nprint(df.filter(like=\"I_sol_tot_\").head())\n</code></pre>"},{"location":"iso_52010/#reference","title":"Reference","text":"<ul> <li>EN ISO 52010-1:2017 \u2013 Energy performance of buildings \u2014 External climatic conditions </li> <li><code>Weather_data_bui</code> \u2013 convenience wrapper that returns a <code>simulation_df</code> built on top of this pipeline  </li> <li><code>ISO52010.Solar_irradiance_calculation</code> \u2013 solar geometry &amp; plane-of-array irradiance  </li> <li><code>ISO52010.Shading_reduction_factor_window</code> \u2013 window shading factors per orientation</li> </ul>"},{"location":"iso_52016/","title":"ISO 52016 - Introduction","text":""},{"location":"iso_52016/#iso-5201052016-building-thermal-simulation-module-level","title":"ISO 52010/52016 Building Thermal Simulation \u2013 Module-level","text":"<p>Standard alignment: ISO EN 52010-1 (climate/solar), ISO EN 52016-1 (zone balance), ISO EN 13789 (transmission &amp; unconditioned zones), ISO EN 16798-1/-7 (internal gains &amp; natural ventilation), ISO EN 15316-1 (calculation of system energy requirements and system efficiencies) License: MIT Version: 0.1 Authors: Daniele Antonucci, Ulrich Filippi Oberegger, Olga Somova</p> <p>This documentation explains each function\u2019s purpose, physics, inputs/outputs, algorithmic flow, and edge cases. All equations use SI unless otherwise stated.</p> <p>ISO EN 52016 is a key international standard that defines methods for the calculation of energy needs for heating and cooling, as well as the internal temperatures and sensible and latent heat loads of buildings. It is part of the ISO 52000 family, which provides a comprehensive framework for assessing the energy performance of buildings (EPB) in accordance with European energy efficiency directives.</p>"},{"location":"iso_52016/#purpose-and-scope","title":"Purpose and Scope","text":"<p>The standard provides detailed calculation procedures for:</p> <ul> <li>Hourly or monthly determination of energy needs for space heating and cooling;</li> <li>Evaluation of internal air temperatures in different thermal zones;</li> <li>Calculation of sensible and latent heat loads on the building;</li> <li>Assessment of the impact of building envelope characteristics, internal gains, solar gains, and ventilation.</li> </ul> <p>It replaces and extends earlier standards such as EN ISO 13790, aligning the methodology with modern requirements for dynamic simulation and integration into building energy performance assessments.</p>"},{"location":"iso_52016/#calculation-principles","title":"Calculation Principles","text":"<p>ISO EN 52016 introduces both hourly and monthly calculation methods:</p> <ul> <li>The hourly method offers a dynamic approach suitable for detailed analysis, design, and simulation tools.</li> <li>The monthly method provides simplified procedures for compliance checks and energy certification purposes.</li> </ul> <p>Key aspects considered in the calculations include:</p> <ul> <li>Thermal properties of opaque and transparent envelope elements;</li> <li>Solar and internal heat gains;</li> <li>Ventilation and infiltration rates;</li> <li>Thermal mass and dynamic effects;</li> <li>Zoning and adjacent space interactions.</li> </ul>"},{"location":"iso_52016/#relation-to-other-standards","title":"Relation to Other Standards","text":"<p>ISO EN 52016 works in coordination with:</p> <ul> <li>ISO 52010, which defines the calculation of solar and daylight quantities on building surfaces;</li> <li>ISO 52017, which provides the dynamic hourly simulation framework for the thermal behavior of buildings;</li> <li>ISO 52000-1, which establishes the overall energy performance assessment framework.</li> <li>and other, such asEN ISO 15316-1, EN ISO 16798-1/-7, etc Together, these standards ensure consistency between the physical modeling of buildings, system performance, and overall energy efficiency evaluation.</li> </ul> <p>By harmonizing calculation methods across Europe, ISO EN 52016 helps ensure that building energy performance is transparent, comparable, and technically robust, supporting sustainable design and policy implementation.</p>"},{"location":"iso_52016_adj_zone/","title":"ISO 52016 - Adjacent Zone","text":""},{"location":"iso_52016_adj_zone/#adjacent-zone","title":"Adjacent zone","text":"<p>The <code>adj_zone</code> dictionary provides all necessary geometric and physical properties of an adjacent unconditioned zone (e.g., attic, basement, or corridor) required to compute the transmission heat transfer coefficient according to ISO 13789.</p>"},{"location":"iso_52016_adj_zone/#adjacent-zone-input-adj_zone","title":"Adjacent Zone Input (<code>adj_zone</code>)","text":"<p>It is possible to simulate a not conditioned adjacent zone providing the following input: </p> <p>Example Structure: <pre><code>{\n    \"name\":\"adj_1\",\n    \"orientation_zone\": {\n        \"azimuth\": 0,\n    },\n    \"area_facade_elements\": np.array([20,60,30,30,50,50], dtype=object),\n    \"typology_elements\": np.array(['OP', 'OP', 'OP', 'OP', 'GR', 'OP'], dtype=object),\n    \"transmittance_U_elements\": np.array([0.82, 0.82, 0.82, 0.82, 0.51, 1.16], dtype=object),\n    \"orientation_elements\": np.array(['NV', 'SV', 'EV', 'WV', 'HOR', 'HOR'], dtype=object),\n    'volume': 300, \n    'building_type_class':'Residential_apartment',\n    'a_use':50 \n}\n</code></pre></p>"},{"location":"iso_52016_adj_zone/#field-descriptions","title":"Field Descriptions","text":"Key Type Description <code>name</code> <code>str</code> Identifier of the adjacent zone (e.g., <code>\"adj_1\"</code>). <code>orientation_zone.azimuth</code> <code>float</code> The azimuth angle (in degrees) of the unconditioned zone orientation. Used to determine the facing direction (0\u00b0 = South, 90\u00b0 = East, 180\u00b0 = North, 270\u00b0 = West). <code>area_facade_elements</code> <code>np.array[float]</code> Array of surface areas (m\u00b2) for each fa\u00e7ade element (walls, ground, horizontal slabs, etc.). <code>typology_elements</code> <code>np.array[str]</code> Surface type codes following ISO 13789/52016 conventions:  - <code>OP</code> = Opaque element (wall)  - <code>GR</code> = Ground-contact surface  - <code>HOR</code> = Horizontal surface (roof/floor) <code>transmittance_U_elements</code> <code>np.array[float]</code> U-values (W/m\u00b2\u00b7K) corresponding to each fa\u00e7ade element, representing their thermal transmittance. <code>orientation_elements</code> <code>np.array[str]</code> Orientation of each surface according to ISO 52016 notation:  - <code>NV</code> = North Vertical (north-facing wall)  - <code>SV</code> = South Vertical (south-facing wall)  - <code>EV</code> = East Vertical (east-facing wall)  - <code>WV</code> = West Vertical (west-facing wall)  - <code>HOR</code> = Horizontal (roof or floor) <code>volume</code> <code>float</code> Volume (m\u00b3) of the adjacent unconditioned zone. Used to estimate ventilation exchange with the external environment. <code>building_type_class</code> <code>str</code> Descriptive label for the building type (e.g., <code>\"Residential_apartment\"</code>, <code>\"Office\"</code>, <code>\"Warehouse\"</code>). Used for classification and potential lookup of empirical coefficients. <code>a_use</code> <code>float</code> Reference area of the adjacent zone (m\u00b2). May be used for normalization or reporting."},{"location":"iso_52016_adj_zone/#interpretation-of-orientation-codes","title":"Interpretation of Orientation Codes","text":"Code Meaning Typical Element Azimuth (\u00b0) NV North Vertical North-facing opaque wall 180 SV South Vertical South-facing opaque wall 0 EV East Vertical East-facing opaque wall 90 WV West Vertical West-facing opaque wall 270 HOR Horizontal Roof or ground-contact surface \u2014 GR Ground Floor or basement slab \u2014"},{"location":"iso_52016_adj_zone/#example-breakdown","title":"Example Breakdown","text":"<p>For the example above:</p> Element Typology Orientation Area (m\u00b2) U-Value (W/m\u00b2\u00b7K) Wall_1 OP NV 20 0.82 Wall_2 OP SV 60 0.82 Wall_3 OP EV 30 0.82 Wall_4 OP WV 30 0.82 Floor GR HOR 50 0.51 Roof OP HOR 50 1.16"},{"location":"iso_52016_adj_zone/#notes","title":"Notes","text":"<ul> <li>Arrays in the dictionary (<code>area_facade_elements</code>, <code>U_elements</code>, <code>orientation_elements</code>, etc.) must have the same length \u2014 one entry per building element.  </li> <li>The azimuth determines the active orientation for calculations (<code>NV</code>, <code>SV</code>, <code>EV</code>, <code>WV</code>, <code>HOR</code>).  </li> <li>Default ISO convention assumes 0\u00b0 = South, rotating clockwise (90\u00b0 = East, 180\u00b0 = North, 270\u00b0 = West).  </li> <li>Horizontal (<code>HOR</code>) and ground (<code>GR</code>) elements contribute to transmission but have no azimuth dependency.</li> </ul>"},{"location":"iso_52016_adj_zone/#summary","title":"Summary","text":"<p>The <code>adj_zone</code> input defines the geometry and thermal characteristics of an unconditioned adjacent space. It serves as the foundation for ISO 13789 calculations of: - Transmission losses through opaque and ground-contact elements. - Ventilation and exchange between conditioned and unconditioned spaces. - Monthly distribution and adjustment factors for unconditioned zones.</p> <p>In each not thermal adjacent zone the calcualtion of heat transfer coefficent by transmission is made using the function <code>transmission_heat_transfer_coefficient_ISO13789</code>, thta is based to the EN ISO 13789:2017 standard.</p>"},{"location":"iso_52016_adj_zone/#transmission-heat-transfer-coefficients-en-iso-13789","title":"Transmission heat transfer coefficients - EN ISO 13789","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(cls, adj_zone, n_ue=0.5, qui=0)\n</code></pre>"},{"location":"iso_52016_adj_zone/#inputs","title":"Inputs","text":"Name Type Description <code>adj_zone</code> <code>dict</code> Dictionary containing the geometric and physical properties of the adjacent (unconditioned) zone. Must include surface orientations, areas, U-values, and volume. <code>n_ue</code> <code>float</code>, default <code>0.5</code> Air change rate (h\u207b\u00b9) between the unconditioned zone and the external environment. <code>qui</code> <code>float</code>, default <code>0</code> Airflow rate (m\u00b3/h) between conditioned and unconditioned zones. Typically zero to avoid underestimating transmission."},{"location":"iso_52016_adj_zone/#purpose","title":"Purpose","text":"<p>This function implements the ISO 13789:2017 method for calculating the transmission heat transfer coefficient (<code>H_tr</code>) between conditioned, unconditioned, and external zones of a building.  </p> <p>It provides a quantitative measure of heat losses through building envelope elements and ventilation exchange with unconditioned spaces and the exterior.</p>"},{"location":"iso_52016_adj_zone/#how-it-works","title":"How it works","text":"<p>1) Identify Orientation</p> <p>The function uses the azimuth of the adjacent zone (<code>adj_zone[\"orientation_zone\"][\"azimuth\"]</code>) to map it to an orientation name (<code>NV</code>, <code>SV</code>, <code>EV</code>, <code>WV</code>) based on predefined azimuth angles:</p> Orientation Azimuth (\u00b0) NV 180 SV 0 EV 90 WV 270 <p>2) Extract Arrays</p> <p>From the <code>adj_zone</code> dictionary:   - <code>areas</code>: surface areas (m\u00b2)   - <code>U_values</code>: transmittances (W/m\u00b2K)   - <code>orientations</code>: list of orientation strings for each facade element</p> <p>3) Boolean Masks</p> <p>Two masks are defined to separate:   - <code>mask_selected</code>: surfaces facing the unconditioned zone   - <code>mask_others</code>: other external surfaces</p> <p>4) Transmission Losses</p> <ul> <li>Between conditioned and unconditioned zones: </li> </ul> \\[ H_{d,zt-ztu} = \\sum (A_i \\cdot U_i) \\text{ for selected orientation} \\] <ul> <li>From unconditioned zone to exterior: </li> </ul> \\[ H_{d,ztu-ext} = \\sum (A_i \\cdot U_i) \\text{ for other orientations} \\] <p>5) Ventilation Losses</p> <pre><code>Ventilation heat transfer coefficients are added according to ISO 13789:\n</code></pre> \\[ H_{ve,iu} = 0.33 \\times q_{iu} \\] \\[ H_{ve,ue} = 0.33 \\times q_{ue} \\] <pre><code>Where:\n- `\u03c1\u00b7cp = 0.33 Wh/(m\u00b3\u00b7K)` for air\n- `q_iu`: airflow between conditioned and unconditioned zones (m\u00b3/h)  \n- `q_ue = V_u \u00d7 n_ue`: airflow between unconditioned zone and exterior\n</code></pre> <p>6) Total Heat Transfer</p> \\[ H_{ue} = H_{d,ztu-ext} + H_{ve,ue} \\\\ H_{iu} = H_{d,zt-ztu} + H_{ve,iu} \\] \\[ H_{ztu,tot} = H_{ue} + H_{iu} \\] <p>7) Adjustment Factor (b\u208dztu\u208e\u2098)     The adjustment factor accounts for the ratio between losses to the exterior and total losses of the unconditioned zone:</p> \\[ b_{ztu,m} = \\frac{H_{ue}}{H_{ue} + H_{iu}} = \\frac{H_{ue}}{H_{ztu,tot}} \\tag{4.13} \\] <p>\\(b_{ztu,m}\\in[0,1]\\) measures how much the unconditioned zone is \u201canchored\u201d to the outside rather than to the conditioned neighbor.</p> <p>8) Distribution Factor (F\u208dztc\u208e\u2098)</p> <p>If multiple conditioned zones exist, the distribution factor allocates transmission between them:</p> \\[ F_{ztc,ztu,m} = \\frac{H_{ztc,i,ztu,m}}{\\sum_j H_{ztc,j,ztu,m}} \\] <p>Here it is set to <code>1.0</code> since only one conditioned zone is assumed.</p>"},{"location":"iso_52016_adj_zone/#physics","title":"Physics","text":"<p>The total heat transfer coefficient <code>H_tr</code> is computed as:</p> \\[ H_{tr} = H_d + H_g + H_u + H_a \\] <p>Where: - H_d: Transmission through external envelope (W/K) - H_g: Transmission through ground (W/K) - H_u: Transmission through unconditioned zones (W/K) - H_a: Transmission to adjacent buildings (W/K)  </p> <p>In this function, we focus on the unconditioned zone contribution (<code>H_u</code>).</p>"},{"location":"iso_52016_adj_zone/#output","title":"Output","text":"Variable Type Description <code>H_ztu_tot</code> <code>float</code> Total transmission heat transfer coefficient between the conditioned zone and the adjacent unconditioned zone (W/K). <code>b_ztu_m</code> <code>float</code> Monthly adjustment factor for the unconditioned adjacent zone (dimensionless). <code>F_ztc_ztu_m</code> <code>float</code> Distribution factor of the transmission coefficient between conditioned and unconditioned zones (dimensionless)."},{"location":"iso_52016_adj_zone/#example","title":"Example","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(BUI, adj_zone_name, n_ue=0.5, qui=0):\n    adj = get_adj_zone(BUI, adj_zone_name)\n    A = np.asarray(adj[\"area_facade_elements\"], dtype=float)\n    U = np.asarray(adj[\"transmittance_U_elements\"], dtype=float)\n    ORI = np.asarray(adj[\"orientation_elements\"])\n    # Define which orientations correspond to zt-ztu interface (project specific rule):\n    mask_interface = is_interface_to_conditioned_zone(ORI, adj, BUI)   # boolean mask\n    Hd_zt_ztu  = float(np.sum(A[mask_interface] * U[mask_interface]))   # Eq. (4.10)\n    Hd_ztu_ext = float(np.sum(A[~mask_interface] * U[~mask_interface])) # Eq. (4.11)\n\n    # Ventilation terms (Eq. 4.12)\n    Vu = float(adj[\"volume\"])\n    que = Vu * n_ue\n    Hve_ue = 0.33 * que\n    Hve_iu = 0.33 * float(qui)\n\n    Hue = Hd_ztu_ext + Hve_ue\n    Hiu = Hd_zt_ztu + Hve_iu\n    Hztu_tot = Hue + Hiu                                 # Eq. (4.12d)\n    b_ztu_m  = Hue / Hztu_tot if Hztu_tot &gt; 0 else 1.0   # Eq. (4.13)\n    return float(Hztu_tot), float(b_ztu_m)\n</code></pre> <ul> <li><code>H_ztu_tot</code> <code>[W\u00b7K\u207b\u00b9]</code> \u2014 total coupling of the unconditioned zone.</li> <li><code>b_ztu_m</code> <code>[-]</code> \u2014 monthly factor (in the current code computed once from static inputs).</li> <li><code>F_ztc_ztu_m</code> <code>[-]</code> \u2014 distribution factor (in the current code computed once from static inputs).</li> </ul> <p>Example Output:</p> <pre><code>H_ztu_tot = 78.45  # W/K\nb_ztu_m = 0.63\nF_ztc_ztu_m = 1.0\n</code></pre>"},{"location":"iso_52016_adj_zone/#practical-extraction-with-your-bui-structure","title":"Practical extraction with your <code>BUI</code> structure","text":"<ul> <li>For a given unconditioned zone <code>adj_i</code>:<ul> <li>Build sets:<ul> <li>\\(\\mathcal{E}_{zt{\\text -}ztu}\\): elements in <code>adj_i</code> whose <code>orientation_elements</code> match the interface direction to the conditioned zone (your code uses equality tests by <code>NV/SV/EV/WV/HOR</code>).</li> <li>\\(\\mathcal{E}_{ztu{\\text -}ext}\\): elements in <code>adj_i</code> not on the interface.</li> </ul> </li> <li>Use <code>adj_i.volume</code> \u2192 \\(V_u\\).  </li> <li>Pick <code>n_ue</code> from <code>df_n_ue</code> by air-tightness class or keep default <code>0.5 h\u207b\u00b9</code>.</li> </ul> </li> </ul>"},{"location":"iso_52016_adj_zone/#edge-cases","title":"Edge Cases","text":"<ul> <li>If <code>A</code>/<code>U</code> vectors contain dtype=object (as in your snippet), cast explicitly to <code>float</code>.</li> <li>If <code>Hztu_tot = 0</code> (degenerate geometry), define <code>b_ztu_m = 1.0</code> by convention (fully outdoor-anchored).</li> </ul>"},{"location":"iso_52016_adj_zone/#notes_1","title":"Notes","text":"<ul> <li><code>H_ztu_tot</code> increases with larger areas, higher U-values, or greater ventilation exchange.  </li> <li>Default <code>n_ue = 0.5</code> corresponds to \u201cwell-sealed joints, no ventilation openings\u201d (ISO 13789 Table 7).  </li> <li>The function currently handles one conditioned zone; for multiple zones, extend the <code>F_ztc_ztu_m</code> calculation.</li> </ul>"},{"location":"iso_52016_aeral_heat_capacity/","title":"ISO 52016 - Aeral heat capacity","text":""},{"location":"iso_52016_aeral_heat_capacity/#aeral-heat-capacity","title":"Aeral Heat capacity","text":"<pre><code>def Areal_heat_capacity_of_element(cls, building_object) -&gt; aeral_heat_capacity\n</code></pre>"},{"location":"iso_52016_aeral_heat_capacity/#parameters","title":"Parameters","text":"Name Type Description <code>building_object</code> <code>dict</code> Building model containing a list of surfaces in <code>building_surface</code> and global settings under <code>building</code>."},{"location":"iso_52016_aeral_heat_capacity/#required-fields","title":"Required Fields","text":"<p>On each surface in <code>building_surface</code>:</p> <ul> <li><code>ISO52016_type_string</code> \u2014 element type: <code>\"OP\"</code> (opaque), <code>\"W\"</code> (transparent), <code>\"GR\"</code> (ground-contact), <code>\"ADJ\"</code> (adjacent opaque).  </li> <li><code>thermal_capacity</code> \u2014 areal heat capacity (e.g., from ISO 52016 Table B.14).</li> </ul> <p>On the building object:</p> <ul> <li><code>building.construction_class</code> \u2014 construction mass class from ISO 52016 Table B.13:  </li> <li><code>class_i</code>, <code>class_e</code>, <code>class_ie</code>, <code>class_d</code>, <code>class_m</code>.</li> </ul>"},{"location":"iso_52016_aeral_heat_capacity/#purpose","title":"Purpose","text":"<p>Computes the areal heat capacity allocation per node for each building envelope element according to EN ISO 52016-1 (6.5.7) and Annex B tables (e.g., B.13 classes and B.14 capacities). The routine returns a 5\u00d7N matrix <code>kappa_pli_eli_</code> where: - rows (0..4) correspond to nodes <code>kpl1..kpl5</code> (external \u2192 internal or per the chosen nodal scheme), - columns (0..N-1) correspond to envelope elements, - entries hold the areal heat capacity assigned to each node/element.</p> <p>The node distribution depends on the construction mass class (<code>class_i</code>, <code>class_e</code>, <code>class_ie</code>, <code>class_d</code>, <code>class_m</code>).</p> <p>How it works</p> <ol> <li> <p>Collect element types and capacities </p> <ul> <li>Build <code>el_type</code> from <code>surface[\"ISO52016_type_string\"]</code>.  </li> <li>Build <code>list_kappa_el</code> from <code>surface[\"thermal_capacity\"]</code> (default 0 if missing).</li> </ul> </li> <li> <p>Initialize matrix </p> <pre><code>kappa_pli_eli_ : (5 \u00d7 N) zeros\nrows 0..4 \u2192 nodes kpl1..kpl5\ncols 0..N \u2192 elements\n</code></pre> </li> <li> <p>Distribute areal heat capacity by construction class (ISO 52016 Table B.13)</p> </li> <li> <p><code>class_i</code> \u2014 mass concentrated at internal side**</p> <ul> <li>Opaque/Adjacent (<code>OP</code>, <code>ADJ</code>): <code>kpl5 = km_eli</code> (node 4); others 0.  </li> <li>Ground (<code>GR</code>): <code>kpl5 = 1e6</code> (treated as very large capacity placeholder); <code>kpl3=kpl4=0</code>.</li> </ul> </li> <li> <p><code>class_e</code> \u2014 mass concentrated at external side**</p> <ul> <li>Opaque/Adjacent: <code>kpl1 = km_eli</code> (node 0).  </li> <li>Ground: <code>kpl3 = km_eli</code> (node 2).</li> </ul> </li> <li> <p><code>class_ie</code> \u2014 mass split internal/external**</p> <ul> <li>Opaque/Adjacent: <code>kpl1 = km_eli/2</code> and <code>kpl5 = km_eli/2</code>.  </li> <li>Ground: <code>kpl1 = km_eli/2</code> and <code>kpl5 = km_eli/2</code>.</li> </ul> </li> <li> <p><code>class_d</code> \u2014 mass equally distributed**</p> <ul> <li>Opaque/Adjacent: <code>kpl2 = kpl3 = kpl4 = km_eli/4</code> (nodes 1,2,3) and <code>kpl1 = kpl5 = km_eli/8</code> (nodes 0,4).  </li> <li>Ground: <code>kpl3 = km_eli/4</code> (node 2) and <code>kpl4 = km_eli/2</code> (node 3); <code>kpl5 = km_eli/4</code> (node 4).</li> </ul> </li> <li> <p><code>class_m</code> \u2014 mass concentrated mid-layer**</p> <ul> <li>Opaque/Adjacent: <code>kpl3 = km_eli</code> (node 2).  </li> <li>Ground: <code>kpl4 = km_eli</code> (node 3).</li> </ul> </li> <li> <p>Return value    Wrap <code>kappa_pli_eli_</code> in <code>aeral_heat_capacity(kappa_pli_eli=...)</code>.</p> </li> </ol>"},{"location":"iso_52016_aeral_heat_capacity/#node-indexing","title":"Node Indexing","text":"<p>The implementation uses a 5-node scheme (rows 0..4 \u2192 <code>kpl1..kpl5</code>). The physical mapping (external\u2194internal) should match your solver\u2019s convention. This function follows the same node positions as used elsewhere in your ISO 52016 implementation.</p>"},{"location":"iso_52016_aeral_heat_capacity/#outputs","title":"Outputs","text":"Type Contents <code>aeral_heat_capacity</code> Wrapper carrying <code>kappa_pli_eli</code> (shape 5 \u00d7 N). Each column is an element; rows are nodes <code>kpl1..kpl5</code>."},{"location":"iso_52016_aeral_heat_capacity/#example","title":"Example","text":"<pre><code>cap = Areal_heat_capacity_of_element(building_object=bui)\n\nM = cap.kappa_pli_eli  # shape 5 \u00d7 N\nprint(M.shape)         # e.g., (5, 12) for 12 elements\nprint(M[:, 0])         # node-wise capacities of the first element\n</code></pre>"},{"location":"iso_52016_aeral_heat_capacity/#notes","title":"Notes","text":"<ul> <li>Transparent elements (<code>type: \"transparent\"</code>) are excluded from mass allocation in several classes (as per code).  </li> <li>The ground element (<code>name: \"Slab to ground\"</code>) receives special handling: very large capacity in <code>class_i</code>, and specific node allocations in other classes.  </li> <li>If a surface lacks <code>thermal_capacity</code>, the corresponding entries remain 0. Provide values consistent with ISO 52016 Annex B tables.  </li> <li>Returned units follow your input <code>thermal_capacity</code> convention (often J/(m\u00b2\u00b7K) in standards; the original docstring mentions W/(m\u00b2\u00b7K) \u2014 ensure consistency across the toolchain).</li> </ul>"},{"location":"iso_52016_aeral_heat_capacity/#references","title":"References","text":"<ul> <li>EN ISO 52016-1 \u2014 Energy performance of buildings \u2014 Calculation of energy needs for heating and cooling.  \u00a76.5.7 (nodal method), Annex B (Tables B.13 construction classes, B.14 areal heat capacities).</li> </ul>"},{"location":"iso_52016_aggregate_surface/","title":"ISO 52016 - Aggregate Surfaces","text":""},{"location":"iso_52016_aggregate_surface/#aggregate-surface-same-orientation-","title":"Aggregate surface - same orientation -","text":"<pre><code>def _aggregate_surfaces_by_direction(cls, building_object)\n</code></pre>"},{"location":"iso_52016_aggregate_surface/#inputs","title":"Inputs","text":"Name Type Description <code>building_object</code> <code>dict</code> A dictionary-like building model that must contain a key <code>\"building_surface\"</code>, which is a list of surface definitions. Each surface should include ISO 52016 descriptors and physical properties (e.g., area, U-value, absorptance, etc.)."},{"location":"iso_52016_aggregate_surface/#purpose","title":"Purpose","text":"<p>This function aggregates (merges) multiple building surfaces that share the same orientation and ISO 52016 surface type into a single, equivalent surface. The goal is to simplify the building model so that heat transmission and solar radiation terms can be computed on aggregated surfaces instead of on many small, redundant ones.</p> <p>How It Works:</p> <ol> <li>Grouping (bucketing):    Surfaces are grouped by:</li> <li><code>ISO52016_type_string</code> (e.g., opaque wall, transparent window, etc.)</li> <li><code>ISO52016_orientation_string</code> (e.g., N, S, E, W, HOR)</li> <li><code>type</code> (transparent/opaque)</li> </ol> <p>\u2192 These three attributes form the aggregation key.</p> <ol> <li>Aggregation Rules:</li> <li>Additive fields: <ul> <li><code>area</code> </li> <li><code>thermal_capacity</code></li> </ul> </li> <li>Area-weighted average fields: <ul> <li><code>u_value</code> </li> <li><code>g_value</code> (only for transparent surfaces)  </li> <li><code>sky_view_factor</code> </li> <li><code>solar_absorptance</code> </li> <li><code>convective</code> and <code>radiative</code> heat transfer coefficients (internal and external)</li> </ul> </li> <li> <p>Name field:      The new aggregated surface name concatenates all original names (trimmed to 120 characters).</p> </li> <li> <p>Orientation Handling:    A simplified numeric orientation is reattached to each aggregated surface:</p> </li> <li>Default: <code>{azimuth: 0, tilt: 90}</code> (vertical)</li> <li> <p>If <code>ISO52016_orientation_string == \"HOR\"</code> \u2192 <code>{azimuth: 0, tilt: 0}</code> (horizontal)</p> </li> <li> <p>Output:    The method builds a new list of surfaces where each element represents one equivalent aggregated surface per direction and type.</p> </li> </ol>"},{"location":"iso_52016_aggregate_surface/#outputs","title":"Outputs","text":"Type Description <code>dict</code> A shallow copy of the input <code>building_object</code>, where <code>building_surface</code> has been replaced with a reduced list of aggregated surfaces."},{"location":"iso_52016_aggregate_surface/#example","title":"Example","text":"<p>If the input building object contains three south-facing opaque walls:</p> Surface Name Type ISO52016 Type Orientation Area (m\u00b2) U-Value (W/m\u00b2K) Wall_1 opaque Wall SV 10 0.30 Wall_2 opaque Wall SV 15 0.25 Wall_3 opaque Wall SV 5 0.40 <p>After aggregation, the function returns one equivalent surface:</p> New Name Type Orientation Area (m\u00b2) U-Value (W/m\u00b2K) Wall_1 + Wall_2 + Wall_3 opaque SV 30 0.30 <p>where the U-value is computed as  </p> \\[ U_{agg} = \\frac{\\sum (U_i \\times A_i)}{\\sum A_i} \\] <p>Example Usage <pre><code>building_object = ISO52016()._aggregate_surfaces_by_direction(building_object)\n\nfor surf in building_object[\"building_surface\"]:\n    print(f\"{surf['ISO52016_orientation_string']} | {surf['type']} | Area = {surf['area']:.1f} m\u00b2 | U = {surf['u_value']:.2f}\")\n</code></pre></p> <p>Example output: <pre><code>HOR | opaque | Area = 130.0 m\u00b2 | U = 2.20\nNV | opaque | Area = 30.0 m\u00b2 | U = 1.40\nSV | opaque | Area = 30.0 m\u00b2 | U = 1.40\nEV | opaque | Area = 30.0 m\u00b2 | U = 1.20\nWV | opaque | Area = 30.0 m\u00b2 | U = 1.20\nHOR | opaque | Area = 100.0 m\u00b2 | U = 1.60\nEV | transparent | Area = 4.0 m\u00b2 | U = 5.00\nWV | transparent | Area = 4.0 m\u00b2 | U = 5.00\n</code></pre></p>"},{"location":"iso_52016_aggregate_surface/#notes","title":"Notes","text":"<ul> <li>Aggregates surfaces sharing type + ISO orientation.</li> <li>Uses area-weighted averages for intensive properties.</li> <li>Returns a clean, compact list of equivalent surfaces .</li> </ul>"},{"location":"iso_52016_aggregate_surface/#advantages","title":"Advantages","text":"<ul> <li>Reduces model complexity for ISO 52016 energy balance computations.</li> <li>Speeds up simulation and simplifies reporting.</li> <li>Avoids double-counting of identical surfaces.</li> <li>Ensures consistent area-weighted physical properties.</li> </ul>"},{"location":"iso_52016_aggregate_surface/#limitations","title":"Limitations","text":"<ul> <li>Works only for dictionary-style <code>building_object</code>.  </li> <li>Orientation azimuth/tilt are currently placeholders, not exact averages.</li> <li> <p>Requires each surface to contain both:</p> <ul> <li><code>ISO52016_type_string</code> that is the <code>type</code>in the BUI dict</li> <li><code>ISO52016_orientation_string</code> that is the <code>orientation</code> in the BUI dict example:</li> </ul> <pre><code>        ..{\n            \"name\": \"Roof surface\",\n            \"type\": \"adj\",     # &lt;-----\n            \"area\": 130,\n            \"sky_view_factor\": 1.0,\n            \"u_value\": 2.2,\n            \"solar_absorptance\": 0.4,\n            \"thermal_capacity\": 741500.0,\n            \"orientation\": {   # &lt;-----\n                \"azimuth\": 0,\n                \"tilt\": 0\n            },\n            \"name_adj_zone\": None\n        }\n</code></pre> </li> </ul>"},{"location":"iso_52016_categorty_profile/","title":"ISO 52016 - Category profiles","text":""},{"location":"iso_52016_categorty_profile/#category-profile","title":"Category profile","text":""},{"location":"iso_52016_categorty_profile/#occupancts-lighting-appliance-ventilation-heating-cooling-profile","title":"Occupancts, Lighting, Appliance, Ventilation, Heating, Cooling profile","text":"<pre><code>def generate_category_profile(\n    cls,\n    building_object,\n    occupants_schedule_workdays,\n    occupants_schedule_weekend,\n    appliances_schedule_workdays,\n    appliances_schedule_weekend,\n    lighting_schedule_workdays,\n    lighting_schedule_weekend,\n)\n</code></pre>"},{"location":"iso_52016_categorty_profile/#inputs","title":"Inputs","text":"Parameter Type Description <code>building_object</code> <code>dict</code> Building model containing <code>building_type_class</code> and optional internal gain profiles. <code>occupants_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly occupancy profiles (24 values each). <code>appliances_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly appliance profiles. <code>lighting_schedule_workdays/weekend</code> <code>dict[str, list[float]]</code> Default hourly lighting profiles."},{"location":"iso_52016_categorty_profile/#purpose","title":"Purpose","text":"<p>In building energy simulations \u2014 especially those following ISO 52016-1:2017 (Energy needs for heating and cooling, internal temperatures, and loads) or the broader EPB (Energy Performance of Buildings) framework \u2014 each thermal zone requires hourly profiles for occupancy, lighting, appliances, ventilation, heating, and cooling.  </p> <p>These profiles describe the temporal behavior of internal gains and system operation (e.g., when people are present, when lights are on, or when HVAC is active). This function automates the generation of such profiles by merging custom schedules (if defined within a building object) with default type-based schedules, ensuring every category has a valid 24-hour pattern.</p> <p>The default type-based schedules are define in the file: <code>table_iso_16798_1.py</code>, where typical profile are getting from the EN ISO 16798-1 standard.</p> <p><code>generate_category_profile()</code> builds a consistent set of hourly category profiles (weekday/weekend) for: - Occupancy - Appliances - Lighting - Ventilation - Heating - Cooling  </p> <p>It ensures that all schedules are properly defined, validated, and ready for use in energy balance, comfort, or control simulations.</p> <p>How it works?</p> <ol> <li> <p>Identify building type    Extracts the <code>building_type_class</code> from the input object to determine which default schedules to use.</p> </li> <li> <p>Load or fallback for each category </p> </li> <li>For occupants, appliances, and lighting:      If custom 24-hour profiles exist in <code>building_object[\"building_parameters\"][\"internal_gains\"]</code>, they are used directly.      Otherwise, defaults are taken from the provided schedule dictionaries.</li> <li> <p>For ventilation, heating, and cooling:      If no profiles are defined in the building object, they inherit the occupancy schedule as a fallback.</p> </li> <li> <p>Validation    Ensures that every schedule contains exactly 24 hourly values (one per hour of the day).</p> </li> <li> <p>Output assembly    Returns all category profiles in a structured dictionary format.</p> </li> </ol>"},{"location":"iso_52016_categorty_profile/#outputs","title":"Outputs","text":"<p><code>dict</code> \u2014 A complete set of hourly category profiles for use in thermal simulations, HVAC control logic, or internal gain estimation.</p> <pre><code>{\n    \"ventilation\": {\"weekday\": array(24), \"holiday\": array(24)},\n    \"heating\":     {\"weekday\": array(24), \"holiday\": array(24)},\n    \"cooling\":     {\"weekday\": array(24), \"holiday\": array(24)},\n    \"occupancy\":   {\"weekday\": array(24), \"holiday\": array(24)},\n    \"lighting\":    {\"weekday\": array(24), \"holiday\": array(24)},\n    \"appliances\":  {\"weekday\": array(24), \"holiday\": array(24)},\n}\n</code></pre> <p>Each category contains 24 hourly fractions for weekdays and weekends (holidays), typically in the range 0\u20131 or as relative intensity values.</p>"},{"location":"iso_52016_categorty_profile/#example","title":"Example","text":"<pre><code>profiles = generate_category_profile(\n    building_object=my_building,\n    occupants_schedule_workdays=OCCUPANTS_WD,\n    occupants_schedule_weekend=OCCUPANTS_WE,\n    appliances_schedule_workdays=APPLIANCES_WD,\n    appliances_schedule_weekend=APPLIANCES_WE,\n    lighting_schedule_workdays=LIGHTING_WD,\n    lighting_schedule_weekend=LIGHTING_WE,\n)\n\n# Example: access weekday lighting profile\nlighting_profile = profiles[\"lighting\"][\"weekday\"]\n</code></pre>"},{"location":"iso_52016_categorty_profile/#notes","title":"Notes","text":"<ul> <li>All profiles must contain exactly 24 numeric values.  </li> <li>Missing ventilation, heating, or cooling profiles automatically default to the occupancy profile.  </li> <li>Works as a preprocessing step to ensure that all internal gain and system schedules are complete and consistent before running the energy balance.</li> <li>This function is typically used in the preprocessing pipeline before running a dynamic energy simulation:</li> </ul> <p>The <code>**generate_category_profile()**</code> is based on the following functions:</p> <ul> <li><code>get_country_code_from_latlon</code></li> <li><code>HourlyProfileGenerator</code></li> </ul>"},{"location":"iso_52016_categorty_profile/#country-code-for-calendar-data","title":"Country code for calendar data","text":"<pre><code>def get_country_code_from_latlon(lat: float, lon: float, default: str = \"IT\") -&gt; str\n</code></pre>"},{"location":"iso_52016_categorty_profile/#parameters","title":"Parameters","text":"<ul> <li><code>lat</code>, <code>lon</code> (float): Geographic coordinates.</li> <li><code>default</code> (str): Fallback code returned on errors or when the API does not return a country code. Default is <code>\"IT\"</code>.</li> </ul>"},{"location":"iso_52016_categorty_profile/#purpose_1","title":"Purpose","text":"<p>Resolve a latitude/longitude to an ISO 3166-1 alpha-2 country code, using a reverse\u2011geocoding API (example: OpenCage).</p> <p>How it works: 1. Builds a request to the OpenCage API endpoint:    - <code>https://api.opencagedata.com/geocode/v1/json</code> 2. Sends the request with your API key (<code>YOUR_OPENCAGE_API_KEY</code> placeholder). 3. On success: extracts <code>ISO_3166-1_alpha2</code> from the first result\u2019s <code>components</code>. 4. On any failure (HTTP \u2260 200, empty results, missing code): returns <code>default</code>.</p>"},{"location":"iso_52016_categorty_profile/#notes-best-practices","title":"Notes &amp; Best Practices","text":"<ul> <li>API Key: Replace <code>\"YOUR_OPENCAGE_API_KEY\"</code> with a valid key (environment variable recommended).</li> <li>Rate Limits: Respect your provider\u2019s quota; implement caching if calling repeatedly.</li> <li>Fallback: Consider logging when the function falls back to <code>default</code> so you can inspect geocoding issues later.</li> <li>Alternative providers: You can switch to other reverse\u2011geocoding services (Nominatim, Google, etc.) by adjusting the request/response handling.</li> </ul>"},{"location":"iso_52016_categorty_profile/#generate-hourly-profiles","title":"Generate hourly profiles","text":"<pre><code>class HourlyProfileGenerator(\n    country: str = \"IT\",\n    num_months: int = 13,\n    start_year: int | None = None,\n    working_day_profile: np.ndarray | None = None,\n    holiday_profile: np.ndarray | None = None,\n    category_profiles: dict | None = None\n)\n</code></pre>"},{"location":"iso_52016_categorty_profile/#inputs_1","title":"Inputs","text":"<ul> <li><code>country</code>: ISO 2-letter country code used by <code>holidays</code> to determine national holidays.</li> <li><code>num_months</code>: How many months to generate (default: <code>13</code>).</li> <li><code>start_year</code>: Starting year for the window. If <code>None</code>, uses the previous calendar year for the December start.</li> <li><code>working_day_profile</code>, <code>holiday_profile</code>: Optional 24\u2011hour arrays to replace the built\u2011in defaults for all categories when <code>category_profiles</code> is omitted.</li> <li><code>category_profiles</code>: A dict providing per\u2011category profiles. Each value can be:</li> <li>a single 24\u2011array \u2192 applied to both weekday and holiday/weekend; or</li> <li>a pair <code>(weekday_24, holiday_24)</code>; or</li> <li>a dict <code>{ 'weekday': weekday_24, 'holiday': holiday_24 }</code>.</li> </ul> <p>Categories: <code>(\"ventilation\", \"heating\", \"cooling\", \"occupancy\", \"lighting\", \"appliances\")</code></p>"},{"location":"iso_52016_categorty_profile/#purpose_2","title":"Purpose","text":"<p>Generate a continuous hourly DataFrame (default: 13 months) with calendar flags (working day / weekend / holiday) and per\u2011category normalized profiles (0..1) for: <code>ventilation</code>, <code>heating</code>, <code>cooling</code>, <code>occupancy</code>, <code>lighting</code>, <code>appliances</code>.</p> <p>Key Concepts - Time span: starts at <code>December 1st</code> of <code>start_year</code> (or previous year if <code>None</code>) and covers <code>num_months</code> months (default 13). - Calendar logic: weekend = Saturday or Sunday; holiday set via the <code>holidays</code> library using <code>country</code>. - Profiles (0..1): Per-category 24\u2011value arrays are mapped to each hour of the day, switching between weekday and holiday/weekend versions. - Retro\u2011compatibility: If <code>category_profiles</code> is not provided, two default 24\u2011hour arrays (one for working days, one for holidays) are used for all categories. You can also pass legacy <code>working_day_profile</code>/<code>holiday_profile</code> to override those defaults.</p>"},{"location":"iso_52016_categorty_profile/#outputs_1","title":"Outputs","text":"<p><code>generate()</code> returns a <code>pandas.DataFrame</code> with columns:</p> <ul> <li><code>datetime</code>: hourly timestamps (timezone\u2011naive).</li> <li><code>date</code>, <code>hour</code>, <code>day_of_week</code>, <code>day_name</code>: common time breakdowns.</li> <li><code>is_holiday</code>, <code>is_weekend</code>, <code>is_working_day</code>, <code>holiday_name</code>.</li> <li>One column per category: <code>\"{category}_profile\"</code> (values in 0..1).</li> <li><code>profile_value</code>: retro\u2011compatibility alias (uses <code>occupancy_profile</code>).</li> <li><code>day_type</code>: <code>\"Working Day\"</code> or <code>\"Holiday/Weekend\"</code>.</li> </ul>"},{"location":"iso_52016_categorty_profile/#examples","title":"Examples","text":""},{"location":"iso_52016_categorty_profile/#a-minimal-generation","title":"A) Minimal generation","text":"<pre><code>from profiles import HourlyProfileGenerator\n\ngen = HourlyProfileGenerator(country=\"IT\")\ndf = gen.generate()\ngen.get_summary()\n\n# Inspect first rows\nprint(df.head())\n</code></pre>"},{"location":"iso_52016_categorty_profile/#b-custom-percategory-profiles","title":"B) Custom per\u2011category profiles","text":"<pre><code>import numpy as np\n\nv_wd = np.array([0]*6 + [1]*10 + [0.5]*8, dtype=float)      # ventilation - weekday\nv_hd = np.array([0]*8 + [0.5]*8 + [0]*8, dtype=float)       # ventilation - holiday/weekend\nocc_24 = np.array([1,1,1,1,1,1,0.5,0.5,0.5,0.1,0.1,0.1,0.2,0.2,0.2,0.2,0.5,0.5,0.5,0.8,0.8,0.8,1,1], dtype=float)\n\ncategory_profiles = {\n    \"ventilation\": {\"weekday\": v_wd, \"holiday\": v_hd},\n    \"occupancy\": occ_24,  # same WD/HD\n    # other categories will use defaults\n}\n\ngen = HourlyProfileGenerator(country=\"DE\", category_profiles=category_profiles)\ndf = gen.generate()\n</code></pre>"},{"location":"iso_52016_categorty_profile/#c-plot-daily-averages-with-weekendholiday-shading","title":"C) Plot daily averages with weekend/holiday shading","text":"<pre><code>fig = gen.plot_annual_profiles(\n    categories=[\"ventilation\", \"occupancy\", \"lighting\"],\n    freq=\"D\",\n    include_weekend_shading=True,\n    title=\"Annual Profiles \u2014 Daily Averages\"\n)\nfig.show()\n</code></pre>"},{"location":"iso_52016_categorty_profile/#d-resolve-a-country-code-from-coordinates","title":"D) Resolve a country code from coordinates","text":"<pre><code>from profiles import get_country_code_from_latlon\ncode = get_country_code_from_latlon(46.49, 11.33, default=\"IT\")\nprint(code)  # e.g., \"IT\" or fallback\n</code></pre>"},{"location":"iso_52016_categorty_profile/#error-handling-edge-cases-and-validation","title":"Error Handling, Edge Cases and Validation","text":"<ul> <li>Invalid profile shapes: raises <code>ValueError</code> for any 24\u2011hour array not equal to <code>(24,)</code>.</li> <li>Geocoding failures: returns the <code>default</code> country code; consider logging or retry strategies.</li> <li>Missing <code>generate()</code>: <code>get_summary()</code> / <code>plot_annual_profiles()</code> will raise if called before <code>generate()</code>.</li> <li>Holiday calendars: ensure <code>country</code> is supported by <code>holidays</code>; for custom calendars, precompute a boolean series and merge it into the DataFrame.</li> <li>Every 24\u2011array is validated to exactly 24 elements; otherwise a <code>ValueError</code> is raised.</li> </ul>"},{"location":"iso_52016_co2_equivalent/","title":"Calculation of CO\u2082 Equivalent (CO\u2082e) Emissions from an Energy Simulation","text":"<p>This document explains how to calculate CO\u2082-equivalent emissions (CO\u2082e) from the results of an energy simulation. The method aligns with ISO 52000, EN 15603, and GHG Protocol frameworks.</p>"},{"location":"iso_52016_co2_equivalent/#required-data-from-the-simulation","title":"\ud83d\udcca Required Data from the Simulation","text":"<p>For each energy carrier (electricity, natural gas, biomass, district heating, etc.), you need: - Final energy consumption (kWh, usually based on LHV) - (Optional) Exported energy (e.g., PV or CHP generation) - (Optional) Auxiliary information such as generator efficiencies or CHP heat/power split</p>"},{"location":"iso_52016_co2_equivalent/#calculation-settings","title":"\u2699\ufe0f Calculation Settings","text":""},{"location":"iso_52016_co2_equivalent/#emission-scopes","title":"Emission Scopes","text":"<ul> <li>Scope 1: Direct on-site fuel combustion (boilers, CHP, etc.)</li> <li>Scope 2: Purchased electricity, steam, heat, or cooling</li> <li>Scope 3 (optional): Upstream emissions (extraction, transport, T&amp;D losses)</li> </ul>"},{"location":"iso_52016_co2_equivalent/#electricity-method","title":"Electricity Method","text":"<ul> <li>Location-based: Average grid emission factor (annual or time-resolved)</li> <li>Market-based: Supplier-specific emission factor (residual mix)</li> </ul>"},{"location":"iso_52016_co2_equivalent/#general-formula","title":"\ud83e\uddee General Formula","text":"<p>For each energy carrier \\(i\\) and time step \\(t\\):</p> \\[ \\mathrm{CO_2e}_{i,t} = E_i(t) \\times \\mathrm{EF}_{i}^{comb}(t) + E_i(t) \\times \\mathrm{EF}_{i}^{upstream}(t) \\] <p>where: - \\(E_i(t)\\): energy consumption (kWh) - \\(\\mathrm{EF}_{i}^{comb}\\): direct combustion emission factor (kgCO\u2082e/kWh) - \\(\\mathrm{EF}_{i}^{upstream}\\): upstream emission factor (kgCO\u2082e/kWh)</p> <p>If emissions are split by gas species (CO\u2082, CH\u2084, N\u2082O):</p> \\[ \\mathrm{CO_2e} = \\mathrm{CO_2} + \\mathrm{CH_4} \\times \\mathrm{GWP}_{100,CH_4} + \\mathrm{N_2O} \\times \\mathrm{GWP}_{100,N_2O} \\]"},{"location":"iso_52016_co2_equivalent/#typical-emission-factors","title":"\ud83c\udf0d Typical Emission Factors","text":"Energy carrier Emission factor (kgCO\u2082e/kWh) Example source Electricity (EU grid) 0.25 ENTSO-E 2023 Natural gas (combustion) 0.202 IPCC 2006 Natural gas (upstream) 0.025 DEFRA 2023 Biomass (solid) 0 (biogenic) IPCC 2006 <p>\u26a0\ufe0f Always use emission factors consistent in region and year.</p>"},{"location":"iso_52016_co2_equivalent/#handling-on-site-generation","title":"\ud83d\udd0b Handling On-Site Generation","text":"<ul> <li>Self-consumed PV: reduces imported grid electricity.  </li> <li>Exported PV: should not be subtracted from consumption unless the reporting framework allows it.  </li> <li>CHP systems: allocate fuel emissions between heat and power using an efficiency- or substitution-based method.</li> </ul>"},{"location":"iso_52016_co2_equivalent/#example-calculation","title":"\ud83d\udcd8 Example Calculation","text":"Energy type Consumption (kWh) EF (kgCO\u2082e/kWh) Emissions (kgCO\u2082e) Electricity (grid) 10,000 0.25 2,500 Natural gas (comb.) 5,000 0.202 1,010 Natural gas (upstream) 5,000 0.025 125 Total \u2014 \u2014 3,635"},{"location":"iso_52016_co2_equivalent/#example-python-script","title":"\ud83d\udc0d Example Python Script","text":"<pre><code>import pandas as pd\n\n# Input data (final energy in kWh)\nenergy = pd.Series({\n    'electricity_grid': 10000,\n    'natural_gas': 5000,\n})\n\n# Emission factors (kgCO2e/kWh)\nEF = {\n    'electricity_grid': 0.25,   # Scope 2\n    'gas_combustion': 0.202,    # Scope 1\n    'gas_upstream': 0.025,      # Scope 3\n}\n\nco2e = {\n    'Scope2_electricity': energy['electricity_grid'] * EF['electricity_grid'],\n    'Scope1_gas': energy['natural_gas'] * EF['gas_combustion'],\n    'Scope3_gas_upstream': energy['natural_gas'] * EF['gas_upstream'],\n}\n\nco2e['Total'] = sum(co2e.values())\nprint(pd.Series(co2e).round(1))\n</code></pre>"},{"location":"iso_52016_input/","title":"ISO 52016 - Input","text":""},{"location":"iso_52016_input/#building-input-bui-structure","title":"Building Input (BUI) Structure","text":"<p>This document explains the BUI (Building Input) dictionary used for ISO\u202f52016 simulations. It defines the building geometry, surfaces, (general)systems, and operational parameters required to calculate hourly temperatures and energy needs.</p>"},{"location":"iso_52016_input/#structure-overview","title":"Structure Overview","text":"<pre><code>BUI = {\n    \"building\": {...},\n    \"adjacent_zones\": [...],\n    \"building_surface\": [...],\n    \"units\": {...},\n    \"building_parameters\": {...}\n}\n</code></pre> <p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre>"},{"location":"iso_52016_input/#main-building-metadata-building","title":"Main Building Metadata: <code>\"building\"</code>","text":"Key Type Description <code>name</code> str Building name or identifier. <code>azimuth_relative_to_true_north</code> float (\u00b0) Orientation of the building relative to north.  (0=N, 90=E, 180=S, 270=W) <code>latitude</code>, <code>longitude</code> float Coordinates (used for weather and solar position). <code>exposed_perimeter</code> float (m) External perimeter. <code>height</code> float (m) Building height (floor to roof). <code>wall_thickness</code> float (m) Average wall layer total thickness <code>n_floors</code> int Number of floors. <code>building_type_class</code> str Type of building (e.g., Residential_apartment, Office). <code>adj_zones_present</code> bool Whether unconditioned/adjacent zones exist. <code>number_adj_zone</code> int Number of adjacent zones. <code>net_floor_area</code> float (m\u00b2) Conditioned floor area. <code>construction_class</code> str Construction quality (e.g., class_i)."},{"location":"iso_52016_input/#adjoiningunconditioned-spaces-adjacent_zones","title":"Adjoining/Unconditioned Spaces: <code>\"adjacent_zones\"</code>","text":"<p>Defines zones adjacent to the conditioned area, used for ISO\u202f13789 transmission heat transfer.</p> <p>Each zone has:</p> Key Description <code>name</code> Zone name. <code>orientation_zone.azimuth</code> local azimuth of each adjacent unconditioned zone (\u00b0). <code>area_facade_elements</code> Areas of fa\u00e7ade elements (array, m\u00b2). <code>typology_elements</code> Element types: <code>OP</code> (opaque), <code>GR</code> (ground), etc. <code>transmittance_U_elements</code> U-values of each element (W/m\u00b2K). <code>orientation_elements</code> orientation code by element: <code>NV</code> North-vertical (\u22480\u00b0), <code>SV</code> South-vertical (\u2248180\u00b0),<code>EV</code> East-vertical (\u224890\u00b0),  <code>WV</code> West-vertical (\u2248270\u00b0),<code>HOR</code> horizontal (roof/slab). <code>volume</code> Zone air volume (m\u00b3). <code>building_type_class</code> Type of building zone (same taxonomy). <code>a_use</code> useful area of the adjacent zone ."},{"location":"iso_52016_input/#envelope-elements-building_surface","title":"Envelope Elements: <code>\"building_surface\"</code>","text":"<p>Describes all external and internal surfaces forming the building envelope.</p>"},{"location":"iso_52016_input/#common-attributes","title":"Common attributes","text":"Key Description <code>name</code> Surface name. <code>type</code> <code>\"opaque\"</code>, <code>\"transparent\"</code>, <code>\"adiabatic\"</code>, <code>\"adjacent\"</code>. <code>area</code> Surface area (m\u00b2). <code>sky_view_factor</code> Fraction of visible sky (0\u20131). <code>u_value</code> Thermal transmittance (W/m\u00b2K). <code>solar_absorptance</code> Fraction of solar radiation absorbed (0\u20131). <code>thermal_capacity</code> Surface thermal capacity (J/K). <code>orientation.azimuth</code> Azimuth (0\u202f=\u202fN, 90\u202f=\u202fE, 180\u202f=\u202fS, 270\u202f=\u202fW). <code>orientation.tilt</code> Tilt angle (0\u202f=\u202fhorizontal, 90\u202f=\u202fvertical). <code>name_adj_zone</code> Linked adjacent zone (if applicable)."},{"location":"iso_52016_input/#transparent-surfaces","title":"Transparent surfaces","text":"<p>Include window-specific attributes: | Key | Description | |------|-------------| | <code>g_value</code> | Solar transmittance of glazing. | | <code>height</code>, <code>width</code> | Window dimensions (m). | | <code>parapet</code> | Window sill height above floor (m). | | <code>shading</code>, <code>shading_type</code> | Boolean and type of shading (e.g., horizontal_overhang). | | <code>width_or_distance_of_shading_elements</code> | Distance or overhang width. | | <code>overhang_proprieties</code> | Additional geometric data for shading devices. |</p>"},{"location":"iso_52016_input/#unit-definitions-units","title":"Unit Definitions: <code>\"units\"</code>","text":"<p>Defines unit conventions for each physical quantity.</p> Key Example Meaning <code>area</code> <code>\"m\u00b2\"</code> Surface area unit. <code>u_value</code> <code>\"W/m\u00b2K\"</code> Heat transmittance. <code>thermal_capacity</code> <code>\"J/kgK\"</code> Heat storage capacity. <code>azimuth</code>, <code>tilt</code> <code>\"degrees\"</code> Orientation conventions. <code>internal_gain</code> <code>\"W/m\u00b2\"</code> Internal gain density. <code>internal_gain_profile</code> <code>\"Normalized 0\u20131\"</code> Profile normalization rule. <code>HVAC_profile</code> <code>\"0: off, 1: on\"</code> HVAC operating schedule encoding."},{"location":"iso_52016_input/#thermal-system-and-operational-settings-building_parameters","title":"Thermal, System, and Operational Settings: <code>\"building_parameters\"</code>","text":""},{"location":"iso_52016_input/#temperature-setpoints","title":"Temperature Setpoints","text":"Key Description <code>heating_setpoint</code>, <code>heating_setback</code> Comfort and setback temperatures (\u00b0C). <code>cooling_setpoint</code>, <code>cooling_setback</code> Cooling comfort and setback (\u00b0C). <code>units</code> <code>\"\u00b0C\"</code>."},{"location":"iso_52016_input/#system-capacities","title":"System Capacities","text":"Key Description <code>heating_capacity</code>, <code>cooling_capacity</code> Maximum system capacities (W). <code>units</code> <code>\"W\"</code>."},{"location":"iso_52016_input/#airflow-rates","title":"Airflow Rates","text":"Key Description <code>infiltration_rate</code> Airflow in air changes per hour (ACH). <code>units</code> <code>\"ACH\"</code>."},{"location":"iso_52016_input/#internal-gains","title":"Internal Gains","text":"<p>Each internal source (occupants, appliances, lighting) defines: | Key | Description | |------|-------------| | <code>name</code> | Gain type. | | <code>full_load</code> | Peak power density (W/m\u00b2). | | <code>weekday</code>, <code>weekend</code> | 24-hour normalized (0\u20131) schedules. |</p>"},{"location":"iso_52016_input/#construction","title":"Construction","text":"Key Description <code>wall_thickness</code> Wall thickness (m). <code>thermal_bridges</code> Linear thermal bridge coefficient (W/m\u00b7K)."},{"location":"iso_52016_input/#climate-parameters","title":"Climate Parameters","text":"Key Description <code>coldest_month</code> Index of coldest month (1\u202f=\u202fJan,\u202f12\u202f=\u202fDec)."},{"location":"iso_52016_input/#hvac-and-ventilation-profiles","title":"HVAC and Ventilation Profiles","text":"<p>Hourly normalized profiles for system operation:</p> Profile Description <code>heating_profile</code> 24\u2011hour on/off (0\u20131) heating activity. <code>cooling_profile</code> 24\u2011hour on/off cooling activity. <code>ventilation_profile</code> 24\u2011hour on/off ventilation schedule."},{"location":"iso_52016_input/#example-workflow","title":"Example Workflow","text":"<pre><code>from iso52016 import ISO52016\n\n# Validate input\nbui_checked, issues = ISO52016.sanitize_and_validate_BUI(BUI, fix=True)\n\n# Run hourly energy needs\nhourly, annual = ISO52016.Temperature_and_Energy_needs_calculation(\n    bui_checked, weather_source=\"pvgis\"\n)\n\nprint(annual)\n</code></pre>"},{"location":"iso_52016_input/#good-practices","title":"Good Practices","text":"<ul> <li>Always verify units and orientation angles before running simulations.  </li> <li>Ensure surface U-values and areas are consistent with geometry.  </li> <li>Normalize all profiles (0\u20131).  </li> <li>When <code>adj_zones_present</code> is <code>True</code>, populate valid adjacent zone data.  </li> <li>Latitude/longitude and azimuth are essential for solar radiation accuracy.</li> </ul>"},{"location":"iso_52016_input/#outputs-of-iso-52016","title":"Outputs of ISO\u202f52016","text":"<p>After running the calculation, typical outputs include: - Hourly heating/cooling needs (<code>Q_HC</code>, W) - Operative temperature (<code>T_op</code>, \u00b0C) - External temperature (<code>T_ext</code>, \u00b0C) - Annual heating/cooling energy (Wh/m\u00b2)</p>"},{"location":"iso_52016_input/#static-data-constants-global_inputspy","title":"Static data &amp; constants: <code>global_inputs.py</code>","text":""},{"location":"iso_52016_input/#purpose","title":"Purpose","text":"<ul> <li>Provide reference tables (e.g., ISO 13789 <code>n_ue</code> air-tightness classes) and thermophysical constants.</li> <li>Contain an emitter table <code>TB14</code> (\u0394T exponents).</li> </ul>"},{"location":"iso_52016_input/#key-objects","title":"Key Objects","text":"<ul> <li><code>periods</code>, <code>bui_types</code>, <code>months</code>: taxonomies.</li> <li><code>WATER_DENSITY = 1000</code> <code>[kg\u00b7m\u207b\u00b3]</code></li> <li><code>WATER_SPECIFIC_HEAT_CAPACITY = 0.00116</code> <code>[kWh\u00b7kg\u207b\u00b9\u00b7K\u207b\u00b9]</code> (\u2192 multiply by <code>kg</code> and <code>\u0394T</code> to get kWh)</li> <li><code>df_n_ue</code> \u2014 ISO 13789:2018 (Table 7) conventional air change rate between unconditioned space and exterior:</li> </ul> code description (air-tightness) <code>n_ue</code> [h\u207b\u00b9] 1 No doors/windows openings 0.1 2 All joints well sealed, no openings 0.5 3 Well sealed, small openings 1.0 4 Some localized open joints 3.0 5 Numerous open joints / large openings 10.0 <ul> <li><code>TB14</code> \u2014 emitter exponents and nominal \u0394T:<ul> <li>Radiator: <code>n=1.3</code>, <code>\u0394\u03b8_air=50\u00b0C</code>, <code>\u0394\u03b8_water=20\u00b0C</code></li> <li>Floor heating: <code>n=1.1</code>, <code>\u0394\u03b8_air=15\u00b0C</code>, <code>\u0394\u03b8_water=5\u00b0C</code></li> <li>Fan coil: <code>n=1.0</code>, <code>\u0394\u03b8_air=25\u00b0C</code>, <code>\u0394\u03b8_water=10\u00b0C</code></li> </ul> </li> </ul>"},{"location":"iso_52016_input/#usage-physics","title":"Usage &amp; Physics","text":"<ul> <li><code>n_ue</code> maps directly into adjacent unconditioned zone ventilation (see \u00a74.3), i.e. <code>que = V_u \u00b7 n_ue</code> <code>[m\u00b3\u00b7h\u207b\u00b9]</code>.</li> <li>Water constants are useful for DHW/emitters energy conversions (not used inside <code>ventilation.py</code> yet).</li> </ul>"},{"location":"iso_52016_input/#implementation-notes-robustness","title":"Implementation Notes &amp; Robustness","text":"<ul> <li>Type safety: many arrays in <code>BUI</code> are <code>dtype=object</code>. Cast to <code>np.asarray(..., dtype=float)</code> before algebra.</li> <li>Orientation logic: To identify interface elements for \\(H_{d,zt{\\text -}ztu}\\), define a clear mapping between <code>building_surface[*].name_adj_zone</code> and the <code>adjacent_zones[*].name</code> and use that to split \\(\\mathcal{E}_{zt{\\text -}ztu}\\) vs \\(\\mathcal{E}_{ztu{\\text -}ext}\\). Avoid relying only on cardinal labels like <code>NV/SV/...</code> when adjacency is explicit in the <code>BUI</code>.</li> <li>Units consistency: Eq. (4.12b) uses the common shortcut <code>0.33</code> <code>[Wh\u00b7m\u207b\u00b3\u00b7K\u207b\u00b9]</code> for flows in m\u00b3\u00b7h\u207b\u00b9. If you operate on SI <code>[s]</code>, convert accordingly \\( \\frac{\\rho c}{3600} \\).</li> <li>Altitude: The simple density correction used in Eq. (4.2) is adequate for building simulation. For high-altitude sites you may want a full barometric formula.</li> </ul>"},{"location":"iso_52016_input_check/","title":"Quality check","text":"ISO 52016 Input Check <p>The data provided before being used for the simulation are processed and evaluated to be considered fit for the simulation. This process includes a series of checks that allow to identify any potential errors.  The following controls are applied:</p>"},{"location":"iso_52016_input_check/#direction-from-orientation","title":"Direction from orientation","text":"<p>Function Name: <code>_dir_from_orientation(azimut:float, tilt:float) -&gt; str</code></p> <p>Purpose:  This function mapd the orientation of the surface (azimuth and tilt) and returns the direction of the surface.</p> <p>Return One of: <code>HOR</code> (horizontal), <code>NV</code>,<code>EV</code>, <code>SV</code>, <code>WV</code>(vertical faces; North, East, South, West) </p> <p>Validations &amp; rules - Tilt checks     - If <code>tilt == 0</code> (|\u0394| \u2264 1e-9): return <code>\"HOR\"</code>.     - If <code>tilt != 90</code> (|\u0394| &gt; 1e-6): uses a fallback threshold:         - <code>tilt &lt; 45 \u2192 \"HOR\"</code>         - <code>tilt \u2265 45 \u2192 \"NV\"</code> (treat as a generic vertical).</p> <ul> <li>Azimuth checks (only when considered vertical):<ul> <li>Normalize <code>azimuth % 360</code>.</li> <li>Exact snaps (|\u0394| \u2264 1e-6):<ul> <li><code>0</code> or <code>360</code> \u2192 <code>\"NV\"</code>, <code>90</code> \u2192 <code>\"EV\"</code>, <code>180</code> \u2192 <code>\"SV\"</code>, <code>270</code> \u2192 <code>\"WV\"</code>.</li> </ul> </li> <li>Otherwise: snap to the nearest of <code>[0,90,180,270]</code>.</li> </ul> </li> </ul> <p>Notes</p> <p>This function does not emit messages; it enforces interpretation by thresholds/snaps.</p>"},{"location":"iso_52016_input_check/#opaque-facade-areas-in-adjacent-zone","title":"Opaque facade areas in adjacent zone","text":"<p>Function Name: <code>_adj_op_area_in_dir(adj_zone: dict, dir_code: str) -&gt; float</code></p> <p>Purpose:  Compute the sum of opaque (\u201cOP\u201d) facade areas in <code>adj_zone</code> for the given direction code <code>(\"NV\"|\"EV\"|\"SV\"|\"WV\")</code>.</p> <p>Validations &amp; rules</p> <ul> <li> <p>Upper-cases and matches:</p> <ul> <li><code>typology_elements == \"OP\"</code> and </li> <li><code>orientation_elements == dir_code</code></li> </ul> </li> <li> <p>If no match: returns <code>0.0</code>.</p> </li> </ul> <p>Notes</p> <p>No messages; pure filtering/aggregation with safe default <code>0.0</code>.</p>"},{"location":"iso_52016_input_check/#check-heating-system-inputs","title":"Check heating system inputs","text":"<p>Function Name: <code>check_heating_system_inputs(system_input: dict) -&gt; dict</code></p> <p>Purpose:  Load and validate heating system configuration, selecting the correct TB14 table and ensuring compatible fields for generator control logic Example of TB14:</p> <pre><code>TB14 = pd.DataFrame({\n    \"Emitters_nominale_deltaTeta_air_C\": [50, 15, 25],\n    \"Emitters_exponent_n\": [1.3, 1.1, 1.0],\n    \"Emitters_nominal_deltaTeta_Water_C\": [20, 5, 10],\n}, index=[\"Radiator\", \"Floor heating\", \"Fan coil\"])\n</code></pre> <p>Returns</p> <pre><code>{\n  \"TB14_used\": pd.DataFrame,   # custom or default TB14\n  \"emitter_type\": str,         # validated (possibly auto-adjusted)\n  \"messages\": list[str],       # human-readable validations/fixes\n  \"config\": dict               # normalized config (may include auto-fixes)\n}\n</code></pre> <p>Validations &amp; auto-fix logic</p> <p>1) TB14 selection</p> <ul> <li>If <code>system_input[\"TB14\"]</code> is a<code>pd.DataFrame</code> \u2192 use it.<ul> <li>Message: <code>Custom TB14 table loaded from input</code>.</li> </ul> </li> <li>Else \u2192 fallback to <code>TB14_backup</code>.<ul> <li>Message: <code>Default TB14 table loaded from global_inputs.py</code>.</li> </ul> </li> </ul> <p>2) <code>emitter_type</code> presence in TB14 index</p> <ul> <li>If missing from <code>TB14.index</code> \u2192 auto-set to the first available index (or <code>None</code> if empty).<ul> <li>Message: <code>Emitter type '...' not found ... auto-set to '...'.</code></li> </ul> </li> <li>Else \u2192 keep as is.<ul> <li>Message: <code>Emitter type '...' found in TB14.</code></li> </ul> </li> </ul> <p>3) <code>gen_flow_temp_control_type</code> validation    - Allowed: <code>\"Type A\" | \"Type B\" | \"Type C\".</code>    - Type A requires <code>gen_outdoor_temp_data</code> as <code>pd.DataFrame</code>:       - If not a DataFrame \u2192 auto-switch to \"Type B\".          - Message: <code>For 'Type A' ... must be provided ... \u2192 switched to 'Type B'.</code>       - Else \u2192 <code>'gen_outdoor_temp_data' provided ...</code>.    - Type C requires numeric <code>\u03b8HW_gen_flw_const</code>:       - If missing/None \u2192 auto-set to <code>50.0</code>.       - Message: <code>\u26a0\ufe0f '\u03b8HW_gen_flw_const' not provided ...; setting it to 50.</code>    - Any other value \u2192 auto-set to \"Type B\".       - Message: <code>\u26a0\ufe0f Invalid value ... Setting to 'Type B'.</code></p> <p>Side effects Returns a normalized copy of the input config in \"config\"; original dict is not mutated by the function.</p>"},{"location":"iso_52016_input_check/#validation-and-optional-sanitation-of-a-bui-structure","title":"Validation and optional sanitation of a BUI structure","text":"<p>Function Name: <code>sanitize_and_validate_BUI(bui: dict, fix: bool = True, eps: float = 1e-6, defaults: dict | None = None) -&gt; tuple[dict, list[dict]]</code></p> <p>Purpose:  Deep validation and optional sanitation of a BUI structure (building, surfaces, adjacent zones, and their pairing). It can also re-balance areas and split surfaces to maintain geometric/physical consistency. There are 4 main controls: - Building-level checks - Surface-level checks - Adjacent zone checks - Adjacency pairing, window caps &amp; residual splitting</p> <p>Returns</p> <ul> <li><code>bui_clean</code>: deep-copied and possibly corrected BUI.</li> <li><code>issues</code>: list of structured messages:</li> </ul> <pre><code>{\"level\": \"ERROR|WARN|INFO\",\n \"path\": \"dot.notation or index path\",\n \"msg\": \"human-readable message\",\n \"fix_applied\": bool}\n</code></pre> <p>Defaults used when <code>defaults</code> is None</p> <pre><code>{\n  \"opaque_u_default\": 0.5,\n  \"transparent_u_default\": 1.6,\n  \"g_default\": 0.6\n}\n</code></pre>"},{"location":"iso_52016_input_check/#1-building-level-checks","title":"1) Building-level checks","text":"<ul> <li> <p>Keys: <code>net_floor_area</code>, <code>exposed_perimeter</code>, <code>height</code></p> </li> <li> <p>Must be numeric and &gt; 0.</p> </li> <li>If <code>fix</code> and value is exactly <code>0</code> \u2192 set to <code>max(eps, 1.0)</code> (\u26a0\ufe0f <code>WARN</code> with fix).</li> <li> <p>Else \u2192 <code>ERROR</code>.</p> </li> <li> <p><code>n_floors</code></p> </li> <li> <p>Must be numeric and &gt; 0.</p> </li> <li>If <code>fix</code> and value is exactly <code>0</code> \u2192 set to <code>1</code> (\u26a0\ufe0f <code>WARN</code> with fix).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul>"},{"location":"iso_52016_input_check/#2-surface-level-checks-building_surface","title":"2) Surface-level checks (<code>building_surface[*]</code>)","text":"<ul> <li>Type typos auto-corrected (<code>\"opque\"|\"opaqu\"|\"trasparent\"</code> \u2192 <code>\"opaque\"|\"transparent\"</code>) with <code>WARN</code>.</li> <li><code>type</code> must be in {<code>\"opaque\"</code>, <code>\"transparent\"</code>, <code>\"adiabatic\"</code>, <code>\"adjacent\"</code>} \u2192 else <code>ERROR</code>.</li> <li><code>area</code> must be numeric &gt; 0.</li> <li>If <code>fix</code> and <code>area</code> is exactly <code>0</code> \u2192 set to <code>max(eps, 1.0)</code> (\u26a0\ufe0f <code>WARN</code> with fix).</li> <li>Else \u2192 <code>ERROR</code>.</li> <li><code>sky_view_factor</code> must be in [0.0, 1.0].</li> <li>If <code>fix</code> and numeric \u2192 clipped into range (\u26a0\ufe0f <code>WARN</code>).</li> <li> <p>Else \u2192 <code>WARN</code>.</p> </li> <li> <p>Thermal properties</p> </li> <li>For <code>opaque/transparent</code>: <code>u_value</code> &gt; 0.<ul> <li>If invalid and <code>fix</code> \u2192 set to default (opaque_u_default or transparent_u_default) (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul> </li> <li> <p>For <code>transparent</code>: <code>g_value</code> &gt; 0.</p> <ul> <li>If invalid and <code>fix</code> \u2192 set to default (g_default) (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul> </li> <li> <p>Transparent dimensions</p> </li> <li><code>height &gt; 0</code>, <code>width &gt; 0.</code><ul> <li>If invalid and <code>fix</code> \u2192 set both to <code>1.0</code> (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul> </li> <li> <p><code>parapet</code> must be in <code>[0, height]</code> when both numeric.</p> <ul> <li>If out of range and <code>fix</code> \u2192 clamp to <code>[0, height]</code> (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>WARN</code>.</li> </ul> </li> <li> <p>Orientation recommendations</p> </li> <li><code>tilt</code> recommended in {0, 90}.<ul> <li>If numeric non-standard and <code>fix</code> \u2192 normalize to nearest of {0, 90} (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>WARN</code>.</li> </ul> </li> <li><code>azimuth</code> recommended in {0, 90, 180, 270}.<ul> <li>If numeric non-standard and <code>fix</code> \u2192 snap to nearest multiple of 90 (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>WARN</code>.</li> </ul> </li> </ul>"},{"location":"iso_52016_input_check/#3-adjacent-zones-checks-adjacent_zones","title":"3) Adjacent zones checks (adjacent_zones[*])","text":"<ul> <li><code>volume &gt; 0.</code></li> <li>If invalid and <code>fix</code> \u2192 set to <code>1.0</code> (\u26a0\ufe0f <code>WARN</code>).</li> <li> <p>Else \u2192 <code>ERROR</code>.</p> </li> <li> <p>Array length coherence across:</p> </li> <li> <p><code>area_facade_elements, typology_elements, transmittance_U_elements, orientation_elements.</code></p> <ul> <li>If lengths mismatch \u2192 <code>ERROR</code>.</li> </ul> </li> <li> <p><code>transmittance_U_elements</code> must be &gt; 0:</p> </li> <li>If invalid and <code>fix</code> \u2192 set invalid entries to <code>opaque_u_default</code> (\u26a0\ufe0f <code>WARN</code>).</li> <li>Else \u2192 <code>ERROR</code>.</li> </ul>"},{"location":"iso_52016_input_check/#4-adjacency-pairing-window-caps-residual-splitting","title":"4) Adjacency pairing, window caps &amp; residual splitting","text":"<p>This stage ensures geometric consistency between:</p> <ul> <li>BUI vertical adjacent surfaces,</li> <li>the opaque (\u201cOP\u201d) areas declared in the adjacent zone on the same cardinal direction, and</li> <li>the transparent (windows) areas on the same direction.</li> </ul> <p>It operates in two passes (an inner while-loop and a later full pass), using the helpers:</p> <ul> <li><code>_azimuth_to_dir:</code> snap 0/90/180/270 \u2192<code>\"NV\"|\"EV\"|\"SV\"|\"WV\"</code>, else <code>None</code>.</li> <li><code>_dir_from_orientation:</code> more general mapper used later.</li> </ul> <p>4.1 For each vertical <code>building_surface</code> of type <code>\"adjacent\"</code> with <code>name_adj_zone</code>:</p> <ul> <li>Compute:  </li> <li><code>A_bui_orig</code>: area of the adjacent BUI surface.</li> <li> <p><code>A_adj_dir_cap</code>: sum of adjacent zone OP areas in the same direction.</p> </li> <li> <p>Cap OP area to BUI area:</p> </li> <li> <p>If <code>A_adj_dir_cap &gt; A_bui_orig + eps</code>:</p> <ul> <li>If <code>fix</code>: scale down those OP areas proportionally (\u26a0\ufe0f WARN with scale factor).</li> <li>Else: ERROR.</li> </ul> </li> </ul> <p>Window check on same direction</p> <ul> <li>Compute <code>A_win_dir</code> = sum of all vertical transparent surfaces in the same direction.</li> <li>Compute <code>diff = max(A_bui_orig - A_adj_dir_cap, 0).</code></li> <li>If <code>A_win_dir &gt; diff + eps</code>:<ul> <li>If <code>fix</code>: scale all those windows proportionally to sum to diff (\u26a0\ufe0f WARN with window scale factor).</li> <li>Else: <code>ERROR</code>.</li> </ul> </li> </ul> <p>Residual exterior creation</p> <ul> <li><code>diff_ext = max(A_bui_orig - A_adj_dir_cap, 0).</code></li> <li>If <code>diff_ext &gt; eps</code>:<ul> <li>If <code>fix</code>:<ul> <li>Append a new <code>\"opaque\"</code> surface with area <code>diff_ext</code> (same orientation, external),</li> <li>Shrink the <code>\"adjacent\"</code>surface area to <code>A_adj_dir_cap</code>.</li> <li>\u26a0\ufe0f <code>WARN</code> describing creation and resizing.</li> </ul> </li> <li>Else: <code>ERROR</code> (unallocated residual).</li> </ul> </li> </ul> <p>4.2 Final pass: split all <code>\"adjacent\"</code> verticals (consistency sweep)</p> <ul> <li> <p>For each <code>\"adjacent\"</code> vertical surface:</p> </li> <li> <p>Compute direction via <code>_dir_from_orientation</code>.</p> </li> <li>Fetch matching adjacent zone and compute <code>A_adj_dir</code> via <code>_adj_op_area_in_dir.</code></li> <li>Cap <code>A_adj_dir</code> to <code>A_bui</code> with <code>WARN</code> if it exceeds.</li> <li>If <code>diff = A_bui - A_adj_dir &gt; 1e-9</code>:<ul> <li>Shrink the \"adjacent\" area to A_adj_dir.</li> </ul> </li> </ul>"},{"location":"iso_52016_input_check/#thermal-and-adjacent-zone","title":"Thermal and Adjacent Zone","text":"<p>Uno degli errori pi\u00f9 caratteristici pu\u00f2 essere quello di immetere dei valori errati di superficie della parete di confine tra la zona termica e la zona non termica. Un esempio \u00e8 quello di dare dei valori pi\u00f9 alti della superificie della parete nella zona non termica rispetto alla superificie della parete nella zona termica. In questo caso se il controllo risulta essere negativo allora il tool imposta il valore del superificie della zona non termica uguale a quello della zona termica.  Qui voglio dire che sebbene la superficie di contatto \u00e8 la stessa pu`o succedere che la parete della zona termica sia o totlamente a contatto con la zon non termica o solamente una parte a contatto con la zona termica   </p>"},{"location":"iso_52016_input_check/#quality-check-of-system-input-check_heating_system_inputs","title":"Quality check of system input <code>check_heating_system_inputs</code>","text":"<p>This function validates and normalizes the input configuration for the heating system. It performs the following checks:</p> <ol> <li>TB14 Table: </li> <li>If a custom <code>TB14</code> DataFrame is provided, it is used.</li> <li> <p>Otherwise, the default <code>TB14</code> from <code>global_inputs.py</code> is used.</p> </li> <li> <p>Emitter Type Validation:</p> </li> <li> <p>If the <code>emitter_type</code> is not found in the selected <code>TB14</code> table, it is automatically set to the first available emitter type, and a warning message is generated.</p> </li> <li> <p>Generator Flow Temperature Control Type (<code>gen_flow_temp_control_type</code>):</p> </li> <li>Type A: Requires <code>gen_outdoor_temp_data</code> as a DataFrame. If not provided, it switches to <code>Type B</code> and generates a warning.</li> <li>Type C: If <code>\u03b8HW_gen_flw_const</code> is not provided, it defaults to <code>50</code> and a warning is shown.</li> <li>Invalid Control Type: Any other values are automatically set to <code>Type B</code>.</li> </ol> <p>The function returns: - The selected <code>TB14</code> table. - The validated <code>emitter_type</code>. - A list of messages about any changes or validations. - The normalized input configuration.</p>"},{"location":"iso_52016_node/","title":"ISO 52016 - Facade elements (nodes)","text":""},{"location":"iso_52016_node/#node-of-building-element","title":"Node of building element","text":"<p>The following two functions calculates the number of nodes to be used in opaque and transparent elements in the 5-node thermal network model.</p> <pre><code>def Number_of_nodes_element(cls, building_object) -&gt; numb_nodes_facade_elements\n</code></pre>"},{"location":"iso_52016_node/#parameters","title":"Parameters","text":"Name Type Description <code>building_object</code> <code>dict</code> Building model containing a list of surfaces under <code>building_surface</code>. Each element defines its physical type."},{"location":"iso_52016_node/#required-fields-in-building_objectbuilding_surface","title":"Required Fields in <code>building_object[\"building_surface\"]</code>","text":"Field Description <code>type</code> Element type string: \u2022 <code>\"opaque\"</code> or <code>\"OP\"</code> \u2192 Opaque element \u2022 <code>\"transparent\"</code> or <code>\"W\"</code> \u2192 Transparent element (window) \u2022 <code>\"adiabatic\"</code> \u2192 Internal/insulated partition with no heat flow."},{"location":"iso_52016_node/#purpose","title":"Purpose","text":"<p>Determines the number of thermal nodes for each building element, according to its type (opaque, transparent, or adiabatic). This step is part of the nodal network definition in EN ISO 52016-1:2017, used for energy balance and dynamic thermal simulations.</p>"},{"location":"iso_52016_node/#how-it-works","title":"How it works","text":"<ol> <li> <p>Initialize all elements as 5-node systems</p> <pre><code>el_list = len(building_object[\"building_surface\"])\nPln = np.full(el_list, 5)\n</code></pre> <p>ISO 52016 default: each opaque surface is modeled with 5 thermal nodes.</p> </li> <li> <p>Adjust per element type</p> <ul> <li>Transparent (<code>\"transparent\"</code>) \u2192 2 nodes (external/internal surfaces only).  </li> <li>Adiabatic (<code>\"adiabatic\"</code>) \u2192 0 nodes (no heat transfer).</li> </ul> <pre><code>for i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"transparent\":\n        Pln[i] = 2\n    elif surf[\"type\"] == \"adiabatic\":\n        Pln[i] = 0\n</code></pre> </li> <li> <p>Compute cumulative node index (<code>PlnSum</code>)</p> <p><pre><code>for Eli in range(1, el_list):\n    PlnSum[Eli] = PlnSum[Eli-1] + Pln[Eli-1]\n</code></pre> Each element\u2019s node sequence starts where the previous one ends.</p> </li> <li> <p>Compute the last node index (<code>Rn</code>)</p> <pre><code>Rn = PlnSum[-1] + Pln[-1] + 1\n</code></pre> <p>Adds one final node for matrix dimensioning in the solver.</p> </li> <li> <p>Return wrapper</p> <pre><code>return numb_nodes_facade_elements(Rn, Pln, PlnSum)\n</code></pre> </li> </ol> <p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre>"},{"location":"iso_52016_node/#output","title":"Output","text":"Variable Type Description <code>Rn</code> <code>int</code> Index of the last node in the complete nodal vector. Used for vector and matrix sizing. <code>Pln</code> <code>np.ndarray[int]</code> Array of the number of nodes per element: 5 for opaque, 2 for transparent, 0 for adiabatic. <code>PlnSum</code> <code>np.ndarray[int]</code> Sequential cumulative node indices for mapping all elements. <code>numb_nodes_facade_elements</code> <code>object</code> Wrapper containing <code>(Rn, Pln, PlnSum)</code>."},{"location":"iso_52016_node/#example","title":"Example","text":"<p><pre><code>building_object = {\n    \"building_surface\": [\n        {\"type\": \"opaque\"},\n        {\"type\": \"transparent\"},\n        {\"type\": \"opaque\"},\n        {\"type\": \"adiabatic\"}\n    ]\n}\n\nnodes = Number_of_nodes_element(building_object)\nprint(\"Rn:\", nodes.Rn)\nprint(\"Pln:\", nodes.Pln)\nprint(\"PlnSum:\", nodes.PlnSum)\n</code></pre> Example Output: <pre><code>Rn: 13\nPln: [5 2 5 0]\nPlnSum: [0 5 7 12]\n</code></pre></p>"},{"location":"iso_52016_node/#notes","title":"Notes","text":"<ul> <li>Opaque and adiabatic surfaces are both considered non-transparent; adiabatic ones simply have no conductive nodes.  </li> <li>The nodal indexing ensures continuous node numbering across all envelope elements \u2014 crucial for constructing the global heat transfer matrix.  </li> <li>ISO 52016 recommends 5 nodes for opaque elements (multi-layer walls/roofs) and 2 nodes for transparent elements (windows).  </li> <li>The function prepares data for the later calculation of heat capacity, conductance, and solar absorption matrices.</li> </ul>"},{"location":"iso_52016_node/#calculation-of-conduttance","title":"Calculation of conduttance","text":"<pre><code>def Conduttance_node_of_element(cls, building_object, lambda_gr=2.0) -&gt; conduttance_elements\n</code></pre>"},{"location":"iso_52016_node/#parameters_1","title":"Parameters","text":"Name Type Default Description <code>building_object</code> <code>dict</code> \u2014 Building structure containing the envelope elements in <code>building_surface</code>. <code>lambda_gr</code> <code>float</code> <code>2.0</code> Ground thermal conductivity (W/m\u00b7K), used for ground-contact elements (<code>GR</code>)."},{"location":"iso_52016_node/#required-fields-in-building_objectbuilding_surface_1","title":"Required Fields in <code>building_object[\"building_surface\"]</code>","text":"<p>Each surface element must include:</p> Field Description <code>ISO52016_type_string</code> ISO 52016 element type string: \u2022 <code>OP</code> = Opaque element \u2022 <code>W</code> = Transparent (window) \u2022 <code>GR</code> = Ground-contact \u2022 <code>AD</code> or <code>ADJ</code> = Adjacent wall <code>u_value</code> Overall thermal transmittance (W/m\u00b2\u00b7K). <code>convective_heat_transfer_coefficient_internal</code> Internal convective heat transfer coefficient (W/m\u00b2\u00b7K). <code>radiative_heat_transfer_coefficient_internal</code> Internal radiative heat transfer coefficient (W/m\u00b2\u00b7K). <code>area</code> Element surface area (m\u00b2). (optional) <code>convective_heat_transfer_coefficient_external</code> If not defined, default = 20 W/m\u00b2\u00b7K (ISO 13789). (optional) <code>radiative_heat_transfer_coefficient_external</code> If not defined, default = 4.14 W/m\u00b2\u00b7K (ISO 13789)."},{"location":"iso_52016_node/#purpose_1","title":"Purpose","text":"<p>Calculates the thermal conductance between the internal nodes (<code>pli</code> and <code>pli-1</code>) of each construction element in accordance with EN ISO 52016-1 (Section 6.5.7). It defines the inter-nodal conductances (W/m\u00b2\u00b7K) that represent the heat transfer capability through each layer of opaque, transparent, or ground-contact elements in the 5-node thermal network model.</p>"},{"location":"iso_52016_node/#how-it-works_1","title":"How it works","text":"<ol> <li> <p>Initialize constants and arrays</p> <ul> <li>Ground resistance:  </li> </ul> \\[ R_{gr} = \\frac{0.5}{\\lambda_{gr}} \\;(\\text{m}^2K/W) \\] <ul> <li>Build lists of:<ul> <li>element types (<code>el_type</code>),  </li> <li>U-values,  </li> <li>internal heat-transfer coefficients (<code>h_ci</code>, <code>h_ri</code>),  </li> <li>external coefficients (<code>h_ce</code>, <code>h_re</code>).</li> </ul> </li> </ul> </li> <li> <p>Assign external coefficients</p> <ul> <li>Default convective = 20 W/m\u00b2\u00b7K, radiative = 4.14 W/m\u00b2\u00b7K.  </li> <li>For adjacent elements (<code>AD</code>), both coefficients are set to 0 \u2192 no external exchange.</li> </ul> </li> <li> <p>Compute construction resistance </p> \\[R_{c,eli} = \\frac{1}{U_{eli}} - \\frac{1}{(h_{ci}+h_{ri})} - \\frac{1}{(h_{ce}+h_{re})}\\] <p>This represents the core conduction resistance of the element (m\u00b2\u00b7K/W).</p> </li> <li> <p>Distribute conductances among layers </p> <p>For each element i, the nodal conductances <code>h_pli_eli[layer, i]</code> are defined as:</p> <p>Layer 1 (node pair 1\u20132)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 6/R_c \\) <code>W</code> \\( h = 1/R_c \\) <code>GR</code> \\( h = 2/R_{gr} \\) <p>Layer 2 (node pair 2\u20133)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 3/R_c \\) <code>GR</code> \\( h = 1/(R_c/4 + R_{gr}/2) \\) <p>Layer 3 (node pair 3\u20134)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 3/R_c \\) <code>GR</code> \\( h = 2/R_c \\) <p>Layer 4 (node pair 4\u20135)</p> Type Formula <code>OP</code>, <code>ADJ</code> \\( h = 6/R_c \\) <code>GR</code> \\( h = 4/R_c \\) </li> <li> <p>Return    The final 4\u00d7N matrix is wrapped in <code>conduttance_elements(h_pli_eli=h_pli_eli)</code>.</p> </li> </ol> <p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre>"},{"location":"iso_52016_node/#outputs","title":"Outputs","text":"Type Description <code>conduttance_elements</code> Wrapper object containing the matrix <code>h_pli_eli</code> (4\u00d7N) where N = number of envelope elements. Each row corresponds to a node pair (<code>pli</code>, <code>pli\u22121</code>) and each column to an element. Units: W/m\u00b2\u00b7K."},{"location":"iso_52016_node/#example_1","title":"Example","text":"<pre><code>h = Conduttance_node_of_element(building_object=bui, lambda_gr=2.0)\nH = h.h_pli_eli\nprint(H.shape)  # (4, N)\nprint(H[:, 0])  # conductance values for element #0\n</code></pre>"},{"location":"iso_52016_node/#notes_1","title":"Notes","text":"<ul> <li>For adjacent surfaces (<code>AD</code>), external heat-transfer coefficients are zero (no external exchange).  </li> <li>Ground-contact elements use simplified analytical correlations (ISO 13370).  </li> <li><code>R_c</code> is set to \u221e for \u201cAD\u201d elements \u2192 conductance = 0.  </li> <li>Default coefficients (20 W/m\u00b2\u00b7K, 4.14 W/m\u00b2\u00b7K) are consistent with ISO 13789 recommendations.  </li> <li>The 4 layers correspond to the 5-node surface temperature network used in ISO 52016.  </li> </ul>"},{"location":"iso_52016_node/#references","title":"References","text":"<ul> <li>EN ISO 52016-1:2017 \u2013 Energy performance of buildings \u2014 Calculation of energy needs for heating and cooling, Section 6.5.7.  </li> <li>EN ISO 13789:2017 \u2013 Thermal performance of buildings \u2014 Transmission and ventilation heat transfer coefficients \u2014 Calculation method.  </li> <li>EN ISO 13370:2017 \u2013 Heat transfer via the ground \u2014 Calculation methods (for ground-related resistances).</li> </ul>"},{"location":"iso_52016_overall_procedure/","title":"ISO 52016 - Overall procedure","text":""},{"location":"iso_52016_overall_procedure/#overall-procedure-energy-need-en-iso-52016","title":"Overall procedure - Energy Need EN ISO 52016","text":"<pre><code>@classmethod\ndef Temperature_and_Energy_needs_calculation(\n    cls,\n    building_object,\n    nrHCmodes=2,\n    c_int_per_A_us=10000,\n    f_int_c=0.4,\n    f_sol_c=0.1,\n    f_H_c=1,\n    f_C_c=1,\n    delta_Theta_er=11,\n    **kwargs,   # weather_source='pvgis' | 'epw', path_weather_file=... (when epw)\n)\n</code></pre> <p>This guide explains how the <code>Temperature_and_Energy_needs_calculation(...)</code> classmethod computes hourly operative temperatures and heating/cooling needs following ISO 52016:2017.  It walks through inputs, preprocessing, per\u2011timestep assembly of the linear system, HVAC setpoint logic, numerical safeguards, and outputs.</p>"},{"location":"iso_52016_overall_procedure/#inputs","title":"Inputs","text":""},{"location":"iso_52016_overall_procedure/#building-description-building_object","title":"Building description (<code>building_object</code>)","text":"<ul> <li><code>building.net_floor_area</code> (m\u00b2)</li> <li><code>building_parameters.temperature_setpoints</code></li> <li><code>heating_setpoint</code>, <code>heating_setback</code>, <code>cooling_setpoint</code>, <code>cooling_setback</code> (\u00b0C)</li> <li><code>building_parameters.system_capacities</code></li> <li><code>heating_capacity</code> (W), <code>cooling_capacity</code> (W)</li> <li><code>building_surface</code>: list of surfaces with fields (examples)</li> <li><code>type</code>: <code>\"opaque\" | \"transparent\" | \"adiabatic\" | \"adjacent\" | \"ground\"</code></li> <li><code>area</code> (m\u00b2), <code>u_value</code> (W/m\u00b2K) (if relevant), <code>thermal_capacity</code> (J/K) (optional)</li> <li><code>orientation = { azimuth, tilt }</code> with sky view factor <code>sky_view_factor \u2208 [0,1]</code></li> <li>windows: <code>g_value</code>, shading info (optional)</li> <li>optional adjacent zones block for coupling to unconditioned zones.</li> </ul>"},{"location":"iso_52016_overall_procedure/#model-parameters-function-arguments","title":"Model parameters (function arguments)","text":"<ul> <li><code>nrHCmodes</code> \u2014 modes evaluated: 1=free, 2=H or C, 3=both (default 2).</li> <li><code>c_int_per_A_us</code> \u2014 areal internal capacity (J/m\u00b2K) \u2192 multiplied by <code>net_floor_area</code> to get <code>C_int</code>.</li> <li><code>f_int_c</code>, <code>f_sol_c</code> \u2014 convective fractions for internal and solar gains.</li> <li><code>f_H_c</code>, <code>f_C_c</code> \u2014 convective fractions for heating and cooling system emission.</li> <li><code>delta_Theta_er</code> \u2014 \u0394T external air\u2013sky (\u00b0C) for radiative exchange on external surfaces.</li> <li><code>kwargs</code>: weather provider (<code>\"pvgis\"</code> or <code>\"epw\"</code>, with <code>path_weather_file</code> for EPW).</li> </ul>"},{"location":"iso_52016_overall_procedure/#purpose","title":"Purpose","text":"<p>Purpose: Solve the zone energy balance hour by hour:</p> \\[ \\underbrace{\\mathbf{A}}_{\\text{conduction + convection + radiation + capacities}}  \\cdot  \\underbrace{\\mathbf{X}}_{\\text{node temps}} = \\underbrace{\\mathbf{B}}_{\\text{weather + gains + HVAC}} \\] <ul> <li><code>X</code> contains the unknown temperatures at the air node (zone) and the conduction nodes for each surface.</li> <li>The solution is computed for up to three columns: free-floating, heating-upper, cooling-upper.</li> </ul>"},{"location":"iso_52016_overall_procedure/#1-weather-timebase","title":"1) Weather &amp; timebase","text":"<ol> <li>Choose weather source:<ul> <li><code>\"pvgis\"</code> \u2192 provider called without a file path.</li> <li><code>\"epw\"</code> \u2192 pass <code>path_weather_file</code> when provided.</li> </ul> </li> <li>Obtain <code>simulation_df</code> with hourly columns, e.g.:<ul> <li><code>T2m</code> (external temperature), global/direct/diffuse irradiance per orientation (<code>I_sol_tot_*</code>, <code>I_sol_dir_w_*</code>, <code>I_sol_dif_*</code>), wind speed, etc.</li> </ul> </li> <li><code>Tstepn = len(simulation_df)</code> \u2014 total hours simulated.</li> <li>Define <code>Dtime = 3600 s</code> for each hour (1\u2011hour step).</li> </ol>"},{"location":"iso_52016_overall_procedure/#2-surface-hydration-classification-and-aggregation","title":"2) Surface hydration, classification, and aggregation","text":"<ol> <li>Classify each surface:<ul> <li><code>\"GR\"</code>: ground (opaque with <code>sky_view_factor == 0</code>)</li> <li><code>\"AD\"</code>: adiabatic</li> <li><code>\"ADJ\"</code>: adjacent (opaque to unconditioned zone)</li> <li><code>\"W\"</code>: transparent (window)</li> <li><code>\"EXT\"</code>: other external opaque</li> </ul> </li> <li>Orientation string:<ul> <li>tilt 0 \u2192 <code>\"HOR\"</code>, tilt 90 \u2192 <code>\"NV\" | \"EV\" | \"SV\" | \"WV\"</code> based on azimuth, else heuristic (<code>HOR</code> for shallow tilts).</li> </ul> </li> <li>Hydrate coefficients if missing (typical defaults):<ul> <li>internal convection <code>h_ci</code> (facade/roof/ground/adiabatic)</li> <li>external convection <code>h_ce</code></li> <li>internal &amp; external radiation <code>h_re</code></li> </ul> </li> <li>Windows: collect <code>g_value</code> per surface (0 for non\u2011windows).</li> <li>Areas: build <code>area_elements</code> and total <code>area_elements_tot</code>.</li> <li>Aggregate by direction (optional internal step) to simplify the system, then rebuild arrays (types, orientations, <code>h_ci</code>, <code>h_ce</code>, <code>h_ri</code>, <code>h_re</code>, areas, <code>g_value</code>, <code>sky_view_factor</code>).</li> </ol>"},{"location":"iso_52016_overall_procedure/#3-zone-state-node-topology","title":"3) Zone state &amp; node topology","text":"<ol> <li>Node graph (<code>Number_of_nodes_element</code>):<ul> <li>Node index <code>0</code> \u2192 zone air/furniture.</li> <li>For each surface <code>eli</code> with <code>Pli</code> conduction nodes, the last node (<code>Pli-1</code>) is the internal surface node.</li> <li>Arrays: <code>Rn</code> (# of nodes), <code>Pln</code> (nodes per surface), <code>PlnSum</code> (overall number of nodes for all surfaces).</li> </ul> </li> <li>Capacities:<ul> <li>Zone capacity <code>C_int = c_int_per_A_us \u00d7 net_floor_area</code>.</li> <li>Lump adiabatic surface capacities into <code>C_int</code> (robustness).</li> <li>Per-surface areal capacities from <code>Areal_heat_capacity_of_element</code> \u2192 mapped into <code>C_state</code> at the corresponding node indices.</li> </ul> </li> <li>Conductances:<ul> <li>From <code>Conduttance_node_of_element</code> (array <code>h_pli_eli</code>) for intra\u2011element conduction links.</li> </ul> </li> <li>Radiative mean:<ul> <li>Internal mean radiative heat transfer coefficient (area\u2011weighted).</li> </ul> </li> </ol>"},{"location":"iso_52016_overall_procedure/#4-ground-thermal-bridges-and-solar-preparatory-data","title":"4) Ground, thermal bridges, and solar preparatory data","text":"<ol> <li>Ground model: <code>Temp_calculation_of_ground(building_object)</code> returns:<ul> <li>monthly ground temperature <code>Theta_gr_ve[1..12]</code></li> <li>equivalent resistance <code>R_gr_ve</code></li> <li>(and thermal bridge term <code>thermal_bridge_heat</code> if included in that structure).</li> </ul> </li> <li>Solar absorption:<ul> <li><code>Solar_absorption_of_element</code> \u2192 <code>a_sol_pli_eli</code> for outer nodes, and window transmission with <code>g_value</code>.</li> </ul> </li> <li>Shading:<ul> <li>Frame fraction <code>F_fr</code> (default 0.25 if unknown) reduces transparent area; optional obstacle factors per window column.</li> </ul> </li> </ol>"},{"location":"iso_52016_overall_procedure/#5-internal-and-ventilation-gains-profiles","title":"5) Internal and ventilation gains &amp; profiles","text":"<ol> <li>Build hourly profiles:<ul> <li><code>occupancy_profile</code>, <code>appliances_profile</code>, <code>lighting_profile</code></li> <li><code>heating_profile</code>, <code>cooling_profile</code>, <code>ventilation_profile</code></li> </ul> </li> <li>Fallbacks: if any H/C/ventilation profile is empty (all zero), use occupancy as a proxy to avoid a perpetually off system.</li> <li>Compute ventilation heat transfer <code>H_ve</code> each hour (function of outdoor T, wind, and profile).</li> <li>Compute internal gains (W) from building use and profiles.     Split convective vs radiative using <code>f_int_c</code>:<ul> <li>Convective part to air node</li> <li>Radiative part to internal surface nodes (area\u2011weighted)</li> </ul> </li> </ol>"},{"location":"iso_52016_overall_procedure/#6-adjacent-unconditioned-zones-if-any","title":"6) Adjacent (unconditioned) zones (if any)","text":"<ol> <li>If <code>adj_zones_present</code>:<ul> <li>Use ISO 13789 to calculate the transmission (<code>H_ztu</code>, <code>b_ztu</code>, <code>F_ztc_ztu_m</code>) per adjacent zone.</li> <li>Propagate an effective adjacent zone temperature <code>\u03b8_ztu(t)</code> each hour using:<ul> <li>previous indoor operative temperature,</li> <li>outdoor temperature,</li> <li>internal/solar gains in the unconditioned space,</li> <li>a growth limiter <code>c_ztu_h_max</code> (from tabulated guidance).</li> </ul> </li> </ul> </li> <li>For ADJ surfaces, use <code>\u03b8_ztu(t)</code> as the external boundary in the matrix assembly.</li> </ol>"},{"location":"iso_52016_overall_procedure/#7-pertimestep-assembly-iso-52016-equations","title":"7) Per\u2011timestep assembly (ISO 52016 equations)","text":"<p>At each hour t, assemble the system for up to 3 columns (free, heating-upper, cooling-upper):</p>"},{"location":"iso_52016_overall_procedure/#71-righthand-side-b-contributions","title":"7.1 Right\u2011hand side <code>B</code> contributions","text":"<p>For the zone air node (row 0):</p> <ul> <li>Capacitive carryover: <code>(C_int / \u0394t) \u00b7 \u03b8_old_air</code></li> <li>Ventilation: <code>H_ve \u00b7 T_out(t)</code></li> <li>Thermal bridges: <code>H_tb \u00b7 T_out(t)</code> (from ground/bridges model)</li> <li>Convective internal gains: <code>f_int_c \u00b7 \u03a6_int(t)</code></li> <li>Convective solar gains: <code>f_sol_c \u00b7 \u03a6_solar(t)</code></li> <li>Convective HVAC portion: <code>f_H_c\u00b7\u03a6_H + f_C_c\u00b7\u03a6_C</code> when the column represents an upper case with nonzero load</li> </ul> <p>For each internal surface node:</p> <ul> <li>Radiative gains assigned by area ratio: <code>(1 - f_int_c)\u00b7\u03a6_int + (1 - f_sol_c)\u00b7\u03a6_solar</code> divided by total internal area (W/m\u00b2 basis)</li> <li>Capacitive carryover of that node: <code>(\u03ba_pli,eli / \u0394t) \u00b7 \u03b8_old_node</code></li> </ul> <p>For each external surface node:</p> <ul> <li>External convection+radiation with outdoor air: <code>(h_ce + h_re) \u00b7 T_out(t)</code></li> <li>Sky radiation term: <code>- \u03c6_sky = - (sky_factor \u00b7 h_re \u00b7 \u0394T_er)</code></li> <li>Solar absorption term for the outer node: <code>a_sol_pli_eli \u00b7 I_sol_tot_orientation(t)</code></li> <li>For ADJ surfaces, use <code>T_adj_zone(t)</code> instead of <code>T_out(t)</code>.</li> <li>For GR surfaces, use <code>(1/R_gr) \u00b7 T_ground(month)</code>.</li> </ul>"},{"location":"iso_52016_overall_procedure/#72-matrix-a-contributions","title":"7.2 Matrix <code>A</code> contributions","text":"<ul> <li>Zone air row (0,0):<ul> <li>add <code>(C_int/\u0394t) + H_ve + H_tb + \u03a3 (A_eli\u00b7h_ci_eli)</code> </li> <li>subtract <code>A_eli\u00b7h_ci_eli</code> towards each internal surface node (coupling)</li> </ul> </li> <li> <p>Internal surface node:</p> <ul> <li>add own capacity term <code>(\u03ba/\u0394t)</code></li> <li> <p>add <code>h_ci_eli</code> (convective to air) and radiative coupling to all other internal surfaces via area\u2011weighted term:</p> \\[ h_{ri,eli} \\cdot \\sum_k \\left( \\frac{A_k}{A_\\text{int,tot}} \\right) \\] </li> <li> <p>subtract coupling to air node: <code>h_ci_eli</code></p> </li> <li>subtract radiative couplings to other internal surfaces via area ratios</li> <li>add conduction links <code>+h_{pli-1,eli}</code> to previous node and <code>+h_{pli,eli}</code> to next node; subtract the symmetric terms on neighbors</li> <li>External surface node:</li> <li>add <code>(h_ce + h_re)</code> for EXT/ADJ or <code>(1/R_gr)</code> for **GR`</li> <li>add own capacity term <code>(\u03ba/\u0394t)</code></li> <li>add conduction links to next/previous node (as above)</li> </ul> </li> </ul> <p>A small diagonal regularization is applied to keep <code>A</code> non\u2011singular.</p>"},{"location":"iso_52016_overall_procedure/#8-solve-the-systems-and-compute-operative-temperatures","title":"8) Solve the system(s) and compute operative temperatures","text":"<ol> <li>Check rank/conditioning; regularize if needed.</li> <li>Solve <code>A\u00b7X = B</code> for each column (free, heating-upper, cooling-upper).</li> <li>Extract:<ul> <li><code>\u03b8_int_air(t)</code> = <code>X[air_row, :]</code></li> <li><code>\u03b8_int_r_mn(t)</code> = area\u2011weighted average of internal surface node temperatures</li> <li><code>\u03b8_op(t)</code> = <code>0.5 \u00b7 (\u03b8_int_air + \u03b8_int_r_mn)</code> for each column.</li> </ul> </li> </ol>"},{"location":"iso_52016_overall_procedure/#9-hvac-setpoint-logic-iso-52016-6552","title":"9) HVAC setpoint logic (ISO 52016 \u00a76.5.5.2)","text":"<p>For each hour:</p> <ol> <li> <p>Determine active setpoints using <code>heating_profile</code>/<code>cooling_profile</code>:</p> <ul> <li>no heating \u2192 use heating setback; if special sentinel (e.g., <code>&lt; -995</code>), disable heating.</li> <li>no cooling \u2192 use cooling setback; if <code>&gt; +995</code>, disable cooling.</li> </ul> </li> <li> <p>Compare free operative temperature <code>\u03b8_op_free</code> with setpoints:</p> <ul> <li>If <code>\u03b8_op_free &lt; \u03b8_heat_set</code>: compute heating load using eq. (27):</li> </ul> \\[ \u03a6_{HC} = \u03a6_{H,\\text{max}} \\cdot \\frac{\u03b8_\\text{set} - \u03b8_{op,0}}{\u03b8_{op,H} - \u03b8_{op,0}} \\] <p>where <code>\u03b8_{op,H}</code> is the \u201cupper\u201d heating solution and clip to <code>heating_capacity</code>.</p> <ul> <li>If <code>\u03b8_op_free &gt; \u03b8_cool_set</code>: compute cooling load similarly (negative W), clip to <code>cooling_capacity</code>.</li> </ul> </li> <li> <p>If capacity is not saturated (partial load), reassemble with the actual HVAC load and resolve once so that the achieved <code>\u03b8_op</code> equals the setpoint (within tolerance).</p> </li> <li>Save <code>\u03a6_HC(t)</code> into the time series (<code>Q_HC</code>, positive for heating, negative for cooling) and record <code>\u03b8_op_act(t)</code>.</li> </ol>"},{"location":"iso_52016_overall_procedure/#10-energy-accounting-sankey-style-optional","title":"10) Energy accounting (Sankey-style, optional)","text":"<p>Per hour, accumulate Wh contributions:</p> <ul> <li>Inputs: <code>Heating</code>, <code>Internal gains</code>, <code>Solar &amp; free-gain</code></li> <li>Outputs: <code>Cooling (extracted)</code>, <code>Ventilation</code>, <code>Thermal bridges</code>, <code>Ground</code>, <code>Transmission by surface</code></li> <li>Storage: change in state energy (<code>\u2211 C_state \u00b7 \u0394\u03b8 / 3600</code>)</li> </ul> <p>At the end:</p> <ul> <li>Check balance: Inputs \u2248 Outputs + Storage (absorb small residuals into Storage if &lt;1% Inputs).</li> </ul>"},{"location":"iso_52016_overall_procedure/#11-build-outputs","title":"11) Build outputs","text":""},{"location":"iso_52016_overall_procedure/#111-hourly-results-after-warmup","title":"11.1 Hourly results (after warm\u2011up)","text":"<p>DataFrame columns:</p> <ul> <li><code>Q_HC</code> (W) \u2014 signed HVAC need (+: heating, \u2212: cooling)</li> <li><code>T_op</code> (\u00b0C) \u2014 achieved operative temperature</li> <li><code>T_ext</code> (\u00b0C) \u2014 outdoor temperature</li> <li>Convenience splits:<ul> <li><code>Q_H = max(Q_HC, 0)</code></li> <li><code>Q_C = max(-Q_HC, 0)</code></li> </ul> </li> </ul>"},{"location":"iso_52016_overall_procedure/#112-annual-aggregation","title":"11.2 Annual aggregation","text":"<ul> <li><code>Q_H_annual = \u03a3 Q_H \u00b7 \u0394t</code> (Wh)</li> <li><code>Q_C_annual = \u03a3 Q_C \u00b7 \u0394t</code> (Wh)</li> <li>Per-area KPIs (Wh/m\u00b2): divide by <code>building.net_floor_area</code>.</li> </ul>"},{"location":"iso_52016_overall_procedure/#12-units-conventions","title":"12) Units &amp; conventions","text":"<ul> <li>Temperature <code>\u03b8</code>: \u00b0C </li> <li>Power <code>\u03a6</code> / <code>Q</code>: W </li> <li>Energy: Wh (integration across hours)  </li> <li>Capacity <code>C</code>, <code>\u03ba</code>: J/K (areal capacities multiplied by area become J/K at node)</li> <li>Conductances <code>h_*</code>: W/m\u00b2K; when multiplied by area \u2192 W/K.</li> </ul>"},{"location":"iso_52016_overall_procedure/#13-numerical-stability-robustness","title":"13) Numerical stability &amp; robustness","text":"<ul> <li>Diagonal regularization of <code>A</code> (min diag value based on \u2225A\u2225\u221e) to avoid singularities.</li> <li>Warm\u2011up (e.g., first month) simulated and typically excluded from reporting to reduce initial transients.</li> <li>Limiters for adjacent-zone temperature growth (<code>c_ztu_h_max</code>) and ventilation sanity checks (non-negative, finite).</li> <li>Clamp microscopic residuals (|x| &lt; 1e\u20119 \u2192 0) in energy accounting.</li> </ul>"},{"location":"iso_52016_overall_procedure/#14-minimal-checklist-before-running","title":"14) Minimal checklist before running","text":"<ul> <li>Weather source set correctly; EPW file path valid if used.</li> <li>Surfaces have: <code>type</code>, <code>area</code>, <code>orientation</code>, <code>sky_view_factor</code>, and suitable <code>U</code>/<code>g_value</code> where relevant.</li> <li>Setpoints and capacities are present and in W/\u00b0C.</li> <li>Profiles are present or fallbacks enabled.</li> </ul>"},{"location":"iso_52016_overall_procedure/#15-worked-outline-pseudoalgorithm","title":"15) Worked outline (pseudo\u2011algorithm)","text":"<pre><code>get weather(sim_df), Tstepn\nclassify &amp; hydrate surfaces (types, orientation strings, h_ci/h_ce/h_ri/h_re, areas, g-values)\naggregate by direction (optional) \u2192 rebuild arrays\n\nnodes = Number_of_nodes_element(building_object)\nC_state[air] = c_int_per_A_us * net_floor_area (+ AD capacities)\nC_state[elem nodes] from Areal_heat_capacity_of_element\nprecompute: ground model, thermal bridges, conductances h_pli_eli, solar absorption a_sol_pli_eli\nbuild hourly profiles (H/C/vent/occ/app/light) with fallbacks\n\nfor each hour t:\n  assemble A, B for (free, heat-upper, cool-upper):\n    zone row: capacities, H_ve, H_tb, convective gains + HVAC convective chunk\n    internal nodes: capacities, conduction, convection to air, radiative coupling, gains (radiative chunks)\n    external nodes: capacities, boundary to outdoor/adj/ground, solar terms\n  solve \u2192 X (three columns)\n  compute T_op for each column\n  apply setpoint logic (eq. 27), clip to capacities, possibly reassemble with partial \u03a6_HC\n  write Q_HC(t), T_op_act(t)\n  accumulate energy terms (inputs/outputs/storage)\n\npost:\n  build hourly DataFrame (drop warm-up)\n  integrate Wh \u2192 annual totals and Wh/m\u00b2\n  return hourly_results, annual_results_df\n</code></pre>"},{"location":"iso_52016_overall_procedure/#16-interpretation-tips","title":"16) Interpretation tips","text":"<ul> <li><code>Q_HC</code> is need, not system energy use. Apply system efficiencies (e.g., seasonal COP/\u03b7) downstream to obtain consumption.</li> <li>If <code>T_op</code> frequently deviates from setpoints, the capacity is insufficient or profiles/weather are too demanding.</li> <li>Large storage swings indicate high thermal mass; near-zero annual storage is expected (balance closure).</li> </ul>"},{"location":"iso_52016_overall_procedure/#17-common-pitfalls-remedies","title":"17) Common pitfalls &amp; remedies","text":"<ul> <li>All-zero profiles \u2192 no HVAC action: enable fallbacks or fix schedules.</li> <li>Missing g-values \u2192 underestimated solar gains for windows: add <code>g_value</code>.</li> <li>Incorrect sky view factor \u2192 radiative cooling to sky misrepresented: ensure <code>0..1</code>.</li> <li>Singular matrix \u2192 add/verify capacities, check AD nodes, keep time step at 1h, allow diagonal regularization.</li> <li>Units confusion \u2192 check W vs Wh vs J/K; capacities are often mistaken for J/m\u00b2K without conversion.</li> </ul> <p>Note</p> <p>This document describes the computational steps implemented by the method and their physical meaning, aligned with ISO 52016 methodology (free-floating, upper-limit solutions, and setpoint-based interpolation with capacity clipping).</p> <p>This library was developed to showcase specific computational elements outlined in the relevant technical standards. It is designed to supplement, not replace, the official regulations, as these are crucial for understanding the underlying calculations. Intended for demonstration and testing purposes only, this library is distributed as open source without protections against misuse or misapplication.</p> <p>The opinions and information contained in this document belong to the authors and do not necessarily represent the official stance of the European Union. Neither the European Union's institutions and bodies, nor anyone acting on their behalf, shall bear responsibility for how the information herein is utilized.</p>"},{"location":"iso_52016_solar_absorption/","title":"ISO 52016 - Solar absorption","text":""},{"location":"iso_52016_solar_absorption/#solar-absorption-of-building-envelope-elements","title":"Solar absorption of building envelope elements","text":"<pre><code>def Solar_absorption_of_element(cls, building_object) -&gt; solar_absorption_elements\n</code></pre>"},{"location":"iso_52016_solar_absorption/#inputs","title":"Inputs","text":"Name Type Description <code>building_object</code> <code>dict</code> Building data structure that contains a list of surfaces under <code>building_surface</code>. Each surface must define <code>ISO52016_type_string</code> and optical parameters (<code>solar_absorptance</code> or <code>g_value</code>)."},{"location":"iso_52016_solar_absorption/#required-fields-in-building_objectbuilding_surface","title":"Required Fields in <code>building_object[\"building_surface\"]</code>","text":"<p>Each element in <code>building_surface</code> should include:</p> Field Description <code>ISO52016_type_string</code> <code>OP</code> = Opaque element \u2022 <code>W</code> = Transparent (window) \u2022 <code>GR</code> = Ground-contact \u2022 <code>AD</code> or <code>ADJ</code> = Adjacent wall <code>solar_absorptance</code> Solar absorptance coefficient (0\u20131) for opaque elements. <code>g_value</code> Solar energy transmittance (0\u20131) for transparent elements."},{"location":"iso_52016_solar_absorption/#purpose","title":"Purpose","text":"<p>Computes the solar absorption coefficients for each building envelope element in accordance with EN ISO 52016-1 solar heat gain modeling. The result is a 5\u00d7N matrix <code>a_sol_pli_eli</code> assigning solar absorption values to the nodal structure of each surface.</p>"},{"location":"iso_52016_solar_absorption/#how-it-works","title":"How it works","text":"<p>Note</p> <p>The type of the surface has been mapped in the calculation using the following code:</p> <ul> <li><code>OP</code>: Opaque element</li> <li><code>W</code>: Transparent element</li> <li><code>GR</code>: Ground-contact element</li> <li><code>AD</code>: Adiabatic element</li> <li><code>ADJ</code>: Adjacent element</li> </ul> <pre><code>...\nfor i, surf in enumerate(building_object[\"building_surface\"]):\n    if surf[\"type\"] == \"opaque\":\n        if surf[\"sky_view_factor\"] == 0:\n            typology_elements[i] = \"GR\"\n        else:\n            typology_elements[i] = \"OP\"\n    elif surf[\"type\"] == \"adiabatic\":\n        typology_elements[i] = \"AD\"\n    elif surf[\"type\"] == \"transparent\":\n        typology_elements[i] = \"W\"\n    elif surf[\"type\"] == \"adjacent\":\n        typology_elements[i] = \"ADJ\"\n    surf[\"ISO52016_type_string\"] = typology_elements[i]\n</code></pre> <ol> <li> <p>Determine number of envelope elements</p> <p><pre><code>el_list = len(building_object[\"building_surface\"])\n</code></pre> Creates an empty coefficient list <code>solar_abs_elements</code> of length N.</p> </li> <li> <p>Extract solar properties</p> <ul> <li>For each surface:<ul> <li>If <code>\"solar_absorptance\"</code> is defined and the element is not <code>\"AD\"</code> or <code>\"ADJ\"</code>, use its value.</li> <li>If <code>\"solar_absorptance\"</code> is missing, use the <code>\"g_value\"</code> (for transparent elements).</li> <li>If the element type is <code>\"AD\"</code> or <code>\"ADJ\"</code>, set absorptance = 0.0 (no solar gain through adjacent walls).</li> </ul> </li> </ul> </li> <li> <p>Create absorption matrix</p> <pre><code>a_sol_pli_eli = np.zeros((5, el_list))\na_sol_pli_eli[0, :] = solar_abs_elements\n</code></pre> <p>Only the first node (external surface) receives the solar absorptance value; deeper nodes remain zero.</p> </li> <li> <p>Return result</p> <pre><code>return solar_absorption_elements(a_sol_pli_eli=a_sol_pli_eli)\n</code></pre> </li> </ol>"},{"location":"iso_52016_solar_absorption/#outputs","title":"Outputs","text":"Type Description <code>solar_absorption_elements</code> Wrapper containing the 2D array <code>a_sol_pli_eli</code> (shape 5\u00d7N), where N = number of elements in <code>building_surface</code>."},{"location":"iso_52016_solar_absorption/#example","title":"Example","text":"<pre><code># Expected result:\na_sol_pli_eli = np.array([\n    [0. , 0.6, 0.6, 0.6, 0.6, 0.6, 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n    [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],\n])\n</code></pre>"},{"location":"iso_52016_solar_absorption/#notes","title":"Notes","text":"<ul> <li>Only external surfaces (node 0) receive solar absorption values, as solar radiation is applied to the outermost layer.  </li> <li>Adjacent elements (<code>\"AD\"</code> or <code>\"ADJ\"</code>) are excluded from solar absorption (set to zero).  </li> <li>Transparent elements (<code>\"W\"</code>) use <code>g_value</code> instead of <code>solar_absorptance</code>.  </li> <li>The 5\u00d7N output format is consistent with the 5-node thermal network defined in ISO 52016-1.</li> </ul>"},{"location":"iso_52016_solar_absorption/#references","title":"References","text":"<ul> <li>EN ISO 52016-1:2017 \u2013 Energy performance of buildings \u2013 Calculation of energy needs for heating and cooling. - Section 6.5.7 \u2013 Definition of solar absorptance and its application to surface nodes.</li> </ul>"},{"location":"iso_52016_ventilation/","title":"ISO 52016 - Ventilation","text":""},{"location":"iso_52016_ventilation/#ventilation-internal-gains-and-transmission-heat-transfer-between-adjacent-zones","title":"Ventilation, Internal Gains and Transmission Heat Transfer between Adjacent Zones","text":"<p>This module implements methods for evaluating heat transfer by ventilation and internal heat gains in thermally conditioned and unconditioned zones.</p> <p>It also includes an auxiliary function for computing transmission heat transfer coefficients between conditioned and adjacent zones, following ISO 13789.</p>"},{"location":"iso_52016_ventilation/#overview","title":"Overview","text":"<p>The module covers three main components:</p> <ol> <li>Ventilation heat transfer coefficient (<code>VentilationInternalGains.heat_transfer_coefficient_by_ventilation</code>):</li> <li>Evaluates the natural ventilation rate and corresponding heat transfer coefficient (<code>H_ve_nat</code>) using ISO 16798\u20117 (wind and temperature-driven airflow).</li> <li> <p>Supports a simplified occupancy-based ventilation model.</p> </li> <li> <p>Internal heat gains (<code>VentilationInternalGains.internal_gains</code>):</p> </li> <li> <p>Computes total internal heat gains from occupants, appliances, and optionally nearby unconditioned zones, using ISO 16798\u20111 and ISO 15316\u20111 formulations.</p> </li> <li> <p>Transmission between zones (<code>transmission_heat_transfer_coefficient_ISO13789</code>):</p> </li> <li>Calculates inter-zone transmission coefficients (<code>H_ztu_tot</code>, <code>b_ztu_m</code>) according to ISO 13789, accounting for heat exchanges between conditioned, unconditioned, and external environments.</li> </ol>"},{"location":"iso_52016_ventilation/#calculation-of-heat-transfer-coefficient-by-ventilation","title":"Calculation of heat transfer coefficient by ventilation","text":"<pre><code>@staticmethod\ndef heat_transfer_coefficient_by_ventilation(\n    building_object, Tz, Te, u_site, Rw_arg_i=None, c_air=1006, \n    rho_air=1.204, C_wnd=0.001, C_st=0.0035, rho_a_ref=1.204, altitude=None,\n    type_ventilation=\"temp_wind\", flowrate_person=1.4\n) -&gt; h_natural_vent:\n</code></pre>"},{"location":"iso_52016_ventilation/#inputs-main","title":"Inputs (main)","text":"<ul> <li><code>Tz</code> <code>[\u00b0C]</code> indoor air temperature (zone).</li> <li><code>Te</code> <code>[\u00b0C]</code> outdoor air temperature.</li> <li><code>u_site</code> <code>[m\u00b7s\u207b\u00b9]</code> local wind speed at site height (as per ISO 16798-7 assumptions).</li> <li><code>Rw_arg_i</code> <code>[-]</code> array of opening ratios per window (<code>0\u20261</code>). If <code>None</code>, defaults to <code>0.9</code>.</li> <li><code>C_wnd = 0.001</code> <code>[(m\u00b7s\u207b\u00b9)\u207b\u00b9]</code> wind coefficient (ISO 16798-7 Table 11).</li> <li><code>C_st = 0.0035</code> <code>[(m\u00b7s\u207b\u00b9)/(m\u00b7K)]</code> stack coefficient (ISO 16798-7 Table 11).</li> <li><code>rho_a_ref</code> <code>[kg\u00b7m\u207b\u00b3]</code> reference air density at ~20 \u00b0C; corrected with <code>altitude</code> if provided.</li> <li><code>type_ventilation</code>: <code>\"temp_wind\"</code> (ISO airing) or <code>\"occupancy\"</code> (area-based volumetric rule).</li> <li><code>flowrate_person</code> <code>[L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2]</code> used only in <code>\"occupancy\"</code> branch.</li> </ul>"},{"location":"iso_52016_ventilation/#purpose","title":"Purpose","text":"<p>Physical purpose: compute the ventilation heat transfer coefficient \\(H_{ve}\\) <code>[W\u00b7K\u207b\u00b9]</code> of the thermal zone either: - from natural ventilation (ISO 16798-7:2017, single-sided airing via windows, wind/stack), or - from occupancy-driven flow (simplified volumetric rate per floor area).</p>"},{"location":"iso_52016_ventilation/#physics","title":"Physics","text":"<p>Step A \u2014 Effective opening height (stack path) For each transparent surface: - parapet height \\(h_p\\) <code>[m]</code>, - window height \\(h_w\\) <code>[m]</code>, - path height (vertical center): \\(h_{path,i} = h_p + \\frac{h_w}{2}\\), - fa height: \\(h_{fa,i} = \\frac{h_w}{2}\\).</p> <p>The useful stack height:</p> \\[ h_{w,st} = \\max_i\\!\\left(h_{path,i} + \\frac{h_{fa,i}}{2}\\right) - \\min_i\\!\\left(h_{path,i} - \\frac{h_{fa,i}}{2}\\right) \\tag{4.1} \\] <p>Step B \u2014 Density correction If <code>altitude</code> present, a standard atmosphere relation updates \\(\\rho_{a,ref}\\). Outdoor density:</p> \\[ \\rho_{a,e} = \\rho_{a,ref}\\,\\frac{291.15}{273.15 + T_e} \\tag{4.2} \\] <p>Step C \u2014 Effective openable area </p> <p>For each window \\(i\\), geometric area \\(A_{w,i} = h_{w,i}\\,w_i\\). Open area \\(A_{w,i}^{open} = A_{w,i}\\,R_{w,i}\\) with \\(R_{w,i}\\in[0,1]\\). If <code>Rw_arg_i</code> is missing or length mismatches the number of windows, default \\(R_{w,i}=0.9\\).</p> \\[ A_{w,tot} = \\sum_i A_{w,i}^{open} \\tag{4.3} \\] <p>Step D \u2014 Airing volumetric flow (single-sided) </p> <p>Using ISO 16798-7 \u00a76.4.3.5.4:</p> \\[ q_v = 3600\\;\\frac{\\rho_{a,ref}}{\\rho_{a,e}}\\;\\frac{A_{w,tot}}{2}\\, \\left[\\max\\!\\Big(C_{wnd}\\,u_{site}^2,\\; C_{st}\\,h_{w,st}\\,\\lvert T_z-T_e\\rvert\\Big)\\right]^{1/2} \\quad [\\text{m}^3/\\text{h}] \\tag{4.4} \\] <p>Step E \u2014 Ventilation conductance</p> \\[ H_{ve} = \\frac{c_{air}\\,\\rho_{air}}{3600}\\;q_v \\quad [\\text{W\u00b7K}^{-1}] \\tag{4.5} \\] <p>Occupancy branch: area-based simplified rule (constant per hour)</p> \\[ H_{ve} = A_{use}\\cdot (3.6\\,\\dot v_{pers})\\cdot \\frac{c_{air}\\,\\rho_{air}}{3600} \\tag{4.6} \\] <p>with \\(\\dot v_{pers}\\) in <code>[L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2]</code> and <code>3.6</code> converting L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2 to m\u00b3\u00b7h\u207b\u00b9\u00b7m\u207b\u00b2.</p>"},{"location":"iso_52016_ventilation/#outputs","title":"Outputs","text":"<ul> <li><code>np.ndarray</code> of <code>H_ve_k_t</code> <code>[W\u00b7K\u207b\u00b9]</code> (scalar or time-series depending on inputs).</li> </ul>"},{"location":"iso_52016_ventilation/#example","title":"Example","text":"<pre><code>if type_ventilation == \"temp_wind\":\n    extract all windows -&gt; {height, width, parapet}\n    compute hw_path_i, hw_fa_i -&gt; hw_st  # Eq. (4.1)\n    density correction -&gt; rho_a_e        # Eq. (4.2)\n    aw_tot -&gt; Eq. (4.3)\n    qv -&gt; Eq. (4.4)\n    Hve -&gt; Eq. (4.5)\nelse:  # occupancy\n    A_use &lt;- building_object[\"building\"][\"net_floor_area\"]\n    Hve  &lt;- Eq. (4.6)\nreturn np.array(Hve)\n</code></pre>"},{"location":"iso_52016_ventilation/#edge-cases-validation","title":"Edge Cases &amp; Validation","text":"<ul> <li>No transparent surfaces \u2192 \\(A_{w,tot}=0\\) \u2192 \\(H_{ve}=0\\).</li> <li><code>Rw_arg_i</code> length mismatch \u2192 warning + default 0.9.</li> <li>Negative or null <code>u_site</code> accepted; <code>max(\u00b7)</code> ensures stack/wind pick the dominant driver.</li> </ul>"},{"location":"iso_52016_ventilation/#internal-gains-calculation","title":"Internal gains calculation","text":"<pre><code>def internal_gains(\n    cls, building_type_class, a_use, unconditioned_zones_nearby=False,\n    list_adj_zones=None, Fztc_ztu_m: float=1, b_ztu: float=1,\n    h_occup: float=1, h_app: float=1, h_light: float=1, h_dhw: float=1,\n    h_hvac: float=1, h_proc: float=1\n) -&gt; float:\n</code></pre>"},{"location":"iso_52016_ventilation/#inputs-main_1","title":"Inputs (main)","text":"<ul> <li><code>building_type_class</code>: key for the lookup table <code>internal_gains_occupants</code> (imported from <code>source.table_iso_16798_1</code>).</li> <li><code>a_use</code> <code>[m\u00b2]</code>: useful area of the conditioned zone.</li> <li><code>h_*</code> <code>[-]</code>: hourly multipliers (profiles) for each sub-component (currently occupants and appliances are used).</li> <li>Coupling params for unconditioned zones:<ul> <li><code>b_ztu</code> <code>[-]</code>: adjustment factor of the adjacent unconditioned zone (see \u00a74.4, Eq. (4.13)).</li> <li><code>Fztc_ztu_m</code> <code>[-]</code>: fractional path factor conditioned\u2192unconditioned in month <code>m</code> (lumped path coefficient).</li> <li><code>list_adj_zones</code>: number of adjacent zones (note: the current signature expects an int; see note below).</li> </ul> </li> </ul> <p>Note: The code uses <code>for zones in range(list_adj_zones)</code> \u2014 pass an <code>int</code>. If a list is desired in the future, change to <code>for z in list_adj_zones:</code>.</p>"},{"location":"iso_52016_ventilation/#purpose_1","title":"Purpose","text":"<p>Physical purpose: compute internal sensible gains \\(\\Phi_{int}\\) <code>[W]</code> in the thermally conditioned zone, possibly accounting for spillover to adjacent unconditioned zones.</p>"},{"location":"iso_52016_ventilation/#physics_1","title":"Physics","text":"<p>Let \\(q_{occ}\\) and \\(q_{app}\\) be the nominal density of internal gains <code>[W\u00b7m\u207b\u00b2]</code> for occupants/equipment per <code>building_type_class</code>.</p> <p>Base internal gains in the conditioned zone:</p> \\[ \\Phi_{int,z}(t) = \\big(q_{occ}\\,h_{occup}(t) + q_{app}\\,h_{app}(t)\\big)\\;A_{use} \\tag{4.7} \\] <p>Optional spillover to unconditioned adjacent zones (<code>unconditioned_zones_nearby = True</code>): The code currently adds a further term per adjacent zone combining a direct duplicated contribution and a fractional transfer modulated by \\((1-b_{ztu})\\,F_{ztc{\\text -}ztu,m}\\):</p> \\[ \\Phi_{int,z}^{eff}(t) = \\Phi_{int,z}(t) + \\sum_{j=1}^{N_{adj}} \\left[\\Phi_{int,z}(t) + \\big(1-b_{ztu}\\big)\\,F_{ztc{\\text -}ztu,m}\\,\\Phi_{int,z}(t)\\right] \\tag{4.8} \\]"},{"location":"iso_52016_ventilation/#output","title":"Output","text":"<ul> <li><code>float</code> <code>[W]</code> \u2014 instantaneous internal sensible gains for the conditioned zone with the current coupling rule.</li> </ul>"},{"location":"iso_52016_ventilation/#example_1","title":"Example","text":"<pre><code>q_occ = internal_gains_occupants[building_type_class]['occupants']\nq_app = internal_gains_occupants[building_type_class]['appliances']\nPhi_base = (q_occ*h_occup + q_app*h_app) * a_use        # Eq. (4.7)\nif unconditioned_zones_nearby:\n    Phi_eff = Phi_base\n    for _ in range(list_adj_zones):\n        Phi_eff += Phi_base + (1-b_ztu)*Fztc_ztu_m * Phi_base\n    return float(Phi_eff)\nelse:\n    return float(Phi_base)\n</code></pre>"},{"location":"iso_52016_ventilation/#integration-roadmap-future-enhancements","title":"Integration Roadmap (Future Enhancements)","text":"<ul> <li>Air leaks: integrate infiltration losses for cracks and envelope leakage tests.</li> <li>Cross ventilation: include simultaneous airflow paths between opposite fa\u00e7ades.</li> <li>Mechanical ventilation: handle forced air systems with user\u2011defined flow rates and recovery efficiency.</li> </ul>"},{"location":"iso_52016_ventilation/#references","title":"References","text":"<ul> <li>ISO\u202f52016\u20111:2017, \u00a7\u202f6.5.10\u202fVentilation and Heat Transfer Coefficients  </li> <li>ISO\u202f16798\u20117:2017, \u00a7\u202f6.4.3.5\u202fNatural Ventilation Airflow  </li> <li>ISO\u202f16798\u20111:2019, \u00a7\u202fM1\u2013M10 Internal Gains  </li> <li>ISO\u202f13789:2017, \u00a7\u202f7\u202fTransmission Heat Transfer Coefficients through Adjacent Spaces</li> </ul>"},{"location":"iso_52016_virtual_ground_temperature/","title":"ISO 52016 - Virtual ground temperature","text":""},{"location":"iso_52016_virtual_ground_temperature/#calculation-of-virtual-ground-temperature","title":"Calculation of virtual ground temperature","text":"<pre><code>def Temp_calculation_of_ground(\n    cls,\n    building_object,\n    lambda_gr=2.0,  # W/(m\u00b7K)\n    R_si=0.17,      # m\u00b2K/W (internal surface resistance)\n    R_se=0.04,      # m\u00b2K/W (external surface resistance for ground calc.)\n    psi_k=0.05,     # W/(m\u00b7K) linear transmittance wall/floor junction\n    **kwargs        # expects path_weather_file\n) -&gt; temp_ground\n</code></pre>"},{"location":"iso_52016_virtual_ground_temperature/#inputs","title":"Inputs","text":"Name Type Default Description <code>building_object</code> <code>dict</code> \u2014 Building data structure (geometry, envelope, setpoints). See Required fields below. <code>lambda_gr</code> <code>float</code> <code>2.0</code> Thermal conductivity of the ground, W/(m\u00b7K). <code>R_si</code> <code>float</code> <code>0.17</code> Internal surface resistance, m\u00b2K/W. <code>R_se</code> <code>float</code> <code>0.04</code> External surface resistance (as used for ground calc.), m\u00b2K/W. <code>psi_k</code> <code>float</code> <code>0.05</code> Linear thermal transmittance at the wall/floor junction, W/(m\u00b7K). <code>**kwargs['path_weather_file']</code> <code>str | PathLike</code> \u2014 Path to EPW used by <code>Calculation_ISO_52010</code> to retrieve ambient temperatures."},{"location":"iso_52016_virtual_ground_temperature/#required-fields-in-building_object","title":"Required Fields in <code>building_object</code>","text":"<ul> <li><code>building_parameters.temperature_setpoints.heating_setpoint</code> (\u00b0C)  </li> <li><code>building_parameters.temperature_setpoints.cooling_setpoint</code> (\u00b0C)  </li> <li><code>building_surface</code>: list of surfaces with at least <code>area</code>, <code>sky_view_factor</code> (used to detect floor-on-ground where <code>svf == 0</code>).  </li> <li><code>building.exposed_perimeter</code> (m)  </li> <li><code>building.wall_thickness</code> (m)  </li> <li>(Optional) <code>building.thermal_resistance_floor</code> (m\u00b2K/W). In the current code, <code>thermal_resistance_floor</code> is set to 5.3 m\u00b2K/W internally.  </li> <li>The function stores <code>building_parameters.coldest_month</code> (=1) for later reference.</li> </ul>"},{"location":"iso_52016_virtual_ground_temperature/#purpose","title":"Purpose","text":"<p>Computes the virtual ground temperature and related parameters for slab-on-ground (SoG) floors in accordance with ISO 13370:2017. The routine derives: - <code>R_gr_ve</code>: thermal resistance of the virtual ground layer below the floor, - <code>Theta_gr_ve</code>: monthly virtual ground temperatures seen by the floor, - <code>thermal_bridge_heat</code>: linear thermal bridge contribution at the wall\u2013floor junction.</p> <p>These quantities are used to model heat exchange with the ground in dynamic/steady-state building energy calculations.</p>"},{"location":"iso_52016_virtual_ground_temperature/#how-it-works","title":"How it works","text":"<ol> <li> <p>Reference ground resistance </p> \\[ R_{gr} = \\frac{0.5}{\\lambda_{gr}} \\quad (\\text{m}^2\\,K/W) \\] </li> <li> <p>External temperature statistics (monthly) from <code>Calculation_ISO_52010</code> (local time series):  </p> <ul> <li> <p><code>T2m</code> \u2192 monthly mean / min / max \u2192 amplitude of external temperature variations:  </p> \\[ A_e = \\frac{\\overline{T_{max}} - \\overline{T_{min}}}{2} \\] </li> <li> <p>Annual external mean: \\( \\overline{T_e} \\).</p> </li> </ul> </li> <li> <p>Internal temperature profile     Using active heating/cooling setpoints from the building object:  </p> <ul> <li> <p>Annual mean:  \\( \\overline{T_i} = (T_{set,h} + T_{set,c})/2 \\) </p> </li> <li> <p>Amplitude:  \\( A_i = (T_{set,c} - T_{set,h})/2 \\) </p> </li> <li> <p>With coldest month = 1 (January), monthly internal temperature is:</p> <p>\\( T_{i,m} = \\overline{T_i} - A_i \\cos\\left(\\tfrac{2\\pi (m - m_c)}{12}\\right) \\)</p> </li> </ul> </li> <li> <p>Identify slab-on-ground area (<code>sog_area</code>)     The code searches <code>building_surface</code> for the element with <code>sky_view_factor == 0</code> and uses its <code>area</code> as the contact area with ground.</p> </li> <li> <p>Characteristic floor dimension     With exposed perimeter <code>P</code> and floor area <code>A</code>:</p> \\[ B' = \\frac{A}{0.5 P} \\] </li> <li> <p>Equivalent ground thickness </p> \\[ d_t = t_{wall} + \\lambda_{gr} (R_{floor} + R_{se}) \\] <p>where <code>R_floor</code> = 5.3 m\u00b2K/W in this implementation.</p> </li> <li> <p>Slab-on-ground transmittance \\( U_{sog} \\) (ISO 13370 \u00a78):  </p> <ul> <li> <p>If \\( d_t &lt; B' \\) (un/ moderately insulated):</p> \\[ U_{sog} = \\frac{2\\lambda_{gr}}{\\pi B' + d_t} \\ln\\!\\left(\\frac{\\pi B'}{d_t} + 1\\right) \\] </li> <li> <p>Else (well insulated):  </p> \\[ U_{sog} = \\frac{\\lambda_{gr}}{0.457 B' + d_t} \\] </li> </ul> </li> <li> <p>Virtual layer resistance </p> \\[ R_{gr,ve} = \\frac{1}{U_{sog}} - R_{si} - R_{floor} - R_{gr} \\] </li> <li> <p>Linear thermal bridges </p> \\[ H_{TB} = P \\cdot \\psi_k \\quad (\\text{W/K}) \\] </li> <li> <p>Steady-state &amp; periodic ground heat transfer coefficients </p> <ul> <li> <p>Steady-state: \\( H_{ss} = A\\,U_{sog} + P\\,\\psi_k \\) </p> </li> <li> <p>Periodic terms (with <code>periodic_penetration_depth = 3.2 m</code>):  </p> </li> <li> <p>Internal-side periodic:  </p> \\[ H_{pi} = A\\, \\frac{\\lambda_{gr}}{d_t} \\sqrt{\\frac{2}{(1 + \\delta)^2 + 1}} \\quad \\text{with } \\delta = \\frac{\\text{ppd}}{d_t} \\] </li> <li> <p>External-side periodic:  </p> \\[ H_{pe} = 0.37\\, P\\, \\lambda_{gr} \\ln\\!\\left(\\frac{\\text{ppd}}{d_t} + 1\\right) \\] </li> </ul> </li> <li> <p>Average heat-flow rate (monthly) </p> \\[ \\dot{Q}_{avg} = H_{ss}(\\overline{T_i} - \\overline{T_e}) + Q_{per,i}(m) + Q_{per,e}(m) \\] <p>with phase shifts <code>a_tl = 0</code> (internal) and <code>b_tl = 1</code> (external).</p> </li> <li> <p>Virtual ground temperature </p> \\[ \\Theta_{gr,ve}(m) = T_{i,m} - \\frac{ \\dot{Q}_{avg}(m) - P\\,\\psi_k (\\overline{T_i} - \\overline{T_e}) }{A\\, U_{sog}} \\] </li> </ol>"},{"location":"iso_52016_virtual_ground_temperature/#outputs","title":"Outputs","text":"<p>The function returns a <code>temp_ground</code> wrapper with:</p> <ul> <li><code>R_gr_ve</code> (float, m\u00b2K/W) \u2013 virtual ground-layer thermal resistance below the floor slab.  </li> <li><code>Theta_gr_ve</code> (np.ndarray length 12, \u00b0C) \u2013 monthly virtual ground temperatures as \u201cseen\u201d by the slab.  </li> <li><code>thermal_bridge_heat</code> (float, W/K) \u2013 heat transfer coefficient due to thermal bridges along the exposed perimeter (<code>exposed_perimeter \u00d7 psi_k</code>).</li> </ul>"},{"location":"iso_52016_virtual_ground_temperature/#example","title":"Example","text":"<pre><code>tg = Temp_calculation_of_ground(\n    building_object=bui,\n    lambda_gr=2.0,\n    R_si=0.17, R_se=0.04,\n    psi_k=0.05,\n    path_weather_file=\"../weather/rome.epw\",\n)\nprint(tg.R_gr_ve)        # m\u00b2K/W\nprint(tg.Theta_gr_ve)    # array of 12 monthly temperatures (\u00b0C)\nprint(tg.thermal_bridge_heat)  # W/K\n</code></pre>"},{"location":"iso_52016_virtual_ground_temperature/#notes","title":"Notes","text":"<ul> <li>The procedure is explicitly for slab-on-ground floors and conditioned buildings (not for purely unheated spaces).  </li> <li>The floor thermal resistance is fixed to 5.3 m\u00b2K/W in the code; adjust if your model requires a different construction.  </li> <li>Monthly external temperatures are derived from <code>T2m</code> in the ISO 52010 weather pipeline; ensure your EPW/PVGIS mapping provides <code>T2m</code>.  </li> <li><code>coldest_month</code> is set to January (1); adapt for different climates if necessary.  </li> <li>The sog area is inferred using <code>sky_view_factor == 0</code> on a surface; verify this convention matches your data.  </li> </ul>"},{"location":"iso_52016_virtual_ground_temperature/#references","title":"References","text":"<ul> <li>ISO 13370:2017 \u2014 Thermal performance of buildings \u2014 Heat transfer via the ground \u2014 Calculation methods </li> <li>EN ISO 52010-1:2017 \u2014 External climatic conditions \u2014 Solar &amp; meteorological data for energy calculations</li> </ul>"},{"location":"weather_data/","title":"Weather Data","text":"<pre><code>def Weather_data_bui(cls, building_object, path_weather_file, weather_source=\"pvgis\") -&gt; simulation_df\n</code></pre>"},{"location":"weather_data/#parameters","title":"Parameters","text":"Name Type Default Description <code>building_object</code> <code>dict</code> \u2014 Building data structure used by the ISO 52010 routine for site/geometry context. <code>path_weather_file</code> <code>str | PathLike</code> \u2014 Path to the EPW file, e.g., <code>../User/documents/epw/athens.epw</code>. <code>weather_source</code> <code>str</code> <code>\"pvgis\"</code> Weather pipeline selector. Supported values: <code>\"pvgis\"</code>, <code>\"epw\"</code>. (Both branches currently call the same processor.)"},{"location":"weather_data/#purpose","title":"Purpose","text":"<p>Fetches and prepares weather time series for a building simulation by invoking an ISO 52010-compliant pre-processor and returning a small wrapper that carries the resulting <code>pandas.DataFrame</code>.</p> <p>The weather data can be retrieved in two ways:</p> <ol> <li>through the pvgis website <code>(https://joint-research-centre.ec.europa.eu/photovoltaic-geographical-information-system-pvgis_en)</code>. In this case, you only need to provide the latitude and longitude of the site to retrieve the data directly from the pvgis API</li> <li>through a file epw. The user can provide a meteo file type epw downloadable also from: <code>https://www.ladybug.tools/epwmap/</code></li> </ol>"},{"location":"weather_data/#how-it-works","title":"How it works:","text":"<ol> <li>Calls the ISO 52010 pipeline <pre><code>Calculation_ISO_52010(building_object, path_weather_file, weather_source=weather_source).sim_df\n</code></pre>    wraps the result in a <code>pandas.DataFrame</code> called <code>sim_df</code>.</li> <li>Ensures a proper time index    Casts the index to a <code>pd.DatetimeIndex</code>, so downstream code can rely on hourly timestamps.</li> <li>Returns a lightweight wrapper <pre><code>return simulation_df(simulation_df=sim_df)\n</code></pre></li> </ol>"},{"location":"weather_data/#output","title":"Output","text":"Type Description <code>simulation_df</code> Wrapper object containing <code>simulation_df=sim_df</code>, where <code>sim_df</code> is a <code>pandas.DataFrame</code> indexed by <code>DatetimeIndex</code> with the weather variables produced by the ISO 52010 workflow."},{"location":"weather_data/#typical-sim_df-columns","title":"Typical <code>sim_df</code> Columns","text":"<p>Exact columns depend on your <code>Calculation_ISO_52010</code> implementation, but commonly include:</p> <ul> <li>Dry-bulb temperature, relative humidity, wind speed</li> <li>Solar irradiance terms (e.g., direct/diffuse/global or plane-of-array)</li> <li>Sky temperature / longwave terms if modeled</li> </ul> <p>Non-weather operational drivers (occupancy, setpoints) are not constructed here; this function only prepares weather data.</p>"},{"location":"weather_data/#notes","title":"Notes","text":"<ul> <li><code>weather_source=\"pvgis\"</code> and <code>weather_source=\"epw\"</code> currently execute the same code path. Add branching logic later if you need different parsing or metadata handling.</li> <li>The index is expected to be continuous hourly. If your EPW contains gaps or DST shifts, ensure the ISO 52010 routine resolves them.</li> <li>Units follow standard EPW / ISO 52010 conventions (\u00b0C, W/m\u00b2, m/s, %). Verify if you add custom variables.</li> </ul>"},{"location":"weather_data/#example","title":"Example","text":"<pre><code>sim = Weather_data_bui(\n    building_object=my_building,\n    path_weather_file=\"../data/weather/rome.epw\",\n    weather_source=\"epw\",\n)\ndf = sim.simulation_df            # unwrap the DataFrame\nprint(df.index[:24])              # first day (hourly)\nprint(df.columns.tolist()[:8])    # peek at columns\n</code></pre>"},{"location":"weather_data/#reference","title":"Reference","text":"<ul> <li>EN ISO 52010-1 \u2013 Calculation of solar &amp; daylight quantities for building energy needs</li> <li>Project class/type: <code>simulation_df</code></li> <li>Weather preprocessing class: <code>Calculation_ISO_52010</code></li> </ul>"}]}