{"config":{"lang":["en","it"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"home/","title":"Home","text":"<p>Please cite us if you use this library:  </p>    Introduction: EPBD Requirements for ISO 52000 and ISO 15316 Standards  Note:  !!! New version available !!! New features:  - Calculation of multizona considering adiabiatic walls between zones with the same use destination - Calculation with non heated zones  -"},{"location":"home/#iso-52000-overarching-standards","title":"ISO 52000 - Overarching Standards","text":"<p>The EPBD Directive 2018 (and confirmed in the 2024 revision) requires Member States to describe their national calculation methodology following the national annexes of the \"overarching\" standards, namely: ISO 52000-1, 52003-1, 52010-1, 52016-1, and 52018-1, developed under mandate M/480 given to CEN (European Committee for Standardization).</p> <p>Important: This provision does not constitute mandatory legal codification of these standards. However, the obligation to describe the national methodology following the annexes of the overarching standards will push Member States to explain where and why they deviate from these standards, leading to greater recognition and promotion of the EPB standards set.</p> <p>The ISO 52000 overarching standards are:</p> <ol> <li>ISO 52000-1: General framework and procedures for EPB assessment</li> <li>ISO 52003-1: Indicators, requirements, ratings and certificates</li> <li>ISO 52010-1: Internal environmental parameters</li> <li>ISO 52016-1: Internal temperatures and energy needs for heating/cooling</li> <li>ISO 52018-1: Indicators for overall energy performance</li> </ol>"},{"location":"home/#new-epbd-recast-methodology","title":"New EPBD Recast Methodology","text":"<p>The new EPBD recast provides an update on building performance assessment through a methodology that must consider various factors such as the building\u2019s thermal characteristics, the use of renewable energy sources, building automation and control systems, ventilation, cooling, energy recovery, etc. The methodology should represent actual operating conditions, use measured energy for accuracy and comparability, and be based on hourly or sub-hourly intervals to account for variable conditions significantly impacting system performance, including internal conditions.</p> <p>The energy performance of a building shall be expressed by a numeric indicator of primary energy use per unit of reference floor area per year, in kWh/(m\u00b2.y), for energy performance certification and compliance with minimum energy performance requirements. Numeric indicators of final energy use per unit of reference floor area per year, in kWh/(m\u00b2.y), and energy needs according to ISO 52000 in kWh/(m\u00b2.y) shall also be used. The applied methodology for determining energy performance must be transparent, open to innovation, and reflect best practices, particularly from additional indicators.</p> <p>Member States shall describe their national calculation methodology based on Annex A of the key European standards on energy performance of buildings.</p>"},{"location":"home/#en-15316-heating-and-cooling-systems","title":"EN 15316 - Heating and Cooling Systems","text":"<p>The EN 15316 series covers the calculation method for system energy requirements and system efficiencies. This family of standards is an integral part of the EPB set and covers:</p>"},{"location":"home/#en-15316-modular-structure","title":"EN 15316 Modular Structure:","text":"<ul> <li>EN 15316-1: General and expression of energy performance (Modules M3-1, M3-4, M3-9, M8-1, M8-4)</li> <li>EN 15316-2: Emission systems (heating and cooling)</li> <li>EN 15316-3: Distribution systems (DHW, heating, cooling)</li> <li>EN 15316-4-X: Heat generation systems:<ul> <li>4-1: Combustion boilers</li> <li>4-2: Heat pumps</li> <li>4-3: Solar thermal and photovoltaic systems</li> <li>4-4: Cogeneration systems</li> <li>4-5: District heating</li> <li>4-7: Biomass</li> </ul> </li> <li>EN 15316-5: Storage systems</li> </ul> <p>For space heating, applicable standards include EN 15316-1, EN 15316-2-1, EN 15316-2-3 and the appropriate parts of EN 15316-4 depending on the system type, including losses and control aspects.</p>"},{"location":"home/#relationship-between-epbd-2024-and-standards","title":"Relationship between EPBD 2024 and Standards","text":"<p>The most recent revision of the EPBD was published in May 2024, further strengthening requirements and aligning with the EU's climate neutrality objectives. Member States are encouraged to consider applicable standards, particularly from the EPB standards list.</p> <p>17 of approximately 50 EPB standards are already EN ISO standards, resulting from collaboration between CEN and ISO. The other EPB standards are currently only available at the European level (CEN standards).</p>"},{"location":"home/#pybuildingenergy-the-python-library-for-building-performance-assessment","title":"pyBuildingEnergy: the python library for building performance assessment","text":"<p>pyBuildingEnergy aims to provide an assessment of building performance both in terms of energy and comfort. In this initial release, it is possible to assess the energy performance of the building using ISO 52106-1:2018. Additional modules will be added for a more comprehensive evaluation of performance, assessing ventilation, renewable energies, systems, etc. The actual calculation methods for the assessment of building performance are the following:</p> <ul> <li> <p>[x] the (sensible) energy need for heating and cooling, based on hourly or monthly calculations;</p> </li> <li> <p>[ ] the latent energy need for (de-)humidification, based on hourly or monthly calculations;</p> </li> <li> <p>[x] the internal temperature, based on hourly calculations;</p> </li> <li> <p>[x] the sensible heating and cooling load, based on hourly calculations;</p> </li> <li> <p>[ ] the moisture and latent heat load for (de-)humidification, based on hourly calculations;</p> </li> <li> <p>[ ] the design sensible heating or cooling load and design latent heat load using an hourly calculation interval;</p> </li> <li> <p>[ ] the conditions of the supply air to provide the necessary humidification and dehumidification.</p> </li> </ul> <p>The calculation methods can be used for residential or non-residential buildings, or a part of it, referred to as \"the building\" or the \"assessed object\". ISO 52016-1:2018 also contains specifications for the assessment of thermal zones in the building or in the part of a building. The calculations are performed per thermal zone. In the calculations, the thermal zones can be assumed to be thermally coupled or not. ISO 52016-1:2018 is applicable to buildings at the design stage, to new buildings after construction and to existing buildings in the use phase</p>"},{"location":"home/#weather-data","title":"Weather Data","text":"<p>The tool can use wather data coming from 2 main sources:</p> <ul> <li>pvgis api (https://re.jrc.ec.europa.eu/pvg_tools/en/) - PHOTOVOLTAIC GEOGRAPHICAL INFORMATION SYSTEM</li> <li>.epw file from https://www.ladybug.tools/epwmap/</li> </ul> <p>More details in the example folder</p>"},{"location":"home/#domestic-hot-water-dhw","title":"Domestic Hot Water - DHW","text":"<ul> <li>[x] Calculation of volume and energy need for domestic hot water according to ISO 12831-3. </li> <li>[] Assessment of thermal load based on the type of DHW system</li> </ul>"},{"location":"home/#limitations","title":"Limitations","text":"<p>The library is developed with the intent of demonstrating specific elements of calculation procedures in the relevant standards. It is not intended to replace the regulations but to complement them, as the latter are essential for understanding the calculation.  This library is meant to be used for demonstration and testing purposes and is therefore provided as open source, without protection against misuse or inappropriate use.</p> <p>The information and views set out in this document are those of the authors and do not necessarily reflect the official opinion of the European Union. Neither the European Union institutions and bodies nor any person acting on their behalf may be held responsible for the use that may be made of the information contained herein.</p>"},{"location":"home/#getting-started","title":"Getting Started","text":"<p>The following command will install the latest pyBuildinEnergy library</p> <pre><code>    pip install pybuildingenergy\n</code></pre> <p>The tool allows you to evaluate the performance of buildings in different ways: </p>"},{"location":"home/#building-inputs","title":"Building Inputs","text":"<p>.. list-table:: Building geometry data * general    :widths: 20 20 40 10 10     :header-rows: 1</p> <ul> <li> <ul> <li>Parameter</li> <li>Key</li> <li>Description</li> <li>Unit</li> <li>Mandatory</li> </ul> </li> <li> <ul> <li>Latitude</li> <li>latitude</li> <li>latitude of the building in [decimal] </li> <li>[-]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Longitude</li> <li>longitude</li> <li>longitude of the building location [decimal]</li> <li>[-].</li> <li>YES</li> </ul> </li> <li> <ul> <li>Coldest month</li> <li>coldest_month</li> <li>Define the coldest month of the building location. Value from 1 (January) to 12 (December)</li> <li>[-].</li> <li>YES. Default: 1</li> </ul> </li> <li> <ul> <li>Gross building area</li> <li>a_use</li> <li>gross floor area of the building</li> <li>[m2]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Slab on ground area </li> <li>slab_on_ground_area</li> <li>Ground floor gross area</li> <li>[m2]</li> <li>If not provided, the slab on ground are is calculated as useful area / number of floors</li> </ul> </li> <li> <ul> <li>Number of floors</li> <li>number_of_floor</li> <li>Number of building floors </li> <li>[-]</li> <li>YES/NO if number of floors is provided</li> </ul> </li> <li> <ul> <li>Building perimeter</li> <li>exposed_perimeter</li> <li>perimeter of the building</li> <li>[m]</li> <li>YES/NO iIf not provided, the perimeter is calculated as if the building were rectangular with one side being 10 meters</li> </ul> </li> <li> <ul> <li>Building height</li> <li>height</li> <li>external height of the building</li> <li>[m]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Average thickness of wall</li> <li>wall_thickness</li> <li>average thickness of building walls </li> <li>[m]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Surface of envelope</li> <li>surface_envelope</li> <li>gross volume of the building </li> <li>[m3]</li> <li>If not provided the volume is calcuated as the slab on ground area * building height</li> </ul> </li> <li> <ul> <li>Volume</li> <li>volume</li> <li>gross volume of the building </li> <li>[m3]</li> <li>If not provided the volume is calcuated as the slab on ground area * building height</li> </ul> </li> <li> <ul> <li>Annual mean internal temperature</li> <li>annual_mean_internal_temperature</li> <li>the annual mean internal temperature is the average between Heating and Cooling setpoints</li> <li>[\u00b0C]</li> <li>NO: if not provided, it is calculated.</li> </ul> </li> <li> <ul> <li>Annual mean external temperature</li> <li>annual_mean_external_temperature</li> <li>Annual mean axternal temperature of the building location</li> <li>[\u00b0C]</li> <li>NO: if not provided, it is calculated.</li> </ul> </li> <li> <ul> <li>Heating system</li> <li>heating_mode</li> <li>True if heating system is installed, False if not.</li> <li>[True or False]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Cooling system</li> <li>cooling-mode</li> <li>True if heating system is installed, False if not.</li> <li>[True or False]</li> <li>YES </li> </ul> </li> <li> <ul> <li>Heating setpoint</li> <li>heating_setpoint</li> <li>Temperature set-point of the heating system</li> <li>[\u00b0C]</li> <li>YES. If <code>heating_mode</code> is True</li> </ul> </li> <li> <ul> <li>Cooling setpoint</li> <li>cooling_setpoint</li> <li>Temperature set-point of the cooling system</li> <li>[\u00b0C]</li> <li>YES. If <code>cooling_mode</code> is True</li> </ul> </li> <li> <ul> <li>Heating setback</li> <li>heating_setback</li> <li>Temperature set-back of the heating system</li> <li>[\u00b0C]</li> <li>YES. If <code>heating_mode</code> is True</li> </ul> </li> <li> <ul> <li>Cooling setback</li> <li>cooling_setback</li> <li>Temperature set-back of the cooling system</li> <li>[\u00b0C]</li> <li>YES. If <code>cooling_mode</code> is True</li> </ul> </li> <li> <ul> <li>Max power of heating generator</li> <li>power_heating_max</li> <li>max power of heating generator</li> <li>[W]</li> <li>YES. If <code>heating_mode</code> is True</li> </ul> </li> <li> <ul> <li>Max power of cooling generator</li> <li>power_cooling_max</li> <li>max power of cooling generator</li> <li>[W]</li> <li>YES. If <code>cooling_mode</code> is True</li> </ul> </li> <li> <ul> <li>Air change rate</li> <li>air_change_rate_base_value</li> <li>value of air chnage rate</li> <li>[m3/h*m2]</li> <li>Yes</li> </ul> </li> <li> <ul> <li>Air change rate extra</li> <li>air_change_rate_extra</li> <li>extra value of air change rate, in specific period according to the occupancy profile</li> <li>[m3/h*m2]</li> <li>Yes</li> </ul> </li> <li> <ul> <li>Internal Gains</li> <li>internal_gains_base_value</li> <li>power of internal gains </li> <li>[W/m2] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Extra Internal Gains</li> <li>internal_gains_base_value</li> <li>extra value of internal gains, in specific period according to the occupancy profile</li> <li>[W/m2] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Thermal bridges</li> <li>thermal_bridge_heat</li> <li>Overall heat transfer coefficient for thermal bridges (without groud floor)</li> <li>[W/K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Thermal resistance of floor</li> <li>thermal_resistance_floor</li> <li>Average thermal resistance of internal floors</li> <li>[m2K/W] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Facade elements type</li> <li>typology_elements</li> <li>List of all facade elements (Walls, Roof, Ground Floor, Windows).For:<ul> <li>Wall, Roof use: \"OP\" (Opaque elements)</li> <li>Ground Floor: use \"GF\" (Ground Floor)</li> <li>Windows: use \"W\" (Windows)</li> </ul> </li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Orienation of facade elements</li> <li>orientation_elements</li> <li>For each elements of the facade provide the orientation, according to the following abbreviations:<ul> <li>NV: North Vertical</li> <li>SV: South Vertical</li> <li>EV: East Vertical</li> <li>WV: West Vertical</li> <li>HOR: Horizontal/Slope (for roof and ground floor)</li> </ul> </li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Solar absorption coefficients</li> <li>solar_abs_elements</li> <li>Solar absorption coefficient of external (Opaque) facade elements (e.g. walls)</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Area of facade elements</li> <li>area_elements</li> <li>Area of each facade element (e.g. Wall, Window, etc.)</li> <li>[m2] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Transmittance - U</li> <li>transmittance_U_elements</li> <li>Transmiattance of each facade element.</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Resistance - U</li> <li>thermal_resistance_R_elements</li> <li>Theraml Resistance of each facade element. </li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Thermal capacity - k</li> <li>thermal_resistance_R_elements</li> <li>Addition of the heat capacity of each layer (i.e. calculated by multiplying the density times its thickness times the SHC of the material)</li> <li>[J/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>g-value</li> <li>g_factor_windows</li> <li>solar energy transmittance of windows</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Heat radiative transfer coefficient - internal</li> <li>heat_convective_elements_internal</li> <li>convective heat transfer coefficient internal surface for each element</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Heat convective transfer coefficient - external</li> <li>heat_convective_elements_external</li> <li>convective heat transfer coefficient external surface for each element</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Heat radiative transfer coefficient - internal</li> <li>heat_radiative_elements_internal</li> <li>radiative heat transfer coefficient internal surface for each element</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Heat radiative transfer coefficient - external</li> <li>heat_radiative_elements_external</li> <li>radiative heat transfer coefficient external surface for each element</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>View factor</li> <li>sky_factor_elements</li> <li>View factor between building element and the sky</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Occupancy profile workdays - internal_gains rate</li> <li>comf_level_we</li> <li>Occupancy profile for workdays to evalaute the utilization of extra internal gains</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Occupancy profile weekends - internal_gains rate</li> <li>comf_level_we</li> <li>Occupancy profile for weekdays to evalaute the utilization of extra internal gains</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Occupancy profile workdays - airflow rate</li> <li>comf_level_we</li> <li>Occupancy profile for workdays to evalaute the utilization of extra air change rate</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Occupancy profile weekend - airflow rate</li> <li>comf_level_we</li> <li>Occupancy profile for weekend to evalaute the utilization of extra air change rate</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Class of buidling construction</li> <li>construction_class</li> <li>Distribution of the mass for opaque elements (vertical - walls and horizontal - floor/roof) as described in Table B.13 of ISO52016. Possible choices: class_i, class_e, class_ie, class_d</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Weather source</li> <li>weather_source</li> <li>In English, it would be: \"Select which type of source to use for weather data. Choose 'pvgis' for connecting to the <code>pvgis &lt;https://re.jrc.ec.europa.eu/pvg_tools/en/&gt;</code> or 'epw' file if using an epw file, to be download from <code>here &lt;https://www.ladybug.tools/epwmap/&gt;</code></li> <li>[-] </li> <li>YES</li> </ul> </li> </ul> <p>More information about coefficients are available <code>here &lt;https://github.com/EURAC-EEBgroup/pyBuildingEnergy/tree/master/src/pybuildingenergy/data&gt;</code></p>"},{"location":"home/#documentation","title":"Documentation","text":"<p>Check our new documentation here:https://eurac-eebgroup.github.io/pybuildingenergy-docs/ and here: https://pybuildingenergy.readthedocs.io/en/latest/</p>"},{"location":"home/#example","title":"Example","text":"<p>Here some <code>Examples &lt;https://github.com/EURAC-EEBgroup/pyBuildingEnergy/tree/master/examples&gt;</code> on pybuildingenergy application. For more information .....</p>"},{"location":"home/#contributing-and-support","title":"Contributing and Support","text":"<p>Bug reports/Questions If you encounter a bug, kindly create a GitLab issue detailing the bug.  Please provide steps to reproduce the issue and ideally, include a snippet of code that triggers the bug.  If the bug results in an error, include the traceback. If it leads to unexpected behavior, specify the expected behavior.</p> <p>Code contributions We welcome and deeply appreciate contributions! Every contribution, no matter how small, makes a difference. Click here to find out more about contributing to the project.</p>"},{"location":"home/#acknowledgment","title":"Acknowledgment","text":"<p>This work was carried out within European projects:  Infinite - This project has received funding from the European Union\u2019s Horizon 2020 research and innovation programme under grant agreement No 958397,  Moderate - Horizon Europe research and innovation programme under grant agreement No 101069834,  with the aim of contributing to the development of open products useful for defining plausible scenarios for the decarbonization of the built environment</p> <p>Reagrding the DHW Calculation:  The work was developed using the regulations and results obtained from the spreadsheet created by the EPBCenter.</p>"},{"location":"home/#references","title":"References","text":"<ol> <li>EPB Center - The Energy Performance of Buildings Directive (EPBD)    https://epb.center/epb-standards/the-energy-performance-of-buildings-directive-epbd/</li> <li>REHVA Journal - \"The new EN ISO 52000 family of standards to assess the energy performance of buildings put in practice\"    https://www.rehva.eu/rehva-journal/chapter/the-new-en-iso-52000-family-of-standards-to-assess-the-energy-performance-of-buildings-put-in-practice</li> <li>European Commission - Energy Performance of Buildings Directive    https://energy.ec.europa.eu/topics/energy-efficiency/energy-performance-buildings/energy-performance-buildings-directive_en</li> <li>Directive (EU) 2024/1275 - Official text published in the Official Journal of the EU on May 8, 2024</li> <li>EN ISO 52010-1:2018 - Energy performance of buildings - External climatic conditions - Part 1: Conversion of climatic data for energy calculations</li> <li>EN ISO 52016-1:2018 - Energy performance of buildings - Energy needs for heating and cooling, internal temperatures and sensible and latent heat loads </li> <li>EN ISO 12831-3:2018 - Energy performance of buildings - Method for calculation of the design heat load - Part 3: Domestic hot water systems heat load and characterisation of needs, Module M8-2, M8-3</li> <li>Directive (EU) 2024/1275 - Official text published in the Official Journal of the EU on May 8, 2024</li> </ol>"},{"location":"home/#authors-daniele-antonucci-ulrich-filippi-oberegger","title":"Authors: Daniele Antonucci, Ulrich Filippi Oberegger","text":"<p>License: MIT Version: 0.2 Maintainer: Daniele Antonucci</p>"},{"location":"iso_15316/","title":"Introduction to EN ISO 15316-1","text":""},{"location":"iso_15316/#overview","title":"Overview","text":"<p>ISO 15316-1 (equivalent to EN 15316-1 in Europe) defines the framework and general principles for calculating the energy performance of building heating and domestic hot water systems. It provides a systematic, modular approach that allows engineers, researchers, and software tools to evaluate and compare energy efficiency across different system configurations.</p> <p>This standard is part of the broader Energy Performance of Buildings (EPB) suite developed under the EU Energy Performance of Buildings Directive (EPBD).</p>"},{"location":"iso_15316/#scope","title":"Scope","text":"<p>The standard covers water-based heating and DHW systems where heat is generated, distributed, and emitted to maintain indoor comfort. It applies to: - Emission systems (radiators, floor heating, fan coils, etc.) - Distribution systems (piping, manifolds, circulation) - Storage components (thermal buffers, DHW tanks) - Generation systems (boilers, heat pumps, cogeneration)</p> <p>It does not include ventilation-only or purely air-based systems, except when heated by water circuits.</p>"},{"location":"iso_15316/#methodological-structure","title":"Methodological Structure","text":"<p>EN 15316-1 introduces a modular structure, dividing the entire heating system into interconnected subsystems:</p> <ol> <li>Emission (C.2\u2013C.5) \u2013 heat transfer from water to the indoor space  </li> <li>Distribution \u2013 transport of heat through pipes, including losses and auxiliaries  </li> <li>Storage \u2013 intermediate energy buffering or recovery  </li> <li>Generation \u2013 production of useful heat from a fuel or electricity source  </li> </ol> <p>Each module has its own energy balance:</p> \\[ \\text{Energy In} = \\text{Useful Output} + \\text{Losses} - \\text{Recoverable Losses} - \\text{Auxiliaries} \\] <p>The calculation proceeds in the direction:</p> \\[ \\text{Energy Needs (Building)} \\rightarrow \\text{Delivered Heat (Emission)} \\rightarrow \\text{Distribution} \\rightarrow \\text{Generation} \\rightarrow \\text{Primary Energy Input} \\] <p>This enables transparent energy tracking and consistent efficiency assessment across technologies.</p>"},{"location":"iso_15316/#objectives","title":"Objectives","text":"<p>The main objectives of ISO 15316-1 are to: - Provide a consistent calculation structure for all sub-systems in heating and DHW installations. - Define input and output data exchange between modules. - Enable comparability between different system types (e.g., boilers vs. heat pumps). - Serve as the reference method for EPB-compliant national calculation procedures.</p>"},{"location":"iso_15316/#key-principles","title":"Key Principles","text":"<ul> <li>System boundary definition \u2013 explicit separation of emission, distribution, storage, and generation.  </li> <li>Energy flow consistency \u2013 all sub-systems connect via clear input/output relationships.  </li> <li>Recoverable vs. non-recoverable losses \u2013 internal gains can offset building demand.  </li> <li>Auxiliary energy \u2013 electric or mechanical support energy is always accounted for.  </li> <li>Adaptability \u2013 compatible with both monthly and hourly calculation time steps.</li> </ul>"},{"location":"iso_15316/#benefits","title":"Benefits","text":"<ul> <li>Harmonized methodology for energy performance certificates, design tools, and research.  </li> <li>Facilitates diagnostic comparison of subsystems (e.g., identifying excessive distribution losses).  </li> <li>Supports policy implementation under EPBD and national building codes.  </li> <li>Enhances reproducibility and transparency in simulation and benchmarking.</li> </ul>"},{"location":"iso_15316/#relationship-with-subsequent-parts","title":"Relationship with Subsequent Parts","text":"<p>Part 1 provides the general framework only. Detailed formulas and reference values for each sub-system are defined in:</p> <ul> <li>EN 15316-2 \u2013 Emission and control (M3-5) </li> <li>EN 15316-3 \u2013 Distribution and control (M3 -6)  </li> <li>EN 15316-4 \u2013 Generation systems (M3-8) for different generator: <ul> <li>EN 15316-4-1 \u2013 Combustion boilers (M3-8-1) </li> <li>EN 15316-4-2 \u2013 Heat pumps (M3-8-2) </li> <li>EN 15316-4-3 \u2013 Thermal solar and photovoltaic (M3-8-3) </li> <li>EN 15316-4-4 \u2013 On-site cogeneration (M3-8-4) </li> <li>EN 15316-4-5 \u2013 District Heating and Cooling (M3-8-5) </li> <li>EN 15316-4-9 \u2013 Direct electrical heater (M3-8-6) </li> <li>EN 15316-4-8 \u2013 Radiant heating and stoves (M3-8-8) </li> </ul> </li> <li>EN 15316-5 \u2013 Storage and control (M3-7)  </li> </ul>"},{"location":"iso_15316/#references","title":"References","text":"<ul> <li>EN 15316-1:2017 \u2013 Energy performance of buildings \u2014 Method for calculation of system energy requirements and system efficiencies \u2014 Part 1: General and energy performance expression. </li> <li>REHVA (2017) \u2014 Information Paper: CEN Standards for Heating and Domestic Hot Water Systems. </li> <li>CENSE Project (EU) \u2014 Application of the EPBD Calculation Framework.</li> </ul>"},{"location":"iso_15316_calculation_procedure/","title":"CALCULATION PROCEDURE","text":"Note: THE ACTUAL CALCULATION OF PRIMARY ENRGY USING THE ISO 15316-1 IS FOR A SINGLE ZONE, IT IS NOT YET IMPLEMENTED THE CALCULATION FOR MULTIPLE ZONES.  <p>The calculation procedure follows the direction from the energy need to the source (building energy need -&gt; primary energy)</p>"},{"location":"iso_15316_calculation_procedure/#description-of-functions","title":"Description of functions","text":"<p>Herunder explanation of what the script does and comments each function, with emphasis on: - assumptions, units of measurement and formulas used; - structure of input/output data; - flow of calculation for single step and time series.</p> <p>Standard of reference: the calculator follows the logic of the ISO 15316-1 for heating systems and supports 4 types of emission circuits (C.2, C.3, C.4, C.5). Building Energy Need: The building energy need is calculated using the module ISO 52016. For more information refers to the module ISO 52016.</p>"},{"location":"iso_15316_calculation_procedure/#1-overview","title":"1) Overview","text":"<ul> <li>Main class: <code>HeatingSystemCalculator</code></li> <li>Input: a dictionary <code>input_data</code> with parameters of emission, distribution and generation (primary).</li> <li>Tabular data:</li> <li><code>TB14</code> (DF): ISO table with \u0394T nominal and exponent n for the terminal (radiators, panels, etc.).     If not provided in <code>input_data[\"TB14\"]</code>, uses <code>TB14_backup</code> from <code>global_inputs</code>.</li> <li>Units (principali):</li> <li>Energy: kWh (exception: <code>Q_H</code> can arrive in Wh and is converted)</li> <li>Power: kW, Losses/Aux: kWh</li> <li>Volumetric flows: m\u00b3/h</li> <li>Temperature: \u00b0C</li> <li>c_w: specific heat of water in Wh/(kg\u00b7K) (\u22481.16)</li> <li>Output:</li> <li>for single step: dictionary with temperature, flow and energy on emission, distribution and generation;</li> <li>for time series: DataFrame hourly/temporal with the same structure.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#2-class-structure","title":"2) Class structure","text":"<pre><code>class HeatingSystemCalculator:\n    \\\"\\\"\\\"Calcolatore secondo ISO 15316-1 con 4 tipologie C.2\u2013C.5.\\\"\\\"\\\"\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#__init__self-input_data","title":"<code>__init__(self, input_data)</code>","text":"<ul> <li>What it does: saves the input, loads constants and parameters by calling <code>_load_constants()</code> and <code>_load_input_parameters()</code>.</li> <li>Attention: <code>input_data</code> guides everything (control policy, generator efficiency, external curves, etc.).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#3-loading-constants-and-parameters","title":"3) Loading constants and parameters","text":""},{"location":"iso_15316_calculation_procedure/#_load_constantsself","title":"<code>_load_constants(self)</code>","text":"<ul> <li>What it does: loads constants and parameters by calling <code>_load_constants()</code> and <code>_load_input_parameters()</code>. </li> <li>Details:</li> <li>If <code>input_data[\"TB14\"]</code> is a <code>pd.DataFrame</code>, uses it; otherwise uses <code>TB14_backup</code>.</li> <li>Set <code>c_w = 1.16</code> Wh/(kg\u00b7K).</li> <li>Why it is needed: <code>TB14</code> provides nominal \u0394T and exponent n to calculate the relationship power \u2194 \u0394T air-emitter.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_load_input_parametersself","title":"<code>_load_input_parameters(self)</code>","text":"<ul> <li>What it does: reads from the input dictionary the parameters of:</li> <li>Emission (secondary): type of emitter, nominal power, efficiency, mixing valve, type of temperature control (demand/external/constant), auxiliary powers, t operative, external secondary curve data.</li> <li>Distribution: recovery of losses, auxiliary powers, loss coefficient [W/K], service time, etc.</li> <li>Generation (primary): power at full load, maximum load factor, service time, hydraulic scheme (direct or independent), pump control, nominal \u0394T, optional setpoints, generator efficiency model (simple/parametric/manufacturer) and relative curves/parameters, primary circuit temperature control (Type A/B/C) and external primary curve.</li> <li>Important notes:</li> <li><code>selected_emm_cont_circuit</code> \u2208 {0,1,2,3} \u2192 C.2/C.3/C.4/C.5.</li> <li>Policy Q_H \u2264 0: <code>calc_when_QH_positive_only</code> + <code>off_compute_mode</code> (<code>idle</code>/<code>temps</code>/<code>full</code>) decide how to handle periods without load.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#4-default-tables-and-data","title":"4) Default tables and data","text":""},{"location":"iso_15316_calculation_procedure/#_default_emission_dataself","title":"<code>_default_emission_data(self)</code>","text":"<ul> <li>What it provides: limits/setpoint secondary (emission): T supply max, \u0394T max, T return desired, load factor with ON/OFF, T min supply.</li> <li>Why it is needed: it is needed to constrain the calculation of the emitter in function of the demand and the type C.2\u2013C.5.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_default_outdoor_dataself","title":"<code>_default_outdoor_data(self)</code>","text":"<ul> <li>What it provides: outdoor curve (secondary) defining min/max supply vs. min/max outdoor T..</li> <li>Usage: used by <code>calculate_circuit_node_temperature</code> when the control is \"based on outdoor\".</li> </ul>"},{"location":"iso_15316_calculation_procedure/#5-time-series-data","title":"5) Time series data","text":""},{"location":"iso_15316_calculation_procedure/#load_csv_dataself-csv_path_or_df","title":"<code>load_csv_data(self, csv_path_or_df)</code>","text":"<ul> <li>What it does: loads time series data from CSV/DataFrame with expected columns:</li> <li><code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> (alias supported).</li> <li>Logic:</li> <li>If <code>Q_H</code> is in Wh, creates <code>Q_H_kWh = Q_H / 1000</code>.</li> <li>Saves in <code>self.timeseries_data</code>.</li> <li>Returns: loaded DataFrame.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#6-emission-common-parameters","title":"6) Emission \u2014 common parameters","text":""},{"location":"iso_15316_calculation_procedure/#calculate_common_emission_parametersself-heating_needs_kwh-int","title":"<code>calculate_common_emission_parameters(self, heating_needs_kWh, \u03b8int)</code>","text":"<ul> <li>What it does: calculates common quantities for C.2\u2013C.5:</li> <li>net demand (after recoverable losses of system),</li> <li>average power emitted <code>\u03a6H_em_eff</code> (kW) on <code>tH_em_i_ON</code>,</li> <li>losses/inputs of emission, auxiliary powers,</li> <li>nominal parameters TB14: <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code>, nominal flow <code>V_H_em_nom</code>.</li> <li>Note:</li> <li><code>V_H_em_nom = \u03a6H_em_n / (\u0394\u03b8H_em_n * c_w)</code>.</li> <li>Calculates load factor \u03b2 and partial ON time for auxiliary powers.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#7-emission-models-c2c3c4c5","title":"7) Emission \u2014 models C.2/C.3/C.4/C.5","text":"<p>All use the non-linear relationship power \u2194 \u0394T air-emitter with exponent n from TB14.</p>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c2self-common_params-int-c2-constant-flow-constant-water-temperature","title":"<code>calculate_type_C2(self, common_params, \u03b8int)</code> \u2014 C.2: constant flow, constant water temperature","text":"<ul> <li>Uses <code>V_H_em_nom</code> as effective flow.</li> <li>Stima <code>\u0394\u03b8H_em_air_eff = \u0394\u03b8_air_nom * (\u03a6_eff/\u03a6_nom)^(1/n)</code>.</li> <li>Calculates <code>\u03b8H_em_avg</code>, then \u0394T water <code>\u0394\u03b8H_em_w_eff = \u03a6_eff / (c_w * V)</code> and from there supply/return emitter.</li> <li><code>\u03b8H_em_flw_min</code> include mixing offset if <code>MIX_EM=True</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c3self-common_params-int-c3-variable-flow-constant-water-temperature-return-limited","title":"<code>calculate_type_C3(self, common_params, \u03b8int)</code> \u2014 C.3: variable flow, constant water temperature (return limited)","text":"<ul> <li>Fixes <code>\u03b8H_em_ret_set</code> (\u2265 <code>\u03b8int</code>), limits supply (<code>\u03b8H_em_flw_max</code>, \u0394T_w_max).</li> <li>Determines <code>\u03b8H_em_flw</code> and <code>\u03b8H_em_ret</code> coherent and derives the flow from \u0394T water.</li> <li><code>\u03b8H_em_flw_min</code> include mixing offset.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c4self-common_params-int-c4-onoff-intermittent","title":"<code>calculate_type_C4(self, common_params, \u03b8int)</code> \u2014 C.4: ON\u2013OFF intermittent","text":"<ul> <li>Uses a duty cycle to ensure the energy hourly with power ON.</li> <li>Determines <code>\u03b8H_em_flw_calc</code> during ON (from TB14, \u03b2 required).</li> <li>Provides minimum flow for the distribution circuit.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c5self-common_params-int-c5-constant-flow-variable-exchange-bypass","title":"<code>calculate_type_C5(self, common_params, \u03b8int)</code> \u2014 C.5: constant flow, variable exchange (bypass)","text":"<ul> <li>Maintains nominal flow; the actual flow is the maximum between the calculation and the minimum set (<code>\u03b8H_em_flw_min_tz_i</code>).</li> <li>The output includes <code>\u03b8H_em_flw_min</code> (with mixing offset).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#8-circuit-node-temperature","title":"8) Circuit node temperature","text":""},{"location":"iso_15316_calculation_procedure/#calculate_circuit_node_temperatureself-ext-emission_results","title":"<code>calculate_circuit_node_temperature(self, \u03b8ext, emission_results)</code>","text":"<ul> <li>What it does: calculates the flow at the node <code>\u03b8H_nod_out</code> based on the secondary control type:</li> <li>Type 1 \u2013 Based on demand: uses <code>\u03b8H_em_flw_min</code> of the emission.</li> <li>Type 2 \u2013 Based on outdoor: uses the climate curve secondary.</li> <li>Type 3 \u2013 Constant temperature: uses <code>\u03b8em_flw_sahz_i</code> (constant).</li> <li>Output: <code>\u03b8H_nod_out</code> (\u00b0C).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#9-operating-conditions-secondary","title":"9) Operating conditions (secondary)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_operating_conditionsself-emission_results-common_params-int-h_nod_out","title":"<code>calculate_operating_conditions(self, emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"<ul> <li>What it does: combines the choice C.2/C.3/C.4/C.5 and the node to generate:</li> <li>temperature circuit: <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, flow <code>V_H_cr</code>;</li> <li>temperature distribution (between collector and emitter): <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>;</li> <li>load factor <code>\u03b2H_em</code> and minimum flow requested <code>\u03b8H_em_flw_min</code>;</li> <li>return emitter (used downstream).</li> <li>Note:</li> <li>C.4 introduces ON time and power calculation in ON;</li> <li>C.5 maintains minimum flow and calculates the return from the balance with constant flow.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#10-distribution","title":"10) Distribution","text":""},{"location":"iso_15316_calculation_procedure/#calculate_distributionself-h_dis_flw-h_dis_ret-int-qh_em_i_in","title":"<code>calculate_distribution(self, \u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"<ul> <li>What it does: estimates the distribution losses and auxiliary powers, the recoverable part and the required energy input from the distribution.</li> <li>Key formulas:</li> <li>Losses [kWh] \u2248 <code>((T_media - T_int) * U[W/K] / 1000) * t[h]</code></li> <li>Required input: <code>QH_dis_i_in = QH_dis_i_req + losses - aux - recoveries</code></li> <li>Distribution flow: <code>V_H_dis = QH_dis_i_in / (c_w * \u0394T_dis * t)</code></li> <li>Output: dictionary with losses/aux/recoveries and <code>V_H_dis</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#11-generator-efficiency-primary","title":"11) Generator efficiency (primary)","text":""},{"location":"iso_15316_calculation_procedure/#_efficiency_from_modelself-flw-ret-load_frac10","title":"<code>_efficiency_from_model(self, \u03b8flw, \u03b8ret, load_frac=1.0)</code>","text":"<ul> <li>What it does: returns the efficiency (%) according to the selected model:</li> <li>simple: heuristic in function of <code>\u03b8ret</code> (high condensation at low returns).</li> <li>parametric: piecewise linear model (parameters: <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>).</li> <li>manufacturer: curve 1D (\u03b7=f(Tret)) o 2D (\u03b7=f(Tflw,Tret)) con interpolazione bilineare.</li> <li>Note: clamp a [1, 110] %; fallback a modello semplice se curve non valide.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#12-primary-circuit-setpoint","title":"12) Primary circuit setpoint","text":""},{"location":"iso_15316_calculation_procedure/#_generator_flow_setpointself-ext-h_dis_flw_demand","title":"<code>_generator_flow_setpoint(self, \u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"<ul> <li>What it does: calculates the primary circuit setpoint based on the selected control:</li> <li>Type A \u2013 Outdoor: uses the primary curve (min/max vs T external).</li> <li>Type B \u2013 Demand: pursues the secondary demand (<code>\u03b8H_dis_flw</code>).</li> <li>Type C \u2013 Constant: uses <code>\u03b8HW_gen_flw_const</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#13-generation-primary","title":"13) Generation (primary)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_generationself-h_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"<code>calculate_generation(self, \u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"<ul> <li> <p>Purpose: Calculates the primary circuit thermal output, setpoints, and energy consumption according to the selected control strategy.</p> </li> <li> <p>Control types:</p> <p>-Type A \u2013 Outdoor: Uses the primary weather curve (supply temperature as a function of outdoor temperature). -Type B \u2013 Demand: Follows the secondary circuit demand (\u03b8H_dis_flw). -Type C \u2013 Constant: Uses a fixed setpoint \u03b8HW_gen_flw_const.</p> </li> <li> <p>Computation steps:</p> <p>1) Maximum capacity: max_output_g1 = P_full * LF_max * t Defines the maximum hourly energy the generator can deliver.</p> <p>2) Requested output: QH_gen_out = min(QH_dis_i_in, max_output_g1) Limits the generator\u2019s output to its capacity.</p> <p>3) Mass and volume flows: ms = \u03c1 * V_dis for the secondary side; primary flow depends on configuration.</p> <p>4) Hydraulic configurations:</p> <ul> <li>Direct: primary and secondary circuits are identical.</li> <li>Independent: computes \u0394T_p, determines the primary supply setpoint (Type A/B/C), applies primary line losses, calculates primary flow mp = Q * 1000 / (c_w * \u0394T), and optionally applies anti-dilution logic before finding the return temperature Tp_ret.</li> </ul> <p>5) Efficiency: Re-evaluated using the actual flow/return temperatures via the chosen generator efficiency model.</p> <p>6) Energy balance:</p> <ul> <li>Input energy: EHW_gen_in = (QH_gen_out * 100) / \u03b7</li> <li> <p>Auxiliary energy: EHW_gen_aux = EHW_gen_in * (aux_generator / 100)</p> </li> <li> <p>Recoverable generator losses: QW_gen_i_ls_rbl_H</p> </li> <li>Thermal outputs and split of useful (EH_gen_in) and waste (EWH_gen_in) energy.</li> </ul> </li> <li> <p>Output: A dictionary containing primary-side temperatures, mass/volume flows, efficiency, and energy consumption for the generator.</p> </li> </ul>"},{"location":"iso_15316_calculation_procedure/#14-single-step-execution","title":"14) Single step execution","text":""},{"location":"iso_15316_calculation_procedure/#compute_stepself-q_h_kwh-int-ext","title":"<code>compute_step(self, q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>Flow:</li> <li>Common emission parameters</li> <li>Emission C.2/C.3/C.4/C.5 (in base a <code>selected_emm_cont_circuit</code>)</li> <li>Calculation supply node (secondary)</li> <li>Operating conditions of the circuit</li> <li>Distribution</li> <li>Generation (primary)</li> <li>Composition of the output of the step (dictionary)</li> <li>Returns: all temperatures, flows and energies of the step.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#15-time-series-execution","title":"15) Time series execution","text":""},{"location":"iso_15316_calculation_procedure/#_temps_row_when_offself-int-ext","title":"<code>_temps_row_when_off(self, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>What it does: in absence of load (<code>Q_H \u2264 0</code>) and with policy <code>off_compute_mode='temps'</code>,   calculates only the temperatures significant keeping powers/flows=0.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#run_timeseriesself-dfnone","title":"<code>run_timeseries(self, df=None)</code>","text":"<ul> <li>What it does: executes the calculation on the entire DataFrame.</li> <li>Alias recognized:</li> <li><code>Q_H_kWh</code> \u2194 <code>Q_H</code>, <code>Q_h</code>, <code>Heating_needs</code></li> <li><code>T_op</code> \u2194 <code>T_int</code>, <code>theta_int</code></li> <li><code>T_ext</code> \u2194 <code>theta_ext</code></li> <li>Policy when <code>Q_H \u2264 0</code>:</li> <li><code>calc_when_QH_positive_only=False</code>: calculates the complete flow.</li> <li><code>True</code> with:<ul> <li><code>idle</code>: empty row (NaN/0) \u2014 see <code>_idle_row</code>.</li> <li><code>temps</code>: row only temperatures \u2014 see <code>_temps_row_when_off</code>.</li> <li><code>full</code>: complete calculation even with null load.</li> </ul> </li> <li>Returns: DataFrame indexed by timestamp with all columns.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#16-output-columns-extracted","title":"16) Output columns (extracted)","text":"<ul> <li>Inputs: <code>Q_h(kWh)</code>, <code>T_op(\u00b0C)</code>, <code>T_ext(\u00b0C)</code></li> <li>Emission: <code>\u03a6H_em_eff(kW)</code>, <code>\u03b8H_em_flow(\u00b0C)</code>, <code>\u03b8H_em_ret(\u00b0C)</code>, <code>V_H_em_eff(m3/h)</code>, <code>\u03b8H_em_flw_min_req(\u00b0C)</code></li> <li>Node/Circuit: <code>\u03b8H_nod_out(\u00b0C)</code>, <code>\u03b8H_cr_flw(\u00b0C)</code>, <code>\u03b8H_cr_ret(\u00b0C)</code>, <code>V_H_cr(m3/h)</code>, <code>\u03b2H_em(-)</code></li> <li>Distribution: <code>Q_w_dis_i_ls(kWh)</code>, <code>Q_w_dis_i_aux(kWh)</code>, <code>Q_w_dis_i_ls_rbl_H(kWh)</code>, <code>QH_dis_i_in(kWh)</code>, <code>V_H_dis(m3/h)</code></li> <li>Generation: <code>QH_gen_out(kWh)</code>, <code>\u03b8X_gen_cr_flw(\u00b0C)</code>, <code>\u03b8X_gen_cr_ret(\u00b0C)</code>, <code>V_H_gen(m3/h)</code>, <code>efficiency_gen(%)</code>, <code>EHW_gen_in(kWh)</code>, <code>EHW_gen_aux(kWh)</code></li> </ul>"},{"location":"iso_15316_calculation_procedure/#17-best-practices-and-notes","title":"17) Best practices and notes","text":"<ul> <li>Verify that <code>TB14</code> contains the rows for the emitter type (<code>emitter_type</code>) and the columns:</li> <li><code>Emitters_nominal_deltaTeta_Water_C</code>, <code>Emitters_nominale_deltaTeta_air_C</code>, <code>Emitters_exponent_n</code>.</li> <li>Ensure Q_H is provided in kWh (or Wh with automatic conversion).</li> <li>For independent circuits, evaluate:</li> <li><code>generator_nominal_deltaT</code>, <code>gen_flow_temp_control_type</code>, <code>\u03b8HW_gen_flw_const</code>,</li> <li><code>allow_dilution</code> and <code>primary_line_loss</code> if you want to model the primary hydraulic node with/without dilution.</li> <li>The efficiency model can be refined with manufacturer curves (1D/2D) for boilers/heat pumps.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#18-function-responsibility-mapping","title":"18) Function \u2192 responsibility mapping","text":"Function Main responsibility <code>_load_constants</code> Global constants and <code>TB14</code> <code>_load_input_parameters</code> Reading all parameters (emission, distribution, generation) <code>_default_emission_data</code>, <code>_default_outdoor_data</code> Default for limits/setpoint and secondary circuit curve <code>load_csv_data</code> Loading timeseries and energy normalization <code>calculate_common_emission_parameters</code> Common emission parameters (C.2\u2013C.5) <code>calculate_type_C2/C3/C4/C5</code> Emission models <code>calculate_circuit_node_temperature</code> Compute the secondary node (circuit) supply temperature \u03b8H_nod_out according to the selected secondary control policy: based on demand, outdoor, or constant. <code>calculate_operating_conditions</code> Temperature/portate circuito e distribuzione <code>calculate_distribution</code> Losses/auxiliaries/recoveries and distribution flow <code>_efficiency_from_model</code> Generator efficiency according to selected model <code>_generator_flow_setpoint</code> Setpoint mandata primaria (outdoor/demand/costante) <code>calculate_generation</code> Primary circuit balance: useful power, efficiency, consumptions <code>compute_step</code> Pipeline for a single step <code>_temps_row_when_off</code> Row \"only temperatures\" when Q_H\u22640 <code>run_timeseries</code> Execution on the entire time series"},{"location":"iso_15316_calculation_procedure/#flowchart-overview","title":"Flowchart (overview)","text":"<pre>\nflowchart TD\n  A[Start] --&gt; B[__init__]\n  B --&gt; C[_load_constants]\n  B --&gt; D[_load_input_parameters]\n  C --&gt; E{Execution?}\n  D --&gt; E\n\n  E --&gt;|single step| F[compute_step]\n  E --&gt;|timeseries| TS[run_timeseries]\n\n  subgraph Pipeline[\"Pipeline compute_step\"]\n    F --&gt; G[calculate_common_emission_parameters]\n    G --&gt; H{Tipo circuito?}\n    H --&gt;|C.2| I1[calculate_type_C2]\n    H --&gt;|C.3| I2[calculate_type_C3]\n    H --&gt;|C.4| I3[calculate_type_C4]\n    H --&gt;|C.5| I4[calculate_type_C5]\n    I1 --&gt; J[calculate_circuit_node_temperature]\n    I2 --&gt; J\n    I3 --&gt; J\n    I4 --&gt; J\n    J --&gt; K[calculate_operating_conditions]\n    K --&gt; L[calculate_distribution]\n    L --&gt; M[calculate_generation]\n    M --&gt; N[Compose outputs dict]\n  end\n\n  subgraph Timeseries[\"Timeseries run_timeseries\"]\n    TS --&gt; TS0{Row loop}\n    TS0 --&gt;|Q_H \u2264 0 AND policy=idle| T0[_idle_row]\n    TS0 --&gt;|Q_H \u2264 0 AND policy=temps| T1[_temps_row_when_off]\n    TS0 --&gt;|altrimenti| T2[compute_step]\n    T0 --&gt; T3[accumula risultati]\n    T1 --&gt; T3\n    T2 --&gt; T3\n  end\n\n  N --&gt; O[Return dict]\n  T3 --&gt; P[Return DataFrame]\n</pre>"},{"location":"iso_15316_calculation_procedure/#inputoutput-tables-main-functions","title":"Input/Output tables (main functions)","text":""},{"location":"iso_15316_calculation_procedure/#21-__init__input_data","title":"2.1 <code>__init__(input_data)</code>","text":"Field Type Description <code>input_data</code> dict Parameters of emission, distribution, generation, policy and tables. Output Initializes the instance and calls <code>_load_constants()</code> &amp; <code>_load_input_parameters()</code>."},{"location":"iso_15316_calculation_procedure/#22-_load_constants","title":"2.2 <code>_load_constants()</code>","text":"Field Type Description <code>input_data[\"TB14\"]</code> (optional) <code>pd.DataFrame</code> ISO table with nominal \u0394T/esponente; if missing uses <code>TB14_backup</code>. Side-effects <code>self.TB14</code> assigned; <code>self.c_w = 1.16</code>. Output No explicit return."},{"location":"iso_15316_calculation_procedure/#23-_load_input_parameters","title":"2.3 <code>_load_input_parameters()</code>","text":"Block Main keys Default (example) Emissione <code>emitter_type</code>, <code>nominal_power</code>, <code>emission_efficiency</code>, <code>mixing_valve</code>, <code>flow_temp_control_type</code>, <code>auxiliars_power</code>, <code>emission_operation_time</code>, <code>mixing_valve_delta</code>, <code>selected_emm_cont_circuit</code>, <code>heat_emission_data</code>, <code>outdoor_temp_data</code>, <code>constant_flow_temp</code> <code>Floor heating</code>, <code>8 kW</code>, <code>90%</code>, <code>True</code>, <code>Type 1</code>, <code>0 W</code>, <code>1 h</code>, <code>2 \u00b0C</code>, <code>0</code>, <code>42</code> Distribuzione <code>Heat_losses_recovered</code>, <code>distribution_loss_recovery</code>, <code>simplified_approach</code>, <code>distribution_aux_recovery</code>, <code>distribution_aux_power</code>, <code>distribution_loss_coeff</code>, <code>distribution_operation_time</code>, <code>recoverable_losses</code> <code>True</code>, <code>90%</code>, <code>80%</code>, <code>80%</code>, <code>30 W</code>, <code>48 W/K</code>, <code>1 h</code>, <code>0 kWh</code> Generazione <code>full_load_power</code>, <code>max_monthly_load_factor</code>, <code>tH_gen_i_ON</code>, <code>auxiliary_power_generator</code>, <code>fraction_of_auxiliary_power_generator</code>, <code>generator_circuit</code>, <code>speed_control_generator_pump</code>, <code>generator_nominal_deltaT</code>, <code>\u03b8HW_gen_flw_set</code>, <code>\u03b8HW_gen_ret_set</code>, <code>calc_when_QH_positive_only</code>, <code>fill_zeros_when_skipped</code>, <code>off_compute_mode</code>, <code>efficiency_model</code>, <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>, <code>manuf_curve_1d</code>, <code>manuf_curve_2d</code>, <code>gen_flow_temp_control_type</code>, <code>gen_outdoor_temp_data</code>, <code>\u03b8HW_gen_flw_const</code> <code>24 kW</code>, <code>100%</code>, <code>1 h</code>, <code>0%</code>, <code>40%</code>, <code>independent</code>, <code>variable</code>, <code>20 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>True</code>, <code>False</code>, <code>idle</code>, <code>simple</code>, <code>110%</code>, <code>95%</code>, <code>20 \u00b0C</code>, <code>50 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>Type A</code>, <code>curve 1D/2D</code>,<code>50 \u00b0C</code>"},{"location":"iso_15316_calculation_procedure/#24-_default_emission_data-_default_outdoor_data","title":"2.4 <code>_default_emission_data()</code> / <code>_default_outdoor_data()</code>","text":"Function Output Note <code>_default_emission_data</code> DF con <code>\u03b8H_em_flw_max_sahz_i</code>, <code>\u0394\u03b8H_em_w_max_sahz_i</code>, <code>\u03b8H_em_ret_req_sahz_i</code>, <code>\u03b2H_em_req_sahz_i</code>, <code>\u03b8H_em_flw_min_tz_i</code> <code>Limits/setpoint secondary circuit</code> <code>_default_outdoor_data</code> DF con <code>\u03b8ext_min_sahz_i</code>, <code>\u03b8ext_max_sahz_i</code>, <code>\u03b8em_flw_max_sahz_i</code>, <code>\u03b8em_flw_min_sahz_i</code> <code>Secondary circuit limits</code>"},{"location":"iso_15316_calculation_procedure/#25-load_csv_datacsv_path_or_df","title":"2.5 <code>load_csv_data(csv_path_or_df)</code>","text":"Input Type Description <code>csv_path_or_df</code> str / DataFrame Timeseries with columns (<code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> or aliases) Output DataFrame With optional <code>Q_H_kWh</code> added; saved in <code>self.timeseries_data</code>"},{"location":"iso_15316_calculation_procedure/#26-calculate_common_emission_parametersheating_needs_kwh-int","title":"2.6 <code>calculate_common_emission_parameters(heating_needs_kWh, \u03b8int)</code>","text":"Output (key) Description <code>QH_sys_out_hz_i</code> Net demand after recoveries <code>QH_em_i_in</code> Energy in at emission <code>\u03a6H_em_eff</code> Average power on interval (kW) <code>V_H_em_nom</code> Nominal flow (m\u00b3/h) <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code> Parameters from TB14"},{"location":"iso_15316_calculation_procedure/#27-calculate_type_c2-c3-c4-c5","title":"2.7 <code>calculate_type_C2 / C3 / C4 / C5</code>","text":"Function Principle Output Note <code>C2</code> Constant flow, constant water temperature <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C3</code> Variable flow, constant water temperature (return limited) <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C4</code> ON\u2013OFF (duty cycle) <code>\u03b8H_em_flw_calc</code>, <code>\u03b8H_em_flw_min</code>, ecc. <code>C5</code> Constant flow, variable heat exchange (bypass) <code>\u03b8H_em_flow=min</code>, <code>\u03b8H_em_ret\u2248</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code>"},{"location":"iso_15316_calculation_procedure/#28-calculate_circuit_node_temperatureext-emission_results","title":"2.8 <code>calculate_circuit_node_temperature(\u03b8ext, emission_results)</code>","text":"Control Logic Output Type 1 Demand \u2192 <code>\u03b8H_em_flw_min</code> <code>\u03b8H_nod_out</code> Type 2 Secondary circuit limits <code>\u03b8H_nod_out</code> Type 3 Constant (<code>\u03b8em_flw_sahz_i</code>) <code>\u03b8H_nod_out</code>"},{"location":"iso_15316_calculation_procedure/#29-calculate_operating_conditionsemission_results-common_params-int-h_nod_out","title":"2.9 <code>calculate_operating_conditions(emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"Case Output Note C.2 / C.3 / C.4 / C.5 <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, <code>V_H_cr</code>, <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>, <code>\u03b2H_em</code>, <code>\u03b8H_em_flw_min</code>, <code>\u03b8H_em_ret_eff</code>"},{"location":"iso_15316_calculation_procedure/#210-calculate_distributionh_dis_flw-h_dis_ret-int-qh_em_i_in","title":"2.10 <code>calculate_distribution(\u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"Output Meaning <code>Q_w_dis_i_ls</code>, <code>Q_w_dis_i_aux</code>, <code>Q_w_dis_i_ls_rbl_H</code> Losses, auxiliaries and recoverable (kWh) <code>QH_dis_i_req</code>, <code>QH_dis_i_in</code> Request and effective input to distribution <code>V_H_dis</code> Distribution volumetric flow (m\u00b3/h)"},{"location":"iso_15316_calculation_procedure/#211-_efficiency_from_modelflw-ret-load_frac","title":"2.11 <code>_efficiency_from_model(\u03b8flw, \u03b8ret, load_frac)</code>","text":"Model Description <code>simple</code> Efficiency as function of return temperature (condensation) <code>parametric</code> Piecewise linear with thresholds (<code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>) <code>manufacturer</code> Manufacturer curves 1D/2D with interpolation"},{"location":"iso_15316_calculation_procedure/#212-_generator_flow_setpointext-h_dis_flw_demand","title":"2.12 <code>_generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"Type Logic Type A Primary curve (outdoor) Type B Follow secondary demand Type C Constant"},{"location":"iso_15316_calculation_procedure/#213-calculate_generationh_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"2.13 <code>calculate_generation(\u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"Output Meaning <code>max_output_g1</code>, <code>QH_gen_out</code> Limit capacity and thermal output (kWh) <code>\u03b8X_gen_cr_flw</code>, <code>\u03b8X_gen_cr_ret</code> Primary circuit effective (\u00b0C) <code>V_H_gen</code> Primary circuit volumetric flow (m\u00b3/h) <code>efficiency_gen</code> Efficiency (%) <code>EHW_gen_in</code>, <code>EHW_gen_aux</code> Energy in ingress and auxiliaries (kWh) <code>QW_gen_i_ls_rbl_H</code> Recoverable losses (kWh) <code>QW_gen_out</code>, <code>QHW_gen_out</code>, <code>EH_gen_in</code>, <code>EWH_gen_in</code> Thermal balances"},{"location":"iso_15316_calculation_procedure/#214-compute_stepq_h_kwh-int-ext","title":"2.14 <code>compute_step(q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"Input Output <code>q_h_kWh</code>, <code>\u03b8int</code>, <code>\u03b8ext</code> Dictionary with emission, node/circuit, distribution, generation"},{"location":"iso_15316_calculation_procedure/#215-_temps_row_when_offint-ext","title":"2.15 <code>_temps_row_when_off(\u03b8int, \u03b8ext)</code>","text":"Purpose Output Row \"only temperature\" for <code>Q_H \u2264 0</code> Same keys, with powers/volumes=0"},{"location":"iso_15316_calculation_procedure/#216-run_timeseriesdfnone","title":"2.16 <code>run_timeseries(df=None)</code>","text":"Input Output <code>df</code> (optional) or <code>self.timeseries_data</code> DataFrame indexed by timestamp with results of each step"},{"location":"iso_15316_calculation_procedure/#modelling-suggestions","title":"Modelling suggestions","text":"<ul> <li>Verify consistency between emitter type and <code>TB14</code> rows.  </li> <li>For independent schemes, curate <code>generator_nominal_deltaT</code>, <code>primary_line_loss</code> and <code>allow_dilution</code>.  </li> <li>Use <code>manufacturer</code> with realistic manufacturer curves when available.</li> </ul>"},{"location":"iso_15316_generation_circuit/","title":"GENERATION","text":"<p>The annex D of ISO 15316-1 standard provides the calculation procedure for the generation circuit. It is the general procedure that can be improved using the detailed standards for different type of generator, such as Heat pump, Combustion boilers, District heating and cooling, etc. </p> <p>There are 2 typed of generaiont circuit:</p> <p>1) Generation with DIRECT circuit withou hydraulic separtion 2) Generation with INDIPENDENT flow rate circuit, using the hydraulic separtion</p>"},{"location":"iso_15316_generation_circuit/#direct-circuit","title":"DIRECT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>The standard define no control to the circuit.  In the pybuildingenergy, the contol have been applied on the generator based on:</p> <pre><code>- 'Type A - Based on outdoor temperature': uses primary's own weather curve\n- 'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)\n- 'Type C - Constant temperature'       : uses self.\u03b8HW_gen_flw_const\n</code></pre> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> <p>No data</p> <p>System design data: </p> <p>No data</p> <p>Process control data</p> <p>No data</p> <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#independent-circuit","title":"INDEPENDENT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal generator power max_output_g1 kW - 0 to 10<sup>4</sup> Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) water (flow-return) dTp \u00b0C - 1..40 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system <p>System design data: </p> <p>No data</p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Generator pump speed control speed_control_generator_pump - - - Generator pump speed control, could be varaible or deltaT_constant <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Generation flow Temperature Tp_sup \u00b0C - - Generation flow Temperature Generation return Temperature Tp_ret \u00b0C - - Generation return Temperature Generation flow rate V_H_gen m3/h - - Generation flow rate"},{"location":"iso_15316_heating_circuit/","title":"Heating circuit.","text":"<p>The library provides modules for evaluating 4 types of hydraulic circuits, where, based on Table C.1 of the standard, for each circuit it is identified which type of emission system to use and the type of control. as defined below: </p> Code Module Emitters Control C2 Constan mass flow rate and varying water temperature Radiators and Panels Heating curve, mixing valvew and variable generation temperature C3 Varying mass flow (constant temperature) Radiators, Panels, Heating coils Thermostatic valve, flow rate control with two way valve C4 ON-OFF and varying temperature Radiators and Panels On-Off control C5 Varying heat exchange Fan-coil, heating coils emitters with on-off blower  and continuos circulation 3 way by-pass valve control <p>All modules allow the us of a mixing valve to allow different temperatures in the different circuits. A distinction is made between:  - the emitter tmperature and flow rate; - the circuit temperature and flow rate; </p> <p>They differ where there is a mixing or by-pass 3 way valve in the circuit.</p>"},{"location":"iso_15316_heating_circuit/#system-type-and-input-parameters","title":"System type and input parameters","text":""},{"location":"iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators Heating Panels Control Parameters Heating curve flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maximum distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c3-varying-mass-flow-rate-and-constant-water-temperature","title":"C3 - varying mass flow rate and constant water temperature","text":"<p>This configuration is for sample heating circuit with varying mass flow rate and constant water temperature. </p> Figure 1: System C3_1 - Example of sample heating circuit varying mass flow rate.  Figure 1: System C3_1 - Example of sample heating circuit with series control (AHU coil).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators with thermostatic valve AHU coil with series control Panels with PID control Control Parameters Maximum flow/return \u0394\u03b8 Maximum flow temperature Target return temperature <p>Inputs required</p> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve Target return temperature \u03b8H_em_ret_req_sahz_i \u00b0C - - Desired return temperature of the emission circuit Maximum flow/return \u0394\u03b8 \u0394\u03b8H_em_w_max_sahz_i \u00b0C - - Maximum flow/return temperature difference of the emission circuit Maximum flow temperature \u03b8H_em_flw_max_sahz_i \u00b0C - - Maximum flow temperature of the emission circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c4-intermittent-flow-rate-module-on-off","title":"C4 - Intermittent flow rate module (ON-OFF)","text":"<p>This configuration is for sample heating circuit with intermittent flow rate and constant water temperature. </p> Figure 1: System C4 - Example of sample heating circuit with intermittent flow rate module (ON-OFF).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Desired load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c5-constant-flow-rate-and-variable-heat-exchange","title":"C5 - Constant flow rate and variable heat exchange","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  Figure 1: System C4 - Example of sample heating circuit with three way by-pass control.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Target load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Minimum flow temperature \u03b8H_em_flw_min_sahz_i \u00b0C - - Minimum flow temperature of the emission circuit for a zone i Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"iso_15316_system_inputs/","title":"HVAC SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"iso_15316_system_inputs/#emission","title":"EMISSION","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</li> <li> <p>mixing valve delta: it is the offset temperature of the mixing valve in \u00b0C. It refers to the varaible mixing_valve_delta. </p> <ul> <li> <p>The offset refers to the temperature difference between the desired temperature and the actual temperature, which is applied when mixing hot and cold water.</p> </li> <li> <p>In this case, the parameter \u0394\u03b8H_em_mix_sahz_i represents the temperature offset applied by the mixing valve, with a default value set to 2\u00b0C (as defined in the code).</p> </li> <li> <p>This means that when the mixing valve is operating, it will allow a 2\u00b0C deviation from the desired temperature to account for system dynamics, such as heat losses, system inertia, or external temperature influences.</p> </li> </ul> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0 <p>heat_emission_data: it is the table that contains the data of the emission circuit. If it is not provided the default values are used and the emitter_type is set to the first one in the table. In the code we have the function <code>_default_emission_data()</code> that returns the default values. These values are default emission circuit parameters for the heating system\u2019s secondary side (the side connected to heating emitters, such as radiators or underfloor heating).  They represent nominal and operational setpoints for a single heating zone (HZ1), including flow/return temperatures and load control factors.</p> <p>Table 4: Emission circuit data</p> Parameter (column name) Description Default Value Unit <code>\u03b8H_em_flw_max_sahz_i</code> Maximum flow temperature for the heating emission circuit 45 \u00b0C <code>\u0394\u03b8H_em_w_max_sahz_i</code> Maximum water flow/return temperature difference 8 \u00b0C <code>\u03b8H_em_ret_req_sahz_i</code> Desired return temperature of the emission circuit 20 \u00b0C <code>\u03b2H_em_req_sahz_i</code> Desired load factor with ON/OFF control 80 % <code>\u03b8H_em_flw_min_tz_i</code> Minimum required flow temperature for the thermal zone 28 \u00b0C"},{"location":"iso_15316_system_inputs/#distribution","title":"DISTRIBUTION","text":"<p><pre><code># --- distribution ---\n'heat_losses_recovered': True,\n'distribution_loss_recovery': 90,\n'simplified_approach': 80,\n'distribution_aux_recovery': 80,\n'distribution_aux_power': 30,\n'distribution_loss_coeff': 48,\n'distribution_operation_time': 1,\n</code></pre> The parameters are used inside the class HeatingSystemCalculator as:</p> <pre><code>self.Heat_losses_recovered = inp.get('heat_losses_recovered', True)\nself.f_h_dist_i_ls = inp.get('distribution_loss_recovery', 90)  # %\nself.simplified_or_holistic_approach = inp.get('simplified_approach', 80)  # %\nself.f_h_dist_i_aux = inp.get('distribution_aux_recovery', 80)  # %\nself.W_H_dist_i_aux = inp.get('distribution_aux_power', 30)  # W\nself.Heat_loss_coefficent_dist = inp.get('distribution_loss_coeff', 48)  # W/K\nself.tH_dis_i_ON = inp.get('distribution_operation_time', 1)  # h\n</code></pre> <p>if data is not provided by the user, the default values are used.</p> <p>These parameters describe the thermal and electrical behavior of the heat distribution subsystem, which connects the generator to the emitters (secondary circuits). They define how heat losses, auxiliary energy use, and simplifications in the calculation are handled within the ISO 15316-1 framework.</p> Variable Description Default Unit <code>heat_losses_recovered</code> Boolean flag that defines whether distribution heat losses are considered recoverable in the building (e.g., heat lost in indoor piping contributes to heating). <code>True</code> \u2013 <code>distribution_loss_recovery</code> (<code>f_h_dist_i_ls</code>) Fraction of distribution losses that are recoverable (typically within the heated zone). <code>90</code> % <code>simplified_approach</code> (<code>simplified_or_holistic_approach</code>) Defines the calculation approach for recovered losses: a simplified method (<code>&gt; 0</code>) or a holistic method (<code>0</code> for detailed ISO modeling). <code>80</code> % <code>distribution_aux_recovery</code> (<code>f_h_dist_i_aux</code>) Fraction of auxiliary electrical power (e.g., pumps, valves) that is converted into useful heat and recovered within the heated space. <code>80</code> % <code>distribution_aux_power</code> (<code>W_H_dist_i_aux</code>) Rated auxiliary electrical power of the distribution system (e.g., circulation pumps). <code>30</code> W <code>distribution_loss_coeff</code> (<code>Heat_loss_coefficent_dist</code>) Overall heat loss coefficient of the distribution system, representing thermal losses per degree of temperature difference between the fluid and ambient air. <code>48</code> W/K <code>distribution_operation_time</code> (<code>tH_dis_i_ON</code>) Average operation time of the distribution system per time step (typically the same as the emission system). <code>1</code> h"},{"location":"iso_15316_system_inputs/#generation","title":"GENERATION","text":"<p>The generator is modelled using the following parameters:</p> <pre><code>    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"])\n    '\u03b8HW_gen_flw_const': 50.0\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20\n</code></pre> <p>That are: </p> <ul> <li>load power: it is the power of the generator in kW, defined in the product data. variable name: 'full_load_power'</li> <li>max monthly load factor: it is the maximum load factor of the generator in %.  variable_name: 'max_monthly_load_factor'</li> <li>tH_gen_i_ON: it is the time of the generator in ON state in hours. variable_name: 'tH_gen_i_ON'</li> </ul> <ul> <li>auxiliary power generator: Percentage of generator input energy used by auxiliary systems (generally 0-5 %).Increases total system energy input. variable_name: 'auxiliary_power_generator'</li> <li> <p>fraction of auxiliary power generator: it is the portion of auxiliary energy recovered as heat (generally 20\u201360%). Reduces auxiliary losses.variable_name: 'fraction_of_auxiliary_power_generator'.</p> <p> 1. <code>auxiliary_power_generator</code> This parameter defines how much additional electrical power (in %) is consumed by the generator\u2019s own auxiliary components, such as:</p> <ul> <li>Circulation pumps  </li> <li>Combustion or ventilation fans  </li> <li>Electronic controls and sensors  </li> <li>Ignition systems  </li> <li>Internal electronics (standby mode)</li> </ul> <p>Formula:</p> \\[ E_{HW,gen,aux} = E_{HW,gen,in} \\times \\frac{\\text{auxiliary\\_power\\_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( E_{HW,gen,in} \\): Generator input energy (kWh)  </li> <li>\\( E_{HW,gen,aux} \\): Auxiliary energy consumed (kWh)</li> </ul> <p> 2. <code>fraction_of_auxiliary_power_generator</code></p> <p>This parameter represents the fraction of auxiliary power that is recoverable as useful heat. Some auxiliary systems release heat that can be recovered by the generator\u2019s thermal circuit.</p> <p>For example: - Pump motors or internal electronics may release part of their heat to the water loop. - Fans or controllers might dissipate energy inside the generator casing.</p> <p>Formula:</p> \\[ Q_{W,gen,i,ls,rbl,H} = E_{HW,gen,aux} \\times \\frac{\\text{fraction_of_auxiliary_power_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( Q_{W,gen,i,ls,rbl,H} \\): Recovered auxiliary heat (kWh)</li> </ul> </li> </ul> <ul> <li>generator circuit: it is the circuit of the generator. It can be 'direct' or 'independent'. variable_name: 'generator_circuit'<ul> <li>Direct: the generator is connected to the primary circuit, no hydraulic separation primary = secondary</li> <li>Independent: the generator is connected to the secondary circuit, with hydraulic separator primary != secondary</li> </ul> </li> </ul> <p>The primary circuit supply temperature setpoint (Tp_sup_set), i.e., the flow temperature on the generator side (boiler, heat pump, etc.) is calculated using the function _generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand), according to the selected control strategy of the generation system</p> <p>It determines how hot the generator should make the supply water based on: - the outdoor temperature (\u03b8ext), and/or - the heating demand from the distribution/emission side (\u03b8H_dis_flw_demand), and/or - a fixed setpoint defined by the user.</p> <p>The input parameters of the function are:</p> <ul> <li>\u03b8ext: outdoor air temperature</li> <li>\u03b8H_dis_flw_demand: Flow temperature requested by the secondary circuit (distribution/emission side)</li> </ul> <p>with global inputs that are:</p> <ul> <li>df_gen_out_temp: Table defining the primary (generator) heating curve</li> <li> <p>gen_flow_temp_control_type: Type of control used to control the flow temperature of the generator.Defines which control strategy is used (\u201cType A\u201d, \u201cType B\u201d, \u201cType C\u201d):</p> <ul> <li>'Type A - Based on outdoor temperature': uses primary's own weather curve</li> <li>'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)</li> <li>'Type C - Constant temperature'       : uses \u03b8HW_gen_flw_const</li> </ul> </li> <li> <p>\u03b8HW_gen_flw_const: Constant flow temperature of the generator</p> </li> </ul> <p>The user should provide the information directly in the dictionary:</p> <pre><code>'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n'gen_outdoor_temp_data': pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],\n    \"\u03b8flw_gen_min\": [35],\n}, index=[\"Generator curve\"])\n'\u03b8HW_gen_flw_const': 50.0\n</code></pre> <p>where, in the code are defined as: </p> <p><pre><code>self.df_gen_out_temp = inp.get('gen_outdoor_temp_data', pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],   # \u00b0C, max primary supply\n    \"\u03b8flw_gen_min\": [35],   # \u00b0C, min primary supply\n}, index=[\"Generator curve\"]))\n\nself.gen_flow_temp_control_type = inp.get(\n    'gen_flow_temp_control_type',\n    'Type A - Based on outdoor temperature'   # 'Type A' | 'Type B' | 'Type C'\n)\n\nself.\u03b8HW_gen_flw_const = float(inp.get('\u03b8HW_gen_flw_const', 50.0))\n</code></pre> Explanation of the different type of control:</p> <ul> <li> Type A - Based on outdoor temperature. Climatic curve (outdoor compensation) <pre><code>if ctrl.startswith('Type A'):\n    if \u03b8ext_max != \u03b8ext_min:\n        Tp = \u03b8flw_min + (\u03b8flw_max - \u03b8flw_min) * (\u03b8ext_max - \u03b8ext) / (\u03b8ext_max - \u03b8ext_min)\n        return max(min(Tp, \u03b8flw_max), \u03b8flw_min)\n    return \u03b8flw_min\n</code></pre> Calculates the generator flow temperature linearly based on outdoor temperature. Equation: The generator flow temperature \\( T_{p, \\text{set}} \\) is calculated linearly based on the outdoor temperature \\( \\theta_{\\text{ext}} \\), following the formula:</li> </ul> \\[ T_{p, \\text{set}} = T_{\\text{flw}, \\text{min}} + \\left( T_{\\text{flw}, \\text{max}} - T_{\\text{flw}, \\text{min}} \\right) \\cdot \\frac{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}} \\right)}{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}, \\text{min}} \\right)} \\] <p>Where:</p> <ul> <li>\\( T_{\\text{flw}, \\text{min}} \\) = minimum flow temperature (e.g., 35\u00b0C)</li> <li>\\( T_{\\text{flw}, \\text{max}} \\) = maximum flow temperature (e.g., 60\u00b0C)</li> <li>\\( \\theta_{\\text{ext}} \\) = outdoor air temperature</li> <li>\\( \\theta_{\\text{ext}, \\text{min}} \\) = minimum outdoor temperature (e.g., -7\u00b0C)</li> <li>\\( \\theta_{\\text{ext}, \\text{max}} \\) = maximum outdoor temperature (e.g., 15\u00b0C) The calculated \\( T_{p, \\text{set}} \\) is then clamped between the minimum and maximum values:</li> </ul> \\[ T_{p, \\text{set}} = \\max\\left( \\min\\left( T_{p, \\text{set}}, T_{\\text{flw}, \\text{max}} \\right), T_{\\text{flw}, \\text{min}} \\right) \\] <p>\ud83d\udc49\ud83c\udffb Meaning: This is the typical weather-compensated control used (for example) in boilers and heat pumps. It automatically adjusts water temperature to the outdoor conditions for better efficiency and comfort. Example visualization of type A: <pre><code>Generator flow temperature (\u00b0C)\n\u2502\n\u2502    60\u00b0C \u2500\u2500\u2500\u2500\u2510\n\u2502              \\\n\u2502               \\\n\u2502                \\\n\u2502                 \\\n\u2502    35\u00b0C \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Outdoor temperature (\u00b0C)\n          -7          0           +15\n</code></pre></p> <ul> <li> <p> Type B - Based on demand. Follow secondary demand <pre><code>if ctrl.startswith('Type B'):\n    return float(\u03b8H_dis_flw_demand)\n</code></pre> Sets the generator supply temperature equal to the demand from the secondary (distribution/emission) side. \ud83d\udc49\ud83c\udffb Meaning: This is used in systems with hydraulic separation (e.g., with a buffer tank or heat exchanger) where the generator must match the needs of the secondary circuit dynamically. Example: If the radiator loop requests 45 \u00b0C \u2192 the generator must deliver exactly 45 \u00b0C to maintain balance.</p> </li> <li> <p> Type C - Constant temperature <pre><code>return float(self.\u03b8HW_gen_flw_const)\n</code></pre> Ignores weather and demand \u2014 the generator runs at a fixed supply temperature (e.g., 50 \u00b0C). \ud83d\udc49\ud83c\udffb Meaning: Simplest and oldest control type, often found in small or legacy heating systems. It offers no adaptation to weather or load, typically less efficient. Example: If the user defines a constant supply temperature of 50 \u00b0C \u2192 the generator will always deliver 50 \u00b0C, regardless of the demand from the secondary circuit.</p> </li> </ul> <ul> <li>speed control of generator pump: icontrols how \u0394T varies with system load (constant vs variable). It can be in the code 'variable' or 'deltaT_constant'. variable_name: 'speed_control_generator_pump'</li> <li> <p>Nominal water deltaT of generator: defines the nominal \u0394T at design (full load) \u2014 the reference used in thermal balance equations in \u00b0C. variable_name: 'generator_nominal_deltaT'. It is used if speed_control_of_generator_pump is 'deltaT_constant'.</p> <p>More info:</p> <ul> <li><code>\"deltaT_constant\"</code> \u2192 The pump maintains a fixed temperature difference (\u0394T) between flow and return.</li> <li>Example: The pump adjusts its speed so that \u0394T = 20 \u00b0C remains constant.</li> <li><code>\"variable\"</code> \u2192 The pump varies its speed dynamically according to the system load.</li> <li>When heating demand decreases, the water flow rate decreases.</li> <li>This leads to a smaller \u0394T at partial loads, improving efficiency.</li> </ul> <p>When <code>variable</code>, the temperature difference (\u0394T) decreases proportionally with the thermal load, which represents real modulating behavior of pumps and heat generators.</p> <p><code>generator_nominal_deltaT</code></p> <p>Defines the nominal temperature difference (\u0394T) between the generator flow and return at full-load conditions.</p> \\[ \\Delta T_{nom} = T_{flow,nominal} - T_{return,nominal} \\] <p>This is the design operating condition for the generator, used as a reference in calculations.</p> <p>Example:</p> <p>If <code>generator_nominal_deltaT = 20</code>, then at full load:</p> <ul> <li>Supply temperature = 60 \u00b0C  </li> <li>Return temperature = 40 \u00b0C \u2192 \u0394T = 20 \u00b0C  </li> </ul> <p>At partial load:</p> <ul> <li>If <code>speed_control_generator_pump = \"deltaT_constant\"</code> \u2192 \u0394T remains 20 \u00b0C.  </li> <li>If <code>speed_control_generator_pump = \"variable\"</code> \u2192 \u0394T may drop to 10\u201315 \u00b0C, depending on demand.</li> </ul> </li> </ul> <p>It is possible to define the optional primary setpoints (used if circuit is independent).</p> <ul> <li>\u03b8HW_gen_flw_set: flow temperature setpoint</li> <li>\u03b8HW_gen_ret_set: return temperature setpoint</li> </ul>"},{"location":"iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <pre><code>1) 'simple'       : linear heuristic vs. return temperature\n2) 'parametric'   : piecewise/threshold model\n3) 'manufacturer' : 1D (return) or 2D (flow/return) map\n</code></pre> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic</p> <p>1) Detect zero or negative heating demand</p> <p><pre><code>if float(qh) &lt;= 0:\n</code></pre> This means there is no heating required (or possibly cooling). Now the function checks which policy is set for such cases.</p> <p>2) Case 1 \u2014 Full simulation even when Q_H = 0 <pre><code>if not self.calc_when_QH_positive_only:\n    # Full calculation even with zero load\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n    ...\n</code></pre></p> <ul> <li>Here, the flag calc_when_QH_positive_only is False, so the user wants to compute everything even when there\u2019s no load.</li> <li> <p>It runs the complete thermal balance by calling: <pre><code>res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre> This means: compute system temperatures, efficiencies, flow rates, etc., as if the system were still active but with zero heating power.</p> </li> <li> <p>The results are appended to the output DataFrame as usual.</p> </li> </ul> <p>Use case: See how the system behaves under \u201cno load\u201d conditions (e.g., during shoulder months) \u2014 including standby losses or auxiliary power.</p> <p>3) Case 2 \u2014 Skip detailed calculation (calc_when_QH_positive_only = True)</p> <p>If this flag is True, the system should behave differently depending on how \u201coff periods\u201d are treated.</p> <p>There are three \u201coff modes\u201d controlled by self.off_compute_mode.</p> <ul> <li> <p> a) Mode: 'idle' \u2192 Minimal record  <pre><code>if self.off_compute_mode == 'idle':\n    res_row = {'timestamp': idx}\n    res_row.update(self._idle_row(0.0, float(\u03b8int), float(\u03b8ext)))\n</code></pre></p> <ul> <li>Produces a minimal output line using _idle_row().</li> <li>This function fills the row mostly with zeros or NaN values \u2014 representing that nothing is being calculated because the system is idle.</li> <li>Only basic fields like timestamp, indoor temperature, and outdoor temperature are kept.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For speed optimization when simulating a full year \u2014 avoids doing unnecessary physics calculations.</p> </li> <li> <p> b) Mode: 'temps' \u2192 Record only temperatures  <pre><code>elif self.off_compute_mode == 'temps':\n    res = self._temps_row_when_off(float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>This still computes temperatures (like circuit or node flow/return) using _temps_row_when_off(),</li> <li>but all energetic terms (flows, powers, losses) are set to zero.</li> <li>This way, you can visualize how the temperature control or mixing valves behave even with zero heating demand.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For continuous temperature mapping, useful when validating system controls or comfort conditions.</p> </li> <li> <p> c) Mode: 'full' \u2192 Full calculation despite Q_H = 0  <pre><code>elif self.off_compute_mode == 'full':\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>Similar to Case 1 but triggered explicitly by mode 'full' \u2014 performs a complete computation of all variables even if load = 0.</li> <li>This is a \u201cforce full calc\u201d inside the zero-demand policy.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: When testing or debugging; ensures identical data structure across all timesteps.</p> </li> </ul> <p>4) continue statements</p> <p>Each branch ends with continue \u2014 \u2192 meaning the loop moves to the next timestep immediately after handling this case. No further code in the timestep is executed once the \u201czero-load\u201d policy has been applied.</p> <p>General-physical interpretation </p> <p>This logic helps balance accuracy vs performance:</p> <p>In annual simulations (8760 hours), 70\u201390% of the time may have zero heating demand (e.g., in summer). Recomputing all hydraulic and thermal equations each hour would waste time.</p> <p>Therefore, this control allows skipping unnecessary computations or simplifying the result depending on your simulation purpose:</p> <ul> <li>\"idle\" \u2192 fastest</li> <li>\"temps\" \u2192 medium (keep comfort analysis)</li> <li>\"full\" \u2192 slowest but most complete</li> </ul> <p>Example of inputs system: <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n    'heat_emission_data' : pd.DataFrame({\n            \"\u03b8H_em_flw_max_sahz_i\": [45],\n            \"\u0394\u03b8H_em_w_max_sahz_i\": [8],\n            \"\u03b8H_em_ret_req_sahz_i\": [20],\n            \"\u03b2H_em_req_sahz_i\": [80],\n            \"\u03b8H_em_flw_min_tz_i\": [28],\n        }, index=[\n            \"Max flow temperature HZ1\",\n            \"Max \u0394\u03b8 flow / return HZ1\",\n            \"Desired return temperature HZ1\",\n            \"Desired load factor with ON-OFF for HZ1\",\n            \"Minimum flow temperature for HZ1\"\n        ])\n\n    # --- distribution ---\n    'heat_losses_recovered': True,\n    'distribution_loss_recovery': 90,\n    'simplified_approach': 80,\n    'distribution_aux_recovery': 80,\n    'distribution_aux_power': 30,\n    'distribution_loss_coeff': 48,\n    'distribution_operation_time': 1,\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n}\n</code></pre></p>"},{"location":"iso_52016/","title":"ISO 52016 - Introduction","text":""},{"location":"iso_52016/#iso-5201052016-building-simulation-module-level-technical-notes","title":"ISO 52010/52016 Building Simulation \u2013 Module-level Technical Notes","text":"<p>Scope: this document is strictly focused on the existing modules and the current data structure you shared: - <code>global_inputs.py</code> - <code>generate_profile.py</code> - <code>ventilation.py</code> - Input schema <code>BUI</code> (Python dict)</p> <p>It explains each function\u2019s purpose, physics, inputs/outputs, algorithmic flow, and edge cases. All equations use SI unless otherwise stated.</p>"},{"location":"iso_52016/#1-input-schema-bui-data-contract","title":"1) Input Schema \u2014 <code>BUI</code> (data contract)","text":"<p>This dictionary is the canonical input. It provides: - Site (lat/lon, azimuth), morphology (perimeter, height, thickness), program (type class), adjacent zones, surfaces, and system/profiles.</p>"},{"location":"iso_52016/#11-semantics-selected-keys","title":"1.1 Semantics (selected keys)","text":"<ul> <li><code>building.azimuth_relative_to_true_north</code> <code>[deg]</code>: clockwise from true North (0=N, 90=E).</li> <li><code>building.exposed_perimeter</code> <code>[m]</code>: used in some ISO ground/perimeter correlations.</li> <li><code>building.wall_thickness</code> <code>[m]</code>: wall layer total thickness (used e.g. for geometric checks / future U recalcs).</li> <li><code>building.adj_zones_present</code> <code>[bool]</code>: master switch for unconditioned / adjacent zones coupling.</li> <li><code>adjacent_zones[*].orientation_zone.azimuth</code> <code>[deg]</code>: local azimuth of each adjacent unconditioned zone.</li> <li><code>adjacent_zones[*].area_facade_elements</code> <code>[m\u00b2]</code>: areas per element (vector aligned with <code>typology_elements</code> and <code>orientation_elements</code>).</li> <li><code>adjacent_zones[*].typology_elements</code>: element types:</li> <li><code>OP</code> = opaque envelope element,</li> <li><code>GR</code> = ground-coupled,   (extendable: <code>TR</code> windows, etc., if needed in future).</li> <li><code>adjacent_zones[*].transmittance_U_elements</code> <code>[W\u00b7m\u207b\u00b2\u00b7K\u207b\u00b9]</code>: U by element, 1:1 with areas.</li> <li><code>adjacent_zones[*].orientation_elements</code>: orientation code by element:</li> <li><code>NV</code> North-vertical (\u22480\u00b0), <code>SV</code> South-vertical (\u2248180\u00b0),</li> <li><code>EV</code> East-vertical (\u224890\u00b0),  <code>WV</code> West-vertical (\u2248270\u00b0),</li> <li><code>HOR</code> horizontal (roof/slab).</li> <li><code>adjacent_zones[*].volume</code> <code>[m\u00b3]</code>: air volume of unconditioned zone (used for air change calc).</li> <li><code>adjacent_zones[*].a_use</code> <code>[m\u00b2]</code>: useful area of the adjacent zone (for internal gains split).</li> <li><code>building_surface[*]</code>: explicit building surfaces (opaque + transparent), with:</li> <li><code>u_value</code> <code>[W\u00b7m\u207b\u00b2\u00b7K\u207b\u00b9]</code>, <code>g_value</code> (for transparent), <code>solar_absorptance</code> <code>[-]</code>,</li> <li><code>orientation</code> (<code>azimuth</code> <code>[deg]</code>, <code>tilt</code> <code>[deg]</code>),</li> <li>optional <code>name_adj_zone</code> to bind a surface to a specific unconditioned adjacent zone name.</li> <li><code>building_parameters.*</code>: setpoints, capacities, airflow rates (ACH), internal gains profiles, and ON/OFF schedules.</li> </ul> <p>Note: The current modules consume only a subset (ventilation, internal gains, adjacent zone transmission). The fields are intentionally richer to allow later coupling with ISO 52010 solar/sky and ISO 52016 balance.</p>"},{"location":"iso_52016/#2-global_inputspy-static-data-constants","title":"2) <code>global_inputs.py</code> \u2014 Static data &amp; constants","text":""},{"location":"iso_52016/#21-purpose","title":"2.1 Purpose","text":"<ul> <li>Provide reference tables (e.g., ISO 13789 <code>n_ue</code> air-tightness classes) and thermophysical constants.</li> <li>Contain an emitter table <code>TB14</code> (\u0394T exponents).</li> </ul>"},{"location":"iso_52016/#22-key-objects","title":"2.2 Key Objects","text":"<ul> <li><code>periods</code>, <code>bui_types</code>, <code>months</code>: taxonomies.</li> <li><code>WATER_DENSITY = 1000</code> <code>[kg\u00b7m\u207b\u00b3]</code></li> <li><code>WATER_SPECIFIC_HEAT_CAPACITY = 0.00116</code> <code>[kWh\u00b7kg\u207b\u00b9\u00b7K\u207b\u00b9]</code> (\u2192 multiply by <code>kg</code> and <code>\u0394T</code> to get kWh)</li> <li><code>df_n_ue</code> \u2014 ISO 13789:2018 (Table 7) conventional air change rate between unconditioned space and exterior:</li> </ul> code description (air-tightness) <code>n_ue</code> [h\u207b\u00b9] 1 No doors/windows openings 0.1 2 All joints well sealed, no openings 0.5 3 Well sealed, small openings 1.0 4 Some localized open joints 3.0 5 Numerous open joints / large openings 10.0 <ul> <li><code>TB14</code> \u2014 emitter exponents and nominal \u0394T:</li> <li>Radiator: <code>n=1.3</code>, <code>\u0394\u03b8_air=50\u00b0C</code>, <code>\u0394\u03b8_water=20\u00b0C</code></li> <li>Floor heating: <code>n=1.1</code>, <code>\u0394\u03b8_air=15\u00b0C</code>, <code>\u0394\u03b8_water=5\u00b0C</code></li> <li>Fan coil: <code>n=1.0</code>, <code>\u0394\u03b8_air=25\u00b0C</code>, <code>\u0394\u03b8_water=10\u00b0C</code></li> </ul>"},{"location":"iso_52016/#23-usage-physics","title":"2.3 Usage &amp; Physics","text":"<ul> <li><code>n_ue</code> maps directly into adjacent unconditioned zone ventilation (see \u00a74.3), i.e. <code>que = V_u \u00b7 n_ue</code> <code>[m\u00b3\u00b7h\u207b\u00b9]</code>.</li> <li>Water constants are useful for DHW/emitters energy conversions (not used inside <code>ventilation.py</code> yet).</li> </ul>"},{"location":"iso_52016/#3-generate_profilepy-hourly-operational-profiles","title":"3) <code>generate_profile.py</code> \u2014 Hourly operational profiles","text":""},{"location":"iso_52016/#31-purpose","title":"3.1 Purpose","text":"<p>Generate a 13-month hourly DataFrame with working/holiday flags and per-category profiles: <code>{ventilation, heating, cooling, occupancy, lighting, appliances}</code>.</p>"},{"location":"iso_52016/#32-public-api","title":"3.2 Public API","text":""},{"location":"iso_52016/#class","title":"Class","text":"<pre><code>class HourlyProfileGenerator:\n    def __init__(country='IT', num_months=13, start_year=None,\n                 working_day_profile=None, holiday_profile=None,\n                 category_profiles=None)\n</code></pre>"},{"location":"iso_52016/#methods","title":"Methods","text":"<ul> <li><code>generate() -&gt; pd.DataFrame</code></li> <li><code>get_summary() -&gt; None</code></li> <li><code>plot_annual_profiles(categories=None, freq=\"H\", include_weekend_shading=True, title=\"...\") -&gt; plotly.graph_objects.Figure</code></li> </ul>"},{"location":"iso_52016/#33-physics-semantics","title":"3.3 Physics &amp; Semantics","text":"<ul> <li>Profiles are dimensionless multipliers in <code>[0,1]</code> applied to full-load densities (e.g., W\u00b7m\u207b\u00b2 or l\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2) to produce hour-by-hour loads/flows.  </li> <li>Holidays via <code>holidays</code> lib using <code>country</code> 2-letter code; weekends = Sat/Sun.</li> </ul>"},{"location":"iso_52016/#34-normalization-rules","title":"3.4 Normalization Rules","text":"<p>Each category <code>c</code> stores two 24-length arrays: - <code>c_profile</code> on weekday vs holiday/weekend. - Given an hour <code>h</code>, final profile value is: [ p_c(h, d) = \\begin{cases} p_{c,\\mathrm{wd}}(h), &amp; \\text{if } d \\text{ is a working day}\\ p_{c,\\mathrm{hd}}(h), &amp; \\text{if } d \\text{ is holiday/weekend} \\end{cases} \\tag{3.1} ]</p>"},{"location":"iso_52016/#35-outputs","title":"3.5 Outputs","text":"<p><code>generate()</code> returns a DataFrame with: - time columns: <code>datetime</code>, <code>date</code>, <code>hour</code>, <code>day_of_week</code>, <code>day_name</code> - flags: <code>is_holiday</code>, <code>is_weekend</code>, <code>is_working_day</code>, <code>holiday_name</code> - per-category: <code>ventilation_profile</code>, <code>heating_profile</code>, \u2026, <code>appliances_profile</code> - legacy: <code>profile_value</code> (alias of <code>occupancy_profile</code>), <code>day_type</code></p>"},{"location":"iso_52016/#36-edge-cases","title":"3.6 Edge Cases","text":"<ul> <li>If <code>category_profiles</code> is missing a key, defaults are copied from <code>working_day_profile</code> / <code>holiday_profile</code> (or built-in defaults).</li> <li>Input validation enforces 24-length arrays.</li> </ul>"},{"location":"iso_52016/#4-ventilationpy-ventilation-conductance-internal-gains-and-iso-13789-adjacent-zone-coupling","title":"4) <code>ventilation.py</code> \u2014 Ventilation conductance, internal gains, and ISO 13789 adjacent-zone coupling","text":""},{"location":"iso_52016/#41-data-classes","title":"4.1 Data classes","text":"<p><pre><code>@dataclass\nclass h_natural_vent:\n    H_ve_nat: np.ndarray\n</code></pre> Currently a thin container (kept for future interface symmetry).</p>"},{"location":"iso_52016/#42-heat_transfer_coefficient_by_ventilation","title":"4.2 <code>heat_transfer_coefficient_by_ventilation(...)</code>","text":"<p>Physical purpose: compute the ventilation heat transfer coefficient \\(H_{ve}\\) <code>[W\u00b7K\u207b\u00b9]</code> of the thermal zone either: - from natural ventilation (ISO 16798-7:2017, single-sided airing via windows, wind/stack), or - from occupancy-driven flow (simplified volumetric rate per floor area).</p>"},{"location":"iso_52016/#signature","title":"Signature","text":"<pre><code>@staticmethod\ndef heat_transfer_coefficient_by_ventilation(\n    building_object, Tz, Te, u_site, Rw_arg_i=None, c_air=1006, \n    rho_air=1.204, C_wnd=0.001, C_st=0.0035, rho_a_ref=1.204, altitude=None,\n    type_ventilation=\"temp_wind\", flowrate_person=1.4\n) -&gt; h_natural_vent:\n</code></pre>"},{"location":"iso_52016/#inputs-main","title":"Inputs (main)","text":"<ul> <li><code>Tz</code> <code>[\u00b0C]</code> indoor air temperature (zone).</li> <li><code>Te</code> <code>[\u00b0C]</code> outdoor air temperature.</li> <li><code>u_site</code> <code>[m\u00b7s\u207b\u00b9]</code> local wind speed at site height (as per ISO 16798-7 assumptions).</li> <li><code>Rw_arg_i</code> <code>[-]</code> array of opening ratios per window (<code>0\u20261</code>). If <code>None</code>, defaults to <code>0.9</code>.</li> <li><code>C_wnd = 0.001</code> <code>[(m\u00b7s\u207b\u00b9)\u207b\u00b9]</code> wind coefficient (ISO 16798-7 Table 11).</li> <li><code>C_st = 0.0035</code> <code>[(m\u00b7s\u207b\u00b9)/(m\u00b7K)]</code> stack coefficient (ISO 16798-7 Table 11).</li> <li><code>rho_a_ref</code> <code>[kg\u00b7m\u207b\u00b3]</code> reference air density at ~20 \u00b0C; corrected with <code>altitude</code> if provided.</li> <li><code>type_ventilation</code>: <code>\"temp_wind\"</code> (ISO airing) or <code>\"occupancy\"</code> (area-based volumetric rule).</li> <li><code>flowrate_person</code> <code>[L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2]</code> used only in <code>\"occupancy\"</code> branch.</li> </ul>"},{"location":"iso_52016/#physics","title":"Physics","text":"<p>Step A \u2014 Effective opening height (stack path) For each transparent surface: - parapet height \\(h_p\\) <code>[m]</code>, - window height \\(h_w\\) <code>[m]</code>, - path height (vertical center): \\(h_{path,i} = h_p + \\frac{h_w}{2}\\), - fa height: \\(h_{fa,i} = \\frac{h_w}{2}\\).</p> <p>The useful stack height: [ h_{w,st} = \\max_i!\\left(h_{path,i} + \\frac{h_{fa,i}}{2}\\right) - \\min_i!\\left(h_{path,i} - \\frac{h_{fa,i}}{2}\\right) \\tag{4.1} ]</p> <p>Step B \u2014 Density correction If <code>altitude</code> present, a standard atmosphere relation updates \\(\\rho_{a,ref}\\). Outdoor density: [ \\rho_{a,e} = \\rho_{a,ref}\\,\\frac{291.15}{273.15 + T_e} \\tag{4.2} ]</p> <p>Step C \u2014 Effective openable area For each window \\(i\\), geometric area \\(A_{w,i} = h_{w,i}\\,w_i\\). Open area \\(A_{w,i}^{open} = A_{w,i}\\,R_{w,i}\\) with \\(R_{w,i}\\in[0,1]\\). If <code>Rw_arg_i</code> is missing or length mismatches the number of windows, default \\(R_{w,i}=0.9\\). [ A_{w,tot} = \\sum_i A_{w,i}^{open} \\tag{4.3} ]</p> <p>Step D \u2014 Airing volumetric flow (single-sided) Using ISO 16798-7 \u00a76.4.3.5.4: [ q_v = 3600\\;\\frac{\\rho_{a,ref}}{\\rho_{a,e}}\\;\\frac{A_{w,tot}}{2}\\, \\left[\\max!\\Big(C_{wnd}\\,u_{site}^2,\\; C_{st}\\,h_{w,st}\\,\\lvert T_z-T_e\\rvert\\Big)\\right]^{1/2} \\quad [\\text{m}^3/\\text{h}] \\tag{4.4} ]</p> <p>Step E \u2014 Ventilation conductance [ H_{ve} = \\frac{c_{air}\\,\\rho_{air}}{3600}\\;q_v \\quad [\\text{W\u00b7K}^{-1}] \\tag{4.5} ]</p> <p>Occupancy branch: area-based simplified rule (constant per hour) [ H_{ve} = A_{use}\\cdot (3.6\\,\\dot v_{pers})\\cdot \\frac{c_{air}\\,\\rho_{air}}{3600} \\tag{4.6} ] with \\(\\dot v_{pers}\\) in <code>[L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2]</code> and <code>3.6</code> converting L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2 to m\u00b3\u00b7h\u207b\u00b9\u00b7m\u207b\u00b2.</p>"},{"location":"iso_52016/#outputs","title":"Outputs","text":"<ul> <li><code>np.ndarray</code> of <code>H_ve_k_t</code> <code>[W\u00b7K\u207b\u00b9]</code> (scalar or time-series depending on inputs).</li> </ul>"},{"location":"iso_52016/#algorithm-pseudo","title":"Algorithm (pseudo)","text":"<pre><code>if type_ventilation == \"temp_wind\":\n    extract all windows -&gt; {height, width, parapet}\n    compute hw_path_i, hw_fa_i -&gt; hw_st  # Eq. (4.1)\n    density correction -&gt; rho_a_e        # Eq. (4.2)\n    aw_tot -&gt; Eq. (4.3)\n    qv -&gt; Eq. (4.4)\n    Hve -&gt; Eq. (4.5)\nelse:  # occupancy\n    A_use &lt;- building_object[\"building\"][\"net_floor_area\"]\n    Hve  &lt;- Eq. (4.6)\nreturn np.array(Hve)\n</code></pre>"},{"location":"iso_52016/#edge-cases-validation","title":"Edge Cases &amp; Validation","text":"<ul> <li>No transparent surfaces \u2192 \\(A_{w,tot}=0\\) \u2192 \\(H_{ve}=0\\).</li> <li><code>Rw_arg_i</code> length mismatch \u2192 warning + default 0.9.</li> <li>Negative or null <code>u_site</code> accepted; <code>max(\u00b7)</code> ensures stack/wind pick the dominant driver.</li> </ul>"},{"location":"iso_52016/#43-internal_gains","title":"4.3 <code>internal_gains(...)</code>","text":"<p>Physical purpose: compute internal sensible gains \\(\\Phi_{int}\\) <code>[W]</code> in the thermally conditioned zone, possibly accounting for spillover to adjacent unconditioned zones.</p>"},{"location":"iso_52016/#signature_1","title":"Signature","text":"<pre><code>def internal_gains(\n    cls, building_type_class, a_use, unconditioned_zones_nearby=False,\n    list_adj_zones=None, Fztc_ztu_m: float=1, b_ztu: float=1,\n    h_occup: float=1, h_app: float=1, h_light: float=1, h_dhw: float=1,\n    h_hvac: float=1, h_proc: float=1\n) -&gt; float:\n</code></pre>"},{"location":"iso_52016/#inputs-main_1","title":"Inputs (main)","text":"<ul> <li><code>building_type_class</code>: key for the lookup table <code>internal_gains_occupants</code> (imported from <code>source.table_iso_16798_1</code>).</li> <li><code>a_use</code> <code>[m\u00b2]</code>: useful area of the conditioned zone.</li> <li><code>h_*</code> <code>[-]</code>: hourly multipliers (profiles) for each sub-component (currently occupants and appliances are used).</li> <li>Coupling params for unconditioned zones:</li> <li><code>b_ztu</code> <code>[-]</code>: adjustment factor of the adjacent unconditioned zone (see \u00a74.4, Eq. (4.13)).</li> <li><code>Fztc_ztu_m</code> <code>[-]</code>: fractional path factor conditioned\u2192unconditioned in month <code>m</code> (lumped path coefficient).</li> <li><code>list_adj_zones</code>: number of adjacent zones (note: the current signature expects an int; see note below).</li> </ul> <p>Note: The code uses <code>for zones in range(list_adj_zones)</code> \u2014 pass an <code>int</code>. If a list is desired in the future, change to <code>for z in list_adj_zones:</code>.</p>"},{"location":"iso_52016/#physics_1","title":"Physics","text":"<p>Let \\(q_{occ}\\) and \\(q_{app}\\) be the nominal density of internal gains <code>[W\u00b7m\u207b\u00b2]</code> for occupants/equipment per <code>building_type_class</code>.</p> <p>Base internal gains in the conditioned zone: [ \\Phi_{int,z}(t) = \\big(q_{occ}\\,h_{occup}(t) + q_{app}\\,h_{app}(t)\\big)\\;A_{use} \\tag{4.7} ]</p> <p>Optional spillover to unconditioned adjacent zones (<code>unconditioned_zones_nearby = True</code>): The code currently adds a further term per adjacent zone combining a direct duplicated contribution and a fractional transfer modulated by \\((1-b_{ztu})\\,F_{ztc{\\text -}ztu,m}\\): [ \\Phi_{int,z}^{eff}(t) = \\Phi_{int,z}(t) + \\sum_{j=1}^{N_{adj}} \\left[\\Phi_{int,z}(t) + \\big(1-b_{ztu}\\big)\\,F_{ztc{\\text -}ztu,m}\\,\\Phi_{int,z}(t)\\right] \\tag{4.8} ]</p> <p>Remark: Eq. (4.8) mirrors the present implementation logic. In a thermodynamic sense, one might prefer partitioning \\(\\Phi_{int}\\) (instead of adding duplicates) across coupling paths; if you intend to conserve energy strictly, revisit this formulation.</p>"},{"location":"iso_52016/#output","title":"Output","text":"<ul> <li><code>float</code> <code>[W]</code> \u2014 instantaneous internal sensible gains for the conditioned zone with the current coupling rule.</li> </ul>"},{"location":"iso_52016/#algorithm-pseudo_1","title":"Algorithm (pseudo)","text":"<pre><code>q_occ = internal_gains_occupants[building_type_class]['occupants']\nq_app = internal_gains_occupants[building_type_class]['appliances']\nPhi_base = (q_occ*h_occup + q_app*h_app) * a_use        # Eq. (4.7)\nif unconditioned_zones_nearby:\n    Phi_eff = Phi_base\n    for _ in range(list_adj_zones):\n        Phi_eff += Phi_base + (1-b_ztu)*Fztc_ztu_m * Phi_base\n    return float(Phi_eff)\nelse:\n    return float(Phi_base)\n</code></pre>"},{"location":"iso_52016/#44-transmission_heat_transfer_coefficient_iso13789","title":"4.4 <code>transmission_heat_transfer_coefficient_ISO13789(...)</code>","text":"<p>Physical purpose: compute transmission coupling between a thermally conditioned zone (ztc) and adjacent unconditioned zone(s) (ztu) per ISO 13789, including the ventilation of the unconditioned zone to the outside.</p> <p>Important: In the snippet, <code>building_object</code>, <code>orient_all_zones</code>, and <code>volume_all_zones</code> are referenced but not passed. In practice you should pass the adjacent zone object (or the whole <code>BUI</code>) and extract what you need locally. The equations below describe the intended physics.</p>"},{"location":"iso_52016/#signature-as-provided","title":"Signature (as provided)","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(adj_zone, n_ue=0.5, qui=0):\n    ...\n    return H_ztu_tot, b_ztu_m\n</code></pre>"},{"location":"iso_52016/#concepts-notation","title":"Concepts &amp; Notation","text":"<ul> <li>\\(H_{tr}\\) is decomposed as: [ H_{tr} = H_d + H_g + H_u + H_a \\tag{4.9} ] with:</li> <li>\\(H_d\\): direct envelope transmission to exterior,</li> <li>\\(H_g\\): ground transmission,</li> <li>\\(H_u\\): via unconditioned space,</li> <li>\\(H_a\\): to adjacent buildings (not used here).</li> </ul>"},{"location":"iso_52016/#step-1-transmission-conditioned-unconditioned","title":"Step 1 \u2014 Transmission conditioned \u2192 unconditioned","text":"<p>For the interface between ztc and ztu: [ H_{d,zt{\\text -}ztu} = \\sum_{k \\in\\mathcal{E}_{zt{\\text -}ztu}} U_k\\,A_k \\tag{4.10} ] where the set \\(\\mathcal{E}_{zt{\\text -}ztu}\\) are elements on the shared boundary.</p>"},{"location":"iso_52016/#step-2-transmission-unconditioned-exterior","title":"Step 2 \u2014 Transmission unconditioned \u2192 exterior","text":"<p>For ztu walls not shared with ztc (i.e., exposed or to other media): [ H_{d,ztu{\\text -}ext} = \\sum_{k \\in\\mathcal{E}_{ztu{\\text -}ext}} U_k\\,A_k \\tag{4.11} ]</p>"},{"location":"iso_52016/#step-3-ventilation-of-unconditioned-zone","title":"Step 3 \u2014 Ventilation of unconditioned zone","text":"<p>ISO 13789 suggests using air change rate \\(n_{ue}\\) <code>[h\u207b\u00b9]</code> for ztu \u2192 outside. Let \\(V_u\\) <code>[m\u00b3]</code> be ztu air volume. Define: [ q_{ue} = V_u\\,n_{ue} \\quad [\\text{m}^3/\\text{h}], \\qquad q_{iu} = q_{i\\to u} \\quad [\\text{m}^3/\\text{h}] \\text{ (often set to 0 to avoid overestimation)} \\tag{4.12a} ] Use the standard \\(\\rho c\\) factor \\(\\approx 0.33\\) <code>[Wh\u00b7m\u207b\u00b3\u00b7K\u207b\u00b9]</code> for flows expressed in m\u00b3\u00b7h\u207b\u00b9: [ H_{ve,ue} = 0.33\\,q_{ue}, \\qquad H_{ve,iu} = 0.33\\,q_{iu} \\tag{4.12b} ] By default in the code: \\(q_{iu} = 0\\).</p>"},{"location":"iso_52016/#step-4-aggregate-coupling-terms","title":"Step 4 \u2014 Aggregate coupling terms","text":"<p>[ H_{ue} = H_{d,ztu{\\text -}ext} + H_{ve,ue}, \\qquad H_{iu} = H_{d,zt{\\text -}ztu} + H_{ve,iu} \\tag{4.12c} ] Total ztu coupling: [ H_{ztu,tot} = H_{iu} + H_{ue} \\tag{4.12d} ]</p> <p>Adjustment factor \\(b_{ztu,m}\\) (ISO 13789 monthly convention): [ b_{ztu,m} = \\frac{H_{ue}}{H_{ue} + H_{iu}} = \\frac{H_{ue}}{H_{ztu,tot}} \\tag{4.13} ] \\(b_{ztu,m}\\in[0,1]\\) measures how much the unconditioned zone is \u201canchored\u201d to the outside rather than to the conditioned neighbor.</p>"},{"location":"iso_52016/#output_1","title":"Output","text":"<ul> <li><code>H_ztu_tot</code> <code>[W\u00b7K\u207b\u00b9]</code> \u2014 total coupling of the unconditioned zone.</li> <li><code>b_ztu_m</code> <code>[-]</code> \u2014 monthly factor (in the current code computed once from static inputs).</li> </ul>"},{"location":"iso_52016/#practical-extraction-with-your-bui-structure","title":"Practical extraction with your <code>BUI</code> structure","text":"<ul> <li>For a given unconditioned zone <code>adj_i</code>:</li> <li>Build sets:<ul> <li>\\(\\mathcal{E}_{zt{\\text -}ztu}\\): elements in <code>adj_i</code> whose <code>orientation_elements</code> match the interface direction to the conditioned zone (your code uses equality tests by <code>NV/SV/EV/WV/HOR</code>).</li> <li>\\(\\mathcal{E}_{ztu{\\text -}ext}\\): elements in <code>adj_i</code> not on the interface.</li> </ul> </li> <li>Use <code>adj_i.volume</code> \u2192 \\(V_u\\).  </li> <li>Pick <code>n_ue</code> from <code>df_n_ue</code> by air-tightness class or keep default <code>0.5 h\u207b\u00b9</code>.</li> </ul>"},{"location":"iso_52016/#algorithm-pseudo-robust-version","title":"Algorithm (pseudo; robust version)","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(BUI, adj_zone_name, n_ue=0.5, qui=0):\n    adj = get_adj_zone(BUI, adj_zone_name)\n    A = np.asarray(adj[\"area_facade_elements\"], dtype=float)\n    U = np.asarray(adj[\"transmittance_U_elements\"], dtype=float)\n    ORI = np.asarray(adj[\"orientation_elements\"])\n    # Define which orientations correspond to zt-ztu interface (project specific rule):\n    mask_interface = is_interface_to_conditioned_zone(ORI, adj, BUI)   # boolean mask\n    Hd_zt_ztu  = float(np.sum(A[mask_interface] * U[mask_interface]))   # Eq. (4.10)\n    Hd_ztu_ext = float(np.sum(A[~mask_interface] * U[~mask_interface])) # Eq. (4.11)\n\n    # Ventilation terms (Eq. 4.12)\n    Vu = float(adj[\"volume\"])\n    que = Vu * n_ue\n    Hve_ue = 0.33 * que\n    Hve_iu = 0.33 * float(qui)\n\n    Hue = Hd_ztu_ext + Hve_ue\n    Hiu = Hd_zt_ztu + Hve_iu\n    Hztu_tot = Hue + Hiu                                 # Eq. (4.12d)\n    b_ztu_m  = Hue / Hztu_tot if Hztu_tot &gt; 0 else 1.0   # Eq. (4.13)\n    return float(Hztu_tot), float(b_ztu_m)\n</code></pre>"},{"location":"iso_52016/#edge-cases","title":"Edge Cases","text":"<ul> <li>If <code>A</code>/<code>U</code> vectors contain dtype=object (as in your snippet), cast explicitly to <code>float</code>.</li> <li>If <code>Hztu_tot = 0</code> (degenerate geometry), define <code>b_ztu_m = 1.0</code> by convention (fully outdoor-anchored).</li> </ul>"},{"location":"iso_52016/#5-multizone-adjacent-zone-coupling-computational-flow","title":"5) Multizone &amp; Adjacent-Zone Coupling \u2014 Computational Flow","text":"<pre><code>graph TD\n  A[BUI dict] --&gt; B(global_inputs.py)\n  A --&gt; C(generate_profile.py)\n  A --&gt; D(ventilation.py)\n\n  C --&gt; C1[Hourly profiles h_* (0..1)]\n  B --&gt; D1[df_n_ue, constants]\n  D1 --&gt; D3\n  C1 --&gt; D2\n\n  subgraph Ventilation &amp; Gains (ventilation.py)\n    D2[heat_transfer_coefficient_by_ventilation]\\nH_ve via ISO 16798-7 or occupancy\n    D3[transmission_heat_transfer_coefficient_ISO13789]\\nH_ztu_tot, b_ztu_m\n    D4[internal_gains]\\nPhi_int with optional adj-zone spillover\n  end\n\n  D2 --&gt; E[H_ve (W/K)]\n  D3 --&gt; F[b_ztu_m (-)]\n  D4 --&gt; G[Phi_int (W)]\n\n  %% (Future) Energy balance solver (not in scope here)\n  E --&gt; H[(Future: ISO 52016 solver)]\n  F --&gt; H\n  G --&gt; H</code></pre>"},{"location":"iso_52016/#6-variable-glossary-selected","title":"6) Variable Glossary (selected)","text":"Symbol / Name Meaning Units \\(T_z\\), <code>Tz</code> Zone air temperature (indoor) \u00b0C \\(T_e\\), <code>Te</code> Outdoor air temperature \u00b0C \\(u_{site}\\) Site wind speed at window height (per ISO assumptions) m\u00b7s\u207b\u00b9 \\(h_p\\) Parapet height m \\(h_w\\) Window height m \\(h_{path}\\) Window vertical center above floor m \\(h_{w,st}\\) Useful stack height for airing m \\(A_{w,i}\\) Geometric area of window \\(i\\) m\u00b2 \\(R_{w,i}\\) Opening ratio window \\(i\\) \u2013 \\(A_{w,tot}\\) Sum of openable window areas m\u00b2 \\(\\rho_{a,ref}\\) Reference indoor air density kg\u00b7m\u207b\u00b3 \\(\\rho_{a,e}\\) Outdoor density at \\(T_e\\) kg\u00b7m\u207b\u00b3 \\(q_v\\) Airing volumetric flow (single-sided) m\u00b3\u00b7h\u207b\u00b9 \\(H_{ve}\\) Ventilation heat transfer coefficient W\u00b7K\u207b\u00b9 \\(U_k\\) Thermal transmittance of element \\(k\\) W\u00b7m\u207b\u00b2\u00b7K\u207b\u00b9 \\(V_u\\) Air volume of unconditioned zone m\u00b3 \\(n_{ue}\\) Air change rate ztu\u2013exterior h\u207b\u00b9 \\(q_{ue}\\) Flow ztu\u2013exterior \\(=V_u n_{ue}\\) m\u00b3\u00b7h\u207b\u00b9 \\(H_{ve,ue}\\) Vent. conductance ztu\u2013exterior W\u00b7K\u207b\u00b9 \\(H_{d,zt{\\text -}ztu}\\) Transmission cond\u2192uncond W\u00b7K\u207b\u00b9 \\(H_{d,ztu{\\text -}ext}\\) Transmission uncond\u2192ext W\u00b7K\u207b\u00b9 \\(H_{ztu,tot}\\) Total ztu coupling W\u00b7K\u207b\u00b9 \\(b_{ztu,m}\\) Adjustment factor of ztu \u2013 \\(\\Phi_{int}\\) Internal gains (sensible) W \\(q_{occ}, q_{app}\\) Gains densities (occ/app) W\u00b7m\u207b\u00b2"},{"location":"iso_52016/#7-implementation-notes-robustness","title":"7) Implementation Notes &amp; Robustness","text":"<ul> <li>Type safety: many arrays in <code>BUI</code> are <code>dtype=object</code>. Cast to <code>np.asarray(..., dtype=float)</code> before algebra.</li> <li>Orientation logic: To identify interface elements for \\(H_{d,zt{\\text -}ztu}\\), define a clear mapping between <code>building_surface[*].name_adj_zone</code> and the <code>adjacent_zones[*].name</code> and use that to split \\(\\mathcal{E}_{zt{\\text -}ztu}\\) vs \\(\\mathcal{E}_{ztu{\\text -}ext}\\). Avoid relying only on cardinal labels like <code>NV/SV/...</code> when adjacency is explicit in the <code>BUI</code>.</li> <li>Energy conservation: The current <code>internal_gains</code> implementation adds spillover per adjacent zone. If you need strict conservation, change Eq. (4.8) to a partitioning where the sum of delivered gains across all coupled domains equals the source generation.</li> <li>Units consistency: Eq. (4.12b) uses the common shortcut <code>0.33</code> <code>[Wh\u00b7m\u207b\u00b3\u00b7K\u207b\u00b9]</code> for flows in m\u00b3\u00b7h\u207b\u00b9. If you operate on SI <code>[s]</code>, convert accordingly \\( \\frac{\\rho c}{3600} \\).</li> <li>Altitude: The simple density correction used in Eq. (4.2) is adequate for building simulation. For high-altitude sites you may want a full barometric formula.</li> </ul>"},{"location":"iso_52016/#8-worked-example-hooks-with-your-bui","title":"8) Worked Example Hooks (with your <code>BUI</code>)","text":"<p>Below is a minimal sketch showing how to call the three core functions consistently with your schema.</p> <pre><code># Pseudocode (assumes the functions accept BUI as 'building_object')\nfrom ventilation import VentilationInternalGains, transmission_heat_transfer_coefficient_ISO13789\n\n# --- Ventilation H_ve (ISO airing)\nTz = 20.0   # \u00b0C\nTe = 5.0    # \u00b0C\nu  = 2.5    # m/s\nHve = VentilationInternalGains.heat_transfer_coefficient_by_ventilation(\n    building_object=BUI, Tz=Tz, Te=Te, u_site=u, type_ventilation=\"temp_wind\"\n)\n\n# --- Internal gains (W)\nPhi_int = VentilationInternalGains.internal_gains(\n    building_type_class=BUI[\"building\"][\"building_type_class\"],\n    a_use=BUI[\"building\"][\"net_floor_area\"],\n    unconditioned_zones_nearby=True,\n    list_adj_zones=len(BUI[\"adjacent_zones\"]),   # pass an int here\n    Fztc_ztu_m=1.0,\n    b_ztu=0.6,\n    h_occup=0.8, h_app=0.6\n)\n\n# --- Adjacent zone coupling (W/K) for 'adj_1'\nHztu_tot_1, b_ztu_1 = transmission_heat_transfer_coefficient_ISO13789(\n    adj_zone=BUI[\"adjacent_zones\"][0],  # or pass BUI + name, per your refactor\n    n_ue=0.5, qui=0.0\n)\n</code></pre>"},{"location":"iso_52016/#9-testing-checklist","title":"9) Testing Checklist","text":"<ul> <li>No windows \u2192 <code>H_ve=0</code> (temp_wind branch).</li> <li>All <code>Rw_arg_i=0</code> \u2192 <code>H_ve=0</code>.</li> <li>High wind, small \u0394T vs low wind, high \u0394T \u2192 Eq. (4.4) switches between wind/stack terms.</li> <li><code>n_ue</code> sweep (0.1 \u2192 10 h\u207b\u00b9) increases \\(H_{ve,ue}\\) linearly, thus \\(b_{ztu,m}\\) approaches 1.</li> <li><code>qui&gt;0</code> lifts \\(H_{iu}\\), thus \\(b_{ztu,m}\\downarrow\\).</li> <li>Profiles: Verify daily cycles in <code>generate_profile.py</code> and holiday flips.</li> </ul>"},{"location":"iso_52016/#10-known-gaps-future-improvements","title":"10) Known Gaps (future improvements)","text":"<ul> <li>Window cross-ventilation and leakage paths in <code>ventilation.py</code> (not yet implemented).</li> <li>Mechanical ventilation (specific supply/exhaust flow schedule) placeholder.</li> <li>Transparent interface terms in <code>ISO13789</code> when the partition is glazed.</li> <li>Time-varying \\(b_{ztu,m}\\) (currently returned as a scalar unless you process it per month).</li> </ul>"},{"location":"iso_52016_input_check/","title":"ISO 52016 Input Check","text":"<p>The data provided before being used for the simulation are processed and evaluated to be considered fit for the simulation. This process includes a series of checks that allow to identify any potential errors.  The following controls are applied:</p>"},{"location":"iso_52016_input_check/#thermal-and-adjacent-zone","title":"Thermal and Adjacent Zone","text":"<p>Uno degli errori pi\u00f9 caratteristici pu\u00f2 essere quello di immetere dei valori errati di superficie della parete di confine tra la zona termica e la zona non termica. Un esempio \u00e8 quello di dare dei valori pi\u00f9 alti della superificie della parete nella zona non termica rispetto alla superificie della parete nella zona termica. In questo caso se il controllo risulta essere negativo allora il tool imposta il valore del superificie della zona non termica uguale a quello della zona termica.  Qui voglio dire che sebbene la superficie di contatto \u00e8 la stessa pu`o succedere che la parete della zona termica sia o totlamente a contatto con la zon non termica o solamente una parte a contatto con la zona termica   </p>"},{"location":"iso_52016_input_check/#quality-check-of-system-inputs","title":"Quality check of system inputs:","text":""},{"location":"iso_52016_input_check/#check_heating_system_inputs-function","title":"<code>check_heating_system_inputs</code> Function","text":"<p>This function validates and normalizes the input configuration for the heating system. It performs the following checks:</p> <ol> <li>TB14 Table: </li> <li>If a custom <code>TB14</code> DataFrame is provided, it is used.</li> <li> <p>Otherwise, the default <code>TB14</code> from <code>global_inputs.py</code> is used.</p> </li> <li> <p>Emitter Type Validation:</p> </li> <li> <p>If the <code>emitter_type</code> is not found in the selected <code>TB14</code> table, it is automatically set to the first available emitter type, and a warning message is generated.</p> </li> <li> <p>Generator Flow Temperature Control Type (<code>gen_flow_temp_control_type</code>):</p> </li> <li>Type A: Requires <code>gen_outdoor_temp_data</code> as a DataFrame. If not provided, it switches to <code>Type B</code> and generates a warning.</li> <li>Type C: If <code>\u03b8HW_gen_flw_const</code> is not provided, it defaults to <code>50</code> and a warning is shown.</li> <li>Invalid Control Type: Any other values are automatically set to <code>Type B</code>.</li> </ol> <p>The function returns: - The selected <code>TB14</code> table. - The validated <code>emitter_type</code>. - A list of messages about any changes or validations. - The normalized input configuration.</p>"},{"location":"it/home/","title":"pybuildingenergy","text":"<p>Welcome to pybuildingenergy documentation!</p> <p>..</p>"},{"location":"it/iso_15316/","title":"Introduction to ISO 15316-1 / EN 15316-1","text":""},{"location":"it/iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> System Application Control Parameters Radiators Heating curve, flow/return \u0394\u03b8 Heating panel Heating curve, flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"it/iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design temperature flow return \u0394\u03b8 - nominal delta T water \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-50 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours maximum Distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"it/iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"it/iso_15316_system_inputs/","title":"ISO 15316 - HVAC System inputs","text":""},{"location":"it/iso_15316_system_inputs/#system-inputs","title":"SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"it/iso_15316_system_inputs/#emitter","title":"EMITTER","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li> <p>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</p> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0"},{"location":"it/iso_15316_system_inputs/#generator","title":"GENERATOR","text":""},{"location":"it/iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <p>1) 'simple'       : linear heuristic vs. return temperature 2) 'parametric'   : piecewise/threshold model 3) 'manufacturer' : 1D (return) or 2D (flow/return) map</p> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic </p> <p>Example of input systems:  <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n}\n</code></pre></p>"},{"location":"home/","title":"Home","text":"<p>Please cite us if you use this library:  </p>    Introduction: EPBD Requirements for ISO 52000 and ISO 15316 Standards  Note:  !!! New version available !!! New features:  - Calculation of multizona considering adiabiatic walls between zones with the same use destination - Calculation with non heated zones  -"},{"location":"home/#iso-52000-overarching-standards","title":"ISO 52000 - Overarching Standards","text":"<p>The EPBD Directive 2018 (and confirmed in the 2024 revision) requires Member States to describe their national calculation methodology following the national annexes of the \"overarching\" standards, namely: ISO 52000-1, 52003-1, 52010-1, 52016-1, and 52018-1, developed under mandate M/480 given to CEN (European Committee for Standardization).</p> <p>Important: This provision does not constitute mandatory legal codification of these standards. However, the obligation to describe the national methodology following the annexes of the overarching standards will push Member States to explain where and why they deviate from these standards, leading to greater recognition and promotion of the EPB standards set.</p> <p>The ISO 52000 overarching standards are:</p> <ol> <li>ISO 52000-1: General framework and procedures for EPB assessment</li> <li>ISO 52003-1: Indicators, requirements, ratings and certificates</li> <li>ISO 52010-1: Internal environmental parameters</li> <li>ISO 52016-1: Internal temperatures and energy needs for heating/cooling</li> <li>ISO 52018-1: Indicators for overall energy performance</li> </ol>"},{"location":"home/#new-epbd-recast-methodology","title":"New EPBD Recast Methodology","text":"<p>The new EPBD recast provides an update on building performance assessment through a methodology that must consider various factors such as the building\u2019s thermal characteristics, the use of renewable energy sources, building automation and control systems, ventilation, cooling, energy recovery, etc. The methodology should represent actual operating conditions, use measured energy for accuracy and comparability, and be based on hourly or sub-hourly intervals to account for variable conditions significantly impacting system performance, including internal conditions.</p> <p>The energy performance of a building shall be expressed by a numeric indicator of primary energy use per unit of reference floor area per year, in kWh/(m\u00b2.y), for energy performance certification and compliance with minimum energy performance requirements. Numeric indicators of final energy use per unit of reference floor area per year, in kWh/(m\u00b2.y), and energy needs according to ISO 52000 in kWh/(m\u00b2.y) shall also be used. The applied methodology for determining energy performance must be transparent, open to innovation, and reflect best practices, particularly from additional indicators.</p> <p>Member States shall describe their national calculation methodology based on Annex A of the key European standards on energy performance of buildings.</p>"},{"location":"home/#en-15316-heating-and-cooling-systems","title":"EN 15316 - Heating and Cooling Systems","text":"<p>The EN 15316 series covers the calculation method for system energy requirements and system efficiencies. This family of standards is an integral part of the EPB set and covers:</p>"},{"location":"home/#en-15316-modular-structure","title":"EN 15316 Modular Structure:","text":"<ul> <li>EN 15316-1: General and expression of energy performance (Modules M3-1, M3-4, M3-9, M8-1, M8-4)</li> <li>EN 15316-2: Emission systems (heating and cooling)</li> <li>EN 15316-3: Distribution systems (DHW, heating, cooling)</li> <li>EN 15316-4-X: Heat generation systems:<ul> <li>4-1: Combustion boilers</li> <li>4-2: Heat pumps</li> <li>4-3: Solar thermal and photovoltaic systems</li> <li>4-4: Cogeneration systems</li> <li>4-5: District heating</li> <li>4-7: Biomass</li> </ul> </li> <li>EN 15316-5: Storage systems</li> </ul> <p>For space heating, applicable standards include EN 15316-1, EN 15316-2-1, EN 15316-2-3 and the appropriate parts of EN 15316-4 depending on the system type, including losses and control aspects.</p>"},{"location":"home/#relationship-between-epbd-2024-and-standards","title":"Relationship between EPBD 2024 and Standards","text":"<p>The most recent revision of the EPBD was published in May 2024, further strengthening requirements and aligning with the EU's climate neutrality objectives. Member States are encouraged to consider applicable standards, particularly from the EPB standards list.</p> <p>17 of approximately 50 EPB standards are already EN ISO standards, resulting from collaboration between CEN and ISO. The other EPB standards are currently only available at the European level (CEN standards).</p>"},{"location":"home/#pybuildingenergy-the-python-library-for-building-performance-assessment","title":"pyBuildingEnergy: the python library for building performance assessment","text":"<p>pyBuildingEnergy aims to provide an assessment of building performance both in terms of energy and comfort. In this initial release, it is possible to assess the energy performance of the building using ISO 52106-1:2018. Additional modules will be added for a more comprehensive evaluation of performance, assessing ventilation, renewable energies, systems, etc. The actual calculation methods for the assessment of building performance are the following:</p> <ul> <li> <p>[x] the (sensible) energy need for heating and cooling, based on hourly or monthly calculations;</p> </li> <li> <p>[ ] the latent energy need for (de-)humidification, based on hourly or monthly calculations;</p> </li> <li> <p>[x] the internal temperature, based on hourly calculations;</p> </li> <li> <p>[x] the sensible heating and cooling load, based on hourly calculations;</p> </li> <li> <p>[ ] the moisture and latent heat load for (de-)humidification, based on hourly calculations;</p> </li> <li> <p>[ ] the design sensible heating or cooling load and design latent heat load using an hourly calculation interval;</p> </li> <li> <p>[ ] the conditions of the supply air to provide the necessary humidification and dehumidification.</p> </li> </ul> <p>The calculation methods can be used for residential or non-residential buildings, or a part of it, referred to as \"the building\" or the \"assessed object\". ISO 52016-1:2018 also contains specifications for the assessment of thermal zones in the building or in the part of a building. The calculations are performed per thermal zone. In the calculations, the thermal zones can be assumed to be thermally coupled or not. ISO 52016-1:2018 is applicable to buildings at the design stage, to new buildings after construction and to existing buildings in the use phase</p>"},{"location":"home/#weather-data","title":"Weather Data","text":"<p>The tool can use wather data coming from 2 main sources:</p> <ul> <li>pvgis api (https://re.jrc.ec.europa.eu/pvg_tools/en/) - PHOTOVOLTAIC GEOGRAPHICAL INFORMATION SYSTEM</li> <li>.epw file from https://www.ladybug.tools/epwmap/</li> </ul> <p>More details in the example folder</p>"},{"location":"home/#domestic-hot-water-dhw","title":"Domestic Hot Water - DHW","text":"<ul> <li>[x] Calculation of volume and energy need for domestic hot water according to ISO 12831-3. </li> <li>[] Assessment of thermal load based on the type of DHW system</li> </ul>"},{"location":"home/#limitations","title":"Limitations","text":"<p>The library is developed with the intent of demonstrating specific elements of calculation procedures in the relevant standards. It is not intended to replace the regulations but to complement them, as the latter are essential for understanding the calculation.  This library is meant to be used for demonstration and testing purposes and is therefore provided as open source, without protection against misuse or inappropriate use.</p> <p>The information and views set out in this document are those of the authors and do not necessarily reflect the official opinion of the European Union. Neither the European Union institutions and bodies nor any person acting on their behalf may be held responsible for the use that may be made of the information contained herein.</p>"},{"location":"home/#getting-started","title":"Getting Started","text":"<p>The following command will install the latest pyBuildinEnergy library</p> <pre><code>    pip install pybuildingenergy\n</code></pre> <p>The tool allows you to evaluate the performance of buildings in different ways: </p>"},{"location":"home/#building-inputs","title":"Building Inputs","text":"<p>.. list-table:: Building geometry data * general    :widths: 20 20 40 10 10     :header-rows: 1</p> <ul> <li> <ul> <li>Parameter</li> <li>Key</li> <li>Description</li> <li>Unit</li> <li>Mandatory</li> </ul> </li> <li> <ul> <li>Latitude</li> <li>latitude</li> <li>latitude of the building in [decimal] </li> <li>[-]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Longitude</li> <li>longitude</li> <li>longitude of the building location [decimal]</li> <li>[-].</li> <li>YES</li> </ul> </li> <li> <ul> <li>Coldest month</li> <li>coldest_month</li> <li>Define the coldest month of the building location. Value from 1 (January) to 12 (December)</li> <li>[-].</li> <li>YES. Default: 1</li> </ul> </li> <li> <ul> <li>Gross building area</li> <li>a_use</li> <li>gross floor area of the building</li> <li>[m2]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Slab on ground area </li> <li>slab_on_ground_area</li> <li>Ground floor gross area</li> <li>[m2]</li> <li>If not provided, the slab on ground are is calculated as useful area / number of floors</li> </ul> </li> <li> <ul> <li>Number of floors</li> <li>number_of_floor</li> <li>Number of building floors </li> <li>[-]</li> <li>YES/NO if number of floors is provided</li> </ul> </li> <li> <ul> <li>Building perimeter</li> <li>exposed_perimeter</li> <li>perimeter of the building</li> <li>[m]</li> <li>YES/NO iIf not provided, the perimeter is calculated as if the building were rectangular with one side being 10 meters</li> </ul> </li> <li> <ul> <li>Building height</li> <li>height</li> <li>external height of the building</li> <li>[m]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Average thickness of wall</li> <li>wall_thickness</li> <li>average thickness of building walls </li> <li>[m]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Surface of envelope</li> <li>surface_envelope</li> <li>gross volume of the building </li> <li>[m3]</li> <li>If not provided the volume is calcuated as the slab on ground area * building height</li> </ul> </li> <li> <ul> <li>Volume</li> <li>volume</li> <li>gross volume of the building </li> <li>[m3]</li> <li>If not provided the volume is calcuated as the slab on ground area * building height</li> </ul> </li> <li> <ul> <li>Annual mean internal temperature</li> <li>annual_mean_internal_temperature</li> <li>the annual mean internal temperature is the average between Heating and Cooling setpoints</li> <li>[\u00b0C]</li> <li>NO: if not provided, it is calculated.</li> </ul> </li> <li> <ul> <li>Annual mean external temperature</li> <li>annual_mean_external_temperature</li> <li>Annual mean axternal temperature of the building location</li> <li>[\u00b0C]</li> <li>NO: if not provided, it is calculated.</li> </ul> </li> <li> <ul> <li>Heating system</li> <li>heating_mode</li> <li>True if heating system is installed, False if not.</li> <li>[True or False]</li> <li>YES</li> </ul> </li> <li> <ul> <li>Cooling system</li> <li>cooling-mode</li> <li>True if heating system is installed, False if not.</li> <li>[True or False]</li> <li>YES </li> </ul> </li> <li> <ul> <li>Heating setpoint</li> <li>heating_setpoint</li> <li>Temperature set-point of the heating system</li> <li>[\u00b0C]</li> <li>YES. If <code>heating_mode</code> is True</li> </ul> </li> <li> <ul> <li>Cooling setpoint</li> <li>cooling_setpoint</li> <li>Temperature set-point of the cooling system</li> <li>[\u00b0C]</li> <li>YES. If <code>cooling_mode</code> is True</li> </ul> </li> <li> <ul> <li>Heating setback</li> <li>heating_setback</li> <li>Temperature set-back of the heating system</li> <li>[\u00b0C]</li> <li>YES. If <code>heating_mode</code> is True</li> </ul> </li> <li> <ul> <li>Cooling setback</li> <li>cooling_setback</li> <li>Temperature set-back of the cooling system</li> <li>[\u00b0C]</li> <li>YES. If <code>cooling_mode</code> is True</li> </ul> </li> <li> <ul> <li>Max power of heating generator</li> <li>power_heating_max</li> <li>max power of heating generator</li> <li>[W]</li> <li>YES. If <code>heating_mode</code> is True</li> </ul> </li> <li> <ul> <li>Max power of cooling generator</li> <li>power_cooling_max</li> <li>max power of cooling generator</li> <li>[W]</li> <li>YES. If <code>cooling_mode</code> is True</li> </ul> </li> <li> <ul> <li>Air change rate</li> <li>air_change_rate_base_value</li> <li>value of air chnage rate</li> <li>[m3/h*m2]</li> <li>Yes</li> </ul> </li> <li> <ul> <li>Air change rate extra</li> <li>air_change_rate_extra</li> <li>extra value of air change rate, in specific period according to the occupancy profile</li> <li>[m3/h*m2]</li> <li>Yes</li> </ul> </li> <li> <ul> <li>Internal Gains</li> <li>internal_gains_base_value</li> <li>power of internal gains </li> <li>[W/m2] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Extra Internal Gains</li> <li>internal_gains_base_value</li> <li>extra value of internal gains, in specific period according to the occupancy profile</li> <li>[W/m2] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Thermal bridges</li> <li>thermal_bridge_heat</li> <li>Overall heat transfer coefficient for thermal bridges (without groud floor)</li> <li>[W/K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Thermal resistance of floor</li> <li>thermal_resistance_floor</li> <li>Average thermal resistance of internal floors</li> <li>[m2K/W] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Facade elements type</li> <li>typology_elements</li> <li>List of all facade elements (Walls, Roof, Ground Floor, Windows).For:<ul> <li>Wall, Roof use: \"OP\" (Opaque elements)</li> <li>Ground Floor: use \"GF\" (Ground Floor)</li> <li>Windows: use \"W\" (Windows)</li> </ul> </li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Orienation of facade elements</li> <li>orientation_elements</li> <li>For each elements of the facade provide the orientation, according to the following abbreviations:<ul> <li>NV: North Vertical</li> <li>SV: South Vertical</li> <li>EV: East Vertical</li> <li>WV: West Vertical</li> <li>HOR: Horizontal/Slope (for roof and ground floor)</li> </ul> </li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Solar absorption coefficients</li> <li>solar_abs_elements</li> <li>Solar absorption coefficient of external (Opaque) facade elements (e.g. walls)</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Area of facade elements</li> <li>area_elements</li> <li>Area of each facade element (e.g. Wall, Window, etc.)</li> <li>[m2] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Transmittance - U</li> <li>transmittance_U_elements</li> <li>Transmiattance of each facade element.</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Resistance - U</li> <li>thermal_resistance_R_elements</li> <li>Theraml Resistance of each facade element. </li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Thermal capacity - k</li> <li>thermal_resistance_R_elements</li> <li>Addition of the heat capacity of each layer (i.e. calculated by multiplying the density times its thickness times the SHC of the material)</li> <li>[J/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>g-value</li> <li>g_factor_windows</li> <li>solar energy transmittance of windows</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Heat radiative transfer coefficient - internal</li> <li>heat_convective_elements_internal</li> <li>convective heat transfer coefficient internal surface for each element</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Heat convective transfer coefficient - external</li> <li>heat_convective_elements_external</li> <li>convective heat transfer coefficient external surface for each element</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Heat radiative transfer coefficient - internal</li> <li>heat_radiative_elements_internal</li> <li>radiative heat transfer coefficient internal surface for each element</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Heat radiative transfer coefficient - external</li> <li>heat_radiative_elements_external</li> <li>radiative heat transfer coefficient external surface for each element</li> <li>[W/m2K] </li> <li>YES</li> </ul> </li> <li> <ul> <li>View factor</li> <li>sky_factor_elements</li> <li>View factor between building element and the sky</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Occupancy profile workdays - internal_gains rate</li> <li>comf_level_we</li> <li>Occupancy profile for workdays to evalaute the utilization of extra internal gains</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Occupancy profile weekends - internal_gains rate</li> <li>comf_level_we</li> <li>Occupancy profile for weekdays to evalaute the utilization of extra internal gains</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Occupancy profile workdays - airflow rate</li> <li>comf_level_we</li> <li>Occupancy profile for workdays to evalaute the utilization of extra air change rate</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Occupancy profile weekend - airflow rate</li> <li>comf_level_we</li> <li>Occupancy profile for weekend to evalaute the utilization of extra air change rate</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Class of buidling construction</li> <li>construction_class</li> <li>Distribution of the mass for opaque elements (vertical - walls and horizontal - floor/roof) as described in Table B.13 of ISO52016. Possible choices: class_i, class_e, class_ie, class_d</li> <li>[-] </li> <li>YES</li> </ul> </li> <li> <ul> <li>Weather source</li> <li>weather_source</li> <li>In English, it would be: \"Select which type of source to use for weather data. Choose 'pvgis' for connecting to the <code>pvgis &lt;https://re.jrc.ec.europa.eu/pvg_tools/en/&gt;</code> or 'epw' file if using an epw file, to be download from <code>here &lt;https://www.ladybug.tools/epwmap/&gt;</code></li> <li>[-] </li> <li>YES</li> </ul> </li> </ul> <p>More information about coefficients are available <code>here &lt;https://github.com/EURAC-EEBgroup/pyBuildingEnergy/tree/master/src/pybuildingenergy/data&gt;</code></p>"},{"location":"home/#documentation","title":"Documentation","text":"<p>Check our new documentation here:https://eurac-eebgroup.github.io/pybuildingenergy-docs/ and here: https://pybuildingenergy.readthedocs.io/en/latest/</p>"},{"location":"home/#example","title":"Example","text":"<p>Here some <code>Examples &lt;https://github.com/EURAC-EEBgroup/pyBuildingEnergy/tree/master/examples&gt;</code> on pybuildingenergy application. For more information .....</p>"},{"location":"home/#contributing-and-support","title":"Contributing and Support","text":"<p>Bug reports/Questions If you encounter a bug, kindly create a GitLab issue detailing the bug.  Please provide steps to reproduce the issue and ideally, include a snippet of code that triggers the bug.  If the bug results in an error, include the traceback. If it leads to unexpected behavior, specify the expected behavior.</p> <p>Code contributions We welcome and deeply appreciate contributions! Every contribution, no matter how small, makes a difference. Click here to find out more about contributing to the project.</p>"},{"location":"home/#acknowledgment","title":"Acknowledgment","text":"<p>This work was carried out within European projects:  Infinite - This project has received funding from the European Union\u2019s Horizon 2020 research and innovation programme under grant agreement No 958397,  Moderate - Horizon Europe research and innovation programme under grant agreement No 101069834,  with the aim of contributing to the development of open products useful for defining plausible scenarios for the decarbonization of the built environment</p> <p>Reagrding the DHW Calculation:  The work was developed using the regulations and results obtained from the spreadsheet created by the EPBCenter.</p>"},{"location":"home/#references","title":"References","text":"<ol> <li>EPB Center - The Energy Performance of Buildings Directive (EPBD)    https://epb.center/epb-standards/the-energy-performance-of-buildings-directive-epbd/</li> <li>REHVA Journal - \"The new EN ISO 52000 family of standards to assess the energy performance of buildings put in practice\"    https://www.rehva.eu/rehva-journal/chapter/the-new-en-iso-52000-family-of-standards-to-assess-the-energy-performance-of-buildings-put-in-practice</li> <li>European Commission - Energy Performance of Buildings Directive    https://energy.ec.europa.eu/topics/energy-efficiency/energy-performance-buildings/energy-performance-buildings-directive_en</li> <li>Directive (EU) 2024/1275 - Official text published in the Official Journal of the EU on May 8, 2024</li> <li>EN ISO 52010-1:2018 - Energy performance of buildings - External climatic conditions - Part 1: Conversion of climatic data for energy calculations</li> <li>EN ISO 52016-1:2018 - Energy performance of buildings - Energy needs for heating and cooling, internal temperatures and sensible and latent heat loads </li> <li>EN ISO 12831-3:2018 - Energy performance of buildings - Method for calculation of the design heat load - Part 3: Domestic hot water systems heat load and characterisation of needs, Module M8-2, M8-3</li> <li>Directive (EU) 2024/1275 - Official text published in the Official Journal of the EU on May 8, 2024</li> </ol>"},{"location":"home/#authors-daniele-antonucci-ulrich-filippi-oberegger","title":"Authors: Daniele Antonucci, Ulrich Filippi Oberegger","text":"<p>License: MIT Version: 0.2 Maintainer: Daniele Antonucci</p>"},{"location":"iso_15316/","title":"Introduction to EN ISO 15316-1","text":""},{"location":"iso_15316/#overview","title":"Overview","text":"<p>ISO 15316-1 (equivalent to EN 15316-1 in Europe) defines the framework and general principles for calculating the energy performance of building heating and domestic hot water systems. It provides a systematic, modular approach that allows engineers, researchers, and software tools to evaluate and compare energy efficiency across different system configurations.</p> <p>This standard is part of the broader Energy Performance of Buildings (EPB) suite developed under the EU Energy Performance of Buildings Directive (EPBD).</p>"},{"location":"iso_15316/#scope","title":"Scope","text":"<p>The standard covers water-based heating and DHW systems where heat is generated, distributed, and emitted to maintain indoor comfort. It applies to: - Emission systems (radiators, floor heating, fan coils, etc.) - Distribution systems (piping, manifolds, circulation) - Storage components (thermal buffers, DHW tanks) - Generation systems (boilers, heat pumps, cogeneration)</p> <p>It does not include ventilation-only or purely air-based systems, except when heated by water circuits.</p>"},{"location":"iso_15316/#methodological-structure","title":"Methodological Structure","text":"<p>EN 15316-1 introduces a modular structure, dividing the entire heating system into interconnected subsystems:</p> <ol> <li>Emission (C.2\u2013C.5) \u2013 heat transfer from water to the indoor space  </li> <li>Distribution \u2013 transport of heat through pipes, including losses and auxiliaries  </li> <li>Storage \u2013 intermediate energy buffering or recovery  </li> <li>Generation \u2013 production of useful heat from a fuel or electricity source  </li> </ol> <p>Each module has its own energy balance:</p> \\[ \\text{Energy In} = \\text{Useful Output} + \\text{Losses} - \\text{Recoverable Losses} - \\text{Auxiliaries} \\] <p>The calculation proceeds in the direction:</p> \\[ \\text{Energy Needs (Building)} \\rightarrow \\text{Delivered Heat (Emission)} \\rightarrow \\text{Distribution} \\rightarrow \\text{Generation} \\rightarrow \\text{Primary Energy Input} \\] <p>This enables transparent energy tracking and consistent efficiency assessment across technologies.</p>"},{"location":"iso_15316/#objectives","title":"Objectives","text":"<p>The main objectives of ISO 15316-1 are to: - Provide a consistent calculation structure for all sub-systems in heating and DHW installations. - Define input and output data exchange between modules. - Enable comparability between different system types (e.g., boilers vs. heat pumps). - Serve as the reference method for EPB-compliant national calculation procedures.</p>"},{"location":"iso_15316/#key-principles","title":"Key Principles","text":"<ul> <li>System boundary definition \u2013 explicit separation of emission, distribution, storage, and generation.  </li> <li>Energy flow consistency \u2013 all sub-systems connect via clear input/output relationships.  </li> <li>Recoverable vs. non-recoverable losses \u2013 internal gains can offset building demand.  </li> <li>Auxiliary energy \u2013 electric or mechanical support energy is always accounted for.  </li> <li>Adaptability \u2013 compatible with both monthly and hourly calculation time steps.</li> </ul>"},{"location":"iso_15316/#benefits","title":"Benefits","text":"<ul> <li>Harmonized methodology for energy performance certificates, design tools, and research.  </li> <li>Facilitates diagnostic comparison of subsystems (e.g., identifying excessive distribution losses).  </li> <li>Supports policy implementation under EPBD and national building codes.  </li> <li>Enhances reproducibility and transparency in simulation and benchmarking.</li> </ul>"},{"location":"iso_15316/#relationship-with-subsequent-parts","title":"Relationship with Subsequent Parts","text":"<p>Part 1 provides the general framework only. Detailed formulas and reference values for each sub-system are defined in:</p> <ul> <li>EN 15316-2 \u2013 Emission and control (M3-5) </li> <li>EN 15316-3 \u2013 Distribution and control (M3 -6)  </li> <li>EN 15316-4 \u2013 Generation systems (M3-8) for different generator: <ul> <li>EN 15316-4-1 \u2013 Combustion boilers (M3-8-1) </li> <li>EN 15316-4-2 \u2013 Heat pumps (M3-8-2) </li> <li>EN 15316-4-3 \u2013 Thermal solar and photovoltaic (M3-8-3) </li> <li>EN 15316-4-4 \u2013 On-site cogeneration (M3-8-4) </li> <li>EN 15316-4-5 \u2013 District Heating and Cooling (M3-8-5) </li> <li>EN 15316-4-9 \u2013 Direct electrical heater (M3-8-6) </li> <li>EN 15316-4-8 \u2013 Radiant heating and stoves (M3-8-8) </li> </ul> </li> <li>EN 15316-5 \u2013 Storage and control (M3-7)  </li> </ul>"},{"location":"iso_15316/#references","title":"References","text":"<ul> <li>EN 15316-1:2017 \u2013 Energy performance of buildings \u2014 Method for calculation of system energy requirements and system efficiencies \u2014 Part 1: General and energy performance expression. </li> <li>REHVA (2017) \u2014 Information Paper: CEN Standards for Heating and Domestic Hot Water Systems. </li> <li>CENSE Project (EU) \u2014 Application of the EPBD Calculation Framework.</li> </ul>"},{"location":"iso_15316_calculation_procedure/","title":"CALCULATION PROCEDURE","text":"Note: THE ACTUAL CALCULATION OF PRIMARY ENRGY USING THE ISO 15316-1 IS FOR A SINGLE ZONE, IT IS NOT YET IMPLEMENTED THE CALCULATION FOR MULTIPLE ZONES.  <p>The calculation procedure follows the direction from the energy need to the source (building energy need -&gt; primary energy)</p>"},{"location":"iso_15316_calculation_procedure/#description-of-functions","title":"Description of functions","text":"<p>Herunder explanation of what the script does and comments each function, with emphasis on: - assumptions, units of measurement and formulas used; - structure of input/output data; - flow of calculation for single step and time series.</p> <p>Standard of reference: the calculator follows the logic of the ISO 15316-1 for heating systems and supports 4 types of emission circuits (C.2, C.3, C.4, C.5). Building Energy Need: The building energy need is calculated using the module ISO 52016. For more information refers to the module ISO 52016.</p>"},{"location":"iso_15316_calculation_procedure/#1-overview","title":"1) Overview","text":"<ul> <li>Main class: <code>HeatingSystemCalculator</code></li> <li>Input: a dictionary <code>input_data</code> with parameters of emission, distribution and generation (primary).</li> <li>Tabular data:</li> <li><code>TB14</code> (DF): ISO table with \u0394T nominal and exponent n for the terminal (radiators, panels, etc.).     If not provided in <code>input_data[\"TB14\"]</code>, uses <code>TB14_backup</code> from <code>global_inputs</code>.</li> <li>Units (principali):</li> <li>Energy: kWh (exception: <code>Q_H</code> can arrive in Wh and is converted)</li> <li>Power: kW, Losses/Aux: kWh</li> <li>Volumetric flows: m\u00b3/h</li> <li>Temperature: \u00b0C</li> <li>c_w: specific heat of water in Wh/(kg\u00b7K) (\u22481.16)</li> <li>Output:</li> <li>for single step: dictionary with temperature, flow and energy on emission, distribution and generation;</li> <li>for time series: DataFrame hourly/temporal with the same structure.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#2-class-structure","title":"2) Class structure","text":"<pre><code>class HeatingSystemCalculator:\n    \\\"\\\"\\\"Calcolatore secondo ISO 15316-1 con 4 tipologie C.2\u2013C.5.\\\"\\\"\\\"\n</code></pre>"},{"location":"iso_15316_calculation_procedure/#__init__self-input_data","title":"<code>__init__(self, input_data)</code>","text":"<ul> <li>What it does: saves the input, loads constants and parameters by calling <code>_load_constants()</code> and <code>_load_input_parameters()</code>.</li> <li>Attention: <code>input_data</code> guides everything (control policy, generator efficiency, external curves, etc.).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#3-loading-constants-and-parameters","title":"3) Loading constants and parameters","text":""},{"location":"iso_15316_calculation_procedure/#_load_constantsself","title":"<code>_load_constants(self)</code>","text":"<ul> <li>What it does: loads constants and parameters by calling <code>_load_constants()</code> and <code>_load_input_parameters()</code>. </li> <li>Details:</li> <li>If <code>input_data[\"TB14\"]</code> is a <code>pd.DataFrame</code>, uses it; otherwise uses <code>TB14_backup</code>.</li> <li>Set <code>c_w = 1.16</code> Wh/(kg\u00b7K).</li> <li>Why it is needed: <code>TB14</code> provides nominal \u0394T and exponent n to calculate the relationship power \u2194 \u0394T air-emitter.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_load_input_parametersself","title":"<code>_load_input_parameters(self)</code>","text":"<ul> <li>What it does: reads from the input dictionary the parameters of:</li> <li>Emission (secondary): type of emitter, nominal power, efficiency, mixing valve, type of temperature control (demand/external/constant), auxiliary powers, t operative, external secondary curve data.</li> <li>Distribution: recovery of losses, auxiliary powers, loss coefficient [W/K], service time, etc.</li> <li>Generation (primary): power at full load, maximum load factor, service time, hydraulic scheme (direct or independent), pump control, nominal \u0394T, optional setpoints, generator efficiency model (simple/parametric/manufacturer) and relative curves/parameters, primary circuit temperature control (Type A/B/C) and external primary curve.</li> <li>Important notes:</li> <li><code>selected_emm_cont_circuit</code> \u2208 {0,1,2,3} \u2192 C.2/C.3/C.4/C.5.</li> <li>Policy Q_H \u2264 0: <code>calc_when_QH_positive_only</code> + <code>off_compute_mode</code> (<code>idle</code>/<code>temps</code>/<code>full</code>) decide how to handle periods without load.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#4-default-tables-and-data","title":"4) Default tables and data","text":""},{"location":"iso_15316_calculation_procedure/#_default_emission_dataself","title":"<code>_default_emission_data(self)</code>","text":"<ul> <li>What it provides: limits/setpoint secondary (emission): T supply max, \u0394T max, T return desired, load factor with ON/OFF, T min supply.</li> <li>Why it is needed: it is needed to constrain the calculation of the emitter in function of the demand and the type C.2\u2013C.5.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#_default_outdoor_dataself","title":"<code>_default_outdoor_data(self)</code>","text":"<ul> <li>What it provides: outdoor curve (secondary) defining min/max supply vs. min/max outdoor T..</li> <li>Usage: used by <code>calculate_circuit_node_temperature</code> when the control is \"based on outdoor\".</li> </ul>"},{"location":"iso_15316_calculation_procedure/#5-time-series-data","title":"5) Time series data","text":""},{"location":"iso_15316_calculation_procedure/#load_csv_dataself-csv_path_or_df","title":"<code>load_csv_data(self, csv_path_or_df)</code>","text":"<ul> <li>What it does: loads time series data from CSV/DataFrame with expected columns:</li> <li><code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> (alias supported).</li> <li>Logic:</li> <li>If <code>Q_H</code> is in Wh, creates <code>Q_H_kWh = Q_H / 1000</code>.</li> <li>Saves in <code>self.timeseries_data</code>.</li> <li>Returns: loaded DataFrame.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#6-emission-common-parameters","title":"6) Emission \u2014 common parameters","text":""},{"location":"iso_15316_calculation_procedure/#calculate_common_emission_parametersself-heating_needs_kwh-int","title":"<code>calculate_common_emission_parameters(self, heating_needs_kWh, \u03b8int)</code>","text":"<ul> <li>What it does: calculates common quantities for C.2\u2013C.5:</li> <li>net demand (after recoverable losses of system),</li> <li>average power emitted <code>\u03a6H_em_eff</code> (kW) on <code>tH_em_i_ON</code>,</li> <li>losses/inputs of emission, auxiliary powers,</li> <li>nominal parameters TB14: <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code>, nominal flow <code>V_H_em_nom</code>.</li> <li>Note:</li> <li><code>V_H_em_nom = \u03a6H_em_n / (\u0394\u03b8H_em_n * c_w)</code>.</li> <li>Calculates load factor \u03b2 and partial ON time for auxiliary powers.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#7-emission-models-c2c3c4c5","title":"7) Emission \u2014 models C.2/C.3/C.4/C.5","text":"<p>All use the non-linear relationship power \u2194 \u0394T air-emitter with exponent n from TB14.</p>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c2self-common_params-int-c2-constant-flow-constant-water-temperature","title":"<code>calculate_type_C2(self, common_params, \u03b8int)</code> \u2014 C.2: constant flow, constant water temperature","text":"<ul> <li>Uses <code>V_H_em_nom</code> as effective flow.</li> <li>Stima <code>\u0394\u03b8H_em_air_eff = \u0394\u03b8_air_nom * (\u03a6_eff/\u03a6_nom)^(1/n)</code>.</li> <li>Calculates <code>\u03b8H_em_avg</code>, then \u0394T water <code>\u0394\u03b8H_em_w_eff = \u03a6_eff / (c_w * V)</code> and from there supply/return emitter.</li> <li><code>\u03b8H_em_flw_min</code> include mixing offset if <code>MIX_EM=True</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c3self-common_params-int-c3-variable-flow-constant-water-temperature-return-limited","title":"<code>calculate_type_C3(self, common_params, \u03b8int)</code> \u2014 C.3: variable flow, constant water temperature (return limited)","text":"<ul> <li>Fixes <code>\u03b8H_em_ret_set</code> (\u2265 <code>\u03b8int</code>), limits supply (<code>\u03b8H_em_flw_max</code>, \u0394T_w_max).</li> <li>Determines <code>\u03b8H_em_flw</code> and <code>\u03b8H_em_ret</code> coherent and derives the flow from \u0394T water.</li> <li><code>\u03b8H_em_flw_min</code> include mixing offset.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c4self-common_params-int-c4-onoff-intermittent","title":"<code>calculate_type_C4(self, common_params, \u03b8int)</code> \u2014 C.4: ON\u2013OFF intermittent","text":"<ul> <li>Uses a duty cycle to ensure the energy hourly with power ON.</li> <li>Determines <code>\u03b8H_em_flw_calc</code> during ON (from TB14, \u03b2 required).</li> <li>Provides minimum flow for the distribution circuit.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#calculate_type_c5self-common_params-int-c5-constant-flow-variable-exchange-bypass","title":"<code>calculate_type_C5(self, common_params, \u03b8int)</code> \u2014 C.5: constant flow, variable exchange (bypass)","text":"<ul> <li>Maintains nominal flow; the actual flow is the maximum between the calculation and the minimum set (<code>\u03b8H_em_flw_min_tz_i</code>).</li> <li>The output includes <code>\u03b8H_em_flw_min</code> (with mixing offset).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#8-circuit-node-temperature","title":"8) Circuit node temperature","text":""},{"location":"iso_15316_calculation_procedure/#calculate_circuit_node_temperatureself-ext-emission_results","title":"<code>calculate_circuit_node_temperature(self, \u03b8ext, emission_results)</code>","text":"<ul> <li>What it does: calculates the flow at the node <code>\u03b8H_nod_out</code> based on the secondary control type:</li> <li>Type 1 \u2013 Based on demand: uses <code>\u03b8H_em_flw_min</code> of the emission.</li> <li>Type 2 \u2013 Based on outdoor: uses the climate curve secondary.</li> <li>Type 3 \u2013 Constant temperature: uses <code>\u03b8em_flw_sahz_i</code> (constant).</li> <li>Output: <code>\u03b8H_nod_out</code> (\u00b0C).</li> </ul>"},{"location":"iso_15316_calculation_procedure/#9-operating-conditions-secondary","title":"9) Operating conditions (secondary)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_operating_conditionsself-emission_results-common_params-int-h_nod_out","title":"<code>calculate_operating_conditions(self, emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"<ul> <li>What it does: combines the choice C.2/C.3/C.4/C.5 and the node to generate:</li> <li>temperature circuit: <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, flow <code>V_H_cr</code>;</li> <li>temperature distribution (between collector and emitter): <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>;</li> <li>load factor <code>\u03b2H_em</code> and minimum flow requested <code>\u03b8H_em_flw_min</code>;</li> <li>return emitter (used downstream).</li> <li>Note:</li> <li>C.4 introduces ON time and power calculation in ON;</li> <li>C.5 maintains minimum flow and calculates the return from the balance with constant flow.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#10-distribution","title":"10) Distribution","text":""},{"location":"iso_15316_calculation_procedure/#calculate_distributionself-h_dis_flw-h_dis_ret-int-qh_em_i_in","title":"<code>calculate_distribution(self, \u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"<ul> <li>What it does: estimates the distribution losses and auxiliary powers, the recoverable part and the required energy input from the distribution.</li> <li>Key formulas:</li> <li>Losses [kWh] \u2248 <code>((T_media - T_int) * U[W/K] / 1000) * t[h]</code></li> <li>Required input: <code>QH_dis_i_in = QH_dis_i_req + losses - aux - recoveries</code></li> <li>Distribution flow: <code>V_H_dis = QH_dis_i_in / (c_w * \u0394T_dis * t)</code></li> <li>Output: dictionary with losses/aux/recoveries and <code>V_H_dis</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#11-generator-efficiency-primary","title":"11) Generator efficiency (primary)","text":""},{"location":"iso_15316_calculation_procedure/#_efficiency_from_modelself-flw-ret-load_frac10","title":"<code>_efficiency_from_model(self, \u03b8flw, \u03b8ret, load_frac=1.0)</code>","text":"<ul> <li>What it does: returns the efficiency (%) according to the selected model:</li> <li>simple: heuristic in function of <code>\u03b8ret</code> (high condensation at low returns).</li> <li>parametric: piecewise linear model (parameters: <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>).</li> <li>manufacturer: curve 1D (\u03b7=f(Tret)) o 2D (\u03b7=f(Tflw,Tret)) con interpolazione bilineare.</li> <li>Note: clamp a [1, 110] %; fallback a modello semplice se curve non valide.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#12-primary-circuit-setpoint","title":"12) Primary circuit setpoint","text":""},{"location":"iso_15316_calculation_procedure/#_generator_flow_setpointself-ext-h_dis_flw_demand","title":"<code>_generator_flow_setpoint(self, \u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"<ul> <li>What it does: calculates the primary circuit setpoint based on the selected control:</li> <li>Type A \u2013 Outdoor: uses the primary curve (min/max vs T external).</li> <li>Type B \u2013 Demand: pursues the secondary demand (<code>\u03b8H_dis_flw</code>).</li> <li>Type C \u2013 Constant: uses <code>\u03b8HW_gen_flw_const</code>.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#13-generation-primary","title":"13) Generation (primary)","text":""},{"location":"iso_15316_calculation_procedure/#calculate_generationself-h_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"<code>calculate_generation(self, \u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"<ul> <li> <p>Purpose: Calculates the primary circuit thermal output, setpoints, and energy consumption according to the selected control strategy.</p> </li> <li> <p>Control types:</p> <p>-Type A \u2013 Outdoor: Uses the primary weather curve (supply temperature as a function of outdoor temperature). -Type B \u2013 Demand: Follows the secondary circuit demand (\u03b8H_dis_flw). -Type C \u2013 Constant: Uses a fixed setpoint \u03b8HW_gen_flw_const.</p> </li> <li> <p>Computation steps:</p> <p>1) Maximum capacity: max_output_g1 = P_full * LF_max * t Defines the maximum hourly energy the generator can deliver.</p> <p>2) Requested output: QH_gen_out = min(QH_dis_i_in, max_output_g1) Limits the generator\u2019s output to its capacity.</p> <p>3) Mass and volume flows: ms = \u03c1 * V_dis for the secondary side; primary flow depends on configuration.</p> <p>4) Hydraulic configurations:</p> <ul> <li>Direct: primary and secondary circuits are identical.</li> <li>Independent: computes \u0394T_p, determines the primary supply setpoint (Type A/B/C), applies primary line losses, calculates primary flow mp = Q * 1000 / (c_w * \u0394T), and optionally applies anti-dilution logic before finding the return temperature Tp_ret.</li> </ul> <p>5) Efficiency: Re-evaluated using the actual flow/return temperatures via the chosen generator efficiency model.</p> <p>6) Energy balance:</p> <ul> <li>Input energy: EHW_gen_in = (QH_gen_out * 100) / \u03b7</li> <li> <p>Auxiliary energy: EHW_gen_aux = EHW_gen_in * (aux_generator / 100)</p> </li> <li> <p>Recoverable generator losses: QW_gen_i_ls_rbl_H</p> </li> <li>Thermal outputs and split of useful (EH_gen_in) and waste (EWH_gen_in) energy.</li> </ul> </li> <li> <p>Output: A dictionary containing primary-side temperatures, mass/volume flows, efficiency, and energy consumption for the generator.</p> </li> </ul>"},{"location":"iso_15316_calculation_procedure/#14-single-step-execution","title":"14) Single step execution","text":""},{"location":"iso_15316_calculation_procedure/#compute_stepself-q_h_kwh-int-ext","title":"<code>compute_step(self, q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>Flow:</li> <li>Common emission parameters</li> <li>Emission C.2/C.3/C.4/C.5 (in base a <code>selected_emm_cont_circuit</code>)</li> <li>Calculation supply node (secondary)</li> <li>Operating conditions of the circuit</li> <li>Distribution</li> <li>Generation (primary)</li> <li>Composition of the output of the step (dictionary)</li> <li>Returns: all temperatures, flows and energies of the step.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#15-time-series-execution","title":"15) Time series execution","text":""},{"location":"iso_15316_calculation_procedure/#_temps_row_when_offself-int-ext","title":"<code>_temps_row_when_off(self, \u03b8int, \u03b8ext)</code>","text":"<ul> <li>What it does: in absence of load (<code>Q_H \u2264 0</code>) and with policy <code>off_compute_mode='temps'</code>,   calculates only the temperatures significant keeping powers/flows=0.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#run_timeseriesself-dfnone","title":"<code>run_timeseries(self, df=None)</code>","text":"<ul> <li>What it does: executes the calculation on the entire DataFrame.</li> <li>Alias recognized:</li> <li><code>Q_H_kWh</code> \u2194 <code>Q_H</code>, <code>Q_h</code>, <code>Heating_needs</code></li> <li><code>T_op</code> \u2194 <code>T_int</code>, <code>theta_int</code></li> <li><code>T_ext</code> \u2194 <code>theta_ext</code></li> <li>Policy when <code>Q_H \u2264 0</code>:</li> <li><code>calc_when_QH_positive_only=False</code>: calculates the complete flow.</li> <li><code>True</code> with:<ul> <li><code>idle</code>: empty row (NaN/0) \u2014 see <code>_idle_row</code>.</li> <li><code>temps</code>: row only temperatures \u2014 see <code>_temps_row_when_off</code>.</li> <li><code>full</code>: complete calculation even with null load.</li> </ul> </li> <li>Returns: DataFrame indexed by timestamp with all columns.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#16-output-columns-extracted","title":"16) Output columns (extracted)","text":"<ul> <li>Inputs: <code>Q_h(kWh)</code>, <code>T_op(\u00b0C)</code>, <code>T_ext(\u00b0C)</code></li> <li>Emission: <code>\u03a6H_em_eff(kW)</code>, <code>\u03b8H_em_flow(\u00b0C)</code>, <code>\u03b8H_em_ret(\u00b0C)</code>, <code>V_H_em_eff(m3/h)</code>, <code>\u03b8H_em_flw_min_req(\u00b0C)</code></li> <li>Node/Circuit: <code>\u03b8H_nod_out(\u00b0C)</code>, <code>\u03b8H_cr_flw(\u00b0C)</code>, <code>\u03b8H_cr_ret(\u00b0C)</code>, <code>V_H_cr(m3/h)</code>, <code>\u03b2H_em(-)</code></li> <li>Distribution: <code>Q_w_dis_i_ls(kWh)</code>, <code>Q_w_dis_i_aux(kWh)</code>, <code>Q_w_dis_i_ls_rbl_H(kWh)</code>, <code>QH_dis_i_in(kWh)</code>, <code>V_H_dis(m3/h)</code></li> <li>Generation: <code>QH_gen_out(kWh)</code>, <code>\u03b8X_gen_cr_flw(\u00b0C)</code>, <code>\u03b8X_gen_cr_ret(\u00b0C)</code>, <code>V_H_gen(m3/h)</code>, <code>efficiency_gen(%)</code>, <code>EHW_gen_in(kWh)</code>, <code>EHW_gen_aux(kWh)</code></li> </ul>"},{"location":"iso_15316_calculation_procedure/#17-best-practices-and-notes","title":"17) Best practices and notes","text":"<ul> <li>Verify that <code>TB14</code> contains the rows for the emitter type (<code>emitter_type</code>) and the columns:</li> <li><code>Emitters_nominal_deltaTeta_Water_C</code>, <code>Emitters_nominale_deltaTeta_air_C</code>, <code>Emitters_exponent_n</code>.</li> <li>Ensure Q_H is provided in kWh (or Wh with automatic conversion).</li> <li>For independent circuits, evaluate:</li> <li><code>generator_nominal_deltaT</code>, <code>gen_flow_temp_control_type</code>, <code>\u03b8HW_gen_flw_const</code>,</li> <li><code>allow_dilution</code> and <code>primary_line_loss</code> if you want to model the primary hydraulic node with/without dilution.</li> <li>The efficiency model can be refined with manufacturer curves (1D/2D) for boilers/heat pumps.</li> </ul>"},{"location":"iso_15316_calculation_procedure/#18-function-responsibility-mapping","title":"18) Function \u2192 responsibility mapping","text":"Function Main responsibility <code>_load_constants</code> Global constants and <code>TB14</code> <code>_load_input_parameters</code> Reading all parameters (emission, distribution, generation) <code>_default_emission_data</code>, <code>_default_outdoor_data</code> Default for limits/setpoint and secondary circuit curve <code>load_csv_data</code> Loading timeseries and energy normalization <code>calculate_common_emission_parameters</code> Common emission parameters (C.2\u2013C.5) <code>calculate_type_C2/C3/C4/C5</code> Emission models <code>calculate_circuit_node_temperature</code> Compute the secondary node (circuit) supply temperature \u03b8H_nod_out according to the selected secondary control policy: based on demand, outdoor, or constant. <code>calculate_operating_conditions</code> Temperature/portate circuito e distribuzione <code>calculate_distribution</code> Losses/auxiliaries/recoveries and distribution flow <code>_efficiency_from_model</code> Generator efficiency according to selected model <code>_generator_flow_setpoint</code> Setpoint mandata primaria (outdoor/demand/costante) <code>calculate_generation</code> Primary circuit balance: useful power, efficiency, consumptions <code>compute_step</code> Pipeline for a single step <code>_temps_row_when_off</code> Row \"only temperatures\" when Q_H\u22640 <code>run_timeseries</code> Execution on the entire time series"},{"location":"iso_15316_calculation_procedure/#flowchart-overview","title":"Flowchart (overview)","text":"<pre>\nflowchart TD\n  A[Start] --&gt; B[__init__]\n  B --&gt; C[_load_constants]\n  B --&gt; D[_load_input_parameters]\n  C --&gt; E{Execution?}\n  D --&gt; E\n\n  E --&gt;|single step| F[compute_step]\n  E --&gt;|timeseries| TS[run_timeseries]\n\n  subgraph Pipeline[\"Pipeline compute_step\"]\n    F --&gt; G[calculate_common_emission_parameters]\n    G --&gt; H{Tipo circuito?}\n    H --&gt;|C.2| I1[calculate_type_C2]\n    H --&gt;|C.3| I2[calculate_type_C3]\n    H --&gt;|C.4| I3[calculate_type_C4]\n    H --&gt;|C.5| I4[calculate_type_C5]\n    I1 --&gt; J[calculate_circuit_node_temperature]\n    I2 --&gt; J\n    I3 --&gt; J\n    I4 --&gt; J\n    J --&gt; K[calculate_operating_conditions]\n    K --&gt; L[calculate_distribution]\n    L --&gt; M[calculate_generation]\n    M --&gt; N[Compose outputs dict]\n  end\n\n  subgraph Timeseries[\"Timeseries run_timeseries\"]\n    TS --&gt; TS0{Row loop}\n    TS0 --&gt;|Q_H \u2264 0 AND policy=idle| T0[_idle_row]\n    TS0 --&gt;|Q_H \u2264 0 AND policy=temps| T1[_temps_row_when_off]\n    TS0 --&gt;|altrimenti| T2[compute_step]\n    T0 --&gt; T3[accumula risultati]\n    T1 --&gt; T3\n    T2 --&gt; T3\n  end\n\n  N --&gt; O[Return dict]\n  T3 --&gt; P[Return DataFrame]\n</pre>"},{"location":"iso_15316_calculation_procedure/#inputoutput-tables-main-functions","title":"Input/Output tables (main functions)","text":""},{"location":"iso_15316_calculation_procedure/#21-__init__input_data","title":"2.1 <code>__init__(input_data)</code>","text":"Field Type Description <code>input_data</code> dict Parameters of emission, distribution, generation, policy and tables. Output Initializes the instance and calls <code>_load_constants()</code> &amp; <code>_load_input_parameters()</code>."},{"location":"iso_15316_calculation_procedure/#22-_load_constants","title":"2.2 <code>_load_constants()</code>","text":"Field Type Description <code>input_data[\"TB14\"]</code> (optional) <code>pd.DataFrame</code> ISO table with nominal \u0394T/esponente; if missing uses <code>TB14_backup</code>. Side-effects <code>self.TB14</code> assigned; <code>self.c_w = 1.16</code>. Output No explicit return."},{"location":"iso_15316_calculation_procedure/#23-_load_input_parameters","title":"2.3 <code>_load_input_parameters()</code>","text":"Block Main keys Default (example) Emissione <code>emitter_type</code>, <code>nominal_power</code>, <code>emission_efficiency</code>, <code>mixing_valve</code>, <code>flow_temp_control_type</code>, <code>auxiliars_power</code>, <code>emission_operation_time</code>, <code>mixing_valve_delta</code>, <code>selected_emm_cont_circuit</code>, <code>heat_emission_data</code>, <code>outdoor_temp_data</code>, <code>constant_flow_temp</code> <code>Floor heating</code>, <code>8 kW</code>, <code>90%</code>, <code>True</code>, <code>Type 1</code>, <code>0 W</code>, <code>1 h</code>, <code>2 \u00b0C</code>, <code>0</code>, <code>42</code> Distribuzione <code>Heat_losses_recovered</code>, <code>distribution_loss_recovery</code>, <code>simplified_approach</code>, <code>distribution_aux_recovery</code>, <code>distribution_aux_power</code>, <code>distribution_loss_coeff</code>, <code>distribution_operation_time</code>, <code>recoverable_losses</code> <code>True</code>, <code>90%</code>, <code>80%</code>, <code>80%</code>, <code>30 W</code>, <code>48 W/K</code>, <code>1 h</code>, <code>0 kWh</code> Generazione <code>full_load_power</code>, <code>max_monthly_load_factor</code>, <code>tH_gen_i_ON</code>, <code>auxiliary_power_generator</code>, <code>fraction_of_auxiliary_power_generator</code>, <code>generator_circuit</code>, <code>speed_control_generator_pump</code>, <code>generator_nominal_deltaT</code>, <code>\u03b8HW_gen_flw_set</code>, <code>\u03b8HW_gen_ret_set</code>, <code>calc_when_QH_positive_only</code>, <code>fill_zeros_when_skipped</code>, <code>off_compute_mode</code>, <code>efficiency_model</code>, <code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>, <code>manuf_curve_1d</code>, <code>manuf_curve_2d</code>, <code>gen_flow_temp_control_type</code>, <code>gen_outdoor_temp_data</code>, <code>\u03b8HW_gen_flw_const</code> <code>24 kW</code>, <code>100%</code>, <code>1 h</code>, <code>0%</code>, <code>40%</code>, <code>independent</code>, <code>variable</code>, <code>20 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>True</code>, <code>False</code>, <code>idle</code>, <code>simple</code>, <code>110%</code>, <code>95%</code>, <code>20 \u00b0C</code>, <code>50 \u00b0C</code>, <code>None</code>, <code>None</code>, <code>Type A</code>, <code>curve 1D/2D</code>,<code>50 \u00b0C</code>"},{"location":"iso_15316_calculation_procedure/#24-_default_emission_data-_default_outdoor_data","title":"2.4 <code>_default_emission_data()</code> / <code>_default_outdoor_data()</code>","text":"Function Output Note <code>_default_emission_data</code> DF con <code>\u03b8H_em_flw_max_sahz_i</code>, <code>\u0394\u03b8H_em_w_max_sahz_i</code>, <code>\u03b8H_em_ret_req_sahz_i</code>, <code>\u03b2H_em_req_sahz_i</code>, <code>\u03b8H_em_flw_min_tz_i</code> <code>Limits/setpoint secondary circuit</code> <code>_default_outdoor_data</code> DF con <code>\u03b8ext_min_sahz_i</code>, <code>\u03b8ext_max_sahz_i</code>, <code>\u03b8em_flw_max_sahz_i</code>, <code>\u03b8em_flw_min_sahz_i</code> <code>Secondary circuit limits</code>"},{"location":"iso_15316_calculation_procedure/#25-load_csv_datacsv_path_or_df","title":"2.5 <code>load_csv_data(csv_path_or_df)</code>","text":"Input Type Description <code>csv_path_or_df</code> str / DataFrame Timeseries with columns (<code>Q_H</code>, <code>T_op</code>, <code>T_ext</code> or aliases) Output DataFrame With optional <code>Q_H_kWh</code> added; saved in <code>self.timeseries_data</code>"},{"location":"iso_15316_calculation_procedure/#26-calculate_common_emission_parametersheating_needs_kwh-int","title":"2.6 <code>calculate_common_emission_parameters(heating_needs_kWh, \u03b8int)</code>","text":"Output (key) Description <code>QH_sys_out_hz_i</code> Net demand after recoveries <code>QH_em_i_in</code> Energy in at emission <code>\u03a6H_em_eff</code> Average power on interval (kW) <code>V_H_em_nom</code> Nominal flow (m\u00b3/h) <code>\u0394\u03b8H_em_n</code>, <code>\u0394\u03b8H_em_air</code>, <code>nH_em</code> Parameters from TB14"},{"location":"iso_15316_calculation_procedure/#27-calculate_type_c2-c3-c4-c5","title":"2.7 <code>calculate_type_C2 / C3 / C4 / C5</code>","text":"Function Principle Output Note <code>C2</code> Constant flow, constant water temperature <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C3</code> Variable flow, constant water temperature (return limited) <code>\u03b8H_em_flow</code>, <code>\u03b8H_em_ret</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code> <code>C4</code> ON\u2013OFF (duty cycle) <code>\u03b8H_em_flw_calc</code>, <code>\u03b8H_em_flw_min</code>, ecc. <code>C5</code> Constant flow, variable heat exchange (bypass) <code>\u03b8H_em_flow=min</code>, <code>\u03b8H_em_ret\u2248</code>, <code>V_H_em_eff</code>, <code>\u03b8H_em_flw_min</code>"},{"location":"iso_15316_calculation_procedure/#28-calculate_circuit_node_temperatureext-emission_results","title":"2.8 <code>calculate_circuit_node_temperature(\u03b8ext, emission_results)</code>","text":"Control Logic Output Type 1 Demand \u2192 <code>\u03b8H_em_flw_min</code> <code>\u03b8H_nod_out</code> Type 2 Secondary circuit limits <code>\u03b8H_nod_out</code> Type 3 Constant (<code>\u03b8em_flw_sahz_i</code>) <code>\u03b8H_nod_out</code>"},{"location":"iso_15316_calculation_procedure/#29-calculate_operating_conditionsemission_results-common_params-int-h_nod_out","title":"2.9 <code>calculate_operating_conditions(emission_results, common_params, \u03b8int, \u03b8H_nod_out)</code>","text":"Case Output Note C.2 / C.3 / C.4 / C.5 <code>\u03b8H_cr_flw</code>, <code>\u03b8H_cr_ret</code>, <code>V_H_cr</code>, <code>\u03b8H_dis_flw</code>, <code>\u03b8H_dis_ret</code>, <code>\u03b2H_em</code>, <code>\u03b8H_em_flw_min</code>, <code>\u03b8H_em_ret_eff</code>"},{"location":"iso_15316_calculation_procedure/#210-calculate_distributionh_dis_flw-h_dis_ret-int-qh_em_i_in","title":"2.10 <code>calculate_distribution(\u03b8H_dis_flw, \u03b8H_dis_ret, \u03b8int, QH_em_i_in)</code>","text":"Output Meaning <code>Q_w_dis_i_ls</code>, <code>Q_w_dis_i_aux</code>, <code>Q_w_dis_i_ls_rbl_H</code> Losses, auxiliaries and recoverable (kWh) <code>QH_dis_i_req</code>, <code>QH_dis_i_in</code> Request and effective input to distribution <code>V_H_dis</code> Distribution volumetric flow (m\u00b3/h)"},{"location":"iso_15316_calculation_procedure/#211-_efficiency_from_modelflw-ret-load_frac","title":"2.11 <code>_efficiency_from_model(\u03b8flw, \u03b8ret, load_frac)</code>","text":"Model Description <code>simple</code> Efficiency as function of return temperature (condensation) <code>parametric</code> Piecewise linear with thresholds (<code>eta_max</code>, <code>eta_no_cond</code>, <code>T_ret_min</code>, <code>T_ret_thr</code>) <code>manufacturer</code> Manufacturer curves 1D/2D with interpolation"},{"location":"iso_15316_calculation_procedure/#212-_generator_flow_setpointext-h_dis_flw_demand","title":"2.12 <code>_generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand)</code>","text":"Type Logic Type A Primary curve (outdoor) Type B Follow secondary demand Type C Constant"},{"location":"iso_15316_calculation_procedure/#213-calculate_generationh_dis_flw-h_dis_ret-v_h_dis-qh_dis_i_in","title":"2.13 <code>calculate_generation(\u03b8H_dis_flw, \u03b8H_dis_ret, V_H_dis, QH_dis_i_in)</code>","text":"Output Meaning <code>max_output_g1</code>, <code>QH_gen_out</code> Limit capacity and thermal output (kWh) <code>\u03b8X_gen_cr_flw</code>, <code>\u03b8X_gen_cr_ret</code> Primary circuit effective (\u00b0C) <code>V_H_gen</code> Primary circuit volumetric flow (m\u00b3/h) <code>efficiency_gen</code> Efficiency (%) <code>EHW_gen_in</code>, <code>EHW_gen_aux</code> Energy in ingress and auxiliaries (kWh) <code>QW_gen_i_ls_rbl_H</code> Recoverable losses (kWh) <code>QW_gen_out</code>, <code>QHW_gen_out</code>, <code>EH_gen_in</code>, <code>EWH_gen_in</code> Thermal balances"},{"location":"iso_15316_calculation_procedure/#214-compute_stepq_h_kwh-int-ext","title":"2.14 <code>compute_step(q_h_kWh, \u03b8int, \u03b8ext)</code>","text":"Input Output <code>q_h_kWh</code>, <code>\u03b8int</code>, <code>\u03b8ext</code> Dictionary with emission, node/circuit, distribution, generation"},{"location":"iso_15316_calculation_procedure/#215-_temps_row_when_offint-ext","title":"2.15 <code>_temps_row_when_off(\u03b8int, \u03b8ext)</code>","text":"Purpose Output Row \"only temperature\" for <code>Q_H \u2264 0</code> Same keys, with powers/volumes=0"},{"location":"iso_15316_calculation_procedure/#216-run_timeseriesdfnone","title":"2.16 <code>run_timeseries(df=None)</code>","text":"Input Output <code>df</code> (optional) or <code>self.timeseries_data</code> DataFrame indexed by timestamp with results of each step"},{"location":"iso_15316_calculation_procedure/#modelling-suggestions","title":"Modelling suggestions","text":"<ul> <li>Verify consistency between emitter type and <code>TB14</code> rows.  </li> <li>For independent schemes, curate <code>generator_nominal_deltaT</code>, <code>primary_line_loss</code> and <code>allow_dilution</code>.  </li> <li>Use <code>manufacturer</code> with realistic manufacturer curves when available.</li> </ul>"},{"location":"iso_15316_generation_circuit/","title":"GENERATION","text":"<p>The annex D of ISO 15316-1 standard provides the calculation procedure for the generation circuit. It is the general procedure that can be improved using the detailed standards for different type of generator, such as Heat pump, Combustion boilers, District heating and cooling, etc. </p> <p>There are 2 typed of generaiont circuit:</p> <p>1) Generation with DIRECT circuit withou hydraulic separtion 2) Generation with INDIPENDENT flow rate circuit, using the hydraulic separtion</p>"},{"location":"iso_15316_generation_circuit/#direct-circuit","title":"DIRECT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>The standard define no control to the circuit.  In the pybuildingenergy, the contol have been applied on the generator based on:</p> <pre><code>- 'Type A - Based on outdoor temperature': uses primary's own weather curve\n- 'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)\n- 'Type C - Constant temperature'       : uses self.\u03b8HW_gen_flw_const\n</code></pre> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> <p>No data</p> <p>System design data: </p> <p>No data</p> <p>Process control data</p> <p>No data</p> <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#independent-circuit","title":"INDEPENDENT circuit","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal generator power max_output_g1 kW - 0 to 10<sup>4</sup> Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) water (flow-return) dTp \u00b0C - 1..40 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system <p>System design data: </p> <p>No data</p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Generator pump speed control speed_control_generator_pump - - - Generator pump speed control, could be varaible or deltaT_constant <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Required generator output QH_gen_out kWh - 0 to \u221e Required generator output Generator operation time tH_gen_i h 1 1 to 744 Generator operation time Generator circuit flow temperature \u03b8H_gen_cr_flw \u00b0C - 0 to 110 Generator circuit flow temperature Generator circuit return temperature \u03b8H_gen_cr_ret \u00b0C - 0 to 110 Generator circuit return temperature Generator circuit flow rate V_H_gen_cr m3/h - 0 to \u221e Generator circuit flow rate"},{"location":"iso_15316_generation_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Generation flow Temperature Tp_sup \u00b0C - - Generation flow Temperature Generation return Temperature Tp_ret \u00b0C - - Generation return Temperature Generation flow rate V_H_gen m3/h - - Generation flow rate"},{"location":"iso_15316_heating_circuit/","title":"Heating circuit.","text":"<p>The library provides modules for evaluating 4 types of hydraulic circuits, where, based on Table C.1 of the standard, for each circuit it is identified which type of emission system to use and the type of control. as defined below: </p> Code Module Emitters Control C2 Constan mass flow rate and varying water temperature Radiators and Panels Heating curve, mixing valvew and variable generation temperature C3 Varying mass flow (constant temperature) Radiators, Panels, Heating coils Thermostatic valve, flow rate control with two way valve C4 ON-OFF and varying temperature Radiators and Panels On-Off control C5 Varying heat exchange Fan-coil, heating coils emitters with on-off blower  and continuos circulation 3 way by-pass valve control <p>All modules allow the us of a mixing valve to allow different temperatures in the different circuits. A distinction is made between:  - the emitter tmperature and flow rate; - the circuit temperature and flow rate; </p> <p>They differ where there is a mixing or by-pass 3 way valve in the circuit.</p>"},{"location":"iso_15316_heating_circuit/#system-type-and-input-parameters","title":"System type and input parameters","text":""},{"location":"iso_15316_heating_circuit/#c2-constant-mass-flow-rate-and-varying-water-temperature","title":"C2 - constant mass flow rate and varying water temperature","text":"<p>This conffiguration is for sample heating circuit with varying temperature and constant flow, with mixing valve. </p> Figure 1: System C2 - Example of heating circuit with varying temperature and constant flow, with mixing valve.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators Heating Panels Control Parameters Heating curve flow/return \u0394\u03b8 <p>The circuit can have a mixing valve or having a different control on boiler size (ex. climatic heating curve).</p>"},{"location":"iso_15316_heating_circuit/#inputs-required","title":"Inputs required","text":"<p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maximum distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c3-varying-mass-flow-rate-and-constant-water-temperature","title":"C3 - varying mass flow rate and constant water temperature","text":"<p>This configuration is for sample heating circuit with varying mass flow rate and constant water temperature. </p> Figure 1: System C3_1 - Example of sample heating circuit varying mass flow rate.  Figure 1: System C3_1 - Example of sample heating circuit with series control (AHU coil).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application Radiators with thermostatic valve AHU coil with series control Panels with PID control Control Parameters Maximum flow/return \u0394\u03b8 Maximum flow temperature Target return temperature <p>Inputs required</p> <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Mixing valve temperature overhead \u0394\u03b8H_em_mix_sahz_i \u00b0C - - Temperature overhead of the mixing valve Target return temperature \u03b8H_em_ret_req_sahz_i \u00b0C - - Desired return temperature of the emission circuit Maximum flow/return \u0394\u03b8 \u0394\u03b8H_em_w_max_sahz_i \u00b0C - - Maximum flow/return temperature difference of the emission circuit Maximum flow temperature \u03b8H_em_flw_max_sahz_i \u00b0C - - Maximum flow temperature of the emission circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c4-intermittent-flow-rate-module-on-off","title":"C4 - Intermittent flow rate module (ON-OFF)","text":"<p>This configuration is for sample heating circuit with intermittent flow rate and constant water temperature. </p> Figure 1: System C4 - Example of sample heating circuit with intermittent flow rate module (ON-OFF).  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Desired load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#c5-constant-flow-rate-and-variable-heat-exchange","title":"C5 - Constant flow rate and variable heat exchange","text":"Figure 1: System C5-1 - Example of sample heating circuit with varying heat exchange  Figure 1: System C4 - Example of sample heating circuit with three way by-pass control.  <p>The application and possible control parameters to be used are:</p> Tabelle affiancate System Application ON-OFF zone control ON-OFF room control Control Parameters Nominal \u0394\u03b8 (flow rate) Target load factor <p>Constants</p> <p>Water specific heat - cw: 1.16 kWh/m3K</p> <p>Product data: </p> Parameter Symbol Unit Default Accetable Description Nominal emitted power \u03a6H_em_n kW - 0.8..4 * heat load Manufacturer's specified heat output in kilowatts (kW) under standard operating conditions Nominal delta T (\u0394\u03b8) air \u0394\u03b8H_em_air \u00b0C - 1..70 Standard temperature difference used for designing and evaluating HVAC systems, typically between the water entering and leaving the system, and the air entering and leaving the system. Emitter exponent nH_em - - 1...1.5 The emitter exponent is a value that defines the relationship between flow rate and pressure for an emitter <p>System data</p> <p>if a mixing valve is used, the variable MIX_EM == True. </p> <p>Process control data</p> Parameter Symbol Unit Default Accetable Description Design nominal delta T water (inlet-outlet) \u0394\u03b8H_em_n \u00b0C - - Nominal difference between the hot water supply temperature and the return water temperature in a heating system, depends on the typy of emitter, eg. Radiator: 20 (70-50), Heating floor 5 (43-38), etc. Target load factor \u03b2H_em_req_sahz_i % - - Desired load factor with ON/OFF control Minimum flow temperature \u03b8H_em_flw_min_sahz_i \u00b0C - - Minimum flow temperature of the emission circuit for a zone i Set flow temperature \u03b8H_em_flw_set \u00b0C - - Set flow temperature for the heating circuit <p>Operating condition</p> <p>These values can be obtained simulating the thermal zone using the module iso 52016 of the library.</p> Parameter Symbol Unit Default Accetable Description Internal temperature \u03b8int \u00b0C - 0-45 Indoor operative temperature of the thermal zone, it is the T_op(\u00b0C) calcualted from the module 52016 Emitter heat output \u00a0QH_em_i_out kWh - - energy that sould be provided by the emission system to make up for energy need of the building. Pratically considering the energy path it si equal to the energy need of the building minus the system recoverable losses Operating time tH_em_i h 1 - Operating time of the system, generally in hours Maxium distribution water temperature \u03b8H_nod_out \u00a0\u00b0C - - it is the maximum temperature of the ditribution system, this values depends on the type of applied control. If MIX_VALVE == False, this value is equal to the minimum of the emitter temperature \u03b8H_em_flw_min"},{"location":"iso_15316_heating_circuit/#outputs","title":"Outputs","text":"<p>The follwing outputs are calculated for all configurations: </p> Parameter Symbol Unit Default Accetable Description Temperature of the flow (IN) circuit \u03b8H_ecr_flw \u00b0C - - temperature of the circuit at the flow point - water inlet Temperature of the return (OUT) circuit \u03b8H_ecr_ret \u00b0C - - temperature of the circuit at the return point - water outlet Flow rate of the circuit V_H_cr m3/h - - Flow rate of the circuit Distribution flow temperture \u03b8H_dis_flw \u00b0C - - temperature of the distribution circuit - water inlet Distribution return temperture \u03b8H_dis_ret \u00b0C - - temperature of the distribution circuit - water outlet Emission Load Factor \u03b2H_em - - - Ratio between the average emitter power and the nominal emitter power Minimu required flow temperature \u03b8H_em_flw_min \u00b0C - - Minimum required flow temperature of the emitter"},{"location":"iso_15316_system_inputs/","title":"HVAC SYSTEM INPUTS","text":"<p>The user must define the following parameters to perform the calculation of primary energy according to ISO 15316.1. The python class to which this calculation is requested is the HeatingSystemCalculator.</p> <p>Below is shown an example of a dictionary that must be passed to HeatingSystemCalculator in which the parameters necessary for the calculation are indicated.  The following parameters are the minimum required, this does not mean that it is possible to modify other parameters based on your own requests.  For example the table TB14 in the hereunder list. </p>"},{"location":"iso_15316_system_inputs/#emission","title":"EMISSION","text":"<ul> <li>Nominal power: it is the power of the emitter in kW, defined in the product data. </li> <li>Emission efficiency: it is the efficiency of the emitter in %.</li> <li>Flow temperature control type: it is the type of control used to control the flow temperature of the emitter. The possible choice are the ones defined in the \"value\" column of the following table </li> </ul> <p>Table 1: Flow temperature control type</p> Value Description Type 1 - Based on demand The flow temperature is controlled based on the energy demand of the system Type 2 - Based on outdoor temperature The flow temperature is controlled based on the outdoor temperature Type 3 - Constant temperature The flow temperature is controlled based on a constant temperature <ul> <li>Emission control circuit: the value could be from 0 to 3, according to the following table:</li> </ul> <p>Table 2: Emission control circuit</p> Value Emission control type Description 0 C2 - Type 1 - Direct Connect Constant mass flow rate and varying water temperature 1 C3 - Type 2 - Indipendent flow rate Varying mass flow (constant temperature) 2 C4 - Type 3 - Heat exchanger Intermittent flow rate module, ON-OFF and varying temperature 3 C5 - Type 4 - Anti-condensate Constant flow rate and vaiable heat exchange <ul> <li>Mixing valve: it is a boolean that indicates if a mixing valve is used. It refers to the varaible MIX_EM. Possible values: True or False</li> <li> <p>mixing valve delta: it is the offset temperature of the mixing valve in \u00b0C. It refers to the varaible mixing_valve_delta. </p> <ul> <li> <p>The offset refers to the temperature difference between the desired temperature and the actual temperature, which is applied when mixing hot and cold water.</p> </li> <li> <p>In this case, the parameter \u0394\u03b8H_em_mix_sahz_i represents the temperature offset applied by the mixing valve, with a default value set to 2\u00b0C (as defined in the code).</p> </li> <li> <p>This means that when the mixing valve is operating, it will allow a 2\u00b0C deviation from the desired temperature to account for system dynamics, such as heat losses, system inertia, or external temperature influences.</p> </li> </ul> </li> <li> <p>TB14: it is the table that contains the data of the emitter. If it is not provided the default values are used and the emitter_type is set to the first one in the table.</p> </li> </ul> <p>Table 3: Emitter data</p> Index Emitter nominal delta air Temp Emitter nominal delta water Temp Emitter exponent Radiator 50 20 1.3 Floor heating 15 5 1.1 Fan coil 25 10 1.0 <p>heat_emission_data: it is the table that contains the data of the emission circuit. If it is not provided the default values are used and the emitter_type is set to the first one in the table. In the code we have the function <code>_default_emission_data()</code> that returns the default values. These values are default emission circuit parameters for the heating system\u2019s secondary side (the side connected to heating emitters, such as radiators or underfloor heating).  They represent nominal and operational setpoints for a single heating zone (HZ1), including flow/return temperatures and load control factors.</p> <p>Table 4: Emission circuit data</p> Parameter (column name) Description Default Value Unit <code>\u03b8H_em_flw_max_sahz_i</code> Maximum flow temperature for the heating emission circuit 45 \u00b0C <code>\u0394\u03b8H_em_w_max_sahz_i</code> Maximum water flow/return temperature difference 8 \u00b0C <code>\u03b8H_em_ret_req_sahz_i</code> Desired return temperature of the emission circuit 20 \u00b0C <code>\u03b2H_em_req_sahz_i</code> Desired load factor with ON/OFF control 80 % <code>\u03b8H_em_flw_min_tz_i</code> Minimum required flow temperature for the thermal zone 28 \u00b0C"},{"location":"iso_15316_system_inputs/#distribution","title":"DISTRIBUTION","text":"<p><pre><code># --- distribution ---\n'heat_losses_recovered': True,\n'distribution_loss_recovery': 90,\n'simplified_approach': 80,\n'distribution_aux_recovery': 80,\n'distribution_aux_power': 30,\n'distribution_loss_coeff': 48,\n'distribution_operation_time': 1,\n</code></pre> The parameters are used inside the class HeatingSystemCalculator as:</p> <pre><code>self.Heat_losses_recovered = inp.get('heat_losses_recovered', True)\nself.f_h_dist_i_ls = inp.get('distribution_loss_recovery', 90)  # %\nself.simplified_or_holistic_approach = inp.get('simplified_approach', 80)  # %\nself.f_h_dist_i_aux = inp.get('distribution_aux_recovery', 80)  # %\nself.W_H_dist_i_aux = inp.get('distribution_aux_power', 30)  # W\nself.Heat_loss_coefficent_dist = inp.get('distribution_loss_coeff', 48)  # W/K\nself.tH_dis_i_ON = inp.get('distribution_operation_time', 1)  # h\n</code></pre> <p>if data is not provided by the user, the default values are used.</p> <p>These parameters describe the thermal and electrical behavior of the heat distribution subsystem, which connects the generator to the emitters (secondary circuits). They define how heat losses, auxiliary energy use, and simplifications in the calculation are handled within the ISO 15316-1 framework.</p> Variable Description Default Unit <code>heat_losses_recovered</code> Boolean flag that defines whether distribution heat losses are considered recoverable in the building (e.g., heat lost in indoor piping contributes to heating). <code>True</code> \u2013 <code>distribution_loss_recovery</code> (<code>f_h_dist_i_ls</code>) Fraction of distribution losses that are recoverable (typically within the heated zone). <code>90</code> % <code>simplified_approach</code> (<code>simplified_or_holistic_approach</code>) Defines the calculation approach for recovered losses: a simplified method (<code>&gt; 0</code>) or a holistic method (<code>0</code> for detailed ISO modeling). <code>80</code> % <code>distribution_aux_recovery</code> (<code>f_h_dist_i_aux</code>) Fraction of auxiliary electrical power (e.g., pumps, valves) that is converted into useful heat and recovered within the heated space. <code>80</code> % <code>distribution_aux_power</code> (<code>W_H_dist_i_aux</code>) Rated auxiliary electrical power of the distribution system (e.g., circulation pumps). <code>30</code> W <code>distribution_loss_coeff</code> (<code>Heat_loss_coefficent_dist</code>) Overall heat loss coefficient of the distribution system, representing thermal losses per degree of temperature difference between the fluid and ambient air. <code>48</code> W/K <code>distribution_operation_time</code> (<code>tH_dis_i_ON</code>) Average operation time of the distribution system per time step (typically the same as the emission system). <code>1</code> h"},{"location":"iso_15316_system_inputs/#generation","title":"GENERATION","text":"<p>The generator is modelled using the following parameters:</p> <pre><code>    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"])\n    '\u03b8HW_gen_flw_const': 50.0\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20\n</code></pre> <p>That are: </p> <ul> <li>load power: it is the power of the generator in kW, defined in the product data. variable name: 'full_load_power'</li> <li>max monthly load factor: it is the maximum load factor of the generator in %.  variable_name: 'max_monthly_load_factor'</li> <li>tH_gen_i_ON: it is the time of the generator in ON state in hours. variable_name: 'tH_gen_i_ON'</li> </ul> <ul> <li>auxiliary power generator: Percentage of generator input energy used by auxiliary systems (generally 0-5 %).Increases total system energy input. variable_name: 'auxiliary_power_generator'</li> <li> <p>fraction of auxiliary power generator: it is the portion of auxiliary energy recovered as heat (generally 20\u201360%). Reduces auxiliary losses.variable_name: 'fraction_of_auxiliary_power_generator'.</p> <p> 1. <code>auxiliary_power_generator</code> This parameter defines how much additional electrical power (in %) is consumed by the generator\u2019s own auxiliary components, such as:</p> <ul> <li>Circulation pumps  </li> <li>Combustion or ventilation fans  </li> <li>Electronic controls and sensors  </li> <li>Ignition systems  </li> <li>Internal electronics (standby mode)</li> </ul> <p>Formula:</p> \\[ E_{HW,gen,aux} = E_{HW,gen,in} \\times \\frac{\\text{auxiliary\\_power\\_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( E_{HW,gen,in} \\): Generator input energy (kWh)  </li> <li>\\( E_{HW,gen,aux} \\): Auxiliary energy consumed (kWh)</li> </ul> <p> 2. <code>fraction_of_auxiliary_power_generator</code></p> <p>This parameter represents the fraction of auxiliary power that is recoverable as useful heat. Some auxiliary systems release heat that can be recovered by the generator\u2019s thermal circuit.</p> <p>For example: - Pump motors or internal electronics may release part of their heat to the water loop. - Fans or controllers might dissipate energy inside the generator casing.</p> <p>Formula:</p> \\[ Q_{W,gen,i,ls,rbl,H} = E_{HW,gen,aux} \\times \\frac{\\text{fraction_of_auxiliary_power_generator}}{100} \\] <p>Where:</p> <ul> <li>\\( Q_{W,gen,i,ls,rbl,H} \\): Recovered auxiliary heat (kWh)</li> </ul> </li> </ul> <ul> <li>generator circuit: it is the circuit of the generator. It can be 'direct' or 'independent'. variable_name: 'generator_circuit'<ul> <li>Direct: the generator is connected to the primary circuit, no hydraulic separation primary = secondary</li> <li>Independent: the generator is connected to the secondary circuit, with hydraulic separator primary != secondary</li> </ul> </li> </ul> <p>The primary circuit supply temperature setpoint (Tp_sup_set), i.e., the flow temperature on the generator side (boiler, heat pump, etc.) is calculated using the function _generator_flow_setpoint(\u03b8ext, \u03b8H_dis_flw_demand), according to the selected control strategy of the generation system</p> <p>It determines how hot the generator should make the supply water based on: - the outdoor temperature (\u03b8ext), and/or - the heating demand from the distribution/emission side (\u03b8H_dis_flw_demand), and/or - a fixed setpoint defined by the user.</p> <p>The input parameters of the function are:</p> <ul> <li>\u03b8ext: outdoor air temperature</li> <li>\u03b8H_dis_flw_demand: Flow temperature requested by the secondary circuit (distribution/emission side)</li> </ul> <p>with global inputs that are:</p> <ul> <li>df_gen_out_temp: Table defining the primary (generator) heating curve</li> <li> <p>gen_flow_temp_control_type: Type of control used to control the flow temperature of the generator.Defines which control strategy is used (\u201cType A\u201d, \u201cType B\u201d, \u201cType C\u201d):</p> <ul> <li>'Type A - Based on outdoor temperature': uses primary's own weather curve</li> <li>'Type B - Based on demand'            : follows the secondary demand (\u03b8H_dis_flw)</li> <li>'Type C - Constant temperature'       : uses \u03b8HW_gen_flw_const</li> </ul> </li> <li> <p>\u03b8HW_gen_flw_const: Constant flow temperature of the generator</p> </li> </ul> <p>The user should provide the information directly in the dictionary:</p> <pre><code>'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n'gen_outdoor_temp_data': pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],\n    \"\u03b8flw_gen_min\": [35],\n}, index=[\"Generator curve\"])\n'\u03b8HW_gen_flw_const': 50.0\n</code></pre> <p>where, in the code are defined as: </p> <p><pre><code>self.df_gen_out_temp = inp.get('gen_outdoor_temp_data', pd.DataFrame({\n    \"\u03b8ext_min_gen\": [-7],\n    \"\u03b8ext_max_gen\": [15],\n    \"\u03b8flw_gen_max\": [60],   # \u00b0C, max primary supply\n    \"\u03b8flw_gen_min\": [35],   # \u00b0C, min primary supply\n}, index=[\"Generator curve\"]))\n\nself.gen_flow_temp_control_type = inp.get(\n    'gen_flow_temp_control_type',\n    'Type A - Based on outdoor temperature'   # 'Type A' | 'Type B' | 'Type C'\n)\n\nself.\u03b8HW_gen_flw_const = float(inp.get('\u03b8HW_gen_flw_const', 50.0))\n</code></pre> Explanation of the different type of control:</p> <ul> <li> Type A - Based on outdoor temperature. Climatic curve (outdoor compensation) <pre><code>if ctrl.startswith('Type A'):\n    if \u03b8ext_max != \u03b8ext_min:\n        Tp = \u03b8flw_min + (\u03b8flw_max - \u03b8flw_min) * (\u03b8ext_max - \u03b8ext) / (\u03b8ext_max - \u03b8ext_min)\n        return max(min(Tp, \u03b8flw_max), \u03b8flw_min)\n    return \u03b8flw_min\n</code></pre> Calculates the generator flow temperature linearly based on outdoor temperature. Equation: The generator flow temperature \\( T_{p, \\text{set}} \\) is calculated linearly based on the outdoor temperature \\( \\theta_{\\text{ext}} \\), following the formula:</li> </ul> \\[ T_{p, \\text{set}} = T_{\\text{flw}, \\text{min}} + \\left( T_{\\text{flw}, \\text{max}} - T_{\\text{flw}, \\text{min}} \\right) \\cdot \\frac{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}} \\right)}{\\left( \\theta_{\\text{ext}, \\text{max}} - \\theta_{\\text{ext}, \\text{min}} \\right)} \\] <p>Where:</p> <ul> <li>\\( T_{\\text{flw}, \\text{min}} \\) = minimum flow temperature (e.g., 35\u00b0C)</li> <li>\\( T_{\\text{flw}, \\text{max}} \\) = maximum flow temperature (e.g., 60\u00b0C)</li> <li>\\( \\theta_{\\text{ext}} \\) = outdoor air temperature</li> <li>\\( \\theta_{\\text{ext}, \\text{min}} \\) = minimum outdoor temperature (e.g., -7\u00b0C)</li> <li>\\( \\theta_{\\text{ext}, \\text{max}} \\) = maximum outdoor temperature (e.g., 15\u00b0C) The calculated \\( T_{p, \\text{set}} \\) is then clamped between the minimum and maximum values:</li> </ul> \\[ T_{p, \\text{set}} = \\max\\left( \\min\\left( T_{p, \\text{set}}, T_{\\text{flw}, \\text{max}} \\right), T_{\\text{flw}, \\text{min}} \\right) \\] <p>\ud83d\udc49\ud83c\udffb Meaning: This is the typical weather-compensated control used (for example) in boilers and heat pumps. It automatically adjusts water temperature to the outdoor conditions for better efficiency and comfort. Example visualization of type A: <pre><code>Generator flow temperature (\u00b0C)\n\u2502\n\u2502    60\u00b0C \u2500\u2500\u2500\u2500\u2510\n\u2502              \\\n\u2502               \\\n\u2502                \\\n\u2502                 \\\n\u2502    35\u00b0C \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba Outdoor temperature (\u00b0C)\n          -7          0           +15\n</code></pre></p> <ul> <li> <p> Type B - Based on demand. Follow secondary demand <pre><code>if ctrl.startswith('Type B'):\n    return float(\u03b8H_dis_flw_demand)\n</code></pre> Sets the generator supply temperature equal to the demand from the secondary (distribution/emission) side. \ud83d\udc49\ud83c\udffb Meaning: This is used in systems with hydraulic separation (e.g., with a buffer tank or heat exchanger) where the generator must match the needs of the secondary circuit dynamically. Example: If the radiator loop requests 45 \u00b0C \u2192 the generator must deliver exactly 45 \u00b0C to maintain balance.</p> </li> <li> <p> Type C - Constant temperature <pre><code>return float(self.\u03b8HW_gen_flw_const)\n</code></pre> Ignores weather and demand \u2014 the generator runs at a fixed supply temperature (e.g., 50 \u00b0C). \ud83d\udc49\ud83c\udffb Meaning: Simplest and oldest control type, often found in small or legacy heating systems. It offers no adaptation to weather or load, typically less efficient. Example: If the user defines a constant supply temperature of 50 \u00b0C \u2192 the generator will always deliver 50 \u00b0C, regardless of the demand from the secondary circuit.</p> </li> </ul> <ul> <li>speed control of generator pump: icontrols how \u0394T varies with system load (constant vs variable). It can be in the code 'variable' or 'deltaT_constant'. variable_name: 'speed_control_generator_pump'</li> <li> <p>Nominal water deltaT of generator: defines the nominal \u0394T at design (full load) \u2014 the reference used in thermal balance equations in \u00b0C. variable_name: 'generator_nominal_deltaT'. It is used if speed_control_of_generator_pump is 'deltaT_constant'.</p> <p>More info:</p> <ul> <li><code>\"deltaT_constant\"</code> \u2192 The pump maintains a fixed temperature difference (\u0394T) between flow and return.</li> <li>Example: The pump adjusts its speed so that \u0394T = 20 \u00b0C remains constant.</li> <li><code>\"variable\"</code> \u2192 The pump varies its speed dynamically according to the system load.</li> <li>When heating demand decreases, the water flow rate decreases.</li> <li>This leads to a smaller \u0394T at partial loads, improving efficiency.</li> </ul> <p>When <code>variable</code>, the temperature difference (\u0394T) decreases proportionally with the thermal load, which represents real modulating behavior of pumps and heat generators.</p> <p><code>generator_nominal_deltaT</code></p> <p>Defines the nominal temperature difference (\u0394T) between the generator flow and return at full-load conditions.</p> \\[ \\Delta T_{nom} = T_{flow,nominal} - T_{return,nominal} \\] <p>This is the design operating condition for the generator, used as a reference in calculations.</p> <p>Example:</p> <p>If <code>generator_nominal_deltaT = 20</code>, then at full load:</p> <ul> <li>Supply temperature = 60 \u00b0C  </li> <li>Return temperature = 40 \u00b0C \u2192 \u0394T = 20 \u00b0C  </li> </ul> <p>At partial load:</p> <ul> <li>If <code>speed_control_generator_pump = \"deltaT_constant\"</code> \u2192 \u0394T remains 20 \u00b0C.  </li> <li>If <code>speed_control_generator_pump = \"variable\"</code> \u2192 \u0394T may drop to 10\u201315 \u00b0C, depending on demand.</li> </ul> </li> </ul> <p>It is possible to define the optional primary setpoints (used if circuit is independent).</p> <ul> <li>\u03b8HW_gen_flw_set: flow temperature setpoint</li> <li>\u03b8HW_gen_ret_set: return temperature setpoint</li> </ul>"},{"location":"iso_15316_system_inputs/#general","title":"GENERAL","text":"<p>Efficiency model</p> <p>The calculation of efficiency can be done using three type of choices: </p> <pre><code>1) 'simple'       : linear heuristic vs. return temperature\n2) 'parametric'   : piecewise/threshold model\n3) 'manufacturer' : 1D (return) or 2D (flow/return) map\n</code></pre> <p>the calculation is made using the function _efficiency_from_model() that requires one of the above options: simple, parameteric, manufacturer. It calculates how efficiently the generator converts input energy (like gas, electricity, or fuel) into useful heat, depending on the flow (\u03b8flw) and return (\u03b8ret) water temperatures on the primary circuit side. Explanation of each option:</p> <p>1) 'simple': it is a linear heuristic based on the return temperature.  <pre><code>if model == 'simple':\n    if \u03b8ret &lt; 50.0:\n        eff = 110.0 - 0.5 * (\u03b8ret - 20.0)\n    else:\n        eff = 95.0\n    return max(min(eff, 110.0), 1.0)\n</code></pre> This is a simplified heuristic formula typically used for condensing boilers:</p> <ul> <li>When the return temperature (\u03b8ret) is below 50\u00b0C, condensation occurs in the flue gases, recovering latent heat.      \u2192 The efficiency increases up to ~110% (based on lower heating value, PCI).</li> <li>When \u03b8ret \u2265 50\u00b0C, condensation stops, and the efficiency drops to around 95%.</li> </ul> <p>Meaning: | Condition | Return Temp | Typical Generator Behavior | Efficiency | Condesning mode | &lt; 50\u00b0C | Flue gas condensation \u2192 higher recovery | 95-110% | Ono-condensing |  \u2265 50\u00b0C | No condensation | ~95% |</p> <p>2) 'parametric': it is a piecewise/threshold model based on the linear interpolation of return temperature.  <pre><code>if model == 'parametric':\n    eta_max = self.eta_max\n    eta_nc  = self.eta_no_cond\n    T_min   = self.T_ret_min\n    T_thr   = self.T_ret_thr\n\n    Tret_clip = max(min(\u03b8ret, T_thr), T_min)\n    slope = (eta_max - eta_nc) / (T_min - T_thr)\n    if \u03b8ret &lt;= T_thr:\n        eff = eta_max + slope * (Tret_clip - T_min)\n    else:\n        eff = eta_nc\n</code></pre> This is a parameterized linear model that allows flexible configuration without a full manufacturer curve:</p> <ul> <li>eta_max: maximum efficiency (e.g., 110%) when return temperature is low (T_min)</li> <li>eta_nc: non-condensing efficiency (e.g., 95%) when return temperature is high (T_thr)</li> <li>T_min: minimum return temperature (lower bound of condensing operation)</li> <li>T_thr: threshold temperature where condensation ceases</li> </ul> <p>The function linearly interpolates between these two operating points.</p> <p>Meaning:</p> Region Return Temp Efficiency trend Region 1 \u03b8ret &lt;= T_thr Linear decrease from \u03b7_max (at T_min) to \u03b7_nc (at T_thr) Region 2 \u03b8ret &gt; T_thr Constant \u03b7_nc (no more condensation) <p>This model offers a tunable middle ground between the simple heuristic and a full manufacturer curve \u2014 it\u2019s ideal for parametric studies or sensitivity analyses.</p> <p>3) 'manufacturer': it is a 1D (return) or 2D (flow/return) map based on the manufacturer curve.  <pre><code>if model == 'manufacturer':\n    # (a) 1D curve eff = f(Tret)\n    # (b) 2D surface eff = f(Tflw, Tret)\n</code></pre></p> <p>This model uses real efficiency maps provided by the equipment manufacturer.</p> <p>(a) 1D curve</p> <ul> <li>The efficiency is interpolated from a list of measured points: Tret = [20, 30, 40, 50, 60], eta = [109, 106, 101, 95, 93].</li> <li>Uses linear interpolation to find the efficiency for the given \u03b8ret.</li> </ul> <p>(b) 2D surface</p> <ul> <li>For more detailed manufacturer data, efficiency is given as a grid (matrix) depending on both flow and return temperatures.</li> <li>Bilinear interpolation is used between the four nearest points (Q11, Q12, Q21, Q22) to compute an accurate efficiency value.</li> </ul> <p>Meaning:</p> Type Inputs Accuracy Typical Use 1D Return temperature only Moderate Simplified manufacturer data 2D Flow + return temperatures High Detailed boiler performance maps <p>If the manufacturer data is missing or invalid, the function falls back to the simple heuristic.</p> <p>Calculation Model:</p> <pre><code>    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full'\n</code></pre> <p>It controls what the program does when the heating demand (Q_H) is zero or negative \u2014 i.e., when there is no heating load required in that timestep.</p> <p>Every timestep in the timeseries (typically 1 hour) has:</p> <ul> <li>qh \u2192 heating demand in kWh</li> <li>\u03b8int \u2192 indoor air temperature</li> <li>\u03b8ext \u2192 outdoor temperature</li> </ul> <p>The model decides how to behave based on the value of qh and the user-defined policy flags:</p> <ul> <li>calc_when_QH_positive_only</li> <li>off_compute_mode</li> </ul> <p>These two flags control what happens when the heating load = 0.</p> <p>Step by Step Logic</p> <p>1) Detect zero or negative heating demand</p> <p><pre><code>if float(qh) &lt;= 0:\n</code></pre> This means there is no heating required (or possibly cooling). Now the function checks which policy is set for such cases.</p> <p>2) Case 1 \u2014 Full simulation even when Q_H = 0 <pre><code>if not self.calc_when_QH_positive_only:\n    # Full calculation even with zero load\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n    ...\n</code></pre></p> <ul> <li>Here, the flag calc_when_QH_positive_only is False, so the user wants to compute everything even when there\u2019s no load.</li> <li> <p>It runs the complete thermal balance by calling: <pre><code>res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre> This means: compute system temperatures, efficiencies, flow rates, etc., as if the system were still active but with zero heating power.</p> </li> <li> <p>The results are appended to the output DataFrame as usual.</p> </li> </ul> <p>Use case: See how the system behaves under \u201cno load\u201d conditions (e.g., during shoulder months) \u2014 including standby losses or auxiliary power.</p> <p>3) Case 2 \u2014 Skip detailed calculation (calc_when_QH_positive_only = True)</p> <p>If this flag is True, the system should behave differently depending on how \u201coff periods\u201d are treated.</p> <p>There are three \u201coff modes\u201d controlled by self.off_compute_mode.</p> <ul> <li> <p> a) Mode: 'idle' \u2192 Minimal record  <pre><code>if self.off_compute_mode == 'idle':\n    res_row = {'timestamp': idx}\n    res_row.update(self._idle_row(0.0, float(\u03b8int), float(\u03b8ext)))\n</code></pre></p> <ul> <li>Produces a minimal output line using _idle_row().</li> <li>This function fills the row mostly with zeros or NaN values \u2014 representing that nothing is being calculated because the system is idle.</li> <li>Only basic fields like timestamp, indoor temperature, and outdoor temperature are kept.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For speed optimization when simulating a full year \u2014 avoids doing unnecessary physics calculations.</p> </li> <li> <p> b) Mode: 'temps' \u2192 Record only temperatures  <pre><code>elif self.off_compute_mode == 'temps':\n    res = self._temps_row_when_off(float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>This still computes temperatures (like circuit or node flow/return) using _temps_row_when_off(),</li> <li>but all energetic terms (flows, powers, losses) are set to zero.</li> <li>This way, you can visualize how the temperature control or mixing valves behave even with zero heating demand.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: For continuous temperature mapping, useful when validating system controls or comfort conditions.</p> </li> <li> <p> c) Mode: 'full' \u2192 Full calculation despite Q_H = 0  <pre><code>elif self.off_compute_mode == 'full':\n    res = self.compute_step(0.0, float(\u03b8int), float(\u03b8ext))\n</code></pre></p> <ul> <li>Similar to Case 1 but triggered explicitly by mode 'full' \u2014 performs a complete computation of all variables even if load = 0.</li> <li>This is a \u201cforce full calc\u201d inside the zero-demand policy.</li> </ul> <p>\ud83d\udc49\ud83c\udffb Use case: When testing or debugging; ensures identical data structure across all timesteps.</p> </li> </ul> <p>4) continue statements</p> <p>Each branch ends with continue \u2014 \u2192 meaning the loop moves to the next timestep immediately after handling this case. No further code in the timestep is executed once the \u201czero-load\u201d policy has been applied.</p> <p>General-physical interpretation </p> <p>This logic helps balance accuracy vs performance:</p> <p>In annual simulations (8760 hours), 70\u201390% of the time may have zero heating demand (e.g., in summer). Recomputing all hydraulic and thermal equations each hour would waste time.</p> <p>Therefore, this control allows skipping unnecessary computations or simplifying the result depending on your simulation purpose:</p> <ul> <li>\"idle\" \u2192 fastest</li> <li>\"temps\" \u2192 medium (keep comfort analysis)</li> <li>\"full\" \u2192 slowest but most complete</li> </ul> <p>Example of inputs system: <pre><code>INPUT_SYSTEM_HVAC  = {\n\n    # ---- emitter ----\n    'emitter_type': 'Floor heating',\n    'nominal_power': 8,\n    'emission_efficiency': 90,\n    'flow_temp_control_type': 'Type 2 - Based on outdoor temperature',\n    'selected_emm_cont_circuit': 0,\n    'mixing_valve': True,\n    # 'TB14': custom_TB14, #  &lt;- Uncomment and upload your emittere table, oterwhise the default stored in gloabl_inputs.py is used\n    'heat_emission_data' : pd.DataFrame({\n            \"\u03b8H_em_flw_max_sahz_i\": [45],\n            \"\u0394\u03b8H_em_w_max_sahz_i\": [8],\n            \"\u03b8H_em_ret_req_sahz_i\": [20],\n            \"\u03b2H_em_req_sahz_i\": [80],\n            \"\u03b8H_em_flw_min_tz_i\": [28],\n        }, index=[\n            \"Max flow temperature HZ1\",\n            \"Max \u0394\u03b8 flow / return HZ1\",\n            \"Desired return temperature HZ1\",\n            \"Desired load factor with ON-OFF for HZ1\",\n            \"Minimum flow temperature for HZ1\"\n        ])\n\n    # --- distribution ---\n    'heat_losses_recovered': True,\n    'distribution_loss_recovery': 90,\n    'simplified_approach': 80,\n    'distribution_aux_recovery': 80,\n    'distribution_aux_power': 30,\n    'distribution_loss_coeff': 48,\n    'distribution_operation_time': 1,\n\n    # --- generator ---\n    'full_load_power': 27,                  # kW\n    'max_monthly_load_factor': 100,         # %\n    'tH_gen_i_ON': 1,                       # h\n    'auxiliary_power_generator': 0,         # %\n    'fraction_of_auxiliary_power_generator': 40,   # %\n    'generator_circuit': 'independent',     # 'direct' | 'independent'\n    # Optional explicit generator setpoints (commented by default)\n    # '\u03b8HW_gen_flw_set': 50,\n    # '\u03b8HW_gen_ret_set': 40,\n    # Primary: independent climatic curve\n    'gen_flow_temp_control_type': 'Type A - Based on outdoor temperature',\n    'gen_outdoor_temp_data': pd.DataFrame({\n        \"\u03b8ext_min_gen\": [-7],\n        \"\u03b8ext_max_gen\": [15],\n        \"\u03b8flw_gen_max\": [60],\n        \"\u03b8flw_gen_min\": [35],\n    }, index=[\"Generator curve\"]),\n\n    'speed_control_generator_pump': 'variable',\n    'generator_nominal_deltaT': 20,         # \u00b0C\n\n    # Efficiency model\n    'efficiency_model': 'simple',\n\n    # Calculation options\n    'calc_when_QH_positive_only': False,\n    'off_compute_mode': 'full',\n}\n</code></pre></p>"},{"location":"iso_52016/","title":"ISO 52016 - Introduction","text":""},{"location":"iso_52016/#iso-5201052016-building-simulation-module-level-technical-notes","title":"ISO 52010/52016 Building Simulation \u2013 Module-level Technical Notes","text":"<p>Scope: this document is strictly focused on the existing modules and the current data structure you shared: - <code>global_inputs.py</code> - <code>generate_profile.py</code> - <code>ventilation.py</code> - Input schema <code>BUI</code> (Python dict)</p> <p>It explains each function\u2019s purpose, physics, inputs/outputs, algorithmic flow, and edge cases. All equations use SI unless otherwise stated.</p>"},{"location":"iso_52016/#1-input-schema-bui-data-contract","title":"1) Input Schema \u2014 <code>BUI</code> (data contract)","text":"<p>This dictionary is the canonical input. It provides: - Site (lat/lon, azimuth), morphology (perimeter, height, thickness), program (type class), adjacent zones, surfaces, and system/profiles.</p>"},{"location":"iso_52016/#11-semantics-selected-keys","title":"1.1 Semantics (selected keys)","text":"<ul> <li><code>building.azimuth_relative_to_true_north</code> <code>[deg]</code>: clockwise from true North (0=N, 90=E).</li> <li><code>building.exposed_perimeter</code> <code>[m]</code>: used in some ISO ground/perimeter correlations.</li> <li><code>building.wall_thickness</code> <code>[m]</code>: wall layer total thickness (used e.g. for geometric checks / future U recalcs).</li> <li><code>building.adj_zones_present</code> <code>[bool]</code>: master switch for unconditioned / adjacent zones coupling.</li> <li><code>adjacent_zones[*].orientation_zone.azimuth</code> <code>[deg]</code>: local azimuth of each adjacent unconditioned zone.</li> <li><code>adjacent_zones[*].area_facade_elements</code> <code>[m\u00b2]</code>: areas per element (vector aligned with <code>typology_elements</code> and <code>orientation_elements</code>).</li> <li><code>adjacent_zones[*].typology_elements</code>: element types:</li> <li><code>OP</code> = opaque envelope element,</li> <li><code>GR</code> = ground-coupled,   (extendable: <code>TR</code> windows, etc., if needed in future).</li> <li><code>adjacent_zones[*].transmittance_U_elements</code> <code>[W\u00b7m\u207b\u00b2\u00b7K\u207b\u00b9]</code>: U by element, 1:1 with areas.</li> <li><code>adjacent_zones[*].orientation_elements</code>: orientation code by element:</li> <li><code>NV</code> North-vertical (\u22480\u00b0), <code>SV</code> South-vertical (\u2248180\u00b0),</li> <li><code>EV</code> East-vertical (\u224890\u00b0),  <code>WV</code> West-vertical (\u2248270\u00b0),</li> <li><code>HOR</code> horizontal (roof/slab).</li> <li><code>adjacent_zones[*].volume</code> <code>[m\u00b3]</code>: air volume of unconditioned zone (used for air change calc).</li> <li><code>adjacent_zones[*].a_use</code> <code>[m\u00b2]</code>: useful area of the adjacent zone (for internal gains split).</li> <li><code>building_surface[*]</code>: explicit building surfaces (opaque + transparent), with:</li> <li><code>u_value</code> <code>[W\u00b7m\u207b\u00b2\u00b7K\u207b\u00b9]</code>, <code>g_value</code> (for transparent), <code>solar_absorptance</code> <code>[-]</code>,</li> <li><code>orientation</code> (<code>azimuth</code> <code>[deg]</code>, <code>tilt</code> <code>[deg]</code>),</li> <li>optional <code>name_adj_zone</code> to bind a surface to a specific unconditioned adjacent zone name.</li> <li><code>building_parameters.*</code>: setpoints, capacities, airflow rates (ACH), internal gains profiles, and ON/OFF schedules.</li> </ul> <p>Note: The current modules consume only a subset (ventilation, internal gains, adjacent zone transmission). The fields are intentionally richer to allow later coupling with ISO 52010 solar/sky and ISO 52016 balance.</p>"},{"location":"iso_52016/#2-global_inputspy-static-data-constants","title":"2) <code>global_inputs.py</code> \u2014 Static data &amp; constants","text":""},{"location":"iso_52016/#21-purpose","title":"2.1 Purpose","text":"<ul> <li>Provide reference tables (e.g., ISO 13789 <code>n_ue</code> air-tightness classes) and thermophysical constants.</li> <li>Contain an emitter table <code>TB14</code> (\u0394T exponents).</li> </ul>"},{"location":"iso_52016/#22-key-objects","title":"2.2 Key Objects","text":"<ul> <li><code>periods</code>, <code>bui_types</code>, <code>months</code>: taxonomies.</li> <li><code>WATER_DENSITY = 1000</code> <code>[kg\u00b7m\u207b\u00b3]</code></li> <li><code>WATER_SPECIFIC_HEAT_CAPACITY = 0.00116</code> <code>[kWh\u00b7kg\u207b\u00b9\u00b7K\u207b\u00b9]</code> (\u2192 multiply by <code>kg</code> and <code>\u0394T</code> to get kWh)</li> <li><code>df_n_ue</code> \u2014 ISO 13789:2018 (Table 7) conventional air change rate between unconditioned space and exterior:</li> </ul> code description (air-tightness) <code>n_ue</code> [h\u207b\u00b9] 1 No doors/windows openings 0.1 2 All joints well sealed, no openings 0.5 3 Well sealed, small openings 1.0 4 Some localized open joints 3.0 5 Numerous open joints / large openings 10.0 <ul> <li><code>TB14</code> \u2014 emitter exponents and nominal \u0394T:</li> <li>Radiator: <code>n=1.3</code>, <code>\u0394\u03b8_air=50\u00b0C</code>, <code>\u0394\u03b8_water=20\u00b0C</code></li> <li>Floor heating: <code>n=1.1</code>, <code>\u0394\u03b8_air=15\u00b0C</code>, <code>\u0394\u03b8_water=5\u00b0C</code></li> <li>Fan coil: <code>n=1.0</code>, <code>\u0394\u03b8_air=25\u00b0C</code>, <code>\u0394\u03b8_water=10\u00b0C</code></li> </ul>"},{"location":"iso_52016/#23-usage-physics","title":"2.3 Usage &amp; Physics","text":"<ul> <li><code>n_ue</code> maps directly into adjacent unconditioned zone ventilation (see \u00a74.3), i.e. <code>que = V_u \u00b7 n_ue</code> <code>[m\u00b3\u00b7h\u207b\u00b9]</code>.</li> <li>Water constants are useful for DHW/emitters energy conversions (not used inside <code>ventilation.py</code> yet).</li> </ul>"},{"location":"iso_52016/#3-generate_profilepy-hourly-operational-profiles","title":"3) <code>generate_profile.py</code> \u2014 Hourly operational profiles","text":""},{"location":"iso_52016/#31-purpose","title":"3.1 Purpose","text":"<p>Generate a 13-month hourly DataFrame with working/holiday flags and per-category profiles: <code>{ventilation, heating, cooling, occupancy, lighting, appliances}</code>.</p>"},{"location":"iso_52016/#32-public-api","title":"3.2 Public API","text":""},{"location":"iso_52016/#class","title":"Class","text":"<pre><code>class HourlyProfileGenerator:\n    def __init__(country='IT', num_months=13, start_year=None,\n                 working_day_profile=None, holiday_profile=None,\n                 category_profiles=None)\n</code></pre>"},{"location":"iso_52016/#methods","title":"Methods","text":"<ul> <li><code>generate() -&gt; pd.DataFrame</code></li> <li><code>get_summary() -&gt; None</code></li> <li><code>plot_annual_profiles(categories=None, freq=\"H\", include_weekend_shading=True, title=\"...\") -&gt; plotly.graph_objects.Figure</code></li> </ul>"},{"location":"iso_52016/#33-physics-semantics","title":"3.3 Physics &amp; Semantics","text":"<ul> <li>Profiles are dimensionless multipliers in <code>[0,1]</code> applied to full-load densities (e.g., W\u00b7m\u207b\u00b2 or l\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2) to produce hour-by-hour loads/flows.  </li> <li>Holidays via <code>holidays</code> lib using <code>country</code> 2-letter code; weekends = Sat/Sun.</li> </ul>"},{"location":"iso_52016/#34-normalization-rules","title":"3.4 Normalization Rules","text":"<p>Each category <code>c</code> stores two 24-length arrays: - <code>c_profile</code> on weekday vs holiday/weekend. - Given an hour <code>h</code>, final profile value is: [ p_c(h, d) = \\begin{cases} p_{c,\\mathrm{wd}}(h), &amp; \\text{if } d \\text{ is a working day}\\ p_{c,\\mathrm{hd}}(h), &amp; \\text{if } d \\text{ is holiday/weekend} \\end{cases} \\tag{3.1} ]</p>"},{"location":"iso_52016/#35-outputs","title":"3.5 Outputs","text":"<p><code>generate()</code> returns a DataFrame with: - time columns: <code>datetime</code>, <code>date</code>, <code>hour</code>, <code>day_of_week</code>, <code>day_name</code> - flags: <code>is_holiday</code>, <code>is_weekend</code>, <code>is_working_day</code>, <code>holiday_name</code> - per-category: <code>ventilation_profile</code>, <code>heating_profile</code>, \u2026, <code>appliances_profile</code> - legacy: <code>profile_value</code> (alias of <code>occupancy_profile</code>), <code>day_type</code></p>"},{"location":"iso_52016/#36-edge-cases","title":"3.6 Edge Cases","text":"<ul> <li>If <code>category_profiles</code> is missing a key, defaults are copied from <code>working_day_profile</code> / <code>holiday_profile</code> (or built-in defaults).</li> <li>Input validation enforces 24-length arrays.</li> </ul>"},{"location":"iso_52016/#4-ventilationpy-ventilation-conductance-internal-gains-and-iso-13789-adjacent-zone-coupling","title":"4) <code>ventilation.py</code> \u2014 Ventilation conductance, internal gains, and ISO 13789 adjacent-zone coupling","text":""},{"location":"iso_52016/#41-data-classes","title":"4.1 Data classes","text":"<p><pre><code>@dataclass\nclass h_natural_vent:\n    H_ve_nat: np.ndarray\n</code></pre> Currently a thin container (kept for future interface symmetry).</p>"},{"location":"iso_52016/#42-heat_transfer_coefficient_by_ventilation","title":"4.2 <code>heat_transfer_coefficient_by_ventilation(...)</code>","text":"<p>Physical purpose: compute the ventilation heat transfer coefficient \\(H_{ve}\\) <code>[W\u00b7K\u207b\u00b9]</code> of the thermal zone either: - from natural ventilation (ISO 16798-7:2017, single-sided airing via windows, wind/stack), or - from occupancy-driven flow (simplified volumetric rate per floor area).</p>"},{"location":"iso_52016/#signature","title":"Signature","text":"<pre><code>@staticmethod\ndef heat_transfer_coefficient_by_ventilation(\n    building_object, Tz, Te, u_site, Rw_arg_i=None, c_air=1006, \n    rho_air=1.204, C_wnd=0.001, C_st=0.0035, rho_a_ref=1.204, altitude=None,\n    type_ventilation=\"temp_wind\", flowrate_person=1.4\n) -&gt; h_natural_vent:\n</code></pre>"},{"location":"iso_52016/#inputs-main","title":"Inputs (main)","text":"<ul> <li><code>Tz</code> <code>[\u00b0C]</code> indoor air temperature (zone).</li> <li><code>Te</code> <code>[\u00b0C]</code> outdoor air temperature.</li> <li><code>u_site</code> <code>[m\u00b7s\u207b\u00b9]</code> local wind speed at site height (as per ISO 16798-7 assumptions).</li> <li><code>Rw_arg_i</code> <code>[-]</code> array of opening ratios per window (<code>0\u20261</code>). If <code>None</code>, defaults to <code>0.9</code>.</li> <li><code>C_wnd = 0.001</code> <code>[(m\u00b7s\u207b\u00b9)\u207b\u00b9]</code> wind coefficient (ISO 16798-7 Table 11).</li> <li><code>C_st = 0.0035</code> <code>[(m\u00b7s\u207b\u00b9)/(m\u00b7K)]</code> stack coefficient (ISO 16798-7 Table 11).</li> <li><code>rho_a_ref</code> <code>[kg\u00b7m\u207b\u00b3]</code> reference air density at ~20 \u00b0C; corrected with <code>altitude</code> if provided.</li> <li><code>type_ventilation</code>: <code>\"temp_wind\"</code> (ISO airing) or <code>\"occupancy\"</code> (area-based volumetric rule).</li> <li><code>flowrate_person</code> <code>[L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2]</code> used only in <code>\"occupancy\"</code> branch.</li> </ul>"},{"location":"iso_52016/#physics","title":"Physics","text":"<p>Step A \u2014 Effective opening height (stack path) For each transparent surface: - parapet height \\(h_p\\) <code>[m]</code>, - window height \\(h_w\\) <code>[m]</code>, - path height (vertical center): \\(h_{path,i} = h_p + \\frac{h_w}{2}\\), - fa height: \\(h_{fa,i} = \\frac{h_w}{2}\\).</p> <p>The useful stack height: [ h_{w,st} = \\max_i!\\left(h_{path,i} + \\frac{h_{fa,i}}{2}\\right) - \\min_i!\\left(h_{path,i} - \\frac{h_{fa,i}}{2}\\right) \\tag{4.1} ]</p> <p>Step B \u2014 Density correction If <code>altitude</code> present, a standard atmosphere relation updates \\(\\rho_{a,ref}\\). Outdoor density: [ \\rho_{a,e} = \\rho_{a,ref}\\,\\frac{291.15}{273.15 + T_e} \\tag{4.2} ]</p> <p>Step C \u2014 Effective openable area For each window \\(i\\), geometric area \\(A_{w,i} = h_{w,i}\\,w_i\\). Open area \\(A_{w,i}^{open} = A_{w,i}\\,R_{w,i}\\) with \\(R_{w,i}\\in[0,1]\\). If <code>Rw_arg_i</code> is missing or length mismatches the number of windows, default \\(R_{w,i}=0.9\\). [ A_{w,tot} = \\sum_i A_{w,i}^{open} \\tag{4.3} ]</p> <p>Step D \u2014 Airing volumetric flow (single-sided) Using ISO 16798-7 \u00a76.4.3.5.4: [ q_v = 3600\\;\\frac{\\rho_{a,ref}}{\\rho_{a,e}}\\;\\frac{A_{w,tot}}{2}\\, \\left[\\max!\\Big(C_{wnd}\\,u_{site}^2,\\; C_{st}\\,h_{w,st}\\,\\lvert T_z-T_e\\rvert\\Big)\\right]^{1/2} \\quad [\\text{m}^3/\\text{h}] \\tag{4.4} ]</p> <p>Step E \u2014 Ventilation conductance [ H_{ve} = \\frac{c_{air}\\,\\rho_{air}}{3600}\\;q_v \\quad [\\text{W\u00b7K}^{-1}] \\tag{4.5} ]</p> <p>Occupancy branch: area-based simplified rule (constant per hour) [ H_{ve} = A_{use}\\cdot (3.6\\,\\dot v_{pers})\\cdot \\frac{c_{air}\\,\\rho_{air}}{3600} \\tag{4.6} ] with \\(\\dot v_{pers}\\) in <code>[L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2]</code> and <code>3.6</code> converting L\u00b7s\u207b\u00b9\u00b7m\u207b\u00b2 to m\u00b3\u00b7h\u207b\u00b9\u00b7m\u207b\u00b2.</p>"},{"location":"iso_52016/#outputs","title":"Outputs","text":"<ul> <li><code>np.ndarray</code> of <code>H_ve_k_t</code> <code>[W\u00b7K\u207b\u00b9]</code> (scalar or time-series depending on inputs).</li> </ul>"},{"location":"iso_52016/#algorithm-pseudo","title":"Algorithm (pseudo)","text":"<pre><code>if type_ventilation == \"temp_wind\":\n    extract all windows -&gt; {height, width, parapet}\n    compute hw_path_i, hw_fa_i -&gt; hw_st  # Eq. (4.1)\n    density correction -&gt; rho_a_e        # Eq. (4.2)\n    aw_tot -&gt; Eq. (4.3)\n    qv -&gt; Eq. (4.4)\n    Hve -&gt; Eq. (4.5)\nelse:  # occupancy\n    A_use &lt;- building_object[\"building\"][\"net_floor_area\"]\n    Hve  &lt;- Eq. (4.6)\nreturn np.array(Hve)\n</code></pre>"},{"location":"iso_52016/#edge-cases-validation","title":"Edge Cases &amp; Validation","text":"<ul> <li>No transparent surfaces \u2192 \\(A_{w,tot}=0\\) \u2192 \\(H_{ve}=0\\).</li> <li><code>Rw_arg_i</code> length mismatch \u2192 warning + default 0.9.</li> <li>Negative or null <code>u_site</code> accepted; <code>max(\u00b7)</code> ensures stack/wind pick the dominant driver.</li> </ul>"},{"location":"iso_52016/#43-internal_gains","title":"4.3 <code>internal_gains(...)</code>","text":"<p>Physical purpose: compute internal sensible gains \\(\\Phi_{int}\\) <code>[W]</code> in the thermally conditioned zone, possibly accounting for spillover to adjacent unconditioned zones.</p>"},{"location":"iso_52016/#signature_1","title":"Signature","text":"<pre><code>def internal_gains(\n    cls, building_type_class, a_use, unconditioned_zones_nearby=False,\n    list_adj_zones=None, Fztc_ztu_m: float=1, b_ztu: float=1,\n    h_occup: float=1, h_app: float=1, h_light: float=1, h_dhw: float=1,\n    h_hvac: float=1, h_proc: float=1\n) -&gt; float:\n</code></pre>"},{"location":"iso_52016/#inputs-main_1","title":"Inputs (main)","text":"<ul> <li><code>building_type_class</code>: key for the lookup table <code>internal_gains_occupants</code> (imported from <code>source.table_iso_16798_1</code>).</li> <li><code>a_use</code> <code>[m\u00b2]</code>: useful area of the conditioned zone.</li> <li><code>h_*</code> <code>[-]</code>: hourly multipliers (profiles) for each sub-component (currently occupants and appliances are used).</li> <li>Coupling params for unconditioned zones:</li> <li><code>b_ztu</code> <code>[-]</code>: adjustment factor of the adjacent unconditioned zone (see \u00a74.4, Eq. (4.13)).</li> <li><code>Fztc_ztu_m</code> <code>[-]</code>: fractional path factor conditioned\u2192unconditioned in month <code>m</code> (lumped path coefficient).</li> <li><code>list_adj_zones</code>: number of adjacent zones (note: the current signature expects an int; see note below).</li> </ul> <p>Note: The code uses <code>for zones in range(list_adj_zones)</code> \u2014 pass an <code>int</code>. If a list is desired in the future, change to <code>for z in list_adj_zones:</code>.</p>"},{"location":"iso_52016/#physics_1","title":"Physics","text":"<p>Let \\(q_{occ}\\) and \\(q_{app}\\) be the nominal density of internal gains <code>[W\u00b7m\u207b\u00b2]</code> for occupants/equipment per <code>building_type_class</code>.</p> <p>Base internal gains in the conditioned zone: [ \\Phi_{int,z}(t) = \\big(q_{occ}\\,h_{occup}(t) + q_{app}\\,h_{app}(t)\\big)\\;A_{use} \\tag{4.7} ]</p> <p>Optional spillover to unconditioned adjacent zones (<code>unconditioned_zones_nearby = True</code>): The code currently adds a further term per adjacent zone combining a direct duplicated contribution and a fractional transfer modulated by \\((1-b_{ztu})\\,F_{ztc{\\text -}ztu,m}\\): [ \\Phi_{int,z}^{eff}(t) = \\Phi_{int,z}(t) + \\sum_{j=1}^{N_{adj}} \\left[\\Phi_{int,z}(t) + \\big(1-b_{ztu}\\big)\\,F_{ztc{\\text -}ztu,m}\\,\\Phi_{int,z}(t)\\right] \\tag{4.8} ]</p> <p>Remark: Eq. (4.8) mirrors the present implementation logic. In a thermodynamic sense, one might prefer partitioning \\(\\Phi_{int}\\) (instead of adding duplicates) across coupling paths; if you intend to conserve energy strictly, revisit this formulation.</p>"},{"location":"iso_52016/#output","title":"Output","text":"<ul> <li><code>float</code> <code>[W]</code> \u2014 instantaneous internal sensible gains for the conditioned zone with the current coupling rule.</li> </ul>"},{"location":"iso_52016/#algorithm-pseudo_1","title":"Algorithm (pseudo)","text":"<pre><code>q_occ = internal_gains_occupants[building_type_class]['occupants']\nq_app = internal_gains_occupants[building_type_class]['appliances']\nPhi_base = (q_occ*h_occup + q_app*h_app) * a_use        # Eq. (4.7)\nif unconditioned_zones_nearby:\n    Phi_eff = Phi_base\n    for _ in range(list_adj_zones):\n        Phi_eff += Phi_base + (1-b_ztu)*Fztc_ztu_m * Phi_base\n    return float(Phi_eff)\nelse:\n    return float(Phi_base)\n</code></pre>"},{"location":"iso_52016/#44-transmission_heat_transfer_coefficient_iso13789","title":"4.4 <code>transmission_heat_transfer_coefficient_ISO13789(...)</code>","text":"<p>Physical purpose: compute transmission coupling between a thermally conditioned zone (ztc) and adjacent unconditioned zone(s) (ztu) per ISO 13789, including the ventilation of the unconditioned zone to the outside.</p> <p>Important: In the snippet, <code>building_object</code>, <code>orient_all_zones</code>, and <code>volume_all_zones</code> are referenced but not passed. In practice you should pass the adjacent zone object (or the whole <code>BUI</code>) and extract what you need locally. The equations below describe the intended physics.</p>"},{"location":"iso_52016/#signature-as-provided","title":"Signature (as provided)","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(adj_zone, n_ue=0.5, qui=0):\n    ...\n    return H_ztu_tot, b_ztu_m\n</code></pre>"},{"location":"iso_52016/#concepts-notation","title":"Concepts &amp; Notation","text":"<ul> <li>\\(H_{tr}\\) is decomposed as: [ H_{tr} = H_d + H_g + H_u + H_a \\tag{4.9} ] with:</li> <li>\\(H_d\\): direct envelope transmission to exterior,</li> <li>\\(H_g\\): ground transmission,</li> <li>\\(H_u\\): via unconditioned space,</li> <li>\\(H_a\\): to adjacent buildings (not used here).</li> </ul>"},{"location":"iso_52016/#step-1-transmission-conditioned-unconditioned","title":"Step 1 \u2014 Transmission conditioned \u2192 unconditioned","text":"<p>For the interface between ztc and ztu: [ H_{d,zt{\\text -}ztu} = \\sum_{k \\in\\mathcal{E}_{zt{\\text -}ztu}} U_k\\,A_k \\tag{4.10} ] where the set \\(\\mathcal{E}_{zt{\\text -}ztu}\\) are elements on the shared boundary.</p>"},{"location":"iso_52016/#step-2-transmission-unconditioned-exterior","title":"Step 2 \u2014 Transmission unconditioned \u2192 exterior","text":"<p>For ztu walls not shared with ztc (i.e., exposed or to other media): [ H_{d,ztu{\\text -}ext} = \\sum_{k \\in\\mathcal{E}_{ztu{\\text -}ext}} U_k\\,A_k \\tag{4.11} ]</p>"},{"location":"iso_52016/#step-3-ventilation-of-unconditioned-zone","title":"Step 3 \u2014 Ventilation of unconditioned zone","text":"<p>ISO 13789 suggests using air change rate \\(n_{ue}\\) <code>[h\u207b\u00b9]</code> for ztu \u2192 outside. Let \\(V_u\\) <code>[m\u00b3]</code> be ztu air volume. Define: [ q_{ue} = V_u\\,n_{ue} \\quad [\\text{m}^3/\\text{h}], \\qquad q_{iu} = q_{i\\to u} \\quad [\\text{m}^3/\\text{h}] \\text{ (often set to 0 to avoid overestimation)} \\tag{4.12a} ] Use the standard \\(\\rho c\\) factor \\(\\approx 0.33\\) <code>[Wh\u00b7m\u207b\u00b3\u00b7K\u207b\u00b9]</code> for flows expressed in m\u00b3\u00b7h\u207b\u00b9: [ H_{ve,ue} = 0.33\\,q_{ue}, \\qquad H_{ve,iu} = 0.33\\,q_{iu} \\tag{4.12b} ] By default in the code: \\(q_{iu} = 0\\).</p>"},{"location":"iso_52016/#step-4-aggregate-coupling-terms","title":"Step 4 \u2014 Aggregate coupling terms","text":"<p>[ H_{ue} = H_{d,ztu{\\text -}ext} + H_{ve,ue}, \\qquad H_{iu} = H_{d,zt{\\text -}ztu} + H_{ve,iu} \\tag{4.12c} ] Total ztu coupling: [ H_{ztu,tot} = H_{iu} + H_{ue} \\tag{4.12d} ]</p> <p>Adjustment factor \\(b_{ztu,m}\\) (ISO 13789 monthly convention): [ b_{ztu,m} = \\frac{H_{ue}}{H_{ue} + H_{iu}} = \\frac{H_{ue}}{H_{ztu,tot}} \\tag{4.13} ] \\(b_{ztu,m}\\in[0,1]\\) measures how much the unconditioned zone is \u201canchored\u201d to the outside rather than to the conditioned neighbor.</p>"},{"location":"iso_52016/#output_1","title":"Output","text":"<ul> <li><code>H_ztu_tot</code> <code>[W\u00b7K\u207b\u00b9]</code> \u2014 total coupling of the unconditioned zone.</li> <li><code>b_ztu_m</code> <code>[-]</code> \u2014 monthly factor (in the current code computed once from static inputs).</li> </ul>"},{"location":"iso_52016/#practical-extraction-with-your-bui-structure","title":"Practical extraction with your <code>BUI</code> structure","text":"<ul> <li>For a given unconditioned zone <code>adj_i</code>:</li> <li>Build sets:<ul> <li>\\(\\mathcal{E}_{zt{\\text -}ztu}\\): elements in <code>adj_i</code> whose <code>orientation_elements</code> match the interface direction to the conditioned zone (your code uses equality tests by <code>NV/SV/EV/WV/HOR</code>).</li> <li>\\(\\mathcal{E}_{ztu{\\text -}ext}\\): elements in <code>adj_i</code> not on the interface.</li> </ul> </li> <li>Use <code>adj_i.volume</code> \u2192 \\(V_u\\).  </li> <li>Pick <code>n_ue</code> from <code>df_n_ue</code> by air-tightness class or keep default <code>0.5 h\u207b\u00b9</code>.</li> </ul>"},{"location":"iso_52016/#algorithm-pseudo-robust-version","title":"Algorithm (pseudo; robust version)","text":"<pre><code>def transmission_heat_transfer_coefficient_ISO13789(BUI, adj_zone_name, n_ue=0.5, qui=0):\n    adj = get_adj_zone(BUI, adj_zone_name)\n    A = np.asarray(adj[\"area_facade_elements\"], dtype=float)\n    U = np.asarray(adj[\"transmittance_U_elements\"], dtype=float)\n    ORI = np.asarray(adj[\"orientation_elements\"])\n    # Define which orientations correspond to zt-ztu interface (project specific rule):\n    mask_interface = is_interface_to_conditioned_zone(ORI, adj, BUI)   # boolean mask\n    Hd_zt_ztu  = float(np.sum(A[mask_interface] * U[mask_interface]))   # Eq. (4.10)\n    Hd_ztu_ext = float(np.sum(A[~mask_interface] * U[~mask_interface])) # Eq. (4.11)\n\n    # Ventilation terms (Eq. 4.12)\n    Vu = float(adj[\"volume\"])\n    que = Vu * n_ue\n    Hve_ue = 0.33 * que\n    Hve_iu = 0.33 * float(qui)\n\n    Hue = Hd_ztu_ext + Hve_ue\n    Hiu = Hd_zt_ztu + Hve_iu\n    Hztu_tot = Hue + Hiu                                 # Eq. (4.12d)\n    b_ztu_m  = Hue / Hztu_tot if Hztu_tot &gt; 0 else 1.0   # Eq. (4.13)\n    return float(Hztu_tot), float(b_ztu_m)\n</code></pre>"},{"location":"iso_52016/#edge-cases","title":"Edge Cases","text":"<ul> <li>If <code>A</code>/<code>U</code> vectors contain dtype=object (as in your snippet), cast explicitly to <code>float</code>.</li> <li>If <code>Hztu_tot = 0</code> (degenerate geometry), define <code>b_ztu_m = 1.0</code> by convention (fully outdoor-anchored).</li> </ul>"},{"location":"iso_52016/#5-multizone-adjacent-zone-coupling-computational-flow","title":"5) Multizone &amp; Adjacent-Zone Coupling \u2014 Computational Flow","text":"<pre><code>graph TD\n  A[BUI dict] --&gt; B(global_inputs.py)\n  A --&gt; C(generate_profile.py)\n  A --&gt; D(ventilation.py)\n\n  C --&gt; C1[Hourly profiles h_* (0..1)]\n  B --&gt; D1[df_n_ue, constants]\n  D1 --&gt; D3\n  C1 --&gt; D2\n\n  subgraph Ventilation &amp; Gains (ventilation.py)\n    D2[heat_transfer_coefficient_by_ventilation]\\nH_ve via ISO 16798-7 or occupancy\n    D3[transmission_heat_transfer_coefficient_ISO13789]\\nH_ztu_tot, b_ztu_m\n    D4[internal_gains]\\nPhi_int with optional adj-zone spillover\n  end\n\n  D2 --&gt; E[H_ve (W/K)]\n  D3 --&gt; F[b_ztu_m (-)]\n  D4 --&gt; G[Phi_int (W)]\n\n  %% (Future) Energy balance solver (not in scope here)\n  E --&gt; H[(Future: ISO 52016 solver)]\n  F --&gt; H\n  G --&gt; H</code></pre>"},{"location":"iso_52016/#6-variable-glossary-selected","title":"6) Variable Glossary (selected)","text":"Symbol / Name Meaning Units \\(T_z\\), <code>Tz</code> Zone air temperature (indoor) \u00b0C \\(T_e\\), <code>Te</code> Outdoor air temperature \u00b0C \\(u_{site}\\) Site wind speed at window height (per ISO assumptions) m\u00b7s\u207b\u00b9 \\(h_p\\) Parapet height m \\(h_w\\) Window height m \\(h_{path}\\) Window vertical center above floor m \\(h_{w,st}\\) Useful stack height for airing m \\(A_{w,i}\\) Geometric area of window \\(i\\) m\u00b2 \\(R_{w,i}\\) Opening ratio window \\(i\\) \u2013 \\(A_{w,tot}\\) Sum of openable window areas m\u00b2 \\(\\rho_{a,ref}\\) Reference indoor air density kg\u00b7m\u207b\u00b3 \\(\\rho_{a,e}\\) Outdoor density at \\(T_e\\) kg\u00b7m\u207b\u00b3 \\(q_v\\) Airing volumetric flow (single-sided) m\u00b3\u00b7h\u207b\u00b9 \\(H_{ve}\\) Ventilation heat transfer coefficient W\u00b7K\u207b\u00b9 \\(U_k\\) Thermal transmittance of element \\(k\\) W\u00b7m\u207b\u00b2\u00b7K\u207b\u00b9 \\(V_u\\) Air volume of unconditioned zone m\u00b3 \\(n_{ue}\\) Air change rate ztu\u2013exterior h\u207b\u00b9 \\(q_{ue}\\) Flow ztu\u2013exterior \\(=V_u n_{ue}\\) m\u00b3\u00b7h\u207b\u00b9 \\(H_{ve,ue}\\) Vent. conductance ztu\u2013exterior W\u00b7K\u207b\u00b9 \\(H_{d,zt{\\text -}ztu}\\) Transmission cond\u2192uncond W\u00b7K\u207b\u00b9 \\(H_{d,ztu{\\text -}ext}\\) Transmission uncond\u2192ext W\u00b7K\u207b\u00b9 \\(H_{ztu,tot}\\) Total ztu coupling W\u00b7K\u207b\u00b9 \\(b_{ztu,m}\\) Adjustment factor of ztu \u2013 \\(\\Phi_{int}\\) Internal gains (sensible) W \\(q_{occ}, q_{app}\\) Gains densities (occ/app) W\u00b7m\u207b\u00b2"},{"location":"iso_52016/#7-implementation-notes-robustness","title":"7) Implementation Notes &amp; Robustness","text":"<ul> <li>Type safety: many arrays in <code>BUI</code> are <code>dtype=object</code>. Cast to <code>np.asarray(..., dtype=float)</code> before algebra.</li> <li>Orientation logic: To identify interface elements for \\(H_{d,zt{\\text -}ztu}\\), define a clear mapping between <code>building_surface[*].name_adj_zone</code> and the <code>adjacent_zones[*].name</code> and use that to split \\(\\mathcal{E}_{zt{\\text -}ztu}\\) vs \\(\\mathcal{E}_{ztu{\\text -}ext}\\). Avoid relying only on cardinal labels like <code>NV/SV/...</code> when adjacency is explicit in the <code>BUI</code>.</li> <li>Energy conservation: The current <code>internal_gains</code> implementation adds spillover per adjacent zone. If you need strict conservation, change Eq. (4.8) to a partitioning where the sum of delivered gains across all coupled domains equals the source generation.</li> <li>Units consistency: Eq. (4.12b) uses the common shortcut <code>0.33</code> <code>[Wh\u00b7m\u207b\u00b3\u00b7K\u207b\u00b9]</code> for flows in m\u00b3\u00b7h\u207b\u00b9. If you operate on SI <code>[s]</code>, convert accordingly \\( \\frac{\\rho c}{3600} \\).</li> <li>Altitude: The simple density correction used in Eq. (4.2) is adequate for building simulation. For high-altitude sites you may want a full barometric formula.</li> </ul>"},{"location":"iso_52016/#8-worked-example-hooks-with-your-bui","title":"8) Worked Example Hooks (with your <code>BUI</code>)","text":"<p>Below is a minimal sketch showing how to call the three core functions consistently with your schema.</p> <pre><code># Pseudocode (assumes the functions accept BUI as 'building_object')\nfrom ventilation import VentilationInternalGains, transmission_heat_transfer_coefficient_ISO13789\n\n# --- Ventilation H_ve (ISO airing)\nTz = 20.0   # \u00b0C\nTe = 5.0    # \u00b0C\nu  = 2.5    # m/s\nHve = VentilationInternalGains.heat_transfer_coefficient_by_ventilation(\n    building_object=BUI, Tz=Tz, Te=Te, u_site=u, type_ventilation=\"temp_wind\"\n)\n\n# --- Internal gains (W)\nPhi_int = VentilationInternalGains.internal_gains(\n    building_type_class=BUI[\"building\"][\"building_type_class\"],\n    a_use=BUI[\"building\"][\"net_floor_area\"],\n    unconditioned_zones_nearby=True,\n    list_adj_zones=len(BUI[\"adjacent_zones\"]),   # pass an int here\n    Fztc_ztu_m=1.0,\n    b_ztu=0.6,\n    h_occup=0.8, h_app=0.6\n)\n\n# --- Adjacent zone coupling (W/K) for 'adj_1'\nHztu_tot_1, b_ztu_1 = transmission_heat_transfer_coefficient_ISO13789(\n    adj_zone=BUI[\"adjacent_zones\"][0],  # or pass BUI + name, per your refactor\n    n_ue=0.5, qui=0.0\n)\n</code></pre>"},{"location":"iso_52016/#9-testing-checklist","title":"9) Testing Checklist","text":"<ul> <li>No windows \u2192 <code>H_ve=0</code> (temp_wind branch).</li> <li>All <code>Rw_arg_i=0</code> \u2192 <code>H_ve=0</code>.</li> <li>High wind, small \u0394T vs low wind, high \u0394T \u2192 Eq. (4.4) switches between wind/stack terms.</li> <li><code>n_ue</code> sweep (0.1 \u2192 10 h\u207b\u00b9) increases \\(H_{ve,ue}\\) linearly, thus \\(b_{ztu,m}\\) approaches 1.</li> <li><code>qui&gt;0</code> lifts \\(H_{iu}\\), thus \\(b_{ztu,m}\\downarrow\\).</li> <li>Profiles: Verify daily cycles in <code>generate_profile.py</code> and holiday flips.</li> </ul>"},{"location":"iso_52016/#10-known-gaps-future-improvements","title":"10) Known Gaps (future improvements)","text":"<ul> <li>Window cross-ventilation and leakage paths in <code>ventilation.py</code> (not yet implemented).</li> <li>Mechanical ventilation (specific supply/exhaust flow schedule) placeholder.</li> <li>Transparent interface terms in <code>ISO13789</code> when the partition is glazed.</li> <li>Time-varying \\(b_{ztu,m}\\) (currently returned as a scalar unless you process it per month).</li> </ul>"},{"location":"iso_52016_input_check/","title":"ISO 52016 Input Check","text":"<p>The data provided before being used for the simulation are processed and evaluated to be considered fit for the simulation. This process includes a series of checks that allow to identify any potential errors.  The following controls are applied:</p>"},{"location":"iso_52016_input_check/#thermal-and-adjacent-zone","title":"Thermal and Adjacent Zone","text":"<p>Uno degli errori pi\u00f9 caratteristici pu\u00f2 essere quello di immetere dei valori errati di superficie della parete di confine tra la zona termica e la zona non termica. Un esempio \u00e8 quello di dare dei valori pi\u00f9 alti della superificie della parete nella zona non termica rispetto alla superificie della parete nella zona termica. In questo caso se il controllo risulta essere negativo allora il tool imposta il valore del superificie della zona non termica uguale a quello della zona termica.  Qui voglio dire che sebbene la superficie di contatto \u00e8 la stessa pu`o succedere che la parete della zona termica sia o totlamente a contatto con la zon non termica o solamente una parte a contatto con la zona termica   </p>"},{"location":"iso_52016_input_check/#quality-check-of-system-inputs","title":"Quality check of system inputs:","text":""},{"location":"iso_52016_input_check/#check_heating_system_inputs-function","title":"<code>check_heating_system_inputs</code> Function","text":"<p>This function validates and normalizes the input configuration for the heating system. It performs the following checks:</p> <ol> <li>TB14 Table: </li> <li>If a custom <code>TB14</code> DataFrame is provided, it is used.</li> <li> <p>Otherwise, the default <code>TB14</code> from <code>global_inputs.py</code> is used.</p> </li> <li> <p>Emitter Type Validation:</p> </li> <li> <p>If the <code>emitter_type</code> is not found in the selected <code>TB14</code> table, it is automatically set to the first available emitter type, and a warning message is generated.</p> </li> <li> <p>Generator Flow Temperature Control Type (<code>gen_flow_temp_control_type</code>):</p> </li> <li>Type A: Requires <code>gen_outdoor_temp_data</code> as a DataFrame. If not provided, it switches to <code>Type B</code> and generates a warning.</li> <li>Type C: If <code>\u03b8HW_gen_flw_const</code> is not provided, it defaults to <code>50</code> and a warning is shown.</li> <li>Invalid Control Type: Any other values are automatically set to <code>Type B</code>.</li> </ol> <p>The function returns: - The selected <code>TB14</code> table. - The validated <code>emitter_type</code>. - A list of messages about any changes or validations. - The normalized input configuration.</p>"}]}